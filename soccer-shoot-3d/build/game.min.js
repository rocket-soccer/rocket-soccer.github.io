// threejs.org/license
(function(l,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports):"function"===typeof define&&define.amd?define(["exports"],ea):ea(l.THREE={})})(this,function(l){function ea(){}function z(a,b){this.x=a||0;this.y=b||0}function J(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function ha(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1}function p(a,
b,c){this.x=a||0;this.y=b||0;this.z=c||0}function na(){this.elements=[1,0,0,0,1,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function T(a,b,c,d,e,f,g,h,k,m){Object.defineProperty(this,"id",{value:Df++});this.uuid=K.generateUUID();this.name="";this.image=void 0!==a?a:T.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:T.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:1001;this.wrapT=void 0!==d?d:1001;this.magFilter=void 0!==
e?e:1006;this.minFilter=void 0!==f?f:1008;this.anisotropy=void 0!==k?k:1;this.format=void 0!==g?g:1023;this.type=void 0!==h?h:1009;this.offset=new z(0,0);this.repeat=new z(1,1);this.center=new z(0,0);this.rotation=0;this.matrixAutoUpdate=!0;this.matrix=new na;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==m?m:3E3;this.version=0;this.onUpdate=null}function aa(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1}function hb(a,
b,c){this.width=a;this.height=b;this.scissor=new aa(0,0,a,b);this.scissorTest=!1;this.viewport=new aa(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=1006);this.texture=new T(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.texture.generateMipmaps=void 0!==c.generateMipmaps?c.generateMipmaps:!0;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.depthTexture=void 0!==c.depthTexture?
c.depthTexture:null}function Ib(a,b,c){hb.call(this,a,b,c);this.activeMipMapLevel=this.activeCubeFace=0}function ib(a,b,c,d,e,f,g,h,k,m,t,n){T.call(this,null,f,g,h,k,m,d,e,t,n);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:1003;this.minFilter=void 0!==m?m:1003;this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1}function Ua(a,b){this.min=void 0!==a?a:new p(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new p(-Infinity,-Infinity,-Infinity)}function Ea(a,b){this.center=void 0!==
a?a:new p;this.radius=void 0!==b?b:0}function Oa(a,b){this.normal=void 0!==a?a:new p(1,0,0);this.constant=void 0!==b?b:0}function od(a,b,c,d,e,f){this.planes=[void 0!==a?a:new Oa,void 0!==b?b:new Oa,void 0!==c?c:new Oa,void 0!==d?d:new Oa,void 0!==e?e:new Oa,void 0!==f?f:new Oa]}function F(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)}function Rd(){function a(e,f){!1!==c&&(d(e,f),b.requestAnimationFrame(a))}var b=null,c=!1,d=null;return{start:function(){!0!==c&&null!==d&&(b.requestAnimationFrame(a),
c=!0)},stop:function(){c=!1},setAnimationLoop:function(a){d=a},setContext:function(a){b=a}}}function Ef(a){function b(b,c){var d=b.array,e=b.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW,h=a.createBuffer();a.bindBuffer(c,h);a.bufferData(c,d,e);b.onUploadCallback();c=a.FLOAT;d instanceof Float32Array?c=a.FLOAT:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?c=a.UNSIGNED_SHORT:d instanceof Int16Array?c=a.SHORT:d instanceof
Uint32Array?c=a.UNSIGNED_INT:d instanceof Int32Array?c=a.INT:d instanceof Int8Array?c=a.BYTE:d instanceof Uint8Array&&(c=a.UNSIGNED_BYTE);return{buffer:h,type:c,bytesPerElement:d.BYTES_PER_ELEMENT,version:b.version}}var c=new WeakMap;return{get:function(a){a.isInterleavedBufferAttribute&&(a=a.data);return c.get(a)},remove:function(b){b.isInterleavedBufferAttribute&&(b=b.data);var d=c.get(b);d&&(a.deleteBuffer(d.buffer),c.delete(b))},update:function(d,e){d.isInterleavedBufferAttribute&&(d=d.data);
var f=c.get(d);if(void 0===f)c.set(d,b(d,e));else if(f.version<d.version){var g=d,h=g.array,k=g.updateRange;a.bindBuffer(e,f.buffer);!1===g.dynamic?a.bufferData(e,h,a.STATIC_DRAW):-1===k.count?a.bufferSubData(e,0,h):0===k.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(a.bufferSubData(e,k.offset*h.BYTES_PER_ELEMENT,h.subarray(k.offset,k.offset+k.count)),k.count=
-1);f.version=d.version}}}}function jb(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||jb.DefaultOrder}function Sd(){this.mask=1}function B(){Object.defineProperty(this,"id",{value:Ff++});this.uuid=K.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=B.DefaultUp.clone();var a=new p,b=new jb,c=new ha,d=new p(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,
{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelViewMatrix:{value:new J},normalMatrix:{value:new na}});this.matrix=new J;this.matrixWorld=new J;this.matrixAutoUpdate=B.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Sd;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}}function Pa(){B.call(this);this.type="Camera";this.matrixWorldInverse=
new J;this.projectionMatrix=new J;this.projectionMatrixInverse=new J}function Jb(a,b,c,d,e,f){Pa.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()}function Va(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d&&d.isVector3?d:new p;this.vertexNormals=Array.isArray(d)?d:[];this.color=e&&e.isColor?e:new F;this.vertexColors=Array.isArray(e)?e:[];this.materialIndex=
void 0!==f?f:0}function M(){Object.defineProperty(this,"id",{value:Gf+=2});this.uuid=K.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=
!1}function Q(a,b,c){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="";this.array=a;this.itemSize=b;this.count=void 0!==a?a.length/b:0;this.normalized=!0===c;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function qc(a,b,c){Q.call(this,new Int8Array(a),b,c)}function rc(a,b,c){Q.call(this,new Uint8Array(a),b,c)}function sc(a,b,c){Q.call(this,new Uint8ClampedArray(a),b,c)}function tc(a,b,c){Q.call(this,new Int16Array(a),
b,c)}function kb(a,b,c){Q.call(this,new Uint16Array(a),b,c)}function uc(a,b,c){Q.call(this,new Int32Array(a),b,c)}function lb(a,b,c){Q.call(this,new Uint32Array(a),b,c)}function A(a,b,c){Q.call(this,new Float32Array(a),b,c)}function vc(a,b,c){Q.call(this,new Float64Array(a),b,c)}function De(){this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=
this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function Ee(a){if(0===a.length)return-Infinity;for(var b=a[0],c=1,d=a.length;c<d;++c)a[c]>b&&(b=a[c]);return b}function I(){Object.defineProperty(this,"id",{value:Hf+=2});this.uuid=K.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity};this.userData={}}
function Kb(a,b,c,d,e,f){M.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new mb(a,b,c,d,e,f));this.mergeVertices()}function mb(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,l,S,E,If){var r=f/S,O=g/E,v=f/2,y=g/2,w=l/2;g=S+1;var x=E+1,D=f=0,G,z,A=new p;for(z=0;z<x;z++){var B=z*O-y;for(G=0;G<g;G++)A[a]=(G*r-v)*d,A[b]=B*e,A[c]=w,m.push(A.x,A.y,A.z),A[a]=0,A[b]=0,A[c]=0<l?1:-1,t.push(A.x,A.y,A.z),n.push(G/
S),n.push(1-z/E),f+=1}for(z=0;z<E;z++)for(G=0;G<S;G++)a=q+G+g*(z+1),b=q+(G+1)+g*(z+1),c=q+(G+1)+g*z,k.push(q+G+g*z,a,c),k.push(a,b,c),D+=6;h.addGroup(u,D,If);u+=D;q+=f}I.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var h=this;a=a||1;b=b||1;c=c||1;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var k=[],m=[],t=[],n=[],q=0,u=0;g("z","y","x",-1,-1,c,b,a,f,e,0);g("z","y","x",1,-1,c,b,-a,f,e,1);g("x","z","y",
1,1,a,c,b,d,f,2);g("x","z","y",1,-1,a,c,-b,d,f,3);g("x","y","z",1,-1,a,b,c,d,e,4);g("x","y","z",-1,-1,a,b,-c,d,e,5);this.setIndex(k);this.addAttribute("position",new A(m,3));this.addAttribute("normal",new A(t,3));this.addAttribute("uv",new A(n,2))}function wc(a,b,c,d){M.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new nb(a,b,c,d));this.mergeVertices()}function nb(a,b,c,d){I.call(this);this.type="PlaneBufferGeometry";
this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};a=a||1;b=b||1;var e=a/2,f=b/2;c=Math.floor(c)||1;d=Math.floor(d)||1;var g=c+1,h=d+1,k=a/c,m=b/d,t=[],n=[],q=[],u=[];for(a=0;a<h;a++){var r=a*m-f;for(b=0;b<g;b++)n.push(b*k-e,-r,0),q.push(0,0,1),u.push(b/c),u.push(1-a/d)}for(a=0;a<d;a++)for(b=0;b<c;b++)e=b+g*(a+1),f=b+1+g*(a+1),h=b+1+g*a,t.push(b+g*a,e,h),t.push(e,f,h);this.setIndex(t);this.addAttribute("position",new A(n,3));this.addAttribute("normal",new A(q,3));this.addAttribute("uv",
new A(u,2))}function H(){Object.defineProperty(this,"id",{value:Jf++});this.uuid=K.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.flatShading=!1;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;
this.shadowSide=null;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.dithering=!1;this.alphaTest=0;this.premultipliedAlpha=!1;this.overdraw=0;this.visible=!0;this.userData={};this.needsUpdate=!0}function ka(a){H.call(this);this.type="MeshBasicMaterial";this.color=new F(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=
0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)}function ua(a){H.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=
1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.uniformsNeedUpdate=!1;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}function ob(a,
b){this.origin=void 0!==a?a:new p;this.direction=void 0!==b?b:new p}function da(a,b,c){this.a=void 0!==a?a:new p;this.b=void 0!==b?b:new p;this.c=void 0!==c?c:new p}function ta(a,b){B.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new I;this.material=void 0!==b?b:new ka({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function Kf(a,b,c,d){function e(a,c){b.buffers.color.setClear(a.r,a.g,a.b,c,d)}var f=new F(0),g=0,h,k,m;return{getClearColor:function(){return f},setClearColor:function(a,
b){f.set(a);g=void 0!==b?b:1;e(f,g)},getClearAlpha:function(){return g},setClearAlpha:function(a){g=a;e(f,g)},render:function(b,d,q,u){d=d.background;null===d?e(f,g):d&&d.isColor&&(e(d,1),u=!0);(a.autoClear||u)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil);d&&d.isCubeTexture?(void 0===m&&(m=new ta(new mb(1,1,1),new ua({uniforms:pb.cube.uniforms,vertexShader:pb.cube.vertexShader,fragmentShader:pb.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1})),m.geometry.removeAttribute("normal"),
m.geometry.removeAttribute("uv"),m.onBeforeRender=function(a,b,c){this.matrixWorld.copyPosition(c.matrixWorld)},c.update(m)),m.material.uniforms.tCube.value=d,b.push(m,m.geometry,m.material,0,null)):d&&d.isTexture&&(void 0===h&&(h=new Jb(-1,1,1,-1,0,1),k=new ta(new nb(2,2),new ka({depthTest:!1,depthWrite:!1,fog:!1})),c.update(k)),k.material.map=d,a.renderBufferDirect(h,null,k.geometry,k.material,k,null))}}}function Lf(a,b,c,d){var e;this.setMode=function(a){e=a};this.render=function(b,d){a.drawArrays(e,
b,d);c.update(d,e)};this.renderInstances=function(f,g,h){if(d.isWebGL2)var k=a;else if(k=b.get("ANGLE_instanced_arrays"),null===k){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}k[d.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](e,g,h,f.maxInstancedCount);c.update(h,e,f.maxInstancedCount)}}function Mf(a,b,c){function d(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,
a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var e,f="undefined"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext,g=void 0!==c.precision?c.precision:"highp",h=d(g);h!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",
h,"instead."),g=h);c=!0===c.logarithmicDepthBuffer;h=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);var k=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=a.getParameter(a.MAX_TEXTURE_SIZE),t=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),n=a.getParameter(a.MAX_VERTEX_ATTRIBS),q=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),u=a.getParameter(a.MAX_VARYING_VECTORS),r=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),l=0<k,y=f||!!b.get("OES_texture_float");return{isWebGL2:f,getMaxAnisotropy:function(){if(void 0!==
e)return e;var c=b.get("EXT_texture_filter_anisotropic");return e=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:d,precision:g,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:k,maxTextureSize:m,maxCubemapSize:t,maxAttributes:n,maxVertexUniforms:q,maxVaryings:u,maxFragmentUniforms:r,vertexTextures:l,floatFragmentTextures:y,floatVertexTextures:l&&y}}function Nf(){function a(){m.value!==d&&(m.value=d,m.needsUpdate=0<e);c.numPlanes=e;c.numIntersection=0}function b(a,
b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){g=m.value;if(!0!==e||null===g){e=d+4*f;b=b.matrixWorldInverse;k.getNormalMatrix(b);if(null===g||g.length<e)g=new Float32Array(e);for(e=0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,k),h.normal.toArray(g,d),g[d+3]=h.constant}m.value=g;m.needsUpdate=!0}c.numPlanes=f;return g}var c=this,d=null,e=0,f=!1,g=!1,h=new Oa,k=new na,m={value:null,needsUpdate:!1};this.uniform=m;this.numIntersection=this.numPlanes=0;this.init=function(a,c,g){var h=0!==a.length||
c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return h};this.beginShadows=function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,k,u,r,l){if(!f||null===c||0===c.length||g&&!k)g?b(null):a();else{k=g?0:e;var n=4*k,t=r.clippingState||null;m.value=t;t=b(c,u,n,l);for(c=0;c!==n;++c)t[c]=d[c];r.clippingState=t;this.numIntersection=h?this.numPlanes:0;this.numPlanes+=k}}}function Of(a){var b={};return{get:function(c){if(void 0!==b[c])return b[c];switch(c){case "WEBGL_depth_texture":var d=
a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case "EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
break;case "WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=a.getExtension(c)}null===d&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported.");return b[c]=d}}}function Pf(a,b,c){function d(a){var h=a.target;a=e[h.id];null!==a.index&&b.remove(a.index);for(var g in a.attributes)b.remove(a.attributes[g]);h.removeEventListener("dispose",d);delete e[h.id];if(g=f[a.id])b.remove(g),delete f[a.id];
c.memory.geometries--}var e={},f={};return{get:function(a,b){var f=e[b.id];if(f)return f;b.addEventListener("dispose",d);b.isBufferGeometry?f=b:b.isGeometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new I).setFromObject(a)),f=b._bufferGeometry);e[b.id]=f;c.memory.geometries++;return f},update:function(c){var d=c.index,e=c.attributes;null!==d&&b.update(d,a.ELEMENT_ARRAY_BUFFER);for(var f in e)b.update(e[f],a.ARRAY_BUFFER);c=c.morphAttributes;for(f in c){d=c[f];e=0;for(var g=d.length;e<g;e++)b.update(d[e],
a.ARRAY_BUFFER)}},getWireframeAttribute:function(c){var d=f[c.id];if(d)return d;d=[];var e=c.index,g=c.attributes;if(null!==e){e=e.array;g=0;for(var t=e.length;g<t;g+=3){var n=e[g+0],q=e[g+1],u=e[g+2];d.push(n,q,q,u,u,n)}}else for(e=g.position.array,g=0,t=e.length/3-1;g<t;g+=3)n=g+0,q=g+1,u=g+2,d.push(n,q,q,u,u,n);d=new (65535<Ee(d)?lb:kb)(d,1);b.update(d,a.ELEMENT_ARRAY_BUFFER);return f[c.id]=d}}}function Qf(a,b,c,d){var e,f,g;this.setMode=function(a){e=a};this.setIndex=function(a){f=a.type;g=a.bytesPerElement};
this.render=function(b,d){a.drawElements(e,d,f,b*g);c.update(d,e)};this.renderInstances=function(h,k,m){if(d.isWebGL2)var t=a;else if(t=b.get("ANGLE_instanced_arrays"),null===t){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}t[d.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](e,m,f,k*g,h.maxInstancedCount);c.update(m,e,h.maxInstancedCount)}}function Rf(a){var b={frame:0,calls:0,
triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:b,programs:null,autoReset:!0,reset:function(){b.frame++;b.calls=0;b.triangles=0;b.points=0;b.lines=0},update:function(c,d,e){e=e||1;b.calls++;switch(d){case a.TRIANGLES:b.triangles+=c/3*e;break;case a.TRIANGLE_STRIP:case a.TRIANGLE_FAN:b.triangles+=e*(c-2);break;case a.LINES:b.lines+=c/2*e;break;case a.LINE_STRIP:b.lines+=e*(c-1);break;case a.LINE_LOOP:b.lines+=e*c;break;case a.POINTS:b.points+=e*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",
d)}}}}function Sf(a,b){return Math.abs(b[1])-Math.abs(a[1])}function Tf(a){var b={},c=new Float32Array(8);return{update:function(d,e,f,g){var h=d.morphTargetInfluences,k=h.length;d=b[e.id];if(void 0===d){d=[];for(var m=0;m<k;m++)d[m]=[m,0];b[e.id]=d}var t=f.morphTargets&&e.morphAttributes.position;f=f.morphNormals&&e.morphAttributes.normal;for(m=0;m<k;m++){var n=d[m];0!==n[1]&&(t&&e.removeAttribute("morphTarget"+m),f&&e.removeAttribute("morphNormal"+m))}for(m=0;m<k;m++)n=d[m],n[0]=m,n[1]=h[m];d.sort(Sf);
for(m=0;8>m;m++){if(n=d[m])if(h=n[0],k=n[1]){t&&e.addAttribute("morphTarget"+m,t[h]);f&&e.addAttribute("morphNormal"+m,f[h]);c[m]=k;continue}c[m]=0}g.getUniforms().setValue(a,"morphTargetInfluences",c)}}}function Uf(a,b){var c={};return{update:function(d){var e=b.render.frame,f=d.geometry,g=a.get(d,f);c[g.id]!==e&&(f.isGeometry&&g.updateFromObject(d),a.update(g),c[g.id]=e);return g},dispose:function(){c={}}}}function Wa(a,b,c,d,e,f,g,h,k,m){a=void 0!==a?a:[];T.call(this,a,void 0!==b?b:301,c,d,e,f,
g,h,k,m);this.flipY=!1}function Lb(a,b,c){var d=a[0];if(0>=d||0<d)return a;var e=b*c,f=Fe[e];void 0===f&&(f=new Float32Array(e),Fe[e]=f);if(0!==b)for(d.toArray(f,0),d=1,e=0;d!==b;++d)e+=c,a[d].toArray(f,e);return f}function Y(a,b){if(a.length!==b.length)return!1;for(var c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}function ra(a,b){for(var c=0,d=b.length;c<d;c++)a[c]=b[c]}function Ge(a,b){var c=He[b];void 0===c&&(c=new Int32Array(b),He[b]=c);for(var d=0;d!==b;++d)c[d]=a.allocTextureUnit();
return c}function Vf(a,b){var c=this.cache;c[0]!==b&&(a.uniform1f(this.addr,b),c[0]=b)}function Wf(a,b){var c=this.cache;c[0]!==b&&(a.uniform1i(this.addr,b),c[0]=b)}function Xf(a,b){var c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y)a.uniform2f(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y}else Y(c,b)||(a.uniform2fv(this.addr,b),ra(c,b))}function Yf(a,b){var c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)a.uniform3f(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z}else if(void 0!==
b.r){if(c[0]!==b.r||c[1]!==b.g||c[2]!==b.b)a.uniform3f(this.addr,b.r,b.g,b.b),c[0]=b.r,c[1]=b.g,c[2]=b.b}else Y(c,b)||(a.uniform3fv(this.addr,b),ra(c,b))}function Zf(a,b){var c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)a.uniform4f(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w}else Y(c,b)||(a.uniform4fv(this.addr,b),ra(c,b))}function $f(a,b){var c=this.cache,d=b.elements;void 0===d?Y(c,b)||(a.uniformMatrix2fv(this.addr,!1,b),ra(c,b)):Y(c,d)||(Ie.set(d),
a.uniformMatrix2fv(this.addr,!1,Ie),ra(c,d))}function ag(a,b){var c=this.cache,d=b.elements;void 0===d?Y(c,b)||(a.uniformMatrix3fv(this.addr,!1,b),ra(c,b)):Y(c,d)||(Je.set(d),a.uniformMatrix3fv(this.addr,!1,Je),ra(c,d))}function bg(a,b){var c=this.cache,d=b.elements;void 0===d?Y(c,b)||(a.uniformMatrix4fv(this.addr,!1,b),ra(c,b)):Y(c,d)||(Ke.set(d),a.uniformMatrix4fv(this.addr,!1,Ke),ra(c,d))}function cg(a,b,c){var d=this.cache,e=c.allocTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e);c.setTexture2D(b||
Le,e)}function dg(a,b,c){var d=this.cache,e=c.allocTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e);c.setTextureCube(b||Me,e)}function Ne(a,b){var c=this.cache;Y(c,b)||(a.uniform2iv(this.addr,b),ra(c,b))}function Oe(a,b){var c=this.cache;Y(c,b)||(a.uniform3iv(this.addr,b),ra(c,b))}function Pe(a,b){var c=this.cache;Y(c,b)||(a.uniform4iv(this.addr,b),ra(c,b))}function eg(a){switch(a){case 5126:return Vf;case 35664:return Xf;case 35665:return Yf;case 35666:return Zf;case 35674:return $f;case 35675:return ag;
case 35676:return bg;case 35678:case 36198:return cg;case 35680:return dg;case 5124:case 35670:return Wf;case 35667:case 35671:return Ne;case 35668:case 35672:return Oe;case 35669:case 35673:return Pe}}function fg(a,b){var c=this.cache;Y(c,b)||(a.uniform1fv(this.addr,b),ra(c,b))}function gg(a,b){var c=this.cache;Y(c,b)||(a.uniform1iv(this.addr,b),ra(c,b))}function hg(a,b){var c=this.cache;b=Lb(b,this.size,2);Y(c,b)||(a.uniform2fv(this.addr,b),this.updateCache(b))}function ig(a,b){var c=this.cache;
b=Lb(b,this.size,3);Y(c,b)||(a.uniform3fv(this.addr,b),this.updateCache(b))}function jg(a,b){var c=this.cache;b=Lb(b,this.size,4);Y(c,b)||(a.uniform4fv(this.addr,b),this.updateCache(b))}function kg(a,b){var c=this.cache;b=Lb(b,this.size,4);Y(c,b)||(a.uniformMatrix2fv(this.addr,!1,b),this.updateCache(b))}function lg(a,b){var c=this.cache;b=Lb(b,this.size,9);Y(c,b)||(a.uniformMatrix3fv(this.addr,!1,b),this.updateCache(b))}function mg(a,b){var c=this.cache;b=Lb(b,this.size,16);Y(c,b)||(a.uniformMatrix4fv(this.addr,
!1,b),this.updateCache(b))}function ng(a,b,c){var d=this.cache,e=b.length,f=Ge(c,e);!1===Y(d,f)&&(a.uniform1iv(this.addr,f),ra(d,f));for(a=0;a!==e;++a)c.setTexture2D(b[a]||Le,f[a])}function og(a,b,c){var d=this.cache,e=b.length,f=Ge(c,e);!1===Y(d,f)&&(a.uniform1iv(this.addr,f),ra(d,f));for(a=0;a!==e;++a)c.setTextureCube(b[a]||Me,f[a])}function pg(a){switch(a){case 5126:return fg;case 35664:return hg;case 35665:return ig;case 35666:return jg;case 35674:return kg;case 35675:return lg;case 35676:return mg;
case 35678:return ng;case 35680:return og;case 5124:case 35670:return gg;case 35667:case 35671:return Ne;case 35668:case 35672:return Oe;case 35669:case 35673:return Pe}}function qg(a,b,c){this.id=a;this.addr=c;this.cache=[];this.setValue=eg(b.type)}function Qe(a,b,c){this.id=a;this.addr=c;this.cache=[];this.size=b.size;this.setValue=pg(b.type)}function Re(a){this.id=a;this.seq=[];this.map={}}function $a(a,b,c){this.seq=[];this.map={};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=
0;d<c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,k=h.length;for(Ud.lastIndex=0;;){var m=Ud.exec(h),t=Ud.lastIndex,n=m[1],q=m[3];"]"===m[2]&&(n|=0);if(void 0===q||"["===q&&t+2===k){h=g;e=void 0===q?new qg(n,e,f):new Qe(n,e,f);h.seq.push(e);h.map[e.id]=e;break}else q=g.map[n],void 0===q&&(q=new Re(n),n=g,g=q,n.seq.push(g),n.map[g.id]=g),g=q}}}function rg(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}function Se(a,b,c){var d=
a.createShader(b);a.shaderSource(d,c);a.compileShader(d);!1===a.getShaderParameter(d,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==a.getShaderInfoLog(d)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",b===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(d),rg(c));return d}function Te(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];
case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a);}}function Vd(a,b){b=Te(b);return"vec4 "+a+"( vec4 value ) { return "+b[0]+"ToLinear"+b[1]+"; }"}function sg(a,b){b=Te(b);return"vec4 "+a+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"}function tg(a,b){switch(b){case 1:b="Linear";break;case 2:b="Reinhard";break;case 3:b="Uncharted2";break;case 4:b="OptimizedCineon";
break;default:throw Error("unsupported toneMapping: "+b);}return"vec3 "+a+"( vec3 color ) { return "+b+"ToneMapping( color ); }"}function ug(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap&&!b.objectSpaceNormalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":
"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(xc).join("\n")}function vg(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function xc(a){return""!==a}function Ue(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,
b.numHemiLights)}function Ve(a,b){return a.replace(/NUM_CLIPPING_PLANES/g,b.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,b.numClippingPlanes-b.numClipIntersection)}function Wd(a){return a.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(a,c){a=U[c];if(void 0===a)throw Error("Can not resolve #include <"+c+">");return Wd(a)})}function We(a){return a.replace(/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,c,d,e){a="";for(c=parseInt(c);c<
parseInt(d);c++)a+=e.replace(/\[ i \]/g,"[ "+c+" ]");return a})}function wg(a,b,c,d,e,f,g){var h=a.context,k=d.defines,m=e.vertexShader,t=e.fragmentShader,n="SHADOWMAP_TYPE_BASIC";1===f.shadowMapType?n="SHADOWMAP_TYPE_PCF":2===f.shadowMapType&&(n="SHADOWMAP_TYPE_PCF_SOFT");var q="ENVMAP_TYPE_CUBE",u="ENVMAP_MODE_REFLECTION",r="ENVMAP_BLENDING_MULTIPLY";if(f.envMap){switch(d.envMap.mapping){case 301:case 302:q="ENVMAP_TYPE_CUBE";break;case 306:case 307:q="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:q=
"ENVMAP_TYPE_EQUIREC";break;case 305:q="ENVMAP_TYPE_SPHERE"}switch(d.envMap.mapping){case 302:case 304:u="ENVMAP_MODE_REFRACTION"}switch(d.combine){case 0:r="ENVMAP_BLENDING_MULTIPLY";break;case 1:r="ENVMAP_BLENDING_MIX";break;case 2:r="ENVMAP_BLENDING_ADD"}}var l=0<a.gammaFactor?a.gammaFactor:1,y=g.isWebGL2?"":ug(d.extensions,f,b),p=vg(k),w=h.createProgram();d.isRawShaderMaterial?(k=[p].filter(xc).join("\n"),0<k.length&&(k+="\n"),b=[y,p].filter(xc).join("\n"),0<b.length&&(b+="\n")):(k=["precision "+
f.precision+" float;","precision "+f.precision+" int;","#define SHADER_NAME "+e.name,p,f.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+l,"#define MAX_BONES "+f.maxBones,f.useFog&&f.fog?"#define USE_FOG":"",f.useFog&&f.fogExp?"#define FOG_EXP2":"",f.map?"#define USE_MAP":"",f.envMap?"#define USE_ENVMAP":"",f.envMap?"#define "+u:"",f.lightMap?"#define USE_LIGHTMAP":"",f.aoMap?"#define USE_AOMAP":"",f.emissiveMap?"#define USE_EMISSIVEMAP":"",f.bumpMap?"#define USE_BUMPMAP":
"",f.normalMap?"#define USE_NORMALMAP":"",f.normalMap&&f.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",f.displacementMap&&f.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",f.specularMap?"#define USE_SPECULARMAP":"",f.roughnessMap?"#define USE_ROUGHNESSMAP":"",f.metalnessMap?"#define USE_METALNESSMAP":"",f.alphaMap?"#define USE_ALPHAMAP":"",f.vertexColors?"#define USE_COLOR":"",f.flatShading?"#define FLAT_SHADED":"",f.skinning?"#define USE_SKINNING":"",f.useVertexTexture?"#define BONE_TEXTURE":
"",f.morphTargets?"#define USE_MORPHTARGETS":"",f.morphNormals&&!1===f.flatShading?"#define USE_MORPHNORMALS":"",f.doubleSided?"#define DOUBLE_SIDED":"",f.flipSided?"#define FLIP_SIDED":"",f.shadowMapEnabled?"#define USE_SHADOWMAP":"",f.shadowMapEnabled?"#define "+n:"",f.sizeAttenuation?"#define USE_SIZEATTENUATION":"",f.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",f.logarithmicDepthBuffer&&(g.isWebGL2||b.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;",
"uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;",
"\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(xc).join("\n"),b=[y,"precision "+f.precision+" float;","precision "+f.precision+" int;","#define SHADER_NAME "+e.name,p,f.alphaTest?"#define ALPHATEST "+f.alphaTest+
(f.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+l,f.useFog&&f.fog?"#define USE_FOG":"",f.useFog&&f.fogExp?"#define FOG_EXP2":"",f.map?"#define USE_MAP":"",f.envMap?"#define USE_ENVMAP":"",f.envMap?"#define "+q:"",f.envMap?"#define "+u:"",f.envMap?"#define "+r:"",f.lightMap?"#define USE_LIGHTMAP":"",f.aoMap?"#define USE_AOMAP":"",f.emissiveMap?"#define USE_EMISSIVEMAP":"",f.bumpMap?"#define USE_BUMPMAP":"",f.normalMap?"#define USE_NORMALMAP":"",f.normalMap&&f.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":
"",f.specularMap?"#define USE_SPECULARMAP":"",f.roughnessMap?"#define USE_ROUGHNESSMAP":"",f.metalnessMap?"#define USE_METALNESSMAP":"",f.alphaMap?"#define USE_ALPHAMAP":"",f.vertexColors?"#define USE_COLOR":"",f.gradientMap?"#define USE_GRADIENTMAP":"",f.flatShading?"#define FLAT_SHADED":"",f.doubleSided?"#define DOUBLE_SIDED":"",f.flipSided?"#define FLIP_SIDED":"",f.shadowMapEnabled?"#define USE_SHADOWMAP":"",f.shadowMapEnabled?"#define "+n:"",f.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":
"",f.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",f.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",f.logarithmicDepthBuffer&&(g.isWebGL2||b.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",f.envMap&&(g.isWebGL2||b.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==f.toneMapping?"#define TONE_MAPPING":"",0!==f.toneMapping?U.tonemapping_pars_fragment:"",0!==f.toneMapping?tg("toneMapping",f.toneMapping):
"",f.dithering?"#define DITHERING":"",f.outputEncoding||f.mapEncoding||f.envMapEncoding||f.emissiveMapEncoding?U.encodings_pars_fragment:"",f.mapEncoding?Vd("mapTexelToLinear",f.mapEncoding):"",f.envMapEncoding?Vd("envMapTexelToLinear",f.envMapEncoding):"",f.emissiveMapEncoding?Vd("emissiveMapTexelToLinear",f.emissiveMapEncoding):"",f.outputEncoding?sg("linearToOutputTexel",f.outputEncoding):"",f.depthPacking?"#define DEPTH_PACKING "+d.depthPacking:"","\n"].filter(xc).join("\n"));m=Wd(m);m=Ue(m,f);
m=Ve(m,f);t=Wd(t);t=Ue(t,f);t=Ve(t,f);m=We(m);t=We(t);g.isWebGL2&&!d.isRawShaderMaterial&&(g=!1,n=/^\s*#version\s+300\s+es\s*\n/,d.isShaderMaterial&&null!==m.match(n)&&null!==t.match(n)&&(g=!0,m=m.replace(n,""),t=t.replace(n,"")),k="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+k,b=["#version 300 es\n\n#define varying in",g?"":"out highp vec4 pc_fragColor;",g?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+
"\n"+b);t=b+t;m=Se(h,h.VERTEX_SHADER,k+m);t=Se(h,h.FRAGMENT_SHADER,t);h.attachShader(w,m);h.attachShader(w,t);void 0!==d.index0AttributeName?h.bindAttribLocation(w,0,d.index0AttributeName):!0===f.morphTargets&&h.bindAttribLocation(w,0,"position");h.linkProgram(w);f=h.getProgramInfoLog(w).trim();g=h.getShaderInfoLog(m).trim();n=h.getShaderInfoLog(t).trim();u=q=!0;if(!1===h.getProgramParameter(w,h.LINK_STATUS))q=!1,console.error("THREE.WebGLProgram: shader error: ",h.getError(),"gl.VALIDATE_STATUS",
h.getProgramParameter(w,h.VALIDATE_STATUS),"gl.getProgramInfoLog",f,g,n);else if(""!==f)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",f);else if(""===g||""===n)u=!1;u&&(this.diagnostics={runnable:q,material:d,programLog:f,vertexShader:{log:g,prefix:k},fragmentShader:{log:n,prefix:b}});h.deleteShader(m);h.deleteShader(t);var G;this.getUniforms=function(){void 0===G&&(G=new $a(h,w,a));return G};var D;this.getAttributes=function(){if(void 0===D){for(var a={},b=h.getProgramParameter(w,h.ACTIVE_ATTRIBUTES),
c=0;c<b;c++){var d=h.getActiveAttrib(w,c).name;a[d]=h.getAttribLocation(w,d)}D=a}return D};this.destroy=function(){h.deleteProgram(w);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.name=e.name;this.id=xg++;this.code=c;this.usedTimes=1;this.program=
w;this.vertexShader=m;this.fragmentShader=t;return this}function yg(a,b,c){function d(a,b){if(a)a.isTexture?c=a.encoding:a.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),c=a.texture.encoding);else var c=3E3;3E3===c&&b&&(c=3007);return c}var e=[],f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",
MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},g="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering".split(" ");
this.getParameters=function(b,e,g,t,n,q,u){var h=f[b.type];if(u.isSkinnedMesh){var k=u.skeleton.bones;if(c.floatVertexTextures)k=1024;else{var m=Math.min(Math.floor((c.maxVertexUniforms-20)/4),k.length);m<k.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+k.length+" bones. This GPU supports "+m+"."),k=0):k=m}}else k=0;m=c.precision;null!==b.precision&&(m=c.getMaxPrecision(b.precision),m!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",m,"instead."));
var l=a.getRenderTarget();return{shaderID:h,precision:m,supportsVertexTextures:c.vertexTextures,outputEncoding:d(l?l.texture:null,a.gammaOutput),map:!!b.map,mapEncoding:d(b.map,a.gammaInput),envMap:!!b.envMap,envMapMode:b.envMap&&b.envMap.mapping,envMapEncoding:d(b.envMap,a.gammaInput),envMapCubeUV:!!b.envMap&&(306===b.envMap.mapping||307===b.envMap.mapping),lightMap:!!b.lightMap,aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:d(b.emissiveMap,a.gammaInput),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,
objectSpaceNormalMap:1===b.normalMapType,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,alphaMap:!!b.alphaMap,gradientMap:!!b.gradientMap,combine:b.combine,vertexColors:b.vertexColors,fog:!!t,useFog:b.fog,fogExp:t&&t.isFogExp2,flatShading:b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:c.logarithmicDepthBuffer,skinning:b.skinning&&0<k,maxBones:k,useVertexTexture:c.floatVertexTextures,morphTargets:b.morphTargets,
morphNormals:b.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length,numRectAreaLights:e.rectArea.length,numHemiLights:e.hemi.length,numClippingPlanes:n,numClipIntersection:q,dithering:b.dithering,shadowMapEnabled:a.shadowMap.enabled&&u.receiveShadow&&0<g.length,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,
alphaTest:b.alphaTest,doubleSided:2===b.side,flipSided:1===b.side,depthPacking:void 0!==b.depthPacking?b.depthPacking:!1}};this.getProgramCode=function(b,c){var d=[];c.shaderID?d.push(c.shaderID):(d.push(b.fragmentShader),d.push(b.vertexShader));if(void 0!==b.defines)for(var e in b.defines)d.push(e),d.push(b.defines[e]);for(e=0;e<g.length;e++)d.push(c[g[e]]);d.push(b.onBeforeCompile.toString());d.push(a.gammaOutput);return d.join()};this.acquireProgram=function(d,f,g,t){for(var h,k=0,m=e.length;k<
m;k++){var l=e[k];if(l.code===t){h=l;++h.usedTimes;break}}void 0===h&&(h=new wg(a,b,t,d,f,g,c),e.push(h));return h};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=e.indexOf(a);e[b]=e[e.length-1];e.pop();a.destroy()}};this.programs=e}function zg(){var a=new WeakMap;return{get:function(b){var c=a.get(b);void 0===c&&(c={},a.set(b,c));return c},remove:function(b){a.delete(b)},update:function(b,c,d){a.get(b)[c]=d},dispose:function(){a=new WeakMap}}}function Ag(a,b){return a.renderOrder!==
b.renderOrder?a.renderOrder-b.renderOrder:a.program&&b.program&&a.program!==b.program?a.program.id-b.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function Bg(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function Cg(){var a=[],b=0,c=[],d=[];return{opaque:c,transparent:d,init:function(){b=0;c.length=0;d.length=0},push:function(e,f,g,h,k){var m=a[b];void 0===m?(m={id:e.id,object:e,geometry:f,material:g,
program:g.program,renderOrder:e.renderOrder,z:h,group:k},a[b]=m):(m.id=e.id,m.object=e,m.geometry=f,m.material=g,m.program=g.program,m.renderOrder=e.renderOrder,m.z=h,m.group=k);(!0===g.transparent?d:c).push(m);b++},sort:function(){1<c.length&&c.sort(Ag);1<d.length&&d.sort(Bg)}}}function Dg(){var a={};return{get:function(b,c){b=b.id+","+c.id;c=a[b];void 0===c&&(c=new Cg,a[b]=c);return c},dispose:function(){a={}}}}function Eg(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];switch(b.type){case "DirectionalLight":var c=
{direction:new p,color:new F,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new z};break;case "SpotLight":c={position:new p,direction:new p,color:new F,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new z};break;case "PointLight":c={position:new p,color:new F,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new z,shadowCameraNear:1,shadowCameraFar:1E3};break;case "HemisphereLight":c={direction:new p,skyColor:new F,groundColor:new F};
break;case "RectAreaLight":c={color:new F,position:new p,halfWidth:new p,halfHeight:new p}}return a[b.id]=c}}}function Fg(){var a=new Eg,b={id:Gg++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},c=new p,d=new J,e=new J;return{setup:function(f,
g,h){var k=0,m=0,t=0,n=0,q=0,u=0,l=0,v=0;h=h.matrixWorldInverse;for(var y=0,p=f.length;y<p;y++){var w=f[y],G=w.color,D=w.intensity,O=w.distance,S=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)k+=G.r*D,m+=G.g*D,t+=G.b*D;else if(w.isDirectionalLight){var E=a.get(w);E.color.copy(w.color).multiplyScalar(w.intensity);E.direction.setFromMatrixPosition(w.matrixWorld);c.setFromMatrixPosition(w.target.matrixWorld);E.direction.sub(c);E.direction.transformDirection(h);if(E.shadow=w.castShadow)G=
w.shadow,E.shadowBias=G.bias,E.shadowRadius=G.radius,E.shadowMapSize=G.mapSize;b.directionalShadowMap[n]=S;b.directionalShadowMatrix[n]=w.shadow.matrix;b.directional[n]=E;n++}else if(w.isSpotLight){E=a.get(w);E.position.setFromMatrixPosition(w.matrixWorld);E.position.applyMatrix4(h);E.color.copy(G).multiplyScalar(D);E.distance=O;E.direction.setFromMatrixPosition(w.matrixWorld);c.setFromMatrixPosition(w.target.matrixWorld);E.direction.sub(c);E.direction.transformDirection(h);E.coneCos=Math.cos(w.angle);
E.penumbraCos=Math.cos(w.angle*(1-w.penumbra));E.decay=0===w.distance?0:w.decay;if(E.shadow=w.castShadow)G=w.shadow,E.shadowBias=G.bias,E.shadowRadius=G.radius,E.shadowMapSize=G.mapSize;b.spotShadowMap[u]=S;b.spotShadowMatrix[u]=w.shadow.matrix;b.spot[u]=E;u++}else if(w.isRectAreaLight)E=a.get(w),E.color.copy(G).multiplyScalar(D),E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(h),e.identity(),d.copy(w.matrixWorld),d.premultiply(h),e.extractRotation(d),E.halfWidth.set(.5*w.width,
0,0),E.halfHeight.set(0,.5*w.height,0),E.halfWidth.applyMatrix4(e),E.halfHeight.applyMatrix4(e),b.rectArea[l]=E,l++;else if(w.isPointLight){E=a.get(w);E.position.setFromMatrixPosition(w.matrixWorld);E.position.applyMatrix4(h);E.color.copy(w.color).multiplyScalar(w.intensity);E.distance=w.distance;E.decay=0===w.distance?0:w.decay;if(E.shadow=w.castShadow)G=w.shadow,E.shadowBias=G.bias,E.shadowRadius=G.radius,E.shadowMapSize=G.mapSize,E.shadowCameraNear=G.camera.near,E.shadowCameraFar=G.camera.far;
b.pointShadowMap[q]=S;b.pointShadowMatrix[q]=w.shadow.matrix;b.point[q]=E;q++}else w.isHemisphereLight&&(E=a.get(w),E.direction.setFromMatrixPosition(w.matrixWorld),E.direction.transformDirection(h),E.direction.normalize(),E.skyColor.copy(w.color).multiplyScalar(D),E.groundColor.copy(w.groundColor).multiplyScalar(D),b.hemi[v]=E,v++)}b.ambient[0]=k;b.ambient[1]=m;b.ambient[2]=t;b.directional.length=n;b.spot.length=u;b.rectArea.length=l;b.point.length=q;b.hemi.length=v;b.hash.stateID=b.id;b.hash.directionalLength=
n;b.hash.pointLength=q;b.hash.spotLength=u;b.hash.rectAreaLength=l;b.hash.hemiLength=v;b.hash.shadowsLength=g.length},state:b}}function Xe(){var a=new Fg,b=[],c=[];return{init:function(){b.length=0;c.length=0},state:{lightsArray:b,shadowsArray:c,lights:a},setupLights:function(d){a.setup(b,c,d)},pushLight:function(a){b.push(a)},pushShadow:function(a){c.push(a)}}}function Hg(){var a={};return{get:function(b,c){if(void 0===a[b.id]){var d=new Xe;a[b.id]={};a[b.id][c.id]=d}else void 0===a[b.id][c.id]?
(d=new Xe,a[b.id][c.id]=d):d=a[b.id][c.id];return d},dispose:function(){a={}}}}function ab(a){H.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function bb(a){H.call(this);this.type="MeshDistanceMaterial";this.referencePosition=new p;this.nearDistance=1;this.farDistance=
1E3;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.lights=this.fog=!1;this.setValues(a)}function Ye(a,b,c){function d(b,c,d,e,f,g){var h=b.geometry;var k=n;var m=b.customDepthMaterial;d&&(k=q,m=b.customDistanceMaterial);m?k=m:(m=!1,c.morphTargets&&(h&&h.isBufferGeometry?m=h.morphAttributes&&h.morphAttributes.position&&0<h.morphAttributes.position.length:h&&h.isGeometry&&(m=h.morphTargets&&0<h.morphTargets.length)),
b.isSkinnedMesh&&!1===c.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",b),b=b.isSkinnedMesh&&c.skinning,h=0,m&&(h|=1),b&&(h|=2),k=k[h]);a.localClippingEnabled&&!0===c.clipShadows&&0!==c.clippingPlanes.length&&(h=k.uuid,m=c.uuid,b=u[h],void 0===b&&(b={},u[h]=b),h=b[m],void 0===h&&(h=k.clone(),b[m]=h),k=h);k.visible=c.visible;k.wireframe=c.wireframe;k.side=null!=c.shadowSide?c.shadowSide:l[c.side];k.clipShadows=c.clipShadows;k.clippingPlanes=c.clippingPlanes;
k.clipIntersection=c.clipIntersection;k.wireframeLinewidth=c.wireframeLinewidth;k.linewidth=c.linewidth;d&&k.isMeshDistanceMaterial&&(k.referencePosition.copy(e),k.nearDistance=f,k.farDistance=g);return k}function e(c,g,h,k){if(!1!==c.visible){if(c.layers.test(g.layers)&&(c.isMesh||c.isLine||c.isPoints)&&c.castShadow&&(!c.frustumCulled||f.intersectsObject(c))){c.modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,c.matrixWorld);var m=b.update(c),n=c.material;if(Array.isArray(n))for(var q=m.groups,
u=0,l=q.length;u<l;u++){var r=q[u],O=n[r.materialIndex];O&&O.visible&&(O=d(c,O,k,t,h.near,h.far),a.renderBufferDirect(h,null,m,O,c,r))}else n.visible&&(O=d(c,n,k,t,h.near,h.far),a.renderBufferDirect(h,null,m,O,c,null))}c=c.children;m=0;for(n=c.length;m<n;m++)e(c[m],g,h,k)}}var f=new od,g=new J,h=new z,k=new z(c,c),m=new p,t=new p,n=Array(4),q=Array(4),u={},l={0:1,1:0,2:2},v=[new p(1,0,0),new p(-1,0,0),new p(0,0,1),new p(0,0,-1),new p(0,1,0),new p(0,-1,0)],y=[new p(0,1,0),new p(0,1,0),new p(0,1,0),
new p(0,1,0),new p(0,0,1),new p(0,0,-1)],x=[new aa,new aa,new aa,new aa,new aa,new aa];for(c=0;4!==c;++c){var w=0!==(c&1),G=0!==(c&2),D=new ab({depthPacking:3201,morphTargets:w,skinning:G});n[c]=D;w=new bb({morphTargets:w,skinning:G});q[c]=w}var O=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.render=function(b,c,d){if(!1!==O.enabled&&(!1!==O.autoUpdate||!1!==O.needsUpdate)&&0!==b.length){var n=a.state;n.disable(a.context.BLEND);n.buffers.color.setClear(1,1,1,1);n.buffers.depth.setTest(!0);
n.setScissorTest(!1);for(var q,u=0,l=b.length;u<l;u++){var r=b[u];q=r.shadow;var w=r&&r.isPointLight;if(void 0===q)console.warn("THREE.WebGLShadowMap:",r,"has no shadow.");else{var p=q.camera;h.copy(q.mapSize);h.min(k);if(w){var S=h.x,E=h.y;x[0].set(2*S,E,S,E);x[1].set(0,E,S,E);x[2].set(3*S,E,S,E);x[3].set(S,E,S,E);x[4].set(3*S,0,S,E);x[5].set(S,0,S,E);h.x*=4;h.y*=2}null===q.map&&(q.map=new hb(h.x,h.y,{minFilter:1003,magFilter:1003,format:1023}),q.map.texture.name=r.name+".shadowMap",p.updateProjectionMatrix());
q.isSpotLightShadow&&q.update(r);S=q.map;E=q.matrix;t.setFromMatrixPosition(r.matrixWorld);p.position.copy(t);w?(q=6,E.makeTranslation(-t.x,-t.y,-t.z)):(q=1,m.setFromMatrixPosition(r.target.matrixWorld),p.lookAt(m),p.updateMatrixWorld(),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(p.projectionMatrix),E.multiply(p.matrixWorldInverse));a.setRenderTarget(S);a.clear();for(r=0;r<q;r++)w&&(m.copy(p.position),m.add(v[r]),p.up.copy(y[r]),p.lookAt(m),p.updateMatrixWorld(),n.viewport(x[r])),g.multiplyMatrices(p.projectionMatrix,
p.matrixWorldInverse),f.setFromMatrix(g),e(c,d,p,w)}}O.needsUpdate=!1}}}function Ig(a,b,c,d){function e(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}function f(c,e){x[c]=1;0===w[c]&&(a.enableVertexAttribArray(c),w[c]=1);G[c]!==e&&((d.isWebGL2?a:b.get("ANGLE_instanced_arrays"))[d.isWebGL2?"vertexAttribDivisor":
"vertexAttribDivisorANGLE"](c,e),G[c]=e)}function g(b){!0!==D[b]&&(a.enable(b),D[b]=!0)}function h(b){!1!==D[b]&&(a.disable(b),D[b]=!1)}function k(b,d,e,f,k,m,n,t){if(0===b)E&&(h(a.BLEND),E=!1);else if(E||(g(a.BLEND),E=!0),5!==b){if(b!==z||t!==F){if(100!==pd||100!==A)a.blendEquation(a.FUNC_ADD),A=pd=100;if(t)switch(b){case 1:a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case 2:a.blendFunc(a.ONE,a.ONE);break;case 3:a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,
a.ONE_MINUS_SRC_ALPHA);break;case 4:a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",b)}else switch(b){case 1:a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case 2:a.blendFunc(a.SRC_ALPHA,a.ONE);break;case 3:a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR);break;case 4:a.blendFunc(a.ZERO,a.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",b)}I=B=P=Td=null;z=b;
F=t}}else{k=k||d;m=m||e;n=n||f;if(d!==pd||k!==A)a.blendEquationSeparate(c.convert(d),c.convert(k)),pd=d,A=k;if(e!==Td||f!==P||m!==B||n!==I)a.blendFuncSeparate(c.convert(e),c.convert(f),c.convert(m),c.convert(n)),Td=e,P=f,B=m,I=n;z=b;F=null}}function m(b){R!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),R=b)}function t(b){0!==b?(g(a.CULL_FACE),b!==L&&(1===b?a.cullFace(a.BACK):2===b?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):h(a.CULL_FACE);L=b}function n(b,c,d){if(b){if(g(a.POLYGON_OFFSET_FILL),
M!==c||K!==d)a.polygonOffset(c,d),M=c,K=d}else h(a.POLYGON_OFFSET_FILL)}function q(b){void 0===b&&(b=a.TEXTURE0+H-1);U!==b&&(a.activeTexture(b),U=b)}var u=new function(){var b=!1,c=new aa,d=null,e=new aa(0,0,0,0);return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},setLocked:function(a){b=a},setClear:function(b,d,f,g,h){!0===h&&(b*=g,d*=g,f*=g);c.set(b,d,f,g);!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=!1;d=null;e.set(-1,0,0,0)}}},l=new function(){var b=!1,
c=null,d=null,e=null;return{setTest:function(b){b?g(a.DEPTH_TEST):h(a.DEPTH_TEST)},setMask:function(d){c===d||b||(a.depthMask(d),c=d)},setFunc:function(b){if(d!==b){if(b)switch(b){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);
d=b}},setLocked:function(a){b=a},setClear:function(b){e!==b&&(a.clearDepth(b),e=b)},reset:function(){b=!1;e=d=c=null}}},v=new function(){var b=!1,c=null,d=null,e=null,f=null,k=null,m=null,n=null,t=null;return{setTest:function(b){b?g(a.STENCIL_TEST):h(a.STENCIL_TEST)},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,g){if(d!==b||e!==c||f!==g)a.stencilFunc(b,c,g),d=b,e=c,f=g},setOp:function(b,c,d){if(k!==b||m!==c||n!==d)a.stencilOp(b,c,d),k=b,m=c,n=d},setLocked:function(a){b=
a},setClear:function(b){t!==b&&(a.clearStencil(b),t=b)},reset:function(){b=!1;t=n=m=k=f=e=d=c=null}}},p=a.getParameter(a.MAX_VERTEX_ATTRIBS),x=new Uint8Array(p),w=new Uint8Array(p),G=new Uint8Array(p),D={},O=null,S=null,E=null,z=null,pd=null,Td=null,P=null,A=null,B=null,I=null,F=!1,R=null,L=null,J=null,M=null,K=null,H=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Q=!1;p=0;p=a.getParameter(a.VERSION);-1!==p.indexOf("WebGL")?(p=parseFloat(/^WebGL ([0-9])/.exec(p)[1]),Q=1<=p):-1!==p.indexOf("OpenGL ES")&&
(p=parseFloat(/^OpenGL ES ([0-9])/.exec(p)[1]),Q=2<=p);var U=null,V={},Z=new aa,N=new aa,W={};W[a.TEXTURE_2D]=e(a.TEXTURE_2D,a.TEXTURE_2D,1);W[a.TEXTURE_CUBE_MAP]=e(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);u.setClear(0,0,0,1);l.setClear(1);v.setClear(0);g(a.DEPTH_TEST);l.setFunc(3);m(!1);t(1);g(a.CULL_FACE);k(0);return{buffers:{color:u,depth:l,stencil:v},initAttributes:function(){for(var a=0,b=x.length;a<b;a++)x[a]=0},enableAttribute:function(a){f(a,0)},enableAttributeAndDivisor:f,disableUnusedAttributes:function(){for(var b=
0,c=w.length;b!==c;++b)w[b]!==x[b]&&(a.disableVertexAttribArray(b),w[b]=0)},enable:g,disable:h,getCompressedTextureFormats:function(){if(null===O&&(O=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")||b.get("WEBGL_compressed_texture_astc")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<c.length;d++)O.push(c[d]);return O},useProgram:function(b){return S!==b?(a.useProgram(b),S=b,!0):!1},setBlending:k,setMaterial:function(b,
c){2===b.side?h(a.CULL_FACE):g(a.CULL_FACE);var d=1===b.side;c&&(d=!d);m(d);1===b.blending&&!1===b.transparent?k(0):k(b.blending,b.blendEquation,b.blendSrc,b.blendDst,b.blendEquationAlpha,b.blendSrcAlpha,b.blendDstAlpha,b.premultipliedAlpha);l.setFunc(b.depthFunc);l.setTest(b.depthTest);l.setMask(b.depthWrite);u.setMask(b.colorWrite);n(b.polygonOffset,b.polygonOffsetFactor,b.polygonOffsetUnits)},setFlipSided:m,setCullFace:t,setLineWidth:function(b){b!==J&&(Q&&a.lineWidth(b),J=b)},setPolygonOffset:n,
setScissorTest:function(b){b?g(a.SCISSOR_TEST):h(a.SCISSOR_TEST)},activeTexture:q,bindTexture:function(b,c){null===U&&q();var d=V[U];void 0===d&&(d={type:void 0,texture:void 0},V[U]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||W[b]),d.type=b,d.texture=c},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(cb){console.error("THREE.WebGLState:",cb)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(cb){console.error("THREE.WebGLState:",cb)}},scissor:function(b){!1===
Z.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),Z.copy(b))},viewport:function(b){!1===N.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),N.copy(b))},reset:function(){for(var b=0;b<w.length;b++)1===w[b]&&(a.disableVertexAttribArray(b),w[b]=0);D={};U=O=null;V={};L=R=z=S=null;u.reset();l.reset();v.reset()}}}function Jg(a,b,c,d,e,f,g){function h(a,b){if(a.width>b||a.height>b){if("data"in a){console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+a.width+"x"+a.height+").");return}b/=Math.max(a.width,a.height);
var c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");c.width=Math.floor(a.width*b);c.height=Math.floor(a.height*b);c.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,c.width,c.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+c.width+"x"+c.height);return c}return a}function k(a){return K.isPowerOfTwo(a.width)&&K.isPowerOfTwo(a.height)}function m(a,b){return a.generateMipmaps&&b&&1003!==a.minFilter&&1006!==a.minFilter}function t(b,
c,e,f){a.generateMipmap(b);d.get(c).__maxMipLevel=Math.log(Math.max(e,f))*Math.LOG2E}function n(b,c){if(!e.isWebGL2)return b;if(b===a.RGB){if(c===a.FLOAT)return a.RGB32F;if(c===a.HALF_FLOAT)return a.RGB16F;if(c===a.UNSIGNED_BYTE)return a.RGB8}if(b===a.RGBA){if(c===a.FLOAT)return a.RGBA32F;if(c===a.HALF_FLOAT)return a.RGBA16F;if(c===a.UNSIGNED_BYTE)return a.RGBA8}return b}function q(b){return 1003===b||1004===b||1005===b?a.NEAREST:a.LINEAR}function u(b){b=b.target;b.removeEventListener("dispose",u);
a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d.remove(b)}b.isVideoTexture&&delete G[b.id];g.memory.textures--}function l(b){b=b.target;b.removeEventListener("dispose",l);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==e.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b.isWebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),
c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d.remove(b.texture);d.remove(b)}g.memory.textures--}function v(b,q){var l=d.get(b);if(b.isVideoTexture){var r=b.id,v=g.render.frame;G[r]!==v&&(G[r]=v,b.update())}if(0<b.version&&l.__version!==b.version)if(r=b.image,void 0===r)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(!1===
r.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{void 0===l.__webglInit&&(l.__webglInit=!0,b.addEventListener("dispose",u),l.__webglTexture=a.createTexture(),g.memory.textures++);c.activeTexture(a.TEXTURE0+q);c.bindTexture(a.TEXTURE_2D,l.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);q=h(b.image,e.maxTextureSize);
(e.isWebGL2?0:1001!==b.wrapS||1001!==b.wrapT||1003!==b.minFilter&&1006!==b.minFilter)&&!1===k(q)&&(q instanceof HTMLImageElement||q instanceof HTMLCanvasElement||q instanceof ImageBitmap)&&(void 0===D&&(D=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),D.width=K.floorPowerOfTwo(q.width),D.height=K.floorPowerOfTwo(q.height),D.getContext("2d").drawImage(q,0,0,D.width,D.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+q.width+"x"+q.height+"). Resized to "+D.width+
"x"+D.height),q=D);r=k(q);v=f.convert(b.format);var w=f.convert(b.type),O=n(v,w);p(a.TEXTURE_2D,b,r);var y=b.mipmaps;if(b.isDepthTexture){O=a.DEPTH_COMPONENT;if(1015===b.type){if(!e.isWebGL2)throw Error("Float Depth Texture only supported in WebGL2.0");O=a.DEPTH_COMPONENT32F}else e.isWebGL2&&(O=a.DEPTH_COMPONENT16);1026===b.format&&O===a.DEPTH_COMPONENT&&1012!==b.type&&1014!==b.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),b.type=
1012,w=f.convert(b.type));1027===b.format&&(O=a.DEPTH_STENCIL,1020!==b.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),b.type=1020,w=f.convert(b.type)));c.texImage2D(a.TEXTURE_2D,0,O,q.width,q.height,0,v,w,null)}else if(b.isDataTexture)if(0<y.length&&r){for(var S=0,x=y.length;S<x;S++){var z=y[S];c.texImage2D(a.TEXTURE_2D,S,O,z.width,z.height,0,v,w,z.data)}b.generateMipmaps=!1;l.__maxMipLevel=y.length-1}else c.texImage2D(a.TEXTURE_2D,0,O,q.width,
q.height,0,v,w,q.data),l.__maxMipLevel=0;else if(b.isCompressedTexture){S=0;for(x=y.length;S<x;S++)z=y[S],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(v)?c.compressedTexImage2D(a.TEXTURE_2D,S,O,z.width,z.height,0,z.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(a.TEXTURE_2D,S,O,z.width,z.height,0,v,w,z.data);l.__maxMipLevel=y.length-1}else if(0<y.length&&r){S=0;for(x=y.length;S<x;S++)z=
y[S],c.texImage2D(a.TEXTURE_2D,S,O,v,w,z);b.generateMipmaps=!1;l.__maxMipLevel=y.length-1}else c.texImage2D(a.TEXTURE_2D,0,O,v,w,q),l.__maxMipLevel=0;m(b,r)&&t(a.TEXTURE_2D,b,q.width,q.height);l.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}c.activeTexture(a.TEXTURE0+q);c.bindTexture(a.TEXTURE_2D,l.__webglTexture)}function p(c,g,h){h?(a.texParameteri(c,a.TEXTURE_WRAP_S,f.convert(g.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,f.convert(g.wrapT)),a.texParameteri(c,a.TEXTURE_MAG_FILTER,f.convert(g.magFilter)),
a.texParameteri(c,a.TEXTURE_MIN_FILTER,f.convert(g.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),1001===g.wrapS&&1001===g.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(c,a.TEXTURE_MAG_FILTER,q(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,q(g.minFilter)),1003!==g.minFilter&&1006!==g.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));
!(h=b.get("EXT_texture_filter_anisotropic"))||1015===g.type&&null===b.get("OES_texture_float_linear")||1016===g.type&&null===(e.isWebGL2||b.get("OES_texture_half_float_linear"))||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||(a.texParameterf(c,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g.anisotropy,e.getMaxAnisotropy())),d.get(g).__currentAnisotropy=g.anisotropy)}function x(b,e,g,h){var k=f.convert(e.texture.format),m=f.convert(e.texture.type),t=n(k,m);c.texImage2D(h,0,t,e.width,e.height,0,k,m,null);
a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,h,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function w(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,
a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var G={},D;this.setTexture2D=v;this.setTextureCube=function(b,q){var l=d.get(b);if(6===b.image.length)if(0<b.version&&l.__version!==b.version){l.__image__webglTextureCube||(b.addEventListener("dispose",u),l.__image__webglTextureCube=a.createTexture(),g.memory.textures++);c.activeTexture(a.TEXTURE0+q);c.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube);
a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);q=b&&b.isCompressedTexture;for(var r=b.image[0]&&b.image[0].isDataTexture,v=[],w=0;6>w;w++)v[w]=q||r?r?b.image[w].image:b.image[w]:h(b.image[w],e.maxCubemapSize);var y=v[0],O=k(y),x=f.convert(b.format),D=f.convert(b.type),G=n(x,D);p(a.TEXTURE_CUBE_MAP,b,O);for(w=0;6>w;w++)if(q)for(var S,z=v[w].mipmaps,A=0,B=z.length;A<B;A++)S=z[A],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(x)?c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+
w,A,G,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+w,A,G,S.width,S.height,0,x,D,S.data);else r?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+w,0,G,v[w].width,v[w].height,0,x,D,v[w].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+w,0,G,x,D,v[w]);l.__maxMipLevel=q?z.length-1:0;m(b,O)&&t(a.TEXTURE_CUBE_MAP,b,y.width,y.height);l.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+
q),c.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,e){c.activeTexture(a.TEXTURE0+e);c.bindTexture(a.TEXTURE_CUBE_MAP,d.get(b).__webglTexture)};this.setupRenderTarget=function(b){var e=d.get(b),f=d.get(b.texture);b.addEventListener("dispose",l);f.__webglTexture=a.createTexture();g.memory.textures++;var h=!0===b.isWebGLRenderTargetCube,n=k(b);if(h){e.__webglFramebuffer=[];for(var q=0;6>q;q++)e.__webglFramebuffer[q]=a.createFramebuffer()}else e.__webglFramebuffer=
a.createFramebuffer();if(h){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);p(a.TEXTURE_CUBE_MAP,b.texture,n);for(q=0;6>q;q++)x(e.__webglFramebuffer[q],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+q);m(b.texture,n)&&t(a.TEXTURE_CUBE_MAP,b.texture,b.width,b.height);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),p(a.TEXTURE_2D,b.texture,n),x(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),m(b.texture,n)&&t(a.TEXTURE_2D,b.texture,b.width,b.height),
c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=!0===b.isWebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error("target.depthTexture not supported in Cube render targets");if(b&&b.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!b.depthTexture||!b.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(b.depthTexture).__webglTexture&&
b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=!0);v(b.depthTexture,0);e=d.get(b.depthTexture).__webglTexture;if(1026===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,e,0);else if(1027===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,e,0);else throw Error("Unknown depthTexture format");
}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),w(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),w(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(b){var e=b.texture,f=k(b);if(m(e,f)){f=b.isWebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D;var g=d.get(e).__webglTexture;
c.bindTexture(f,g);t(f,e,b.width,b.height);c.bindTexture(f,null)}}}function Ze(a,b,c){return{convert:function(d){if(1E3===d)return a.REPEAT;if(1001===d)return a.CLAMP_TO_EDGE;if(1002===d)return a.MIRRORED_REPEAT;if(1003===d)return a.NEAREST;if(1004===d)return a.NEAREST_MIPMAP_NEAREST;if(1005===d)return a.NEAREST_MIPMAP_LINEAR;if(1006===d)return a.LINEAR;if(1007===d)return a.LINEAR_MIPMAP_NEAREST;if(1008===d)return a.LINEAR_MIPMAP_LINEAR;if(1009===d)return a.UNSIGNED_BYTE;if(1017===d)return a.UNSIGNED_SHORT_4_4_4_4;
if(1018===d)return a.UNSIGNED_SHORT_5_5_5_1;if(1019===d)return a.UNSIGNED_SHORT_5_6_5;if(1010===d)return a.BYTE;if(1011===d)return a.SHORT;if(1012===d)return a.UNSIGNED_SHORT;if(1013===d)return a.INT;if(1014===d)return a.UNSIGNED_INT;if(1015===d)return a.FLOAT;if(1016===d){if(c.isWebGL2)return a.HALF_FLOAT;var e=b.get("OES_texture_half_float");if(null!==e)return e.HALF_FLOAT_OES}if(1021===d)return a.ALPHA;if(1022===d)return a.RGB;if(1023===d)return a.RGBA;if(1024===d)return a.LUMINANCE;if(1025===
d)return a.LUMINANCE_ALPHA;if(1026===d)return a.DEPTH_COMPONENT;if(1027===d)return a.DEPTH_STENCIL;if(100===d)return a.FUNC_ADD;if(101===d)return a.FUNC_SUBTRACT;if(102===d)return a.FUNC_REVERSE_SUBTRACT;if(200===d)return a.ZERO;if(201===d)return a.ONE;if(202===d)return a.SRC_COLOR;if(203===d)return a.ONE_MINUS_SRC_COLOR;if(204===d)return a.SRC_ALPHA;if(205===d)return a.ONE_MINUS_SRC_ALPHA;if(206===d)return a.DST_ALPHA;if(207===d)return a.ONE_MINUS_DST_ALPHA;if(208===d)return a.DST_COLOR;if(209===
d)return a.ONE_MINUS_DST_COLOR;if(210===d)return a.SRC_ALPHA_SATURATE;if(33776===d||33777===d||33778===d||33779===d)if(e=b.get("WEBGL_compressed_texture_s3tc"),null!==e){if(33776===d)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===d)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===d)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===d)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===d||35841===d||35842===d||35843===d)if(e=b.get("WEBGL_compressed_texture_pvrtc"),null!==e){if(35840===d)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;
if(35841===d)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===d)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===d)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===d&&(e=b.get("WEBGL_compressed_texture_etc1"),null!==e))return e.COMPRESSED_RGB_ETC1_WEBGL;if(37808===d||37809===d||37810===d||37811===d||37812===d||37813===d||37814===d||37815===d||37816===d||37817===d||37818===d||37819===d||37820===d||37821===d)if(e=b.get("WEBGL_compressed_texture_astc"),null!==e)return d;if(103===d||104===
d){if(c.isWebGL2){if(103===d)return a.MIN;if(104===d)return a.MAX}e=b.get("EXT_blend_minmax");if(null!==e){if(103===d)return e.MIN_EXT;if(104===d)return e.MAX_EXT}}if(1020===d){if(c.isWebGL2)return a.UNSIGNED_INT_24_8;e=b.get("WEBGL_depth_texture");if(null!==e)return e.UNSIGNED_INT_24_8_WEBGL}return 0}}}function Mb(){B.call(this);this.type="Group"}function X(a,b,c,d){Pa.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;
this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function Ac(a){X.call(this);this.cameras=a||[]}function $e(a){function b(){return null!==e&&!0===e.isPresenting}function c(){if(b()){var c=e.getEyeParameters("left"),f=c.renderWidth;c=c.renderHeight;w=a.getPixelRatio();x=a.getSize();a.setDrawingBufferSize(2*f,c,1);D.start()}else d.enabled&&a.setDrawingBufferSize(x.width,x.height,w),D.stop()}var d=this,e=null,f=null,g=null,h=[],
k=new J,m=new J,t="stage";"undefined"!==typeof window&&"VRFrameData"in window&&(f=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",c,!1));var n=new J,q=new ha,u=new p,l=new X;l.bounds=new aa(0,0,.5,1);l.layers.enable(1);var v=new X;v.bounds=new aa(.5,0,.5,1);v.layers.enable(2);var y=new Ac([l,v]);y.layers.enable(1);y.layers.enable(2);var x,w,G=[];this.enabled=!1;this.getController=function(a){var b=h[a];void 0===b&&(b=new Mb,b.matrixAutoUpdate=!1,b.visible=!1,h[a]=b);return b};
this.getDevice=function(){return e};this.setDevice=function(a){void 0!==a&&(e=a);D.setContext(a)};this.setFrameOfReferenceType=function(a){t=a};this.setPoseTarget=function(a){void 0!==a&&(g=a)};this.getCamera=function(a){var b="stage"===t?1.6:0;if(null===e)return a.position.set(0,b,0),a;e.depthNear=a.near;e.depthFar=a.far;e.getFrameData(f);if("stage"===t){var c=e.stageParameters;c?k.fromArray(c.sittingToStandingTransform):k.makeTranslation(0,b,0)}b=f.pose;c=null!==g?g:a;c.matrix.copy(k);c.matrix.decompose(c.position,
c.quaternion,c.scale);null!==b.orientation&&(q.fromArray(b.orientation),c.quaternion.multiply(q));null!==b.position&&(q.setFromRotationMatrix(k),u.fromArray(b.position),u.applyQuaternion(q),c.position.add(u));c.updateMatrixWorld();if(!1===e.isPresenting)return a;l.near=a.near;v.near=a.near;l.far=a.far;v.far=a.far;y.matrixWorld.copy(a.matrixWorld);y.matrixWorldInverse.copy(a.matrixWorldInverse);l.matrixWorldInverse.fromArray(f.leftViewMatrix);v.matrixWorldInverse.fromArray(f.rightViewMatrix);m.getInverse(k);
"stage"===t&&(l.matrixWorldInverse.multiply(m),v.matrixWorldInverse.multiply(m));a=c.parent;null!==a&&(n.getInverse(a.matrixWorld),l.matrixWorldInverse.multiply(n),v.matrixWorldInverse.multiply(n));l.matrixWorld.getInverse(l.matrixWorldInverse);v.matrixWorld.getInverse(v.matrixWorldInverse);l.projectionMatrix.fromArray(f.leftProjectionMatrix);v.projectionMatrix.fromArray(f.rightProjectionMatrix);y.projectionMatrix.copy(l.projectionMatrix);a=e.getLayers();a.length&&(a=a[0],null!==a.leftBounds&&4===
a.leftBounds.length&&l.bounds.fromArray(a.leftBounds),null!==a.rightBounds&&4===a.rightBounds.length&&v.bounds.fromArray(a.rightBounds));a:for(a=0;a<h.length;a++){b=h[a];b:{c=a;for(var d=navigator.getGamepads&&navigator.getGamepads(),r=0,w=0,p=d.length;r<p;r++){var x=d[r];if(x&&("Daydream Controller"===x.id||"Gear VR Controller"===x.id||"Oculus Go Controller"===x.id||"OpenVR Gamepad"===x.id||x.id.startsWith("Oculus Touch")||x.id.startsWith("Spatial Controller"))){if(w===c){c=x;break b}w++}}c=void 0}if(void 0!==
c&&void 0!==c.pose){if(null===c.pose)break a;d=c.pose;!1===d.hasPosition&&b.position.set(.2,-.6,-.05);null!==d.position&&b.position.fromArray(d.position);null!==d.orientation&&b.quaternion.fromArray(d.orientation);b.matrix.compose(b.position,b.quaternion,b.scale);b.matrix.premultiply(k);b.matrix.decompose(b.position,b.quaternion,b.scale);b.matrixWorldNeedsUpdate=!0;b.visible=!0;d="Daydream Controller"===c.id?0:1;G[a]!==c.buttons[d].pressed&&(G[a]=c.buttons[d].pressed,!0===G[a]?b.dispatchEvent({type:"selectstart"}):
(b.dispatchEvent({type:"selectend"}),b.dispatchEvent({type:"select"})))}else b.visible=!1}return y};this.getStandingMatrix=function(){return k};this.isPresenting=b;var D=new Rd;this.setAnimationLoop=function(a){D.setAnimationLoop(a)};this.submitFrame=function(){b()&&e.submitFrame()};this.dispose=function(){"undefined"!==typeof window&&window.removeEventListener("vrdisplaypresentchange",c)}}function Kg(a){function b(){return null!==h&&null!==k}function c(a){var b=n[q.indexOf(a.inputSource)];b&&b.dispatchEvent({type:a.type})}
function d(){a.setFramebuffer(null);x.stop()}function e(a,b){null===b?a.matrixWorld.copy(a.matrix):a.matrixWorld.multiplyMatrices(b.matrixWorld,a.matrix);a.matrixWorldInverse.getInverse(a.matrixWorld)}var f=a.context,g=null,h=null,k=null,m="stage",t=null,n=[],q=[],l=new X;l.layers.enable(1);l.viewport=new aa;var r=new X;r.layers.enable(2);r.viewport=new aa;var v=new Ac([l,r]);v.layers.enable(1);v.layers.enable(2);this.enabled=!1;this.getController=function(a){var b=n[a];void 0===b&&(b=new Mb,b.matrixAutoUpdate=
!1,b.visible=!1,n[a]=b);return b};this.getDevice=function(){return g};this.setDevice=function(a){void 0!==a&&(g=a);a instanceof XRDevice&&f.setCompatibleXRDevice(a)};this.setFrameOfReferenceType=function(a){m=a};this.setSession=function(b){h=b;null!==h&&(h.addEventListener("select",c),h.addEventListener("selectstart",c),h.addEventListener("selectend",c),h.addEventListener("end",d),h.baseLayer=new XRWebGLLayer(h,f),h.requestFrameOfReference(m).then(function(b){k=b;a.setFramebuffer(h.baseLayer.framebuffer);
x.setContext(h);x.start()}),q=h.getInputSources(),h.addEventListener("inputsourceschange",function(){q=h.getInputSources();console.log(q)}))};this.getCamera=function(a){if(b()){var c=a.parent,d=v.cameras;e(v,c);for(var f=0;f<d.length;f++)e(d[f],c);a.matrixWorld.copy(v.matrixWorld);a=a.children;f=0;for(c=a.length;f<c;f++)a[f].updateMatrixWorld(!0);return v}return a};this.isPresenting=b;var p=null,x=new Rd;x.setAnimationLoop(function(a,b){t=b.getDevicePose(k);if(null!==t)for(var c=h.baseLayer,d=b.views,
e=0;e<d.length;e++){var f=d[e],g=c.getViewport(f),m=t.getViewMatrix(f),l=v.cameras[e];l.matrix.fromArray(m).getInverse(l.matrix);l.projectionMatrix.fromArray(f.projectionMatrix);l.viewport.set(g.x,g.y,g.width,g.height);0===e&&(v.matrix.copy(l.matrix),v.projectionMatrix.copy(l.projectionMatrix))}for(e=0;e<n.length;e++){c=n[e];if(d=q[e])if(d=b.getInputPose(d,k),null!==d){"targetRay"in d?c.matrix.elements=d.targetRay.transformMatrix:"pointerMatrix"in d&&(c.matrix.elements=d.pointerMatrix);c.matrix.decompose(c.position,
c.rotation,c.scale);c.visible=!0;continue}c.visible=!1}p&&p(a)});this.setAnimationLoop=function(a){p=a};this.dispose=function(){};this.getStandingMatrix=function(){console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed.");return new THREE.Matrix4};this.submitFrame=function(){}}function Yd(a){var b;function c(){ia=new Of(C);va=new Mf(C,ia,a);va.isWebGL2||(ia.get("WEBGL_depth_texture"),ia.get("OES_texture_float"),ia.get("OES_texture_half_float"),ia.get("OES_texture_half_float_linear"),
ia.get("OES_standard_derivatives"),ia.get("OES_element_index_uint"),ia.get("ANGLE_instanced_arrays"));ia.get("OES_texture_float_linear");ea=new Ze(C,ia,va);ca=new Ig(C,ia,ea,va);ca.scissor(zc.copy(ha).multiplyScalar(W));ca.viewport(T.copy(cb).multiplyScalar(W));da=new Rf(C);Ca=new zg;ja=new Jg(C,ia,ca,Ca,va,ea,da);qa=new Ef(C);sa=new Pf(C,qa,da);na=new Uf(sa,da);wa=new Tf(C);ma=new yg(P,ia,va);ta=new Dg;oa=new Hg;la=new Kf(P,ca,na,S);xa=new Lf(C,ia,da,va);za=new Qf(C,ia,da,va);da.programs=ma.programs;
P.context=C;P.capabilities=va;P.extensions=ia;P.properties=Ca;P.renderLists=ta;P.state=ca;P.info=da}function d(a){a.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");I=!0}function e(){console.log("THREE.WebGLRenderer: Context Restored.");I=!1;c()}function f(a){a=a.target;a.removeEventListener("dispose",f);g(a);Ca.remove(a)}function g(a){var b=Ca.get(a).program;a.program=void 0;void 0!==b&&ma.releaseProgram(b)}function h(a,b){a.render(function(a){P.renderBufferImmediate(a,b)})}function k(a,
b,c){if(!1!==a.visible){if(a.layers.test(b.layers))if(a.isLight)B.pushLight(a),a.castShadow&&B.pushShadow(a);else if(a.isSprite){if(!a.frustumCulled||pa.intersectsSprite(a)){c&&db.setFromMatrixPosition(a.matrixWorld).applyMatrix4(yc);var d=na.update(a),e=a.material;A.push(a,d,e,db.z,null)}}else if(a.isImmediateRenderObject)c&&db.setFromMatrixPosition(a.matrixWorld).applyMatrix4(yc),A.push(a,null,a.material,db.z,null);else if(a.isMesh||a.isLine||a.isPoints)if(a.isSkinnedMesh&&a.skeleton.update(),!a.frustumCulled||
pa.intersectsObject(a))if(c&&db.setFromMatrixPosition(a.matrixWorld).applyMatrix4(yc),d=na.update(a),e=a.material,Array.isArray(e))for(var f=d.groups,g=0,h=f.length;g<h;g++){var m=f[g],n=e[m.materialIndex];n&&n.visible&&A.push(a,d,n,db.z,m)}else e.visible&&A.push(a,d,e,db.z,null);a=a.children;g=0;for(h=a.length;g<h;g++)k(a[g],b,c)}}function m(a,b,c,d){for(var e=0,f=a.length;e<f;e++){var g=a[e],h=g.object,k=g.geometry,m=void 0===d?g.material:d;g=g.group;if(c.isArrayCamera){Z=c;for(var n=c.cameras,
q=0,l=n.length;q<l;q++){var u=n[q];if(h.layers.test(u.layers)){if("viewport"in u)ca.viewport(T.copy(u.viewport));else{var r=u.bounds;ca.viewport(T.set(r.x*X,r.y*N,r.z*X,r.w*N).multiplyScalar(W))}B.setupLights(u);t(h,b,u,k,m,g)}}}else Z=null,t(h,b,c,k,m,g)}}function t(a,c,d,e,f,g){a.onBeforeRender(P,c,d,e,f,g);B=oa.get(c,Z||d);a.modelViewMatrix.multiplyMatrices(d.matrixWorldInverse,a.matrixWorld);a.normalMatrix.getNormalMatrix(a.modelViewMatrix);if(a.isImmediateRenderObject){ca.setMaterial(f);var k=
q(d,c.fog,f,a);H=b=null;U=!1;h(a,k)}else P.renderBufferDirect(d,c.fog,e,f,a,g);a.onAfterRender(P,c,d,e,f,g);B=oa.get(c,Z||d)}function n(a,b,c){var d=Ca.get(a),e=B.state.lights,h=d.lightsHash,k=e.state.hash;c=ma.getParameters(a,e.state,B.state.shadowsArray,b,ba.numPlanes,ba.numIntersection,c);var m=ma.getProgramCode(a,c),n=d.program,t=!0;if(void 0===n)a.addEventListener("dispose",f);else if(n.code!==m)g(a);else{if(h.stateID!==k.stateID||h.directionalLength!==k.directionalLength||h.pointLength!==k.pointLength||
h.spotLength!==k.spotLength||h.rectAreaLength!==k.rectAreaLength||h.hemiLength!==k.hemiLength||h.shadowsLength!==k.shadowsLength)h.stateID=k.stateID,h.directionalLength=k.directionalLength,h.pointLength=k.pointLength,h.spotLength=k.spotLength,h.rectAreaLength=k.rectAreaLength,h.hemiLength=k.hemiLength,h.shadowsLength=k.shadowsLength;else if(void 0!==c.shaderID)return;t=!1}t&&(c.shaderID?(m=pb[c.shaderID],d.shader={name:a.type,uniforms:Ba.clone(m.uniforms),vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}):
d.shader={name:a.type,uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader},a.onBeforeCompile(d.shader,P),m=ma.getProgramCode(a,c),n=ma.acquireProgram(a,d.shader,c,m),d.program=n,a.program=n);c=n.getAttributes();if(a.morphTargets)for(m=a.numSupportedMorphTargets=0;m<P.maxMorphTargets;m++)0<=c["morphTarget"+m]&&a.numSupportedMorphTargets++;if(a.morphNormals)for(m=a.numSupportedMorphNormals=0;m<P.maxMorphNormals;m++)0<=c["morphNormal"+m]&&a.numSupportedMorphNormals++;c=d.shader.uniforms;
if(!a.isShaderMaterial&&!a.isRawShaderMaterial||!0===a.clipping)d.numClippingPlanes=ba.numPlanes,d.numIntersection=ba.numIntersection,c.clippingPlanes=ba.uniform;d.fog=b;void 0===h&&(d.lightsHash=h={});h.stateID=k.stateID;h.directionalLength=k.directionalLength;h.pointLength=k.pointLength;h.spotLength=k.spotLength;h.rectAreaLength=k.rectAreaLength;h.hemiLength=k.hemiLength;h.shadowsLength=k.shadowsLength;a.lights&&(c.ambientLightColor.value=e.state.ambient,c.directionalLights.value=e.state.directional,
c.spotLights.value=e.state.spot,c.rectAreaLights.value=e.state.rectArea,c.pointLights.value=e.state.point,c.hemisphereLights.value=e.state.hemi,c.directionalShadowMap.value=e.state.directionalShadowMap,c.directionalShadowMatrix.value=e.state.directionalShadowMatrix,c.spotShadowMap.value=e.state.spotShadowMap,c.spotShadowMatrix.value=e.state.spotShadowMatrix,c.pointShadowMap.value=e.state.pointShadowMap,c.pointShadowMatrix.value=e.state.pointShadowMatrix);a=d.program.getUniforms();a=$a.seqWithValue(a.seq,
c);d.uniformsList=a}function q(a,b,c,d){fa=0;var e=Ca.get(c),f=e.lightsHash,g=B.state.lights.state.hash;qd&&(Xd||a!==V)&&ba.setState(c.clippingPlanes,c.clipIntersection,c.clipShadows,a,e,a===V&&c.id===Q);!1===c.needsUpdate&&(void 0===e.program?c.needsUpdate=!0:c.fog&&e.fog!==b?c.needsUpdate=!0:!c.lights||f.stateID===g.stateID&&f.directionalLength===g.directionalLength&&f.pointLength===g.pointLength&&f.spotLength===g.spotLength&&f.rectAreaLength===g.rectAreaLength&&f.hemiLength===g.hemiLength&&f.shadowsLength===
g.shadowsLength?void 0===e.numClippingPlanes||e.numClippingPlanes===ba.numPlanes&&e.numIntersection===ba.numIntersection||(c.needsUpdate=!0):c.needsUpdate=!0);c.needsUpdate&&(n(c,b,d),c.needsUpdate=!1);var h=!1,k=!1,m=!1;f=e.program;g=f.getUniforms();var t=e.shader.uniforms;ca.useProgram(f.program)&&(m=k=h=!0);c.id!==Q&&(Q=c.id,k=!0);if(h||V!==a){g.setValue(C,"projectionMatrix",a.projectionMatrix);va.logarithmicDepthBuffer&&g.setValue(C,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));V!==a&&(V=a,
m=k=!0);if(c.isShaderMaterial||c.isMeshPhongMaterial||c.isMeshStandardMaterial||c.envMap)h=g.map.cameraPosition,void 0!==h&&h.setValue(C,db.setFromMatrixPosition(a.matrixWorld));(c.isMeshPhongMaterial||c.isMeshLambertMaterial||c.isMeshBasicMaterial||c.isMeshStandardMaterial||c.isShaderMaterial||c.skinning)&&g.setValue(C,"viewMatrix",a.matrixWorldInverse)}if(c.skinning&&(g.setOptional(C,d,"bindMatrix"),g.setOptional(C,d,"bindMatrixInverse"),a=d.skeleton))if(h=a.bones,va.floatVertexTextures){if(void 0===
a.boneTexture){h=Math.sqrt(4*h.length);h=K.ceilPowerOfTwo(h);h=Math.max(h,4);var q=new Float32Array(h*h*4);q.set(a.boneMatrices);var u=new ib(q,h,h,1023,1015);u.needsUpdate=!0;a.boneMatrices=q;a.boneTexture=u;a.boneTextureSize=h}g.setValue(C,"boneTexture",a.boneTexture);g.setValue(C,"boneTextureSize",a.boneTextureSize)}else g.setOptional(C,a,"boneMatrices");k&&(g.setValue(C,"toneMappingExposure",P.toneMappingExposure),g.setValue(C,"toneMappingWhitePoint",P.toneMappingWhitePoint),c.lights&&(k=m,t.ambientLightColor.needsUpdate=
k,t.directionalLights.needsUpdate=k,t.pointLights.needsUpdate=k,t.spotLights.needsUpdate=k,t.rectAreaLights.needsUpdate=k,t.hemisphereLights.needsUpdate=k),b&&c.fog&&(t.fogColor.value=b.color,b.isFog?(t.fogNear.value=b.near,t.fogFar.value=b.far):b.isFogExp2&&(t.fogDensity.value=b.density)),c.isMeshBasicMaterial?l(t,c):c.isMeshLambertMaterial?(l(t,c),c.emissiveMap&&(t.emissiveMap.value=c.emissiveMap)):c.isMeshPhongMaterial?(l(t,c),c.isMeshToonMaterial?(r(t,c),c.gradientMap&&(t.gradientMap.value=c.gradientMap)):
r(t,c)):c.isMeshStandardMaterial?(l(t,c),c.isMeshPhysicalMaterial?(v(t,c),t.reflectivity.value=c.reflectivity,t.clearCoat.value=c.clearCoat,t.clearCoatRoughness.value=c.clearCoatRoughness):v(t,c)):c.isMeshDepthMaterial?(l(t,c),c.displacementMap&&(t.displacementMap.value=c.displacementMap,t.displacementScale.value=c.displacementScale,t.displacementBias.value=c.displacementBias)):c.isMeshDistanceMaterial?(l(t,c),c.displacementMap&&(t.displacementMap.value=c.displacementMap,t.displacementScale.value=
c.displacementScale,t.displacementBias.value=c.displacementBias),t.referencePosition.value.copy(c.referencePosition),t.nearDistance.value=c.nearDistance,t.farDistance.value=c.farDistance):c.isMeshNormalMaterial?(l(t,c),c.bumpMap&&(t.bumpMap.value=c.bumpMap,t.bumpScale.value=c.bumpScale,1===c.side&&(t.bumpScale.value*=-1)),c.normalMap&&(t.normalMap.value=c.normalMap,t.normalScale.value.copy(c.normalScale),1===c.side&&t.normalScale.value.negate()),c.displacementMap&&(t.displacementMap.value=c.displacementMap,
t.displacementScale.value=c.displacementScale,t.displacementBias.value=c.displacementBias)):c.isLineBasicMaterial?(t.diffuse.value=c.color,t.opacity.value=c.opacity,c.isLineDashedMaterial&&(t.dashSize.value=c.dashSize,t.totalSize.value=c.dashSize+c.gapSize,t.scale.value=c.scale)):c.isPointsMaterial?(t.diffuse.value=c.color,t.opacity.value=c.opacity,t.size.value=c.size*W,t.scale.value=.5*N,t.map.value=c.map,null!==c.map&&(!0===c.map.matrixAutoUpdate&&c.map.updateMatrix(),t.uvTransform.value.copy(c.map.matrix))):
c.isSpriteMaterial?(t.diffuse.value=c.color,t.opacity.value=c.opacity,t.rotation.value=c.rotation,t.map.value=c.map,null!==c.map&&(!0===c.map.matrixAutoUpdate&&c.map.updateMatrix(),t.uvTransform.value.copy(c.map.matrix))):c.isShadowMaterial&&(t.color.value=c.color,t.opacity.value=c.opacity),void 0!==t.ltc_1&&(t.ltc_1.value=R.LTC_1),void 0!==t.ltc_2&&(t.ltc_2.value=R.LTC_2),$a.upload(C,e.uniformsList,t,P));c.isShaderMaterial&&!0===c.uniformsNeedUpdate&&($a.upload(C,e.uniformsList,t,P),c.uniformsNeedUpdate=
!1);c.isSpriteMaterial&&g.setValue(C,"center",d.center);g.setValue(C,"modelViewMatrix",d.modelViewMatrix);g.setValue(C,"normalMatrix",d.normalMatrix);g.setValue(C,"modelMatrix",d.matrixWorld);return f}function l(a,b){a.opacity.value=b.opacity;b.color&&(a.diffuse.value=b.color);b.emissive&&a.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity);b.map&&(a.map.value=b.map);b.alphaMap&&(a.alphaMap.value=b.alphaMap);b.specularMap&&(a.specularMap.value=b.specularMap);b.envMap&&(a.envMap.value=
b.envMap,a.flipEnvMap.value=b.envMap&&b.envMap.isCubeTexture?-1:1,a.reflectivity.value=b.reflectivity,a.refractionRatio.value=b.refractionRatio,a.maxMipLevel.value=Ca.get(b.envMap).__maxMipLevel);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.aoMap&&(a.aoMap.value=b.aoMap,a.aoMapIntensity.value=b.aoMapIntensity);if(b.map)var c=b.map;else b.specularMap?c=b.specularMap:b.displacementMap?c=b.displacementMap:b.normalMap?c=b.normalMap:b.bumpMap?c=b.bumpMap:b.roughnessMap?
c=b.roughnessMap:b.metalnessMap?c=b.metalnessMap:b.alphaMap?c=b.alphaMap:b.emissiveMap&&(c=b.emissiveMap);void 0!==c&&(c.isWebGLRenderTarget&&(c=c.texture),!0===c.matrixAutoUpdate&&c.updateMatrix(),a.uvTransform.value.copy(c.matrix))}function r(a,b){a.specular.value=b.specular;a.shininess.value=Math.max(b.shininess,1E-4);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale,1===b.side&&(a.bumpScale.value*=-1));b.normalMap&&(a.normalMap.value=
b.normalMap,a.normalScale.value.copy(b.normalScale),1===b.side&&a.normalScale.value.negate());b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}function v(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=
b.bumpMap,a.bumpScale.value=b.bumpScale,1===b.side&&(a.bumpScale.value*=-1));b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale),1===b.side&&a.normalScale.value.negate());b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}console.log("THREE.WebGLRenderer","96");a=a||{};var y=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml",
"canvas"),x=void 0!==a.context?a.context:null,w=void 0!==a.alpha?a.alpha:!1,G=void 0!==a.depth?a.depth:!0,D=void 0!==a.stencil?a.stencil:!0,O=void 0!==a.antialias?a.antialias:!1,S=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,E=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,z=void 0!==a.powerPreference?a.powerPreference:"default",A=null,B=null;this.domElement=y;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=
[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var P=this,I=!1,F=null,L=null,M=null,Q=-1;var H=b=null;var U=!1;var V=null,Z=null,T=new aa,zc=new aa,Y=null,fa=0,X=y.width,N=y.height,W=1,cb=new aa(0,0,X,N),ha=new aa(0,0,X,N),ra=!1,pa=new od,ba=new Nf,qd=!1,Xd=!1,yc=new J,db=new p;try{w={alpha:w,depth:G,stencil:D,antialias:O,
premultipliedAlpha:S,preserveDrawingBuffer:E,powerPreference:z};y.addEventListener("webglcontextlost",d,!1);y.addEventListener("webglcontextrestored",e,!1);var C=x||y.getContext("webgl",w)||y.getContext("experimental-webgl",w);if(null===C){if(null!==y.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.");}void 0===C.getShaderPrecisionFormat&&(C.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Lg){console.error("THREE.WebGLRenderer: "+
Lg.message)}var ia,va,ca,da,Ca,ja,qa,sa,na,ma,ta,oa,la,wa,xa,za,ea;c();var ka="xr"in navigator?new Kg(P):new $e(P);this.vr=ka;var Aa=new Ye(P,na,va.maxTextureSize);this.shadowMap=Aa;this.getContext=function(){return C};this.getContextAttributes=function(){return C.getContextAttributes()};this.forceContextLoss=function(){var a=ia.get("WEBGL_lose_context");a&&a.loseContext()};this.forceContextRestore=function(){var a=ia.get("WEBGL_lose_context");a&&a.restoreContext()};this.getPixelRatio=function(){return W};
this.setPixelRatio=function(a){void 0!==a&&(W=a,this.setSize(X,N,!1))};this.getSize=function(){return{width:X,height:N}};this.setSize=function(a,b,c){ka.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(X=a,N=b,y.width=a*W,y.height=b*W,!1!==c&&(y.style.width=a+"px",y.style.height=b+"px"),this.setViewport(0,0,a,b))};this.getDrawingBufferSize=function(){return{width:X*W,height:N*W}};this.setDrawingBufferSize=function(a,b,c){X=a;N=b;W=c;y.width=a*c;
y.height=b*c;this.setViewport(0,0,a,b)};this.getCurrentViewport=function(){return T};this.setViewport=function(a,b,c,d){cb.set(a,N-b-d,c,d);ca.viewport(T.copy(cb).multiplyScalar(W))};this.setScissor=function(a,b,c,d){ha.set(a,N-b-d,c,d);ca.scissor(zc.copy(ha).multiplyScalar(W))};this.setScissorTest=function(a){ca.setScissorTest(ra=a)};this.getClearColor=function(){return la.getClearColor()};this.setClearColor=function(){la.setClearColor.apply(la,arguments)};this.getClearAlpha=function(){return la.getClearAlpha()};
this.setClearAlpha=function(){la.setClearAlpha.apply(la,arguments)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=C.COLOR_BUFFER_BIT;if(void 0===b||b)d|=C.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=C.STENCIL_BUFFER_BIT;C.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.dispose=function(){y.removeEventListener("webglcontextlost",
d,!1);y.removeEventListener("webglcontextrestored",e,!1);ta.dispose();oa.dispose();Ca.dispose();na.dispose();ka.dispose();ua.stop()};this.renderBufferImmediate=function(a,b){ca.initAttributes();var c=Ca.get(a);a.hasPositions&&!c.position&&(c.position=C.createBuffer());a.hasNormals&&!c.normal&&(c.normal=C.createBuffer());a.hasUvs&&!c.uv&&(c.uv=C.createBuffer());a.hasColors&&!c.color&&(c.color=C.createBuffer());b=b.getAttributes();a.hasPositions&&(C.bindBuffer(C.ARRAY_BUFFER,c.position),C.bufferData(C.ARRAY_BUFFER,
a.positionArray,C.DYNAMIC_DRAW),ca.enableAttribute(b.position),C.vertexAttribPointer(b.position,3,C.FLOAT,!1,0,0));a.hasNormals&&(C.bindBuffer(C.ARRAY_BUFFER,c.normal),C.bufferData(C.ARRAY_BUFFER,a.normalArray,C.DYNAMIC_DRAW),ca.enableAttribute(b.normal),C.vertexAttribPointer(b.normal,3,C.FLOAT,!1,0,0));a.hasUvs&&(C.bindBuffer(C.ARRAY_BUFFER,c.uv),C.bufferData(C.ARRAY_BUFFER,a.uvArray,C.DYNAMIC_DRAW),ca.enableAttribute(b.uv),C.vertexAttribPointer(b.uv,2,C.FLOAT,!1,0,0));a.hasColors&&(C.bindBuffer(C.ARRAY_BUFFER,
c.color),C.bufferData(C.ARRAY_BUFFER,a.colorArray,C.DYNAMIC_DRAW),ca.enableAttribute(b.color),C.vertexAttribPointer(b.color,3,C.FLOAT,!1,0,0));ca.disableUnusedAttributes();C.drawArrays(C.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,c,d,e,f,g){var h=f.isMesh&&0>f.normalMatrix.determinant();ca.setMaterial(e,h);var k=q(a,c,e,f),m=!1;if(b!==d.id||H!==k.id||U!==(!0===e.wireframe))b=d.id,H=k.id,U=!0===e.wireframe,m=!0;f.morphTargetInfluences&&(wa.update(f,d,e,k),m=!0);h=d.index;var t=
d.attributes.position;c=1;!0===e.wireframe&&(h=sa.getWireframeAttribute(d),c=2);a=xa;if(null!==h){var n=qa.get(h);a=za;a.setIndex(n)}if(m){if(d&&d.isInstancedBufferGeometry&!va.isWebGL2&&null===ia.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{ca.initAttributes();m=d.attributes;k=k.getAttributes();var l=e.defaultAttributeValues;for(O in k){var u=k[O];
if(0<=u){var r=m[O];if(void 0!==r){var v=r.normalized,p=r.itemSize,w=qa.get(r);if(void 0!==w){var y=w.buffer,x=w.type;w=w.bytesPerElement;if(r.isInterleavedBufferAttribute){var D=r.data,G=D.stride;r=r.offset;D&&D.isInstancedInterleavedBuffer?(ca.enableAttributeAndDivisor(u,D.meshPerAttribute),void 0===d.maxInstancedCount&&(d.maxInstancedCount=D.meshPerAttribute*D.count)):ca.enableAttribute(u);C.bindBuffer(C.ARRAY_BUFFER,y);C.vertexAttribPointer(u,p,x,v,G*w,r*w)}else r.isInstancedBufferAttribute?(ca.enableAttributeAndDivisor(u,
r.meshPerAttribute),void 0===d.maxInstancedCount&&(d.maxInstancedCount=r.meshPerAttribute*r.count)):ca.enableAttribute(u),C.bindBuffer(C.ARRAY_BUFFER,y),C.vertexAttribPointer(u,p,x,v,0,0)}}else if(void 0!==l&&(v=l[O],void 0!==v))switch(v.length){case 2:C.vertexAttrib2fv(u,v);break;case 3:C.vertexAttrib3fv(u,v);break;case 4:C.vertexAttrib4fv(u,v);break;default:C.vertexAttrib1fv(u,v)}}}ca.disableUnusedAttributes()}null!==h&&C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,n.buffer)}n=Infinity;null!==h?n=h.count:
void 0!==t&&(n=t.count);h=d.drawRange.start*c;t=null!==g?g.start*c:0;var O=Math.max(h,t);g=Math.max(0,Math.min(n,h+d.drawRange.count*c,t+(null!==g?g.count*c:Infinity))-1-O+1);if(0!==g){if(f.isMesh)if(!0===e.wireframe)ca.setLineWidth(e.wireframeLinewidth*(null===L?W:1)),a.setMode(C.LINES);else switch(f.drawMode){case 0:a.setMode(C.TRIANGLES);break;case 1:a.setMode(C.TRIANGLE_STRIP);break;case 2:a.setMode(C.TRIANGLE_FAN)}else f.isLine?(e=e.linewidth,void 0===e&&(e=1),ca.setLineWidth(e*(null===L?W:1)),
f.isLineSegments?a.setMode(C.LINES):f.isLineLoop?a.setMode(C.LINE_LOOP):a.setMode(C.LINE_STRIP)):f.isPoints?a.setMode(C.POINTS):f.isSprite&&a.setMode(C.TRIANGLES);d&&d.isInstancedBufferGeometry?0<d.maxInstancedCount&&a.renderInstances(d,O,g):a.render(O,g)}};this.compile=function(a,b){B=oa.get(a,b);B.init();a.traverse(function(a){a.isLight&&(B.pushLight(a),a.castShadow&&B.pushShadow(a))});B.setupLights(b);a.traverse(function(b){if(b.material)if(Array.isArray(b.material))for(var c=0;c<b.material.length;c++)n(b.material[c],
a.fog,b);else n(b.material,a.fog,b)})};var ya=null,ua=new Rd;ua.setAnimationLoop(function(a){ka.isPresenting()||ya&&ya(a)});"undefined"!==typeof window&&ua.setContext(window);this.setAnimationLoop=function(a){ya=a;ka.setAnimationLoop(a);ua.start()};this.render=function(a,c,d,e){if(!c||!c.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!I){H=b=null;U=!1;Q=-1;V=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===c.parent&&c.updateMatrixWorld();
ka.enabled&&(c=ka.getCamera(c));B=oa.get(a,c);B.init();a.onBeforeRender(P,a,c,d);yc.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);pa.setFromMatrix(yc);Xd=this.localClippingEnabled;qd=ba.init(this.clippingPlanes,Xd,c);A=ta.get(a,c);A.init();k(a,c,P.sortObjects);!0===P.sortObjects&&A.sort();qd&&ba.beginShadows();Aa.render(B.state.shadowsArray,a,c);B.setupLights(c);qd&&ba.endShadows();this.info.autoReset&&this.info.reset();void 0===d&&(d=null);this.setRenderTarget(d);la.render(A,a,c,e);e=
A.opaque;var f=A.transparent;if(a.overrideMaterial){var g=a.overrideMaterial;e.length&&m(e,a,c,g);f.length&&m(f,a,c,g)}else e.length&&m(e,a,c),f.length&&m(f,a,c);d&&ja.updateRenderTargetMipmap(d);ca.buffers.depth.setTest(!0);ca.buffers.depth.setMask(!0);ca.buffers.color.setMask(!0);ca.setPolygonOffset(!1);a.onAfterRender(P,a,c);ka.enabled&&ka.submitFrame();B=A=null}};this.allocTextureUnit=function(){var a=fa;a>=va.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+a+" texture units while this GPU supports only "+
va.maxTextures);fa+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b&&b.isWebGLRenderTarget&&(a||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);ja.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),a=!0);ja.setTexture2D(b,c)}}();this.setTextureCube=function(){var a=
!1;return function(b,c){b&&b.isWebGLRenderTargetCube&&(a||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);b&&b.isCubeTexture||Array.isArray(b.image)&&6===b.image.length?ja.setTextureCube(b,c):ja.setTextureCubeDynamic(b,c)}}();this.setFramebuffer=function(a){F=a};this.getRenderTarget=function(){return L};this.setRenderTarget=function(a){(L=a)&&void 0===Ca.get(a).__webglFramebuffer&&ja.setupRenderTarget(a);
var b=F,c=!1;a?(b=Ca.get(a).__webglFramebuffer,a.isWebGLRenderTargetCube&&(b=b[a.activeCubeFace],c=!0),T.copy(a.viewport),zc.copy(a.scissor),Y=a.scissorTest):(T.copy(cb).multiplyScalar(W),zc.copy(ha).multiplyScalar(W),Y=ra);M!==b&&(C.bindFramebuffer(C.FRAMEBUFFER,b),M=b);ca.viewport(T);ca.scissor(zc);ca.setScissorTest(Y);c&&(c=Ca.get(a.texture),C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,c.__webglTexture,a.activeMipMapLevel))};this.readRenderTargetPixels=
function(a,b,c,d,e,f){if(a&&a.isWebGLRenderTarget){var g=Ca.get(a).__webglFramebuffer;if(g){var h=!1;g!==M&&(C.bindFramebuffer(C.FRAMEBUFFER,g),h=!0);try{var k=a.texture,m=k.format,t=k.type;1023!==m&&ea.convert(m)!==C.getParameter(C.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===t||ea.convert(t)===C.getParameter(C.IMPLEMENTATION_COLOR_READ_TYPE)||1015===t&&(va.isWebGL2||ia.get("OES_texture_float")||
ia.get("WEBGL_color_buffer_float"))||1016===t&&(va.isWebGL2?ia.get("EXT_color_buffer_float"):ia.get("EXT_color_buffer_half_float"))?C.checkFramebufferStatus(C.FRAMEBUFFER)===C.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&C.readPixels(b,c,d,e,ea.convert(m),ea.convert(t),f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{h&&
C.bindFramebuffer(C.FRAMEBUFFER,M)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")};this.copyFramebufferToTexture=function(a,b,c){var d=b.image.width,e=b.image.height,f=ea.convert(b.format);this.setTexture2D(b,0);C.copyTexImage2D(C.TEXTURE_2D,c||0,f,a.x,a.y,d,e,0)};this.copyTextureToTexture=function(a,b,c,d){var e=b.image.width,f=b.image.height,g=ea.convert(c.format),h=ea.convert(c.type);this.setTexture2D(c,0);b.isDataTexture?C.texSubImage2D(C.TEXTURE_2D,
d||0,a.x,a.y,e,f,g,h,b.image.data):C.texSubImage2D(C.TEXTURE_2D,d||0,a.x,a.y,g,h,b.image)}}function Nb(a,b){this.name="";this.color=new F(a);this.density=void 0!==b?b:2.5E-4}function Ob(a,b,c){this.name="";this.color=new F(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3}function rd(){B.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function qb(a,b){this.array=a;this.stride=b;this.count=void 0!==a?a.length/b:0;this.dynamic=!1;this.updateRange=
{offset:0,count:-1};this.version=0}function Bc(a,b,c,d){this.data=a;this.itemSize=b;this.offset=c;this.normalized=!0===d}function eb(a){H.call(this);this.type="SpriteMaterial";this.color=new F(16777215);this.map=null;this.rotation=0;this.sizeAttenuation=!0;this.lights=!1;this.transparent=!0;this.setValues(a)}function Cc(a){B.call(this);this.type="Sprite";if(void 0===Pb){Pb=new I;var b=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);b=new qb(b,5);Pb.setIndex([0,1,2,0,2,3]);
Pb.addAttribute("position",new Bc(b,3,0,!1));Pb.addAttribute("uv",new Bc(b,2,3,!1))}this.geometry=Pb;this.material=void 0!==a?a:new eb;this.center=new z(.5,.5)}function Dc(){B.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Ec(a,b){a=a||[];this.bones=a.slice(0);this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),
this.boneInverses=[],a=0,b=this.bones.length;a<b;a++)this.boneInverses.push(new J)}function sd(){B.call(this);this.type="Bone"}function td(a,b){ta.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new J;this.bindMatrixInverse=new J;a=this.initBones();a=new Ec(a);this.bind(a,this.matrixWorld);this.normalizeSkinWeights()}function V(a){H.call(this);this.type="LineBasicMaterial";this.color=new F(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;
this.setValues(a)}function oa(a,b,c){1===c&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead.");B.call(this);this.type="Line";this.geometry=void 0!==a?a:new I;this.material=void 0!==b?b:new V({color:16777215*Math.random()})}function Z(a,b){oa.call(this,a,b);this.type="LineSegments"}function ud(a,b){oa.call(this,a,b);this.type="LineLoop"}function Fa(a){H.call(this);this.type="PointsMaterial";this.color=new F(16777215);this.map=null;this.size=
1;this.sizeAttenuation=!0;this.lights=this.morphTargets=!1;this.setValues(a)}function Qb(a,b){B.call(this);this.type="Points";this.geometry=void 0!==a?a:new I;this.material=void 0!==b?b:new Fa({color:16777215*Math.random()})}function Zd(a,b,c,d,e,f,g,h,k){T.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1}function Rb(a,b,c,d,e,f,g,h,k,m,t,n){T.call(this,null,f,g,h,k,m,d,e,t,n);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}function Fc(a,b,c,d,e,f,g,h,k){T.call(this,
a,b,c,d,e,f,g,h,k);this.needsUpdate=!0}function Gc(a,b,c,d,e,f,g,h,k,m){m=void 0!==m?m:1026;if(1026!==m&&1027!==m)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&1026===m&&(c=1012);void 0===c&&1027===m&&(c=1020);T.call(this,null,d,e,f,g,h,m,c,k);this.image={width:a,height:b};this.magFilter=void 0!==g?g:1003;this.minFilter=void 0!==h?h:1003;this.generateMipmaps=this.flipY=!1}function Sb(a){I.call(this);this.type="WireframeGeometry";var b=
[],c,d,e,f=[0,0],g={},h=["a","b","c"];if(a&&a.isGeometry){var k=a.faces;var m=0;for(d=k.length;m<d;m++){var t=k[m];for(c=0;3>c;c++){var n=t[h[c]];var q=t[h[(c+1)%3]];f[0]=Math.min(n,q);f[1]=Math.max(n,q);n=f[0]+","+f[1];void 0===g[n]&&(g[n]={index1:f[0],index2:f[1]})}}for(n in g)m=g[n],h=a.vertices[m.index1],b.push(h.x,h.y,h.z),h=a.vertices[m.index2],b.push(h.x,h.y,h.z)}else if(a&&a.isBufferGeometry)if(h=new p,null!==a.index){k=a.attributes.position;t=a.index;var l=a.groups;0===l.length&&(l=[{start:0,
count:t.count,materialIndex:0}]);a=0;for(e=l.length;a<e;++a)for(m=l[a],c=m.start,d=m.count,m=c,d=c+d;m<d;m+=3)for(c=0;3>c;c++)n=t.getX(m+c),q=t.getX(m+(c+1)%3),f[0]=Math.min(n,q),f[1]=Math.max(n,q),n=f[0]+","+f[1],void 0===g[n]&&(g[n]={index1:f[0],index2:f[1]});for(n in g)m=g[n],h.fromBufferAttribute(k,m.index1),b.push(h.x,h.y,h.z),h.fromBufferAttribute(k,m.index2),b.push(h.x,h.y,h.z)}else for(k=a.attributes.position,m=0,d=k.count/3;m<d;m++)for(c=0;3>c;c++)g=3*m+c,h.fromBufferAttribute(k,g),b.push(h.x,
h.y,h.z),g=3*m+(c+1)%3,h.fromBufferAttribute(k,g),b.push(h.x,h.y,h.z);this.addAttribute("position",new A(b,3))}function Hc(a,b,c){M.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};this.fromBufferGeometry(new Tb(a,b,c));this.mergeVertices()}function Tb(a,b,c){I.call(this);this.type="ParametricBufferGeometry";this.parameters={func:a,slices:b,stacks:c};var d=[],e=[],f=[],g=[],h=new p,k=new p,m=new p,t=new p,n=new p,q,l;3>a.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");
var r=b+1;for(q=0;q<=c;q++){var v=q/c;for(l=0;l<=b;l++){var y=l/b;a(y,v,k);e.push(k.x,k.y,k.z);0<=y-1E-5?(a(y-1E-5,v,m),t.subVectors(k,m)):(a(y+1E-5,v,m),t.subVectors(m,k));0<=v-1E-5?(a(y,v-1E-5,m),n.subVectors(k,m)):(a(y,v+1E-5,m),n.subVectors(m,k));h.crossVectors(t,n).normalize();f.push(h.x,h.y,h.z);g.push(y,v)}}for(q=0;q<c;q++)for(l=0;l<b;l++)a=q*r+l+1,h=(q+1)*r+l+1,k=(q+1)*r+l,d.push(q*r+l,a,k),d.push(a,h,k);this.setIndex(d);this.addAttribute("position",new A(e,3));this.addAttribute("normal",
new A(f,3));this.addAttribute("uv",new A(g,2))}function Ic(a,b,c,d){M.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};this.fromBufferGeometry(new la(a,b,c,d));this.mergeVertices()}function la(a,b,c,d){function e(a){h.push(a.x,a.y,a.z)}function f(b,c){b*=3;c.x=a[b+0];c.y=a[b+1];c.z=a[b+2]}function g(a,b,c,d){0>d&&1===a.x&&(k[b]=a.x-1);0===c.x&&0===c.z&&(k[b]=d/2/Math.PI+.5)}I.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,
indices:b,radius:c,detail:d};c=c||1;d=d||0;var h=[],k=[];(function(a){for(var c=new p,d=new p,g=new p,h=0;h<b.length;h+=3){f(b[h+0],c);f(b[h+1],d);f(b[h+2],g);var k,m,l=c,x=d,w=g,G=Math.pow(2,a),D=[];for(m=0;m<=G;m++){D[m]=[];var O=l.clone().lerp(w,m/G),z=x.clone().lerp(w,m/G),E=G-m;for(k=0;k<=E;k++)D[m][k]=0===k&&m===G?O:O.clone().lerp(z,k/E)}for(m=0;m<G;m++)for(k=0;k<2*(G-m)-1;k++)l=Math.floor(k/2),0===k%2?(e(D[m][l+1]),e(D[m+1][l]),e(D[m][l])):(e(D[m][l+1]),e(D[m+1][l+1]),e(D[m+1][l]))}})(d);(function(a){for(var b=
new p,c=0;c<h.length;c+=3)b.x=h[c+0],b.y=h[c+1],b.z=h[c+2],b.normalize().multiplyScalar(a),h[c+0]=b.x,h[c+1]=b.y,h[c+2]=b.z})(c);(function(){for(var a=new p,b=0;b<h.length;b+=3)a.x=h[b+0],a.y=h[b+1],a.z=h[b+2],k.push(Math.atan2(a.z,-a.x)/2/Math.PI+.5,1-(Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5));a=new p;b=new p;for(var c=new p,d=new p,e=new z,f=new z,l=new z,y=0,x=0;y<h.length;y+=9,x+=6){a.set(h[y+0],h[y+1],h[y+2]);b.set(h[y+3],h[y+4],h[y+5]);c.set(h[y+6],h[y+7],h[y+8]);e.set(k[x+0],
k[x+1]);f.set(k[x+2],k[x+3]);l.set(k[x+4],k[x+5]);d.copy(a).add(b).add(c).divideScalar(3);var w=Math.atan2(d.z,-d.x);g(e,x+0,a,w);g(f,x+2,b,w);g(l,x+4,c,w)}for(a=0;a<k.length;a+=6)b=k[a+0],c=k[a+2],d=k[a+4],e=Math.min(b,c,d),.9<Math.max(b,c,d)&&.1>e&&(.2>b&&(k[a+0]+=1),.2>c&&(k[a+2]+=1),.2>d&&(k[a+4]+=1))})();this.addAttribute("position",new A(h,3));this.addAttribute("normal",new A(h.slice(),3));this.addAttribute("uv",new A(k,2));0===d?this.computeVertexNormals():this.normalizeNormals()}function Jc(a,
b){M.call(this);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Ub(a,b));this.mergeVertices()}function Ub(a,b){la.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Kc(a,b){M.call(this);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new rb(a,b));this.mergeVertices()}function rb(a,b){la.call(this,[1,0,0,
-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Lc(a,b){M.call(this);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Vb(a,b));this.mergeVertices()}function Vb(a,b){var c=(1+Math.sqrt(5))/2;la.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,
11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Mc(a,b){M.call(this);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Wb(a,b));this.mergeVertices()}function Wb(a,b){var c=(1+Math.sqrt(5))/2,d=1/c;la.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,
0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Nc(a,b,c,d,e,f){M.call(this);this.type="TubeGeometry";this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,
closed:e};void 0!==f&&console.warn("THREE.TubeGeometry: taper has been removed.");a=new Xb(a,b,c,d,e);this.tangents=a.tangents;this.normals=a.normals;this.binormals=a.binormals;this.fromBufferGeometry(a);this.mergeVertices()}function Xb(a,b,c,d,e){function f(e){t=a.getPointAt(e/b,t);var f=g.normals[e];e=g.binormals[e];for(q=0;q<=d;q++){var m=q/d*Math.PI*2,n=Math.sin(m);m=-Math.cos(m);k.x=m*f.x+n*e.x;k.y=m*f.y+n*e.y;k.z=m*f.z+n*e.z;k.normalize();r.push(k.x,k.y,k.z);h.x=t.x+c*k.x;h.y=t.y+c*k.y;h.z=
t.z+c*k.z;l.push(h.x,h.y,h.z)}}I.call(this);this.type="TubeBufferGeometry";this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,closed:e};b=b||64;c=c||1;d=d||8;e=e||!1;var g=a.computeFrenetFrames(b,e);this.tangents=g.tangents;this.normals=g.normals;this.binormals=g.binormals;var h=new p,k=new p,m=new z,t=new p,n,q,l=[],r=[],v=[],y=[];for(n=0;n<b;n++)f(n);f(!1===e?b:0);for(n=0;n<=b;n++)for(q=0;q<=d;q++)m.x=n/b,m.y=q/d,v.push(m.x,m.y);(function(){for(q=1;q<=b;q++)for(n=1;n<=d;n++){var a=
(d+1)*q+(n-1),c=(d+1)*q+n,e=(d+1)*(q-1)+n;y.push((d+1)*(q-1)+(n-1),a,e);y.push(a,c,e)}})();this.setIndex(y);this.addAttribute("position",new A(l,3));this.addAttribute("normal",new A(r,3));this.addAttribute("uv",new A(v,2))}function Oc(a,b,c,d,e,f,g){M.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void 0!==g&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new Yb(a,
b,c,d,e,f));this.mergeVertices()}function Yb(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.sin(a);b=c/b*a;c=Math.cos(b);e.x=d*(2+c)*.5*Math.cos(a);e.y=d*(2+c)*f*.5;e.z=d*Math.sin(b)*.5}I.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};a=a||1;b=b||.4;c=Math.floor(c)||64;d=Math.floor(d)||8;e=e||2;f=f||3;var h=[],k=[],m=[],t=[],n,q=new p,l=new p,r=new p,v=new p,y=new p,x=new p,w=new p;for(n=0;n<=c;++n){var G=n/c*e*Math.PI*2;
g(G,e,f,a,r);g(G+.01,e,f,a,v);x.subVectors(v,r);w.addVectors(v,r);y.crossVectors(x,w);w.crossVectors(y,x);y.normalize();w.normalize();for(G=0;G<=d;++G){var D=G/d*Math.PI*2,O=-b*Math.cos(D);D=b*Math.sin(D);q.x=r.x+(O*w.x+D*y.x);q.y=r.y+(O*w.y+D*y.y);q.z=r.z+(O*w.z+D*y.z);k.push(q.x,q.y,q.z);l.subVectors(q,r).normalize();m.push(l.x,l.y,l.z);t.push(n/c);t.push(G/d)}}for(G=1;G<=c;G++)for(n=1;n<=d;n++)a=(d+1)*G+(n-1),b=(d+1)*G+n,e=(d+1)*(G-1)+n,h.push((d+1)*(G-1)+(n-1),a,e),h.push(a,b,e);this.setIndex(h);
this.addAttribute("position",new A(k,3));this.addAttribute("normal",new A(m,3));this.addAttribute("uv",new A(t,2))}function Pc(a,b,c,d,e){M.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new Zb(a,b,c,d,e));this.mergeVertices()}function Zb(a,b,c,d,e){I.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||
6;e=e||2*Math.PI;var f=[],g=[],h=[],k=[],m=new p,t=new p,n=new p,q,l;for(q=0;q<=c;q++)for(l=0;l<=d;l++){var r=l/d*e,v=q/c*Math.PI*2;t.x=(a+b*Math.cos(v))*Math.cos(r);t.y=(a+b*Math.cos(v))*Math.sin(r);t.z=b*Math.sin(v);g.push(t.x,t.y,t.z);m.x=a*Math.cos(r);m.y=a*Math.sin(r);n.subVectors(t,m).normalize();h.push(n.x,n.y,n.z);k.push(l/d);k.push(q/c)}for(q=1;q<=c;q++)for(l=1;l<=d;l++)a=(d+1)*(q-1)+l-1,b=(d+1)*(q-1)+l,e=(d+1)*q+l,f.push((d+1)*q+l-1,a,e),f.push(a,b,e);this.setIndex(f);this.addAttribute("position",
new A(g,3));this.addAttribute("normal",new A(h,3));this.addAttribute("uv",new A(k,2))}function af(a,b,c,d,e){for(var f,g=0,h=b,k=c-d;h<c;h+=d)g+=(a[k]-a[h])*(a[h+1]+a[k+1]),k=h;if(e===0<g)for(e=b;e<c;e+=d)f=bf(e,a[e],a[e+1],f);else for(e=c-d;e>=b;e-=d)f=bf(e,a[e],a[e+1],f);f&&sb(f,f.next)&&(Qc(f),f=f.next);return f}function Rc(a,b){if(!a)return a;b||(b=a);do{var c=!1;if(a.steiner||!sb(a,a.next)&&0!==ma(a.prev,a,a.next))a=a.next;else{Qc(a);a=b=a.prev;if(a===a.next)break;c=!0}}while(c||a!==b);return b}
function Sc(a,b,c,d,e,f,g){if(a){if(!g&&f){var h=a,k=h;do null===k.z&&(k.z=$d(k.x,k.y,d,e,f)),k.prevZ=k.prev,k=k.nextZ=k.next;while(k!==h);k.prevZ.nextZ=null;k.prevZ=null;h=k;var m,t,n,l,u=1;do{k=h;var r=h=null;for(t=0;k;){t++;var v=k;for(m=n=0;m<u&&(n++,v=v.nextZ,v);m++);for(l=u;0<n||0<l&&v;)0!==n&&(0===l||!v||k.z<=v.z)?(m=k,k=k.nextZ,n--):(m=v,v=v.nextZ,l--),r?r.nextZ=m:h=m,m.prevZ=r,r=m;k=v}r.nextZ=null;u*=2}while(1<t)}for(h=a;a.prev!==a.next;){k=a.prev;v=a.next;if(f)a:{r=a;l=d;var p=e,x=f;t=r.prev;
n=r;u=r.next;if(0<=ma(t,n,u))r=!1;else{var w=t.x>n.x?t.x>u.x?t.x:u.x:n.x>u.x?n.x:u.x,G=t.y>n.y?t.y>u.y?t.y:u.y:n.y>u.y?n.y:u.y;m=$d(t.x<n.x?t.x<u.x?t.x:u.x:n.x<u.x?n.x:u.x,t.y<n.y?t.y<u.y?t.y:u.y:n.y<u.y?n.y:u.y,l,p,x);l=$d(w,G,l,p,x);for(p=r.nextZ;p&&p.z<=l;){if(p!==r.prev&&p!==r.next&&vd(t.x,t.y,n.x,n.y,u.x,u.y,p.x,p.y)&&0<=ma(p.prev,p,p.next)){r=!1;break a}p=p.nextZ}for(p=r.prevZ;p&&p.z>=m;){if(p!==r.prev&&p!==r.next&&vd(t.x,t.y,n.x,n.y,u.x,u.y,p.x,p.y)&&0<=ma(p.prev,p,p.next)){r=!1;break a}p=
p.prevZ}r=!0}}else a:if(r=a,t=r.prev,n=r,u=r.next,0<=ma(t,n,u))r=!1;else{for(m=r.next.next;m!==r.prev;){if(vd(t.x,t.y,n.x,n.y,u.x,u.y,m.x,m.y)&&0<=ma(m.prev,m,m.next)){r=!1;break a}m=m.next}r=!0}if(r)b.push(k.i/c),b.push(a.i/c),b.push(v.i/c),Qc(a),h=a=v.next;else if(a=v,a===h){if(!g)Sc(Rc(a),b,c,d,e,f,1);else if(1===g){g=b;h=c;k=a;do v=k.prev,r=k.next.next,!sb(v,r)&&cf(v,k,k.next,r)&&Tc(v,r)&&Tc(r,v)&&(g.push(v.i/h),g.push(k.i/h),g.push(r.i/h),Qc(k),Qc(k.next),k=a=r),k=k.next;while(k!==a);a=k;Sc(a,
b,c,d,e,f,2)}else if(2===g)a:{g=a;do{for(h=g.next.next;h!==g.prev;){if(k=g.i!==h.i){k=g;v=h;if(r=k.next.i!==v.i&&k.prev.i!==v.i){b:{r=k;do{if(r.i!==k.i&&r.next.i!==k.i&&r.i!==v.i&&r.next.i!==v.i&&cf(r,r.next,k,v)){r=!0;break b}r=r.next}while(r!==k);r=!1}r=!r}if(r=r&&Tc(k,v)&&Tc(v,k)){r=k;t=!1;n=(k.x+v.x)/2;v=(k.y+v.y)/2;do r.y>v!==r.next.y>v&&r.next.y!==r.y&&n<(r.next.x-r.x)*(v-r.y)/(r.next.y-r.y)+r.x&&(t=!t),r=r.next;while(r!==k);r=t}k=r}if(k){a=df(g,h);g=Rc(g,g.next);a=Rc(a,a.next);Sc(g,b,c,d,e,
f);Sc(a,b,c,d,e,f);break a}h=h.next}g=g.next}while(g!==a)}break}}}}function Mg(a,b){return a.x-b.x}function Ng(a,b){var c=b,d=a.x,e=a.y,f=-Infinity;do{if(e<=c.y&&e>=c.next.y&&c.next.y!==c.y){var g=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(g<=d&&g>f){f=g;if(g===d){if(e===c.y)return c;if(e===c.next.y)return c.next}var h=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!h)return null;if(d===f)return h.prev;b=h;g=h.x;var k=h.y,m=Infinity;for(c=h.next;c!==b;){if(d>=c.x&&c.x>=g&&d!==c.x&&vd(e<k?d:f,e,
g,k,e<k?f:d,e,c.x,c.y)){var t=Math.abs(e-c.y)/(d-c.x);(t<m||t===m&&c.x>h.x)&&Tc(c,a)&&(h=c,m=t)}c=c.next}return h}function $d(a,b,c,d,e){a=32767*(a-c)*e;b=32767*(b-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function Og(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function vd(a,b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-
g)*(b-h)&&0<=(c-g)*(f-h)-(e-g)*(d-h)}function ma(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function sb(a,b){return a.x===b.x&&a.y===b.y}function cf(a,b,c,d){return sb(a,b)&&sb(c,d)||sb(a,d)&&sb(c,b)?!0:0<ma(a,b,c)!==0<ma(a,b,d)&&0<ma(c,d,a)!==0<ma(c,d,b)}function Tc(a,b){return 0>ma(a.prev,a,a.next)?0<=ma(a,b,a.next)&&0<=ma(a,a.prev,b):0>ma(a,b,a.prev)||0>ma(a,a.next,b)}function df(a,b){var c=new ae(a.i,a.x,a.y),d=new ae(b.i,b.x,b.y),e=a.next,f=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=
c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}function bf(a,b,c,d){a=new ae(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function Qc(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function ae(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function ef(a){var b=a.length;2<b&&a[b-1].equals(a[0])&&a.pop()}function ff(a,b){for(var c=0;c<b.length;c++)a.push(b[c].x),
a.push(b[c].y)}function tb(a,b){M.call(this);this.type="ExtrudeGeometry";this.parameters={shapes:a,options:b};this.fromBufferGeometry(new Qa(a,b));this.mergeVertices()}function Qa(a,b){function c(a){function c(a,b,c){b||console.error("THREE.ExtrudeGeometry: vec does not exist");return b.clone().multiplyScalar(c).add(a)}function g(a,b,c){var d=a.x-b.x;var e=a.y-b.y;var f=c.x-a.x;var g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)>Number.EPSILON){var k=Math.sqrt(h),m=Math.sqrt(f*f+g*g);h=b.x-e/k;b=b.y+d/k;
g=((c.x-g/m-h)*g-(c.y+f/m-b)*f)/(d*g-e*f);f=h+d*g-a.x;d=b+e*g-a.y;e=f*f+d*d;if(2>=e)return new z(f,d);e=Math.sqrt(e/2)}else a=!1,d>Number.EPSILON?f>Number.EPSILON&&(a=!0):d<-Number.EPSILON?f<-Number.EPSILON&&(a=!0):Math.sign(e)===Math.sign(g)&&(a=!0),a?(f=-e,e=Math.sqrt(h)):(f=d,d=e,e=Math.sqrt(h/2));return new z(f/e,d/e)}function h(a,b){for(N=a.length;0<=--N;){var c=N;var f=N-1;0>f&&(f=a.length-1);var g,h=w+2*E;for(g=0;g<h;g++){var k=Z*g,m=Z*(g+1),n=b+f+k,t=b+f+m;m=b+c+m;r(b+c+k);r(n);r(m);r(n);
r(t);r(m);k=e.length/3;k=B.generateSideWallUV(d,e,k-6,k-3,k-2,k-1);v(k[0]);v(k[1]);v(k[3]);v(k[1]);v(k[2]);v(k[3])}}}function k(a,b,c){y.push(a);y.push(b);y.push(c)}function l(a,b,c){r(a);r(b);r(c);a=e.length/3;a=B.generateTopUV(d,e,a-3,a-2,a-1);v(a[0]);v(a[1]);v(a[2])}function r(a){e.push(y[3*a]);e.push(y[3*a+1]);e.push(y[3*a+2])}function v(a){f.push(a.x);f.push(a.y)}var y=[],x=void 0!==b.curveSegments?b.curveSegments:12,w=void 0!==b.steps?b.steps:1,G=void 0!==b.depth?b.depth:100,D=void 0!==b.bevelEnabled?
b.bevelEnabled:!0,O=void 0!==b.bevelThickness?b.bevelThickness:6,S=void 0!==b.bevelSize?b.bevelSize:O-2,E=void 0!==b.bevelSegments?b.bevelSegments:3,A=b.extrudePath,B=void 0!==b.UVGenerator?b.UVGenerator:Pg;void 0!==b.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),G=b.amount);var I=!1;if(A){var P=A.getSpacedPoints(w);I=!0;D=!1;var F=A.computeFrenetFrames(w,!1);var L=new p;var R=new p;var M=new p}D||(S=O=E=0);var J;x=a.extractPoints(x);a=x.shape;var Q=x.holes;
if(!Xa.isClockWise(a)){a=a.reverse();var H=0;for(J=Q.length;H<J;H++){var K=Q[H];Xa.isClockWise(K)&&(Q[H]=K.reverse())}}var U=Xa.triangulateShape(a,Q),V=a;H=0;for(J=Q.length;H<J;H++)K=Q[H],a=a.concat(K);var T,Z=a.length,X,aa=U.length;x=[];var N=0;var W=V.length;var Y=W-1;for(T=N+1;N<W;N++,Y++,T++)Y===W&&(Y=0),T===W&&(T=0),x[N]=g(V[N],V[Y],V[T]);A=[];var fa=x.concat();H=0;for(J=Q.length;H<J;H++){K=Q[H];var da=[];N=0;W=K.length;Y=W-1;for(T=N+1;N<W;N++,Y++,T++)Y===W&&(Y=0),T===W&&(T=0),da[N]=g(K[N],K[Y],
K[T]);A.push(da);fa=fa.concat(da)}for(Y=0;Y<E;Y++){W=Y/E;var ea=O*Math.cos(W*Math.PI/2);T=S*Math.sin(W*Math.PI/2);N=0;for(W=V.length;N<W;N++){var ba=c(V[N],x[N],T);k(ba.x,ba.y,-ea)}H=0;for(J=Q.length;H<J;H++)for(K=Q[H],da=A[H],N=0,W=K.length;N<W;N++)ba=c(K[N],da[N],T),k(ba.x,ba.y,-ea)}T=S;for(N=0;N<Z;N++)ba=D?c(a[N],fa[N],T):a[N],I?(R.copy(F.normals[0]).multiplyScalar(ba.x),L.copy(F.binormals[0]).multiplyScalar(ba.y),M.copy(P[0]).add(R).add(L),k(M.x,M.y,M.z)):k(ba.x,ba.y,0);for(W=1;W<=w;W++)for(N=
0;N<Z;N++)ba=D?c(a[N],fa[N],T):a[N],I?(R.copy(F.normals[W]).multiplyScalar(ba.x),L.copy(F.binormals[W]).multiplyScalar(ba.y),M.copy(P[W]).add(R).add(L),k(M.x,M.y,M.z)):k(ba.x,ba.y,G/w*W);for(Y=E-1;0<=Y;Y--){W=Y/E;ea=O*Math.cos(W*Math.PI/2);T=S*Math.sin(W*Math.PI/2);N=0;for(W=V.length;N<W;N++)ba=c(V[N],x[N],T),k(ba.x,ba.y,G+ea);H=0;for(J=Q.length;H<J;H++)for(K=Q[H],da=A[H],N=0,W=K.length;N<W;N++)ba=c(K[N],da[N],T),I?k(ba.x,ba.y+P[w-1].y,P[w-1].x+ea):k(ba.x,ba.y,G+ea)}(function(){var a=e.length/3;if(D){var b=
0*Z;for(N=0;N<aa;N++)X=U[N],l(X[2]+b,X[1]+b,X[0]+b);b=Z*(w+2*E);for(N=0;N<aa;N++)X=U[N],l(X[0]+b,X[1]+b,X[2]+b)}else{for(N=0;N<aa;N++)X=U[N],l(X[2],X[1],X[0]);for(N=0;N<aa;N++)X=U[N],l(X[0]+Z*w,X[1]+Z*w,X[2]+Z*w)}d.addGroup(a,e.length/3-a,0)})();(function(){var a=e.length/3,b=0;h(V,b);b+=V.length;H=0;for(J=Q.length;H<J;H++)K=Q[H],h(K,b),b+=K.length;d.addGroup(a,e.length/3-a,1)})()}I.call(this);this.type="ExtrudeBufferGeometry";this.parameters={shapes:a,options:b};a=Array.isArray(a)?a:[a];for(var d=
this,e=[],f=[],g=0,h=a.length;g<h;g++)c(a[g]);this.addAttribute("position",new A(e,3));this.addAttribute("uv",new A(f,2));this.computeVertexNormals()}function gf(a,b,c){c.shapes=[];if(Array.isArray(a))for(var d=0,e=a.length;d<e;d++)c.shapes.push(a[d].uuid);else c.shapes.push(a.uuid);void 0!==b.extrudePath&&(c.options.extrudePath=b.extrudePath.toJSON());return c}function Uc(a,b){M.call(this);this.type="TextGeometry";this.parameters={text:a,parameters:b};this.fromBufferGeometry(new $b(a,b));this.mergeVertices()}
function $b(a,b){b=b||{};var c=b.font;if(!c||!c.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new M;a=c.generateShapes(a,b.size);b.depth=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);Qa.call(this,a,b);this.type="TextBufferGeometry"}function Vc(a,b,c,d,e,f,g){M.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,
heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new ub(a,b,c,d,e,f,g));this.mergeVertices()}function ub(a,b,c,d,e,f,g){I.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||1;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var h=f+g,k,m,t=0,n=[],l=new p,
u=new p,r=[],v=[],y=[],x=[];for(m=0;m<=c;m++){var w=[],G=m/c;for(k=0;k<=b;k++){var D=k/b;l.x=-a*Math.cos(d+D*e)*Math.sin(f+G*g);l.y=a*Math.cos(f+G*g);l.z=a*Math.sin(d+D*e)*Math.sin(f+G*g);v.push(l.x,l.y,l.z);u.set(l.x,l.y,l.z).normalize();y.push(u.x,u.y,u.z);x.push(D,1-G);w.push(t++)}n.push(w)}for(m=0;m<c;m++)for(k=0;k<b;k++)a=n[m][k+1],d=n[m][k],e=n[m+1][k],g=n[m+1][k+1],(0!==m||0<f)&&r.push(a,d,g),(m!==c-1||h<Math.PI)&&r.push(d,e,g);this.setIndex(r);this.addAttribute("position",new A(v,3));this.addAttribute("normal",
new A(y,3));this.addAttribute("uv",new A(x,2))}function Wc(a,b,c,d,e,f){M.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new ac(a,b,c,d,e,f));this.mergeVertices()}function ac(a,b,c,d,e,f){I.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||.5;b=b||1;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;
c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):1;var g=[],h=[],k=[],m=[],t=a,n=(b-a)/d,l=new p,u=new z,r,v;for(r=0;r<=d;r++){for(v=0;v<=c;v++)a=e+v/c*f,l.x=t*Math.cos(a),l.y=t*Math.sin(a),h.push(l.x,l.y,l.z),k.push(0,0,1),u.x=(l.x/b+1)/2,u.y=(l.y/b+1)/2,m.push(u.x,u.y);t+=n}for(r=0;r<d;r++)for(b=r*(c+1),v=0;v<c;v++)a=v+b,e=a+c+1,f=a+c+2,t=a+1,g.push(a,e,t),g.push(e,f,t);this.setIndex(g);this.addAttribute("position",new A(h,3));this.addAttribute("normal",new A(k,3));this.addAttribute("uv",
new A(m,2))}function Xc(a,b,c,d){M.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new bc(a,b,c,d));this.mergeVertices()}function bc(a,b,c,d){I.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||2*Math.PI;d=K.clamp(d,0,2*Math.PI);var e=[],f=[],g=[],h=1/b,k=new p,m=new z,t;for(t=0;t<=b;t++){var n=c+t*h*d;var l=Math.sin(n),u=Math.cos(n);for(n=
0;n<=a.length-1;n++)k.x=a[n].x*l,k.y=a[n].y,k.z=a[n].x*u,f.push(k.x,k.y,k.z),m.x=t/b,m.y=n/(a.length-1),g.push(m.x,m.y)}for(t=0;t<b;t++)for(n=0;n<a.length-1;n++)c=n+t*a.length,h=c+a.length,k=c+a.length+1,m=c+1,e.push(c,h,m),e.push(h,k,m);this.setIndex(e);this.addAttribute("position",new A(f,3));this.addAttribute("uv",new A(g,2));this.computeVertexNormals();if(d===2*Math.PI)for(d=this.attributes.normal.array,e=new p,f=new p,g=new p,c=b*a.length*3,n=t=0;t<a.length;t++,n+=3)e.x=d[n+0],e.y=d[n+1],e.z=
d[n+2],f.x=d[c+n+0],f.y=d[c+n+1],f.z=d[c+n+2],g.addVectors(e,f).normalize(),d[n+0]=d[c+n+0]=g.x,d[n+1]=d[c+n+1]=g.y,d[n+2]=d[c+n+2]=g.z}function vb(a,b){M.call(this);this.type="ShapeGeometry";"object"===typeof b&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),b=b.curveSegments);this.parameters={shapes:a,curveSegments:b};this.fromBufferGeometry(new wb(a,b));this.mergeVertices()}function wb(a,b){function c(a){var c,h=e.length/3;a=a.extractPoints(b);var m=a.shape,t=a.holes;
if(!1===Xa.isClockWise(m))for(m=m.reverse(),a=0,c=t.length;a<c;a++){var l=t[a];!0===Xa.isClockWise(l)&&(t[a]=l.reverse())}var p=Xa.triangulateShape(m,t);a=0;for(c=t.length;a<c;a++)l=t[a],m=m.concat(l);a=0;for(c=m.length;a<c;a++)l=m[a],e.push(l.x,l.y,0),f.push(0,0,1),g.push(l.x,l.y);a=0;for(c=p.length;a<c;a++)m=p[a],d.push(m[0]+h,m[1]+h,m[2]+h),k+=3}I.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:a,curveSegments:b};b=b||12;var d=[],e=[],f=[],g=[],h=0,k=0;if(!1===Array.isArray(a))c(a);
else for(var m=0;m<a.length;m++)c(a[m]),this.addGroup(h,k,m),h+=k,k=0;this.setIndex(d);this.addAttribute("position",new A(e,3));this.addAttribute("normal",new A(f,3));this.addAttribute("uv",new A(g,2))}function hf(a,b){b.shapes=[];if(Array.isArray(a))for(var c=0,d=a.length;c<d;c++)b.shapes.push(a[c].uuid);else b.shapes.push(a.uuid);return b}function cc(a,b){I.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:b};var c=[];b=Math.cos(K.DEG2RAD*(void 0!==b?b:1));var d=[0,0],e={},f=
["a","b","c"];if(a.isBufferGeometry){var g=new M;g.fromBufferGeometry(a)}else g=a.clone();g.mergeVertices();g.computeFaceNormals();a=g.vertices;g=g.faces;for(var h=0,k=g.length;h<k;h++)for(var m=g[h],t=0;3>t;t++){var n=m[f[t]];var l=m[f[(t+1)%3]];d[0]=Math.min(n,l);d[1]=Math.max(n,l);n=d[0]+","+d[1];void 0===e[n]?e[n]={index1:d[0],index2:d[1],face1:h,face2:void 0}:e[n].face2=h}for(n in e)if(d=e[n],void 0===d.face2||g[d.face1].normal.dot(g[d.face2].normal)<=b)f=a[d.index1],c.push(f.x,f.y,f.z),f=a[d.index2],
c.push(f.x,f.y,f.z);this.addAttribute("position",new A(c,3))}function xb(a,b,c,d,e,f,g,h){M.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new Ya(a,b,c,d,e,f,g,h));this.mergeVertices()}function Ya(a,b,c,d,e,f,g,h){function k(c){var e,f=new z,k=new p,q=0,v=!0===c?a:b,w=!0===c?1:-1;var A=r;for(e=1;e<=d;e++)n.push(0,y*w,0),l.push(0,w,0),u.push(.5,.5),r++;var B=
r;for(e=0;e<=d;e++){var P=e/d*h+g,I=Math.cos(P);P=Math.sin(P);k.x=v*P;k.y=y*w;k.z=v*I;n.push(k.x,k.y,k.z);l.push(0,w,0);f.x=.5*I+.5;f.y=.5*P*w+.5;u.push(f.x,f.y);r++}for(e=0;e<d;e++)f=A+e,k=B+e,!0===c?t.push(k,k+1,f):t.push(k+1,k,f),q+=3;m.addGroup(x,q,!0===c?1:2);x+=q}I.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var m=this;a=void 0!==a?a:1;b=void 0!==b?b:1;c=c||1;d=Math.floor(d)||
8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var t=[],n=[],l=[],u=[],r=0,v=[],y=c/2,x=0;(function(){var f,k,q=new p,O=new p,z=0,E=(b-a)/c;for(k=0;k<=e;k++){var A=[],B=k/e,I=B*(b-a)+a;for(f=0;f<=d;f++){var P=f/d,H=P*h+g,F=Math.sin(H);H=Math.cos(H);O.x=I*F;O.y=-B*c+y;O.z=I*H;n.push(O.x,O.y,O.z);q.set(F,E,H).normalize();l.push(q.x,q.y,q.z);u.push(P,1-B);A.push(r++)}v.push(A)}for(f=0;f<d;f++)for(k=0;k<e;k++)q=v[k+1][f],O=v[k+1][f+1],E=v[k][f+1],t.push(v[k][f],q,E),
t.push(q,O,E),z+=6;m.addGroup(x,z,0);x+=z})();!1===f&&(0<a&&k(!0),0<b&&k(!1));this.setIndex(t);this.addAttribute("position",new A(n,3));this.addAttribute("normal",new A(l,3));this.addAttribute("uv",new A(u,2))}function Yc(a,b,c,d,e,f,g){xb.call(this,0,a,b,c,d,e,f,g);this.type="ConeGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function Zc(a,b,c,d,e,f,g){Ya.call(this,0,a,b,c,d,e,f,g);this.type="ConeBufferGeometry";this.parameters=
{radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function $c(a,b,c,d){M.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new dc(a,b,c,d));this.mergeVertices()}function dc(a,b,c,d){I.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||1;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=[],f=
[],g=[],h=[],k,m=new p,t=new z;f.push(0,0,0);g.push(0,0,1);h.push(.5,.5);var n=0;for(k=3;n<=b;n++,k+=3){var l=c+n/b*d;m.x=a*Math.cos(l);m.y=a*Math.sin(l);f.push(m.x,m.y,m.z);g.push(0,0,1);t.x=(f[k]/a+1)/2;t.y=(f[k+1]/a+1)/2;h.push(t.x,t.y)}for(k=1;k<=b;k++)e.push(k,k+1,0);this.setIndex(e);this.addAttribute("position",new A(f,3));this.addAttribute("normal",new A(g,3));this.addAttribute("uv",new A(h,2))}function yb(a){H.call(this);this.type="ShadowMaterial";this.color=new F(0);this.transparent=!0;this.setValues(a)}
function ec(a){ua.call(this,a);this.type="RawShaderMaterial"}function Ra(a){H.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new F(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new F(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new z(1,1);this.displacementMap=null;this.displacementScale=
1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function zb(a){Ra.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)}function Ga(a){H.call(this);
this.type="MeshPhongMaterial";this.color=new F(16777215);this.specular=new F(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new F(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new z(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;
this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function Ab(a){Ga.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(a)}function Bb(a){H.call(this);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new z(1,1);this.displacementMap=
null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1;this.setValues(a)}function Cb(a){H.call(this);this.type="MeshLambertMaterial";this.color=new F(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new F(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=
1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function Db(a){V.call(this);this.type="LineDashedMaterial";this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(a)}function be(a,b,c){var d=this,e=!1,f=0,g=0,h=void 0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void 0!==d.onStart)d.onStart(a,
f,g);e=!0};this.itemEnd=function(a){f++;if(void 0!==d.onProgress)d.onProgress(a,f,g);if(f===g&&(e=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(a){if(void 0!==d.onError)d.onError(a)};this.resolveURL=function(a){return h?h(a):a};this.setURLModifier=function(a){h=a;return this}}function Ha(a){this.manager=void 0!==a?a:wa}function jf(a){this.manager=void 0!==a?a:wa;this._parser=null}function ce(a){this.manager=void 0!==a?a:wa;this._parser=null}function ad(a){this.manager=void 0!==a?a:wa}
function de(a){this.manager=void 0!==a?a:wa}function wd(a){this.manager=void 0!==a?a:wa}function L(){this.type="Curve";this.arcLengthDivisions=200}function Aa(a,b,c,d,e,f,g,h){L.call(this);this.type="EllipseCurve";this.aX=a||0;this.aY=b||0;this.xRadius=c||1;this.yRadius=d||1;this.aStartAngle=e||0;this.aEndAngle=f||2*Math.PI;this.aClockwise=g||!1;this.aRotation=h||0}function fc(a,b,c,d,e,f){Aa.call(this,a,b,c,c,d,e,f);this.type="ArcCurve"}function ee(){var a=0,b=0,c=0,d=0;return{initCatmullRom:function(e,
f,g,h,k){e=k*(g-e);h=k*(h-f);a=f;b=e;c=-3*f+3*g-2*e-h;d=2*f-2*g+e+h},initNonuniformCatmullRom:function(e,f,g,h,k,m,t){e=((f-e)/k-(g-e)/(k+m)+(g-f)/m)*m;h=((g-f)/m-(h-f)/(m+t)+(h-g)/t)*m;a=f;b=e;c=-3*f+3*g-2*e-h;d=2*f-2*g+e+h},calc:function(e){var f=e*e;return a+b*e+c*f+d*f*e}}}function ja(a,b,c,d){L.call(this);this.type="CatmullRomCurve3";this.points=a||[];this.closed=b||!1;this.curveType=c||"centripetal";this.tension=d||.5}function kf(a,b,c,d,e){b=.5*(d-b);e=.5*(e-c);var f=a*a;return(2*c-2*d+b+e)*
a*f+(-3*c+3*d-2*b-e)*f+b*a+c}function bd(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}function cd(a,b,c,d,e){var f=1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}function Ia(a,b,c,d){L.call(this);this.type="CubicBezierCurve";this.v0=a||new z;this.v1=b||new z;this.v2=c||new z;this.v3=d||new z}function Sa(a,b,c,d){L.call(this);this.type="CubicBezierCurve3";this.v0=a||new p;this.v1=b||new p;this.v2=c||new p;this.v3=d||new p}function xa(a,b){L.call(this);this.type="LineCurve";this.v1=a||
new z;this.v2=b||new z}function Ja(a,b){L.call(this);this.type="LineCurve3";this.v1=a||new p;this.v2=b||new p}function Ka(a,b,c){L.call(this);this.type="QuadraticBezierCurve";this.v0=a||new z;this.v1=b||new z;this.v2=c||new z}function Ta(a,b,c){L.call(this);this.type="QuadraticBezierCurve3";this.v0=a||new p;this.v1=b||new p;this.v2=c||new p}function La(a){L.call(this);this.type="SplineCurve";this.points=a||[]}function Za(){L.call(this);this.type="CurvePath";this.curves=[];this.autoClose=!1}function Ma(a){Za.call(this);
this.type="Path";this.currentPoint=new z;a&&this.setFromPoints(a)}function fb(a){Ma.call(this,a);this.uuid=K.generateUUID();this.type="Shape";this.holes=[]}function fa(a,b){B.call(this);this.type="Light";this.color=new F(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0}function xd(a,b,c){fa.call(this,a,c);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(B.DefaultUp);this.updateMatrix();this.groundColor=new F(b)}function Eb(a){this.camera=a;this.bias=0;this.radius=1;
this.mapSize=new z(512,512);this.map=null;this.matrix=new J}function yd(){Eb.call(this,new X(50,1,.5,500))}function zd(a,b,c,d,e,f){fa.call(this,a,b);this.type="SpotLight";this.position.copy(B.DefaultUp);this.updateMatrix();this.target=new B;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==e?e:0;this.decay=void 0!==f?f:1;this.shadow=new yd}
function Ad(a,b,c,d){fa.call(this,a,b);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==d?d:1;this.shadow=new Eb(new X(90,1,.5,500))}function Bd(){Eb.call(this,new Jb(-5,5,5,-5,.5,500))}function Cd(a,b){fa.call(this,a,b);this.type="DirectionalLight";this.position.copy(B.DefaultUp);this.updateMatrix();this.target=new B;this.shadow=new Bd}function Dd(a,
b){fa.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0}function Ed(a,b,c,d){fa.call(this,a,b);this.type="RectAreaLight";this.width=void 0!==c?c:10;this.height=void 0!==d?d:10}function ya(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c}function Fd(a,b,c,d){ya.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function dd(a,b,c,d){ya.call(this,a,b,c,d)}
function Gd(a,b,c,d){ya.call(this,a,b,c,d)}function pa(a,b,c,d){if(void 0===a)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===b||0===b.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a;this.times=qa.convertArray(b,this.TimeBufferType);this.values=qa.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation)}function Hd(a,b,c){pa.call(this,a,b,c)}function Id(a,b,c,d){pa.call(this,a,b,c,d)}function gc(a,b,c,d){pa.call(this,
a,b,c,d)}function Jd(a,b,c,d){ya.call(this,a,b,c,d)}function ed(a,b,c,d){pa.call(this,a,b,c,d)}function Kd(a,b,c,d){pa.call(this,a,b,c,d)}function hc(a,b,c,d){pa.call(this,a,b,c,d)}function Da(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=K.generateUUID();0>this.duration&&this.resetDuration()}function Qg(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return gc;case "vector":case "vector2":case "vector3":case "vector4":return hc;
case "color":return Id;case "quaternion":return ed;case "bool":case "boolean":return Hd;case "string":return Kd}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+a);}function Rg(a){if(void 0===a.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var b=Qg(a.type);if(void 0===a.times){var c=[],d=[];qa.flattenJSON(a.keys,c,d,"value");a.times=c;a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)}function Ld(a){this.manager=void 0!==
a?a:wa;this.textures={}}function fe(a){this.manager=void 0!==a?a:wa}function ic(){}function ge(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:wa;this.withCredentials=!1}function lf(a){this.manager=void 0!==a?a:wa;this.texturePath=""}function he(a){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.");"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported.");
this.manager=void 0!==a?a:wa;this.options=void 0}function ie(){this.type="ShapePath";this.color=new F;this.subPaths=[];this.currentPath=null}function je(a){this.type="Font";this.data=a}function mf(a){this.manager=void 0!==a?a:wa}function ke(a){this.manager=void 0!==a?a:wa}function nf(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new X;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new X;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=
!1}function fd(a,b,c){B.call(this);this.type="CubeCamera";var d=new X(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new p(1,0,0));this.add(d);var e=new X(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new p(-1,0,0));this.add(e);var f=new X(90,1,a,b);f.up.set(0,0,1);f.lookAt(new p(0,1,0));this.add(f);var g=new X(90,1,a,b);g.up.set(0,0,-1);g.lookAt(new p(0,-1,0));this.add(g);var h=new X(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new p(0,0,1));this.add(h);var k=new X(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new p(0,0,-1));this.add(k);
this.renderTarget=new Ib(c,c,{format:1022,magFilter:1006,minFilter:1006});this.renderTarget.texture.name="CubeCamera";this.update=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,m=c.texture.generateMipmaps;c.texture.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=m;c.activeCubeFace=5;a.render(b,
k,c);a.setRenderTarget(null)};this.clear=function(a,b,c,d){for(var e=this.renderTarget,f=0;6>f;f++)e.activeCubeFace=f,a.setRenderTarget(e),a.clear(b,c,d);a.setRenderTarget(null)}}function le(){B.call(this);this.type="AudioListener";this.context=me.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function jc(a){B.call(this);this.type="Audio";this.context=a.context;this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=
!1;this.buffer=null;this.loop=!1;this.offset=this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function ne(a){jc.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function oe(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)}function pe(a,b,c){this.binding=a;this.valueSize=
c;a=Float64Array;switch(b){case "quaternion":b=this._slerp;break;case "string":case "bool":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0}function of(a,b,c){c=c||sa.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)}function sa(a,b,c){this.path=b;this.parsedPath=c||sa.parseTrackName(b);this.node=sa.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a}function pf(){this.uuid=
K.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var b=0,c=arguments.length;b!==c;++b)a[arguments[b].uuid]=b;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}function qf(a,b,c){this._mixer=a;this._clip=b;this._localRoot=
c||null;a=b.tracks;b=a.length;c=Array(b);for(var d={endingStart:2400,endingEnd:2400},e=0;e!==b;++e){var f=a[e].createInterpolant(null);c[e]=f;f.settings=d}this._interpolantSettings=d;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;
this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function qe(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function Md(a,b){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=b);this.value=a}function re(){I.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function se(a,b,c){qb.call(this,a,b);this.meshPerAttribute=c||1}function te(a,b,c,d){"number"===
typeof c&&(d=c,c=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));Q.call(this,a,b,c);this.meshPerAttribute=d||1}function rf(a,b,c,d){this.ray=new ob(a,b);this.near=c||0;this.far=d||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function sf(a,
b){return a.distance-b.distance}function ue(a,b,c,d){if(!1!==a.visible&&(a.raycast(b,c),!0===d)){a=a.children;d=0;for(var e=a.length;d<e;d++)ue(a[d],b,c,!0)}}function tf(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function uf(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this}function vf(a,b,c){this.radius=void 0!==a?a:1;this.theta=void 0!==b?b:0;this.y=void 0!==c?c:0;return this}function ve(a,b){this.min=
void 0!==a?a:new z(Infinity,Infinity);this.max=void 0!==b?b:new z(-Infinity,-Infinity)}function we(a,b){this.start=void 0!==a?a:new p;this.end=void 0!==b?b:new p}function gd(a){B.call(this);this.material=a;this.render=function(){}}function hd(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;b=0;(c=this.object.geometry)&&c.isGeometry?b=3*c.faces.length:c&&c.isBufferGeometry&&(b=c.attributes.normal.count);c=new I;b=new A(6*b,3);c.addAttribute("position",b);Z.call(this,
c,new V({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function kc(a,b){B.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=b;a=new I;b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var c=0,d=1;32>c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute("position",new A(b,3));b=new V({fog:!1});this.cone=new Z(a,b);this.add(this.cone);
this.update()}function wf(a){var b=[];a&&a.isBone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,wf(a.children[c]));return b}function lc(a){for(var b=wf(a),c=new I,d=[],e=[],f=new F(0,0,1),g=new F(0,1,0),h=0;h<b.length;h++){var k=b[h];k.parent&&k.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),e.push(f.r,f.g,f.b),e.push(g.r,g.g,g.b))}c.addAttribute("position",new A(d,3));c.addAttribute("color",new A(e,3));d=new V({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Z.call(this,c,
d);this.root=a;this.bones=b;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1}function mc(a,b,c){this.light=a;this.light.updateMatrixWorld();this.color=c;a=new ub(b,4,2);b=new ka({wireframe:!0,fog:!1});ta.call(this,a,b);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function nc(a,b){B.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=b;a=new V({fog:!1});b=new I;b.addAttribute("position",new Q(new Float32Array(15),
3));this.line=new oa(b,a);this.add(this.line);this.update()}function oc(a,b,c){B.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=c;a=new rb(b);a.rotateY(.5*Math.PI);this.material=new ka({wireframe:!0,fog:!1});void 0===this.color&&(this.material.vertexColors=2);b=a.getAttribute("position");b=new Float32Array(3*b.count);a.addAttribute("color",new Q(b,3));this.add(new ta(a,this.material));this.update()}function id(a,b,c,d){a=a||10;
b=b||10;c=new F(void 0!==c?c:4473924);d=new F(void 0!==d?d:8947848);var e=b/2,f=a/b,g=a/2;a=[];for(var h=[],k=0,m=0,t=-g;k<=b;k++,t+=f){a.push(-g,0,t,g,0,t);a.push(t,0,-g,t,0,g);var n=k===e?c:d;n.toArray(h,m);m+=3;n.toArray(h,m);m+=3;n.toArray(h,m);m+=3;n.toArray(h,m);m+=3}b=new I;b.addAttribute("position",new A(a,3));b.addAttribute("color",new A(h,3));c=new V({vertexColors:2});Z.call(this,b,c)}function Nd(a,b,c,d,e,f){a=a||10;b=b||16;c=c||8;d=d||64;e=new F(void 0!==e?e:4473924);f=new F(void 0!==
f?f:8947848);var g=[],h=[],k;for(k=0;k<=b;k++){var m=k/b*2*Math.PI;var t=Math.sin(m)*a;m=Math.cos(m)*a;g.push(0,0,0);g.push(t,0,m);var n=k&1?e:f;h.push(n.r,n.g,n.b);h.push(n.r,n.g,n.b)}for(k=0;k<=c;k++){n=k&1?e:f;var l=a-a/c*k;for(b=0;b<d;b++)m=b/d*2*Math.PI,t=Math.sin(m)*l,m=Math.cos(m)*l,g.push(t,0,m),h.push(n.r,n.g,n.b),m=(b+1)/d*2*Math.PI,t=Math.sin(m)*l,m=Math.cos(m)*l,g.push(t,0,m),h.push(n.r,n.g,n.b)}a=new I;a.addAttribute("position",new A(g,3));a.addAttribute("color",new A(h,3));g=new V({vertexColors:2});
Z.call(this,a,g)}function jd(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=0;(c=this.object.geometry)&&c.isGeometry?b=c.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");c=new I;b=new A(6*b,3);c.addAttribute("position",b);Z.call(this,c,new V({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function pc(a,b,c){B.call(this);this.light=a;this.light.updateMatrixWorld();
this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=c;void 0===b&&(b=1);a=new I;a.addAttribute("position",new A([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));b=new V({fog:!1});this.lightPlane=new oa(a,b);this.add(this.lightPlane);a=new I;a.addAttribute("position",new A([0,0,0,0,0,1],3));this.targetLine=new oa(a,b);this.add(this.targetLine);this.update()}function kd(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){f.push(0,0,0);g.push(b.r,b.g,b.b);void 0===h[a]&&(h[a]=[]);h[a].push(f.length/
3-1)}var d=new I,e=new V({color:16777215,vertexColors:1}),f=[],g=[],h={},k=new F(16755200),m=new F(16711680),t=new F(43775),n=new F(16777215),l=new F(3355443);b("n1","n2",k);b("n2","n4",k);b("n4","n3",k);b("n3","n1",k);b("f1","f2",k);b("f2","f4",k);b("f4","f3",k);b("f3","f1",k);b("n1","f1",k);b("n2","f2",k);b("n3","f3",k);b("n4","f4",k);b("p","n1",m);b("p","n2",m);b("p","n3",m);b("p","n4",m);b("u1","u2",t);b("u2","u3",t);b("u3","u1",t);b("c","t",n);b("p","c",l);b("cn1","cn2",l);b("cn3","cn4",l);b("cf1",
"cf2",l);b("cf3","cf4",l);d.addAttribute("position",new A(f,3));d.addAttribute("color",new A(g,3));Z.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=h;this.update()}function Fb(a,b){this.object=a;void 0===b&&(b=16776960);a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var c=new Float32Array(24),d=new I;d.setIndex(new Q(a,1));d.addAttribute("position",new Q(c,
3));Z.call(this,d,new V({color:b}));this.matrixAutoUpdate=!1;this.update()}function ld(a,b){this.type="Box3Helper";this.box=a;a=void 0!==b?b:16776960;b=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var c=new I;c.setIndex(new Q(b,1));c.addAttribute("position",new A([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));Z.call(this,c,new V({color:a}));this.geometry.computeBoundingSphere()}function md(a,b,c){this.type="PlaneHelper";this.plane=a;this.size=void 0===b?1:
b;a=void 0!==c?c:16776960;b=new I;b.addAttribute("position",new A([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3));b.computeBoundingSphere();oa.call(this,b,new V({color:a}));b=new I;b.addAttribute("position",new A([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3));b.computeBoundingSphere();this.add(new ta(b,new ka({color:a,opacity:.2,transparent:!0,depthWrite:!1})))}function Gb(a,b,c,d,e,f){B.call(this);void 0===d&&(d=16776960);void 0===c&&(c=1);void 0===e&&(e=.2*c);void 0===
f&&(f=.2*e);void 0===Od&&(Od=new I,Od.addAttribute("position",new A([0,0,0,0,1,0],3)),xe=new Ya(0,.5,1,5,1),xe.translate(0,-.5,0));this.position.copy(b);this.line=new oa(Od,new V({color:d}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new ta(xe,new ka({color:d}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(c,e,f)}function nd(a){a=a||1;var b=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a];a=new I;a.addAttribute("position",new A(b,3));a.addAttribute("color",
new A([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));b=new V({vertexColors:2});Z.call(this,a,b)}function xf(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");ja.call(this,a);this.type="catmullrom";this.closed=!0}function yf(a){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");ja.call(this,a);this.type="catmullrom"}function ye(a){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");
ja.call(this,a);this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Number.isInteger&&(Number.isInteger=function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a});void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});!1==="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===
a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b}}();Object.assign(ea.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;
var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;b=b.slice(0);for(var c=0,d=b.length;c<d;c++)b[c].call(this,a)}}}});var K={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var a=[],b=0;256>b;b++)a[b]=(16>b?"0":"")+b.toString(16);
return function(){var b=4294967295*Math.random()|0,d=4294967295*Math.random()|0,e=4294967295*Math.random()|0,f=4294967295*Math.random()|0;return(a[b&255]+a[b>>8&255]+a[b>>16&255]+a[b>>24&255]+"-"+a[d&255]+a[d>>8&255]+"-"+a[d>>16&15|64]+a[d>>24&255]+"-"+a[e&63|128]+a[e>>8&255]+"-"+a[e>>16&255]+a[e>>24&255]+a[f&255]+a[f>>8&255]+a[f>>16&255]+a[f>>24&255]).toUpperCase()}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,
d,e){return d+(a-b)*(e-d)/(c-b)},lerp:function(a,b,c){return(1-c)*a+c*b},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*K.DEG2RAD},radToDeg:function(a){return a*
K.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},ceilPowerOfTwo:function(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},floorPowerOfTwo:function(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}};Object.defineProperties(z.prototype,{width:{get:function(){return this.x},set:function(a){this.x=a}},height:{get:function(){return this.y},set:function(a){this.y=a}}});Object.assign(z.prototype,{isVector2:!0,set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=
this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,
b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},applyMatrix3:function(a){var b=this.x,c=this.y;a=a.elements;this.x=a[0]*b+a[3]*c+a[6];this.y=
a[1]*b+a[4]*c+a[7];return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a=new z,b=new z;return function(c,d){a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.divideScalar(c||
1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*
a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=
this.x-a.x;a=this.y-a.y;return b*b+a*a},manhattanDistanceTo:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,
b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromBufferAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().");this.x=a.getX(b);this.y=a.getY(b);return this},rotateAround:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=this.x-a.x,e=this.y-a.y;this.x=d*c-e*b+a.x;this.y=d*b+e*c+a.y;return this}});Object.assign(J.prototype,{isMatrix4:!0,set:function(a,b,c,d,e,f,g,h,k,m,t,n,l,u,r,p){var q=this.elements;
q[0]=a;q[4]=b;q[8]=c;q[12]=d;q[1]=e;q[5]=f;q[9]=g;q[13]=h;q[2]=k;q[6]=m;q[10]=t;q[14]=n;q[3]=l;q[7]=u;q[11]=r;q[15]=p;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new J).fromArray(this.elements)},copy:function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this},copyPosition:function(a){var b=
this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new p;return function(b){var c=this.elements,d=b.elements,e=1/a.setFromMatrixColumn(b,0).length(),f=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,
2).length();c[0]=d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[3]=0;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[7]=0;c[8]=d[8]*b;c[9]=d[9]*b;c[10]=d[10]*b;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return this}}(),makeRotationFromEuler:function(a){a&&a.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=
f*h;var k=f*e,m=c*h,t=c*e;b[0]=g*h;b[4]=-g*e;b[8]=d;b[1]=k+m*d;b[5]=a-t*d;b[9]=-c*g;b[2]=t-a*d;b[6]=m+k*d;b[10]=f*g}else"YXZ"===a.order?(a=g*h,k=g*e,m=d*h,t=d*e,b[0]=a+t*c,b[4]=m*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-m,b[6]=t+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*h,k=g*e,m=d*h,t=d*e,b[0]=a-t*c,b[4]=-f*e,b[8]=m+k*c,b[1]=k+m*c,b[5]=f*h,b[9]=t-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,k=f*e,m=c*h,t=c*e,b[0]=g*h,b[4]=m*d-k,b[8]=a*d+t,b[1]=g*e,b[5]=t*d+a,b[9]=k*d-m,b[2]=-d,b[6]=c*
g,b[10]=f*g):"YZX"===a.order?(a=f*g,k=f*d,m=c*g,t=c*d,b[0]=g*h,b[4]=t-a*e,b[8]=m*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+m,b[10]=a-t*e):"XZY"===a.order&&(a=f*g,k=f*d,m=c*g,t=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+t,b[5]=f*h,b[9]=k*e-m,b[2]=m*e-k,b[6]=c*h,b[10]=t*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(){var a=new p(0,0,0),b=new p(1,1,1);return function(c){return this.compose(a,c,b)}}(),lookAt:function(){var a=new p,b=new p,
c=new p;return function(d,e,f){var g=this.elements;c.subVectors(d,e);0===c.lengthSq()&&(c.z=1);c.normalize();a.crossVectors(f,c);0===a.lengthSq()&&(1===Math.abs(f.z)?c.x+=1E-4:c.z+=1E-4,c.normalize(),a.crossVectors(f,c));a.normalize();b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),
this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=c[8],g=c[12],h=c[1],k=c[5],m=c[9],t=c[13],n=c[2],l=c[6],u=c[10],r=c[14],p=c[3],y=c[7],x=c[11];c=c[15];var w=d[0],G=d[4],D=d[8],O=d[12],z=d[1],E=d[5],A=d[9],B=d[13],I=d[2],H=d[6],F=d[10],L=d[14],M=d[3],J=d[7],K=d[11];d=d[15];b[0]=a*w+e*z+f*I+g*M;b[4]=a*G+e*E+f*H+g*J;b[8]=a*D+e*A+f*F+
g*K;b[12]=a*O+e*B+f*L+g*d;b[1]=h*w+k*z+m*I+t*M;b[5]=h*G+k*E+m*H+t*J;b[9]=h*D+k*A+m*F+t*K;b[13]=h*O+k*B+m*L+t*d;b[2]=n*w+l*z+u*I+r*M;b[6]=n*G+l*E+u*H+r*J;b[10]=n*D+l*A+u*F+r*K;b[14]=n*O+l*B+u*L+r*d;b[3]=p*w+y*z+x*I+c*M;b[7]=p*G+y*E+x*H+c*J;b[11]=p*D+y*A+x*F+c*K;b[15]=p*O+y*B+x*L+c*d;return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToBufferAttribute:function(){var a=
new p;return function(b){for(var c=0,d=b.count;c<d;c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(c,a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],k=a[13],m=a[2],l=a[6],n=a[10],q=a[14];return a[3]*(+e*h*l-d*k*l-e*g*n+c*k*n+d*g*q-c*h*q)+a[7]*(+b*h*q-b*k*n+e*f*n-d*f*q+d*k*m-e*h*m)+a[11]*(+b*k*l-b*g*q-e*f*l+c*f*q+e*g*m-c*k*m)+a[15]*(-d*g*m-b*h*l+b*g*n+d*f*l-c*f*n+c*h*m)},transpose:function(){var a=this.elements;
var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var e=d[1],f=d[2],g=d[3],h=d[4],k=d[5],m=d[6],l=d[7],n=d[8],q=d[9],u=d[10],r=d[11],p=d[12],y=d[13],x=d[14];d=d[15];var w=q*x*l-y*u*l+y*m*r-k*x*r-q*m*d+k*u*d,G=p*u*l-n*x*l-p*m*r+h*x*
r+n*m*d-h*u*d,D=n*y*l-p*q*l+p*k*r-h*y*r-n*k*d+h*q*d,O=p*q*m-n*y*m-p*k*u+h*y*u+n*k*x-h*q*x,z=a*w+e*G+f*D+g*O;if(0===z){if(!0===b)throw Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return this.identity()}b=1/z;c[0]=w*b;c[1]=(y*u*g-q*x*g-y*f*r+e*x*r+q*f*d-e*u*d)*b;c[2]=(k*x*g-y*m*g+y*f*l-e*x*l-k*f*d+e*m*d)*b;c[3]=(q*m*g-k*u*g-q*f*l+e*u*l+k*f*r-e*m*r)*b;c[4]=G*b;c[5]=(n*x*g-p*u*g+p*f*r-a*
x*r-n*f*d+a*u*d)*b;c[6]=(p*m*g-h*x*g-p*f*l+a*x*l+h*f*d-a*m*d)*b;c[7]=(h*u*g-n*m*g+n*f*l-a*u*l-h*f*r+a*m*r)*b;c[8]=D*b;c[9]=(p*q*g-n*y*g-p*e*r+a*y*r+n*e*d-a*q*d)*b;c[10]=(h*y*g-p*k*g+p*e*l-a*y*l-h*e*d+a*k*d)*b;c[11]=(n*k*g-h*q*g-n*e*l+a*q*l+h*e*r-a*k*r)*b;c[12]=O*b;c[13]=(n*y*f-p*q*f+p*e*u-a*y*u-n*e*x+a*q*x)*b;c[14]=(p*k*f-h*y*f-p*e*m+a*y*m+h*e*x-a*k*x)*b;c[15]=(h*q*f-n*k*f+n*e*m-a*q*m-h*e*u+a*k*u)*b;return this},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=
c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);
this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,f=a.y;a=a.z;var g=d*e,h=d*f;this.set(g*e+c,g*f-b*a,g*a+b*f,0,g*f+b*a,h*f+c,h*a-b*e,0,g*a-b*f,h*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},makeShear:function(a,b,c){this.set(1,b,
c,0,a,1,c,0,a,b,1,0,0,0,0,1);return this},compose:function(a,b,c){var d=this.elements,e=b._x,f=b._y,g=b._z,h=b._w,k=e+e,m=f+f,l=g+g;b=e*k;var n=e*m;e*=l;var q=f*m;f*=l;g*=l;k*=h;m*=h;h*=l;l=c.x;var u=c.y;c=c.z;d[0]=(1-(q+g))*l;d[1]=(n+h)*l;d[2]=(e-m)*l;d[3]=0;d[4]=(n-h)*u;d[5]=(1-(b+g))*u;d[6]=(f+k)*u;d[7]=0;d[8]=(e+m)*c;d[9]=(f-k)*c;d[10]=(1-(b+q))*c;d[11]=0;d[12]=a.x;d[13]=a.y;d[14]=a.z;d[15]=1;return this},decompose:function(){var a=new p,b=new J;return function(c,d,e){var f=this.elements,g=a.set(f[0],
f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.copy(this);c=1/g;f=1/h;var m=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=m;b.elements[9]*=m;b.elements[10]*=m;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makePerspective:function(a,b,c,d,e,f){void 0===f&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");
var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(c-d);g[9]=(c+d)/(c-d);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),k=1/(c-d),m=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*k;g[9]=0;g[13]=-((c+d)*k);g[2]=0;g[6]=0;g[10]=-2*m;g[14]=-((f+e)*m);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;
a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;16>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}});Object.assign(ha,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,
d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],k=c[d+1],m=c[d+2];c=c[d+3];d=e[f+0];var l=e[f+1],n=e[f+2];e=e[f+3];if(c!==e||h!==d||k!==l||m!==n){f=1-g;var q=h*d+k*l+m*n+c*e,u=0<=q?1:-1,r=1-q*q;r>Number.EPSILON&&(r=Math.sqrt(r),q=Math.atan2(r,q*u),f=Math.sin(f*q)/r,g=Math.sin(g*q)/r);u*=g;h=h*f+d*u;k=k*f+l*u;m=m*f+n*u;c=c*f+e*u;f===1-g&&(g=1/Math.sqrt(h*h+k*k+m*m+c*c),h*=g,k*=g,m*=g,c*=g)}a[b]=h;a[b+1]=k;a[b+2]=m;a[b+3]=c}});Object.defineProperties(ha.prototype,{x:{get:function(){return this._x},
set:function(a){this._x=a;this.onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a;this.onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=a;this.onChangeCallback()}},w:{get:function(){return this._w},set:function(a){this._w=a;this.onChangeCallback()}}});Object.assign(ha.prototype,{set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,
this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!a||!a.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var c=a._x,d=a._y,e=a._z;a=a.order;var f=Math.cos,g=Math.sin,h=f(c/2),k=f(d/2);f=f(e/2);c=g(c/2);d=g(d/2);e=g(e/2);"XYZ"===a?(this._x=c*k*f+h*d*e,this._y=h*d*f-c*k*e,this._z=h*k*e+c*d*f,this._w=h*k*f-c*d*e):"YXZ"===a?(this._x=c*k*f+
h*d*e,this._y=h*d*f-c*k*e,this._z=h*k*e-c*d*f,this._w=h*k*f+c*d*e):"ZXY"===a?(this._x=c*k*f-h*d*e,this._y=h*d*f+c*k*e,this._z=h*k*e+c*d*f,this._w=h*k*f-c*d*e):"ZYX"===a?(this._x=c*k*f-h*d*e,this._y=h*d*f+c*k*e,this._z=h*k*e-c*d*f,this._w=h*k*f+c*d*e):"YZX"===a?(this._x=c*k*f+h*d*e,this._y=h*d*f+c*k*e,this._z=h*k*e-c*d*f,this._w=h*k*f-c*d*e):"XZY"===a&&(this._x=c*k*f-h*d*e,this._y=h*d*f-c*k*e,this._z=h*k*e+c*d*f,this._w=h*k*f+c*d*e);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){b/=2;var c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],k=b[6];b=b[10];var m=c+f+b;0<m?(c=.5/Math.sqrt(m+1),this._w=.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=
.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a=new p,b;return function(c,d){void 0===a&&(a=new p);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),angleTo:function(a){return 2*Math.acos(Math.abs(K.clamp(this.dot(a),-1,1)))},rotateTowards:function(a,
b){var c=this.angleTo(a);if(0===c)return this;this.slerp(a,Math.min(1,b/c));return this},inverse:function(){return this.conjugate()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=
this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;
var f=b._x,g=b._y,h=b._z;b=b._w;this._x=c*b+a*f+d*h-e*g;this._y=d*b+a*g+e*f-c*h;this._z=e*b+a*h+c*g-d*f;this._w=a*b-c*f-d*g-e*h;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;a=1-g*g;if(a<=Number.EPSILON)return g=1-b,this._w=g*
f+b*this._w,this._x=g*c+b*this._x,this._y=g*d+b*this._y,this._z=g*e+b*this._z,this.normalize();a=Math.sqrt(a);var h=Math.atan2(a,g);g=Math.sin((1-b)*h)/a;b=Math.sin(b*h)/a;this._w=f*g+this._w*b;this._x=c*g+this._x*b;this._y=d*g+this._y*b;this._z=e*g+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();
return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}});Object.assign(p.prototype,{isVector3:!0,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},
setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;
return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},multiplyVectors:function(a,b){this.x=a.x*
b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a=new ha;return function(b){b&&b.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a=new ha;return function(b,c){return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*
b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,m=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-m*-f;this.y=k*a+b*-f+m*-e-h*-g;this.z=m*a+b*
-g+h*-f-k*-e;return this},project:function(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)},unproject:function(){var a=new J;return function(b){return this.applyMatrix4(a.getInverse(b.projectionMatrix)).applyMatrix4(b.matrixWorld)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=
a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a=new p,b=new p;
return function(c,d){a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);
return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,
b)):this.crossVectors(this,a)},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a=new p;return function(b){a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a=new p;return function(b){return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=
this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(K.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},manhattanDistanceTo:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)},setFromSphericalCoords:function(a,b,c){var d=Math.sin(b)*a;this.x=
d*Math.sin(c);this.y=Math.cos(b)*a;this.z=d*Math.cos(c);return this},setFromCylindrical:function(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)},setFromCylindricalCoords:function(a,b,c){this.x=a*Math.sin(b);this.y=c;this.z=a*Math.cos(b);return this},setFromMatrixPosition:function(a){a=a.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,
2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromBufferAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().");
this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);return this}});Object.assign(na.prototype,{isMatrix3:!0,set:function(a,b,c,d,e,f,g,h,k){var m=this.elements;m[0]=a;m[1]=d;m[2]=g;m[3]=b;m[4]=e;m[5]=h;m[6]=c;m[7]=f;m[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=
a[8];return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);return this},applyToBufferAttribute:function(){var a=new p;return function(b){for(var c=0,d=b.count;c<d;c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(c,a.x,a.y,a.z);return b}}(),multiply:function(a){return this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;
b=this.elements;a=c[0];var e=c[3],f=c[6],g=c[1],h=c[4],k=c[7],m=c[2],l=c[5];c=c[8];var n=d[0],q=d[3],u=d[6],r=d[1],p=d[4],y=d[7],x=d[2],w=d[5];d=d[8];b[0]=a*n+e*r+f*x;b[3]=a*q+e*p+f*w;b[6]=a*u+e*y+f*d;b[1]=g*n+h*r+k*x;b[4]=g*q+h*p+k*w;b[7]=g*u+h*y+k*d;b[2]=m*n+l*r+c*x;b[5]=m*q+l*p+c*w;b[8]=m*u+l*y+c*d;return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],
d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7];a=a[8];return b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getInverse:function(a,b){a&&a.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var c=a.elements;a=this.elements;var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],k=c[5],m=c[6],l=c[7];c=c[8];var n=c*h-k*l,q=k*m-c*g,u=l*g-h*m,p=d*n+e*q+f*u;if(0===p){if(!0===b)throw Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");console.warn("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");
return this.identity()}b=1/p;a[0]=n*b;a[1]=(f*l-c*e)*b;a[2]=(k*e-f*h)*b;a[3]=q*b;a[4]=(c*d-f*m)*b;a[5]=(f*g-k*d)*b;a[6]=u*b;a[7]=(e*m-l*d)*b;a[8]=(h*d-e*g)*b;return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=
b[2];a[7]=b[5];a[8]=b[8];return this},setUvTransform:function(a,b,c,d,e,f,g){var h=Math.cos(e);e=Math.sin(e);this.set(c*h,c*e,-c*(h*f+e*g)+f+a,-d*e,d*h,-d*(-e*f+h*g)+g+b,0,0,1)},scale:function(a,b){var c=this.elements;c[0]*=a;c[3]*=a;c[6]*=a;c[1]*=b;c[4]*=b;c[7]*=b;return this},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.elements,d=c[0],e=c[3],f=c[6],g=c[1],h=c[4],k=c[7];c[0]=b*d+a*g;c[3]=b*e+a*h;c[6]=b*f+a*k;c[1]=-a*d+b*g;c[4]=-a*e+b*h;c[7]=-a*f+b*k;return this},translate:function(a,
b){var c=this.elements;c[0]+=a*c[2];c[3]+=a*c[5];c[6]+=a*c[8];c[1]+=b*c[2];c[4]+=b*c[5];c[7]+=b*c[8];return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;9>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];
return a}});var gb={getDataURL:function(a){if(a instanceof HTMLCanvasElement)var b=a;else{b=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");b.width=a.width;b.height=a.height;var c=b.getContext("2d");a instanceof ImageData?c.putImageData(a,0,0):c.drawImage(a,0,0,a.width,a.height)}return 2048<b.width||2048<b.height?b.toDataURL("image/jpeg",.6):b.toDataURL("image/png")}},Df=0;T.DEFAULT_IMAGE=void 0;T.DEFAULT_MAPPING=300;T.prototype=Object.assign(Object.create(ea.prototype),{constructor:T,
isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);
this.repeat.copy(a.repeat);this.center.copy(a.center);this.rotation=a.rotation;this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrix.copy(a.matrix);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){var b=void 0===a||"string"===typeof a;if(!b&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];var c={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},
uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=K.generateUUID());if(!b&&void 0===a.images[d.uuid]){if(Array.isArray(d)){var e=[];for(var f=0,g=d.length;f<
g;f++)e.push(gb.getDataURL(d[f]))}else e=gb.getDataURL(d);a.images[d.uuid]={uuid:d.uuid,url:e}}c.image=d.uuid}b||(a.textures[this.uuid]=c);return c},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(300!==this.mapping)return a;a.applyMatrix3(this.matrix);if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;break;case 1002:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=
Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y);return a}});Object.defineProperty(T.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(aa.prototype,{isVector4:!0,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=
a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,
this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},
addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/
b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],f=a[5],g=a[9];var h=a[2];var k=a[6];var m=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-h)&&.01>Math.abs(g-k)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+h)&&.1>Math.abs(g+k)&&.1>Math.abs(b+f+m-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;f=(f+1)/2;m=(m+1)/2;c=(c+e)/4;d=(d+h)/4;g=(g+k)/4;b>f&&b>m?.01>b?(k=0,c=h=.707106781):(k=Math.sqrt(b),h=c/k,c=d/k):f>m?.01>f?(k=.707106781,h=0,c=.707106781):
(h=Math.sqrt(f),k=c/h,c=g/h):.01>m?(h=k=.707106781,c=0):(c=Math.sqrt(m),k=d/c,h=g/c);this.set(k,h,c,a);return this}a=Math.sqrt((k-g)*(k-g)+(d-h)*(d-h)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(k-g)/a;this.y=(d-h)/a;this.z=(e-c)/a;this.w=Math.acos((b+f+m-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,
a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new aa,b=new aa);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,
c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):
Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===
b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromBufferAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().");this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);this.w=a.getW(b);return this}});hb.prototype=Object.assign(Object.create(ea.prototype),{constructor:hb,isWebGLRenderTarget:!0,
setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
Ib.prototype=Object.create(hb.prototype);Ib.prototype.constructor=Ib;Ib.prototype.isWebGLRenderTargetCube=!0;ib.prototype=Object.create(T.prototype);ib.prototype.constructor=ib;ib.prototype.isDataTexture=!0;Object.assign(Ua.prototype,{isBox3:!0,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.length;h<k;h+=3){var m=a[h],l=a[h+1],n=a[h+2];m<b&&(b=m);l<c&&(c=l);n<d&&(d=n);m>
e&&(e=m);l>f&&(f=l);n>g&&(g=n)}this.min.set(b,c,d);this.max.set(e,f,g);return this},setFromBufferAttribute:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.count;h<k;h++){var m=a.getX(h),l=a.getY(h),n=a.getZ(h);m<b&&(b=m);l<c&&(c=l);n<d&&(d=n);m>e&&(e=m);l>f&&(f=l);n>g&&(g=n)}this.min.set(b,c,d);this.max.set(e,f,g);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=
new p;return function(b,c){c=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(c);this.max.copy(b).add(c);return this}}(),setFromObject:function(a){this.makeEmpty();return this.expandByObject(a)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<
this.min.y||this.max.z<this.min.z},getCenter:function(a){void 0===a&&(console.warn("THREE.Box3: .getCenter() target is now required"),a=new p);return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){void 0===a&&(console.warn("THREE.Box3: .getSize() target is now required"),a=new p);return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);
this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},expandByObject:function(){function a(a){var f=a.geometry;if(void 0!==f)if(f.isGeometry)for(f=f.vertices,c=0,d=f.length;c<d;c++)e.copy(f[c]),e.applyMatrix4(a.matrixWorld),b.expandByPoint(e);else if(f.isBufferGeometry&&(f=f.attributes.position,void 0!==f))for(c=0,d=f.count;c<d;c++)e.fromBufferAttribute(f,c).applyMatrix4(a.matrixWorld),b.expandByPoint(e)}var b,c,d,e=new p;return function(c){b=
this;c.updateMatrixWorld(!0);c.traverse(a);return this}}(),containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){void 0===b&&(console.warn("THREE.Box3: .getParameter() target is now required"),b=new p);return b.set((a.x-this.min.x)/(this.max.x-
this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a=new p;return function(b){this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){if(0<a.normal.x){var b=a.normal.x*this.min.x;var c=a.normal.x*this.max.x}else b=
a.normal.x*this.max.x,c=a.normal.x*this.min.x;0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},intersectsTriangle:function(){function a(a){var e;var f=0;for(e=a.length-3;f<=e;f+=3){h.fromArray(a,f);var g=m.x*Math.abs(h.x)+m.y*Math.abs(h.y)+m.z*Math.abs(h.z),k=b.dot(h),l=c.dot(h),
n=d.dot(h);if(Math.max(-Math.max(k,l,n),Math.min(k,l,n))>g)return!1}return!0}var b=new p,c=new p,d=new p,e=new p,f=new p,g=new p,h=new p,k=new p,m=new p,l=new p;return function(h){if(this.isEmpty())return!1;this.getCenter(k);m.subVectors(this.max,k);b.subVectors(h.a,k);c.subVectors(h.b,k);d.subVectors(h.c,k);e.subVectors(c,b);f.subVectors(d,c);g.subVectors(b,d);h=[0,-e.z,e.y,0,-f.z,f.y,0,-g.z,g.y,e.z,0,-e.x,f.z,0,-f.x,g.z,0,-g.x,-e.y,e.x,0,-f.y,f.x,0,-g.y,g.x,0];if(!a(h))return!1;h=[1,0,0,0,1,0,0,
0,1];if(!a(h))return!1;l.crossVectors(e,f);h=[l.x,l.y,l.z];return a(h)}}(),clampPoint:function(a,b){void 0===b&&(console.warn("THREE.Box3: .clampPoint() target is now required"),b=new p);return b.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new p;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new p;return function(b){void 0===b&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),b=new Ea);
this.getCenter(b.center);b.radius=.5*this.getSize(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new p,new p,new p,new p,new p,new p,new p,new p];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);
a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&
a.max.equals(this.max)}});Object.assign(Ea.prototype,{set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new Ua;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).getCenter(d);for(var e=c=0,f=b.length;e<f;e++)c=Math.max(c,d.distanceToSquared(b[e]));this.radius=Math.sqrt(c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=
this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);
void 0===b&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),b=new p);b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){void 0===a&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),a=new Ua);a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},
translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}});Object.assign(Oa.prototype,{set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new p,b=new p;return function(c,d,e){d=
a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-
a.radius},projectPoint:function(a,b){void 0===b&&(console.warn("THREE.Plane: .projectPoint() target is now required"),b=new p);return b.copy(this.normal).multiplyScalar(-this.distanceToPoint(a)).add(a)},intersectLine:function(){var a=new p;return function(b,c){void 0===c&&(console.warn("THREE.Plane: .intersectLine() target is now required"),c=new p);var d=b.delta(a),e=this.normal.dot(d);if(0===e){if(0===this.distanceToPoint(b.start))return c.copy(b.start)}else if(e=-(b.start.dot(this.normal)+this.constant)/
e,!(0>e||1<e))return c.copy(d).multiplyScalar(e).add(b.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){void 0===a&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),a=new p);return a.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=
new p,b=new na;return function(c,d){d=d||b.getNormalMatrix(c);c=this.coplanarPoint(a).applyMatrix4(c);d=this.normal.applyMatrix3(d).normalize();this.constant=-c.dot(d);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}});Object.assign(od.prototype,{set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},
clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],m=c[7],l=c[8],n=c[9],q=c[10],p=c[11],r=c[12],v=c[13],y=c[14];c=c[15];b[0].setComponents(f-a,m-g,p-l,c-r).normalize();b[1].setComponents(f+a,m+g,p+l,c+r).normalize();b[2].setComponents(f+d,m+h,p+n,c+v).normalize();b[3].setComponents(f-d,m-h,p-n,c-
v).normalize();b[4].setComponents(f-e,m-k,p-q,c-y).normalize();b[5].setComponents(f+e,m+k,p+q,c+y).normalize();return this},intersectsObject:function(){var a=new Ea;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSprite:function(){var a=new Ea;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),
intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new p;return function(b){for(var c=this.planes,d=0;6>d;d++){var e=c[d];a.x=0<e.normal.x?b.max.x:b.min.x;a.y=0<e.normal.y?b.max.y:b.min.y;a.z=0<e.normal.z?b.max.z:b.min.z;if(0>e.distanceToPoint(a))return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}});var U=
{alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",
clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",
color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",
emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif\n",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",
gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",
lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",
lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif\n",
logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif\n",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",
map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",
metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",
morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",
roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",
distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",
meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",
normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}\n",
shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n"},
Ba={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture)?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}},Sg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,
blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,
darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,
lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,
mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,
rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(F.prototype,
{isColor:!0,r:1,g:1,b:1,set:function(a){a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a;return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(c-a)*d:.5>d?c:d<2/3?a+6*(c-a)*(2/3-d):a}return function(b,
c,d){b=K.euclideanModulo(b,1);c=K.clamp(c,0,1);d=K.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5>=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var d=c[2];switch(c[1]){case "rgb":case "rgba":if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=
Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case "hsl":case "hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){d=parseFloat(c[1])/
360;var e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&(c=Sg[a],
void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(a){this.copyGammaToLinear(this,
a);return this},convertLinearToGamma:function(a){this.copyLinearToGamma(this,a);return this},copySRGBToLinear:function(){function a(a){return.04045>a?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}return function(b){this.r=a(b.r);this.g=a(b.g);this.b=a(b.b);return this}}(),copyLinearToSRGB:function(){function a(a){return.0031308>a?12.92*a:1.055*Math.pow(a,.41666)-.055}return function(b){this.r=a(b.r);this.g=a(b.g);this.b=a(b.b);return this}}(),convertSRGBToLinear:function(){this.copySRGBToLinear(this);
return this},convertLinearToSRGB:function(){this.copyLinearToSRGB(this);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){void 0===a&&(console.warn("THREE.Color: .getHSL() target is now required"),a={h:0,s:0,l:0});var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var k=e-f;f=.5>=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-
d)/k+(c<d?6:0);break;case c:g=(d-b)/k+2;break;case d:g=(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var a={};return function(b,c,d){this.getHSL(a);a.h+=b;a.s+=c;a.l+=d;this.setHSL(a.h,a.s,a.l);return this}}(),add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=
a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},lerpHSL:function(){var a={h:0,s:0,l:0},b={h:0,s:0,l:0};return function(c,d){this.getHSL(a);c.getHSL(b);c=K.lerp(a.h,
b.h,d);var e=K.lerp(a.s,b.s,d);d=K.lerp(a.l,b.l,d);this.setHSL(c,e,d);return this}}(),equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},toJSON:function(){return this.getHex()}});var R={common:{diffuse:{value:new F(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new na},
alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new z(1,1)}},displacementmap:{displacementMap:{value:null},
displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new F(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},
spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},
skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new F(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new na}},sprite:{diffuse:{value:new F(15658734)},opacity:{value:1},center:{value:new z(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new na}}},pb={basic:{uniforms:Ba.merge([R.common,R.specularmap,R.envmap,R.aomap,R.lightmap,R.fog]),vertexShader:U.meshbasic_vert,
fragmentShader:U.meshbasic_frag},lambert:{uniforms:Ba.merge([R.common,R.specularmap,R.envmap,R.aomap,R.lightmap,R.emissivemap,R.fog,R.lights,{emissive:{value:new F(0)}}]),vertexShader:U.meshlambert_vert,fragmentShader:U.meshlambert_frag},phong:{uniforms:Ba.merge([R.common,R.specularmap,R.envmap,R.aomap,R.lightmap,R.emissivemap,R.bumpmap,R.normalmap,R.displacementmap,R.gradientmap,R.fog,R.lights,{emissive:{value:new F(0)},specular:{value:new F(1118481)},shininess:{value:30}}]),vertexShader:U.meshphong_vert,
fragmentShader:U.meshphong_frag},standard:{uniforms:Ba.merge([R.common,R.envmap,R.aomap,R.lightmap,R.emissivemap,R.bumpmap,R.normalmap,R.displacementmap,R.roughnessmap,R.metalnessmap,R.fog,R.lights,{emissive:{value:new F(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:U.meshphysical_vert,fragmentShader:U.meshphysical_frag},points:{uniforms:Ba.merge([R.points,R.fog]),vertexShader:U.points_vert,fragmentShader:U.points_frag},dashed:{uniforms:Ba.merge([R.common,
R.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:U.linedashed_vert,fragmentShader:U.linedashed_frag},depth:{uniforms:Ba.merge([R.common,R.displacementmap]),vertexShader:U.depth_vert,fragmentShader:U.depth_frag},normal:{uniforms:Ba.merge([R.common,R.bumpmap,R.normalmap,R.displacementmap,{opacity:{value:1}}]),vertexShader:U.normal_vert,fragmentShader:U.normal_frag},sprite:{uniforms:Ba.merge([R.sprite,R.fog]),vertexShader:U.sprite_vert,fragmentShader:U.sprite_frag},cube:{uniforms:{tCube:{value:null},
tFlip:{value:-1},opacity:{value:1}},vertexShader:U.cube_vert,fragmentShader:U.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:U.equirect_vert,fragmentShader:U.equirect_frag},distanceRGBA:{uniforms:Ba.merge([R.common,R.displacementmap,{referencePosition:{value:new p},nearDistance:{value:1},farDistance:{value:1E3}}]),vertexShader:U.distanceRGBA_vert,fragmentShader:U.distanceRGBA_frag},shadow:{uniforms:Ba.merge([R.lights,R.fog,{color:{value:new F(0)},opacity:{value:1}}]),vertexShader:U.shadow_vert,
fragmentShader:U.shadow_frag}};pb.physical={uniforms:Ba.merge([pb.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:U.meshphysical_vert,fragmentShader:U.meshphysical_frag};jb.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");jb.DefaultOrder="XYZ";Object.defineProperties(jb.prototype,{x:{get:function(){return this._x},set:function(a){this._x=a;this.onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a;this.onChangeCallback()}},z:{get:function(){return this._z},
set:function(a){this._z=a;this.onChangeCallback()}},order:{get:function(){return this._order},set:function(a){this._order=a;this.onChangeCallback()}}});Object.assign(jb.prototype,{isEuler:!0,set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},
setFromRotationMatrix:function(a,b,c){var d=K.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],m=e[9],l=e[2],n=e[6];e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-m,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(n,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(m,-1,1)),.99999>Math.abs(m)?(this._y=Math.atan2(g,e),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-l,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(n,-1,1)),.99999>Math.abs(n)?
(this._y=Math.atan2(-l,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?(this._x=Math.atan2(n,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,k))):"YZX"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-m,k),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(n,k),this._y=Math.atan2(g,a)):(this._x=
Math.atan2(-m,e),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a=new J;return function(b,c,d){a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,d)}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new ha;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===
this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new p(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}});
Object.assign(Sd.prototype,{set:function(a){this.mask=1<<a|0},enable:function(a){this.mask=this.mask|1<<a|0},toggle:function(a){this.mask^=1<<a|0},disable:function(a){this.mask&=~(1<<a|0)},test:function(a){return 0!==(this.mask&a.mask)}});var Ff=0;B.DefaultUp=new p(0,1,0);B.DefaultMatrixAutoUpdate=!0;B.prototype=Object.assign(Object.create(ea.prototype),{constructor:B,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);
this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(a){this.quaternion.premultiply(a);return this},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new ha;return function(b,c){a.setFromAxisAngle(b,
c);this.quaternion.multiply(a);return this}}(),rotateOnWorldAxis:function(){var a=new ha;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.premultiply(a);return this}}(),rotateX:function(){var a=new p(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new p(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new p(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new p;return function(b,
c){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new p(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new p(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new p(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new J;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),
lookAt:function(){var a=new ha,b=new J,c=new p,d=new p;return function(e,f,g){e.isVector3?c.copy(e):c.set(e,f,g);e=this.parent;this.updateWorldMatrix(!0,!1);d.setFromMatrixPosition(this.matrixWorld);this.isCamera?b.lookAt(d,c,this.up):b.lookAt(c,d,this.up);this.quaternion.setFromRotationMatrix(b);e&&(b.extractRotation(e.matrixWorld),a.setFromRotationMatrix(b),this.quaternion.premultiply(a.inverse()))}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);
return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);return this}b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),
this.children.splice(b,1));return this},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){void 0===a&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),a=new p);this.updateMatrixWorld(!0);
return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new p,b=new p;return function(c){void 0===c&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),c=new ha);this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldScale:function(){var a=new p,b=new ha;return function(c){void 0===c&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),c=new p);this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,
b,c);return c}}(),getWorldDirection:function(a){void 0===a&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),a=new p);this.updateMatrixWorld(!0);var b=this.matrixWorld.elements;return a.set(b[8],b[9],b[10]).normalize()},raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=
this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].updateMatrixWorld(a)},
updateWorldMatrix:function(a,b){var c=this.parent;!0===a&&null!==c&&c.updateWorldMatrix(!0,!1);this.matrixAutoUpdate&&this.updateMatrix();null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);if(!0===b)for(a=this.children,b=0,c=a.length;b<c;b++)a[b].updateWorldMatrix(!1,!0)},toJSON:function(a){function b(b,c){void 0===b[c.uuid]&&(b[c.uuid]=c.toJSON(a));return c.uuid}function c(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;
b.push(d)}return b}var d=void 0===a||"string"===typeof a,e={};d&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var f={};f.uuid=this.uuid;f.type=this.type;""!==this.name&&(f.name=this.name);!0===this.castShadow&&(f.castShadow=!0);!0===this.receiveShadow&&(f.receiveShadow=!0);!1===this.visible&&(f.visible=!1);!1===this.frustumCulled&&(f.frustumCulled=!1);0!==this.renderOrder&&(f.renderOrder=this.renderOrder);"{}"!==
JSON.stringify(this.userData)&&(f.userData=this.userData);f.layers=this.layers.mask;f.matrix=this.matrix.toArray();!1===this.matrixAutoUpdate&&(f.matrixAutoUpdate=!1);if(this.isMesh||this.isLine||this.isPoints){f.geometry=b(a.geometries,this.geometry);var g=this.geometry.parameters;if(void 0!==g&&void 0!==g.shapes)if(g=g.shapes,Array.isArray(g))for(var h=0,k=g.length;h<k;h++)b(a.shapes,g[h]);else b(a.shapes,g)}if(void 0!==this.material)if(Array.isArray(this.material)){g=[];h=0;for(k=this.material.length;h<
k;h++)g.push(b(a.materials,this.material[h]));f.material=g}else f.material=b(a.materials,this.material);if(0<this.children.length)for(f.children=[],h=0;h<this.children.length;h++)f.children.push(this.children[h].toJSON(a).object);if(d){d=c(a.geometries);h=c(a.materials);k=c(a.textures);var m=c(a.images);g=c(a.shapes);0<d.length&&(e.geometries=d);0<h.length&&(e.materials=h);0<k.length&&(e.textures=k);0<m.length&&(e.images=m);0<g.length&&(e.shapes=g)}e.object=f;return e},clone:function(a){return(new this.constructor).copy(this,
a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.layers.mask=a.layers.mask;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;
this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(b=0;b<a.children.length;b++)this.add(a.children[b].clone());return this}});Pa.prototype=Object.assign(Object.create(B.prototype),{constructor:Pa,isCamera:!0,copy:function(a,b){B.prototype.copy.call(this,a,b);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);this.projectionMatrixInverse.copy(a.projectionMatrixInverse);return this},getWorldDirection:function(a){void 0===a&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),
a=new p);this.updateMatrixWorld(!0);var b=this.matrixWorld.elements;return a.set(-b[8],-b[9],-b[10]).normalize()},updateMatrixWorld:function(a){B.prototype.updateMatrixWorld.call(this,a);this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}});Jb.prototype=Object.assign(Object.create(Pa.prototype),{constructor:Jb,isOrthographicCamera:!0,copy:function(a,b){Pa.prototype.copy.call(this,a,b);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=
a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,d,e,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=a;this.view.fullHeight=b;this.view.offsetX=c;this.view.offsetY=d;this.view.width=e;this.view.height=f;this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=
!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a;c+=a;a=d+b;b=d-b;if(null!==this.view&&this.view.enabled){c=this.zoom/(this.view.width/this.view.fullWidth);b=this.zoom/(this.view.height/this.view.fullHeight);var f=(this.right-this.left)/this.view.width;d=(this.top-this.bottom)/this.view.height;e+=this.view.offsetX/c*f;c=e+this.view.width/
c*f;a-=this.view.offsetY/b*d;b=a-this.view.height/b*d}this.projectionMatrix.makeOrthographic(e,c,a,b,this.near,this.far);this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(a){a=B.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});Object.assign(Va.prototype,
{clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}});var Gf=0;M.prototype=Object.assign(Object.create(ea.prototype),{constructor:M,isGeometry:!0,applyMatrix:function(a){for(var b=
(new na).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a=new J;return function(b){a.makeRotationX(b);
this.applyMatrix(a);return this}}(),rotateY:function(){var a=new J;return function(b){a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a=new J;return function(b){a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a=new J;return function(b,c,d){a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a=new J;return function(b,c,d){a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a=new B;return function(b){a.lookAt(b);
a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,d,e){var f=void 0!==g?[l[a].clone(),l[b].clone(),l[d].clone()]:[],t=void 0!==h?[c.colors[a].clone(),c.colors[b].clone(),c.colors[d].clone()]:[];e=new Va(a,b,d,f,t,e);c.faces.push(e);void 0!==k&&c.faceVertexUvs[0].push([n[a].clone(),n[b].clone(),n[d].clone()]);void 0!==m&&c.faceVertexUvs[1].push([q[a].clone(),q[b].clone(),q[d].clone()])}var c=this,d=null!==a.index?a.index.array:void 0,e=a.attributes,f=e.position.array,
g=void 0!==e.normal?e.normal.array:void 0,h=void 0!==e.color?e.color.array:void 0,k=void 0!==e.uv?e.uv.array:void 0,m=void 0!==e.uv2?e.uv2.array:void 0;void 0!==m&&(this.faceVertexUvs[1]=[]);for(var l=[],n=[],q=[],u=e=0;e<f.length;e+=3,u+=2)c.vertices.push(new p(f[e],f[e+1],f[e+2])),void 0!==g&&l.push(new p(g[e],g[e+1],g[e+2])),void 0!==h&&c.colors.push(new F(h[e],h[e+1],h[e+2])),void 0!==k&&n.push(new z(k[u],k[u+1])),void 0!==m&&q.push(new z(m[u],m[u+1]));var r=a.groups;if(0<r.length)for(e=0;e<r.length;e++){f=
r[e];var v=f.start,y=f.count;u=v;for(v+=y;u<v;u+=3)void 0!==d?b(d[u],d[u+1],d[u+2],f.materialIndex):b(u,u+1,u+2,f.materialIndex)}else if(void 0!==d)for(e=0;e<d.length;e+=3)b(d[e],d[e+1],d[e+2]);else for(e=0;e<f.length/3;e+=3)b(e,e+1,e+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){var a=new p;return function(){this.computeBoundingBox();this.boundingBox.getCenter(a).negate();
this.translate(a.x,a.y,a.z);return this}}(),normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius;b=0===b?1:1/b;var c=new J;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new p,b=new p,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},
computeVertexNormals:function(a){void 0===a&&(a=!0);var b;var c=Array(this.vertices.length);var d=0;for(b=this.vertices.length;d<b;d++)c[d]=new p;if(a){var e=new p,f=new p;a=0;for(d=this.faces.length;a<d;a++){b=this.faces[a];var g=this.vertices[b.a];var h=this.vertices[b.b];var k=this.vertices[b.c];e.subVectors(k,h);f.subVectors(g,h);e.cross(f);c[b.a].add(e);c[b.b].add(e);c[b.c].add(e)}}else for(this.computeFaceNormals(),a=0,d=this.faces.length;a<d;a++)b=this.faces[a],c[b.a].add(b.normal),c[b.b].add(b.normal),
c[b.c].add(b.normal);d=0;for(b=this.vertices.length;d<b;d++)c[d].normalize();a=0;for(d=this.faces.length;a<d;a++)b=this.faces[a],g=b.vertexNormals,3===g.length?(g[0].copy(c[b.a]),g[1].copy(c[b.b]),g[2].copy(c[b.c])):(g[0]=c[b.a].clone(),g[1]=c[b.b].clone(),g[2]=c[b.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var a;this.computeFaceNormals();var b=0;for(a=this.faces.length;b<a;b++){var c=this.faces[b];var d=c.vertexNormals;3===d.length?(d[0].copy(c.normal),
d[1].copy(c.normal),d[2].copy(c.normal)):(d[0]=c.normal.clone(),d[1]=c.normal.clone(),d[2]=c.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b;var c=0;for(b=this.faces.length;c<b;c++){var d=this.faces[c];d.__originalFaceNormal?d.__originalFaceNormal.copy(d.normal):d.__originalFaceNormal=d.normal.clone();d.__originalVertexNormals||(d.__originalVertexNormals=[]);var e=0;for(a=d.vertexNormals.length;e<a;e++)d.__originalVertexNormals[e]?d.__originalVertexNormals[e].copy(d.vertexNormals[e]):
d.__originalVertexNormals[e]=d.vertexNormals[e].clone()}var f=new M;f.faces=this.faces;e=0;for(a=this.morphTargets.length;e<a;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];d=this.morphNormals[e].faceNormals;var g=this.morphNormals[e].vertexNormals;c=0;for(b=this.faces.length;c<b;c++){var h=new p;var k={a:new p,b:new p,c:new p};d.push(h);g.push(k)}}g=this.morphNormals[e];f.vertices=this.morphTargets[e].vertices;f.computeFaceNormals();
f.computeVertexNormals();c=0;for(b=this.faces.length;c<b;c++)d=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(d.normal),k.a.copy(d.vertexNormals[0]),k.b.copy(d.vertexNormals[1]),k.c.copy(d.vertexNormals[2])}c=0;for(b=this.faces.length;c<b;c++)d=this.faces[c],d.normal=d.__originalFaceNormal,d.vertexNormals=d.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ua);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===
this.boundingSphere&&(this.boundingSphere=new Ea);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(a&&a.isGeometry){var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,m=this.faceVertexUvs[0],l=a.faceVertexUvs[0],n=this.colors,q=a.colors;void 0===c&&(c=0);void 0!==b&&(d=(new na).getNormalMatrix(b));a=0;for(var p=g.length;a<p;a++){var r=g[a].clone();void 0!==b&&r.applyMatrix4(b);f.push(r)}a=0;for(p=q.length;a<p;a++)n.push(q[a].clone());a=0;for(p=
k.length;a<p;a++){g=k[a];var v=g.vertexNormals;q=g.vertexColors;n=new Va(g.a+e,g.b+e,g.c+e);n.normal.copy(g.normal);void 0!==d&&n.normal.applyMatrix3(d).normalize();b=0;for(f=v.length;b<f;b++)r=v[b].clone(),void 0!==d&&r.applyMatrix3(d).normalize(),n.vertexNormals.push(r);n.color.copy(g.color);b=0;for(f=q.length;b<f;b++)r=q[b],n.vertexColors.push(r.clone());n.materialIndex=g.materialIndex+c;h.push(n)}a=0;for(p=l.length;a<p;a++)if(c=l[a],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(c[b].clone());
m.push(d)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a)},mergeMesh:function(a){a&&a.isMesh?(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a)},mergeVertices:function(){var a={},b=[],c=[],d=Math.pow(10,4),e;var f=0;for(e=this.vertices.length;f<e;f++){var g=this.vertices[f];g=Math.round(g.x*d)+"_"+Math.round(g.y*d)+"_"+Math.round(g.z*d);void 0===a[g]?
(a[g]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[g]]}a=[];f=0;for(e=this.faces.length;f<e;f++)for(d=this.faces[f],d.a=c[d.a],d.b=c[d.b],d.c=c[d.c],d=[d.a,d.b,d.c],g=0;3>g;g++)if(d[g]===d[(g+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(d=a[f],this.faces.splice(d,1),c=0,e=this.faceVertexUvs.length;c<e;c++)this.faceVertexUvs[c].splice(d,1);f=this.vertices.length-b.length;this.vertices=b;return f},setFromPoints:function(a){this.vertices=[];for(var b=0,c=a.length;b<c;b++){var d=a[b];
this.vertices.push(new p(d.x,d.y,d.z||0))}return this},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var h=a[c]._id;f&&f.push(d[h]);g&&g.push(e[h])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=g)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=
a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==m[b])return m[b];m[b]=k.length/3;k.push(a.x,a.y,a.z);return m[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==n[b])return n[b];n[b]=l.length;l.push(a.getHex());return n[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==p[b])return p[b];p[b]=q.length/2;q.push(a.x,a.y);return p[b]}var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&
(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}h=[];var k=[],m={},l=[],n={},q=[],p={};for(g=0;g<this.faces.length;g++){var r=this.faces[g],v=void 0!==this.faceVertexUvs[0][g],y=0<r.normal.length(),x=0<r.vertexNormals.length,w=1!==r.color.r||1!==r.color.g||1!==r.color.b,z=0<r.vertexColors.length,D=0;D=a(D,0,0);D=a(D,1,!0);D=a(D,2,!1);D=a(D,3,v);
D=a(D,4,y);D=a(D,5,x);D=a(D,6,w);D=a(D,7,z);h.push(D);h.push(r.a,r.b,r.c);h.push(r.materialIndex);v&&(v=this.faceVertexUvs[0][g],h.push(d(v[0]),d(v[1]),d(v[2])));y&&h.push(b(r.normal));x&&(y=r.vertexNormals,h.push(b(y[0]),b(y[1]),b(y[2])));w&&h.push(c(r.color));z&&(r=r.vertexColors,h.push(c(r[0]),c(r[1]),c(r[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<l.length&&(e.data.colors=l);0<q.length&&(e.data.uvs=[q]);e.data.faces=h;return e},clone:function(){return(new M).copy(this)},copy:function(a){var b,
c,d;this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.name=a.name;var e=a.vertices;var f=0;for(b=e.length;f<b;f++)this.vertices.push(e[f].clone());e=a.colors;f=0;for(b=e.length;f<b;f++)this.colors.push(e[f].clone());e=a.faces;f=0;for(b=e.length;f<b;f++)this.faces.push(e[f].clone());f=0;for(b=a.faceVertexUvs.length;f<b;f++){var g=
a.faceVertexUvs[f];void 0===this.faceVertexUvs[f]&&(this.faceVertexUvs[f]=[]);e=0;for(c=g.length;e<c;e++){var h=g[e],k=[];var m=0;for(d=h.length;m<d;m++)k.push(h[m].clone());this.faceVertexUvs[f].push(k)}}m=a.morphTargets;f=0;for(b=m.length;f<b;f++){d={};d.name=m[f].name;if(void 0!==m[f].vertices)for(d.vertices=[],e=0,c=m[f].vertices.length;e<c;e++)d.vertices.push(m[f].vertices[e].clone());if(void 0!==m[f].normals)for(d.normals=[],e=0,c=m[f].normals.length;e<c;e++)d.normals.push(m[f].normals[e].clone());
this.morphTargets.push(d)}m=a.morphNormals;f=0;for(b=m.length;f<b;f++){d={};if(void 0!==m[f].vertexNormals)for(d.vertexNormals=[],e=0,c=m[f].vertexNormals.length;e<c;e++)g=m[f].vertexNormals[e],h={},h.a=g.a.clone(),h.b=g.b.clone(),h.c=g.c.clone(),d.vertexNormals.push(h);if(void 0!==m[f].faceNormals)for(d.faceNormals=[],e=0,c=m[f].faceNormals.length;e<c;e++)d.faceNormals.push(m[f].faceNormals[e].clone());this.morphNormals.push(d)}e=a.skinWeights;f=0;for(b=e.length;f<b;f++)this.skinWeights.push(e[f].clone());
e=a.skinIndices;f=0;for(b=e.length;f<b;f++)this.skinIndices.push(e[f].clone());e=a.lineDistances;f=0;for(b=e.length;f<b;f++)this.lineDistances.push(e[f]);f=a.boundingBox;null!==f&&(this.boundingBox=f.clone());f=a.boundingSphere;null!==f&&(this.boundingSphere=f.clone());this.elementsNeedUpdate=a.elementsNeedUpdate;this.verticesNeedUpdate=a.verticesNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.lineDistancesNeedUpdate=
a.lineDistancesNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(Q.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(Q.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==a?a.length/this.itemSize:0;this.array=a;return this},setDynamic:function(a){this.dynamic=
a;return this},copy:function(a){this.name=a.name;this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",
d),f=new F);b[c++]=f.r;b[c++]=f.g;b[c++]=f.b}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new z);b[c++]=f.x;b[c++]=f.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new p);b[c++]=f.x;b[c++]=f.y;
b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),f=new aa);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+
1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this},
setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},onUpload:function(a){this.onUploadCallback=a;return this},clone:function(){return(new this.constructor(this.array,this.itemSize)).copy(this)}});qc.prototype=Object.create(Q.prototype);qc.prototype.constructor=qc;rc.prototype=Object.create(Q.prototype);rc.prototype.constructor=rc;sc.prototype=Object.create(Q.prototype);sc.prototype.constructor=sc;tc.prototype=Object.create(Q.prototype);
tc.prototype.constructor=tc;kb.prototype=Object.create(Q.prototype);kb.prototype.constructor=kb;uc.prototype=Object.create(Q.prototype);uc.prototype.constructor=uc;lb.prototype=Object.create(Q.prototype);lb.prototype.constructor=lb;A.prototype=Object.create(Q.prototype);A.prototype.constructor=A;vc.prototype=Object.create(Q.prototype);vc.prototype.constructor=vc;Object.assign(De.prototype,{computeGroups:function(a){var b=[],c=void 0;a=a.faces;for(var d=0;d<a.length;d++){var e=a[d];if(e.materialIndex!==
c){c=e.materialIndex;void 0!==f&&(f.count=3*d-f.start,b.push(f));var f={start:3*d,materialIndex:c}}}void 0!==f&&(f.count=3*d-f.start,b.push(f));this.groups=b},fromGeometry:function(a){var b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,g=a.morphTargets,h=g.length;if(0<h){var k=[];for(var m=0;m<h;m++)k[m]={name:g[m].name,data:[]};this.morphTargets.position=k}var l=a.morphNormals,n=l.length;if(0<n){var q=[];for(m=0;m<n;m++)q[m]={name:l[m].name,data:[]};this.morphTargets.normal=
q}var p=a.skinIndices,r=a.skinWeights,v=p.length===c.length,y=r.length===c.length;0<c.length&&0===b.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(m=0;m<b.length;m++){var x=b[m];this.vertices.push(c[x.a],c[x.b],c[x.c]);var w=x.vertexNormals;3===w.length?this.normals.push(w[0],w[1],w[2]):(w=x.normal,this.normals.push(w,w,w));w=x.vertexColors;3===w.length?this.colors.push(w[0],w[1],w[2]):(w=x.color,this.colors.push(w,w,w));!0===e&&(w=d[0][m],void 0!==w?this.uvs.push(w[0],
w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new z,new z,new z)));!0===f&&(w=d[1][m],void 0!==w?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new z,new z,new z)));for(w=0;w<h;w++){var G=g[w].vertices;k[w].data.push(G[x.a],G[x.b],G[x.c])}for(w=0;w<n;w++)G=l[w].vertexNormals[m],q[w].data.push(G.a,G.b,G.c);v&&this.skinIndices.push(p[x.a],p[x.b],p[x.c]);y&&this.skinWeights.push(r[x.a],
r[x.b],r[x.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this}});var Hf=1;I.prototype=Object.assign(Object.create(ea.prototype),{constructor:I,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){Array.isArray(a)?this.index=new (65535<Ee(a)?lb:kb)(a,1):this.index=a},addAttribute:function(a,
b,c){if(!(b&&b.isBufferAttribute||b&&b.isInterleavedBufferAttribute))return console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new Q(b,c));if("index"===a)return console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(b),this;this.attributes[a]=b;return this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,
c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToBufferAttribute(b),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new na).getNormalMatrix(a).applyToBufferAttribute(b),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();
return this},rotateX:function(){var a=new J;return function(b){a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a=new J;return function(b){a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a=new J;return function(b){a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a=new J;return function(b,c,d){a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a=new J;return function(b,c,d){a.makeScale(b,
c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a=new B;return function(b){a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){var a=new p;return function(){this.computeBoundingBox();this.boundingBox.getCenter(a).negate();this.translate(a.x,a.y,a.z);return this}}(),setFromObject:function(a){var b=a.geometry;if(a.isPoints||a.isLine){a=new A(3*b.vertices.length,3);var c=new A(3*b.colors.length,3);this.addAttribute("position",a.copyVector3sArray(b.vertices));
this.addAttribute("color",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&(a=new A(b.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a.isMesh&&b&&b.isGeometry&&this.fromGeometry(b);return this},setFromPoints:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(e.x,
e.y,e.z||0)}this.addAttribute("position",new A(b,3));return this},updateFromObject:function(a){var b=a.geometry;if(a.isMesh){var c=b.__directGeometry;!0===b.elementsNeedUpdate&&(c=void 0,b.elementsNeedUpdate=!1);if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=b.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=
!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),c.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==
c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new De).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*
a.vertices.length);this.addAttribute("position",(new Q(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute("normal",(new Q(b,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute("color",(new Q(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new Q(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*
a.uvs2.length),this.addAttribute("uv2",(new Q(b,2)).copyVector2sArray(a.uvs2)));this.groups=a.groups;for(var c in a.morphTargets){b=[];for(var d=a.morphTargets[c],e=0,f=d.length;e<f;e++){var g=d[e],h=new A(3*g.data.length,3);h.name=g.name;b.push(h.copyVector3sArray(g.data))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new A(4*a.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new A(4*a.skinWeights.length,4),this.addAttribute("skinWeight",
c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ua);var a=this.attributes.position;void 0!==a?this.boundingBox.setFromBufferAttribute(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',
this)},computeBoundingSphere:function(){var a=new Ua,b=new p;return function(){null===this.boundingSphere&&(this.boundingSphere=new Ea);var c=this.attributes.position;if(c){var d=this.boundingSphere.center;a.setFromBufferAttribute(c);a.getCenter(d);for(var e=0,f=0,g=c.count;f<g;f++)b.x=c.getX(f),b.y=c.getY(f),b.z=c.getZ(f),e=Math.max(e,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',
this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes;if(b.position){var c=b.position.array;if(void 0===b.normal)this.addAttribute("normal",new Q(new Float32Array(c.length),3));else for(var d=b.normal.array,e=0,f=d.length;e<f;e++)d[e]=0;d=b.normal.array;var g=new p,h=new p,k=new p,m=new p,l=new p;if(a){var n=a.array;e=0;for(f=a.count;e<f;e+=3){a=3*n[e+0];var q=3*n[e+1];var u=3*n[e+2];g.fromArray(c,a);h.fromArray(c,q);k.fromArray(c,u);m.subVectors(k,
h);l.subVectors(g,h);m.cross(l);d[a]+=m.x;d[a+1]+=m.y;d[a+2]+=m.z;d[q]+=m.x;d[q+1]+=m.y;d[q+2]+=m.z;d[u]+=m.x;d[u+1]+=m.y;d[u+2]+=m.z}}else for(e=0,f=c.length;e<f;e+=9)g.fromArray(c,e),h.fromArray(c,e+3),k.fromArray(c,e+6),m.subVectors(k,h),l.subVectors(g,h),m.cross(l),d[e]=m.x,d[e+1]=m.y,d[e+2]=m.z,d[e+3]=m.x,d[e+4]=m.y,d[e+5]=m.z,d[e+6]=m.x,d[e+7]=m.y,d[e+8]=m.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(a&&a.isBufferGeometry){void 0===b&&(b=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));
var c=this.attributes,d;for(d in c)if(void 0!==a.attributes[d]){var e=c[d].array,f=a.attributes[d],g=f.array,h=0;for(f=f.itemSize*b;h<g.length;h++,f++)e[f]=g[h]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a)},normalizeNormals:function(){var a=new p;return function(){for(var b=this.attributes.normal,c=0,d=b.count;c<d;c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.normalize(),b.setXYZ(c,a.x,a.y,a.z)}}(),toNonIndexed:function(){if(null===
this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new I,b=this.index.array,c=this.attributes,d;for(d in c){var e=c[d],f=e.array,g=e.itemSize,h=new f.constructor(b.length*g),k=0;e=0;for(var m=b.length;e<m;e++){var l=b[e]*g;for(var n=0;n<g;n++)h[k++]=f[l++]}a.addAttribute(d,new Q(h,g))}b=this.groups;e=0;for(m=b.length;e<m;e++)c=b[e],a.addGroup(c.start,c.count,c.materialIndex);return a},toJSON:function(){var a={metadata:{version:4.5,type:"BufferGeometry",
generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);0<Object.keys(this.userData).length&&(a.userData=this.userData);if(void 0!==this.parameters){var b=this.parameters;for(e in b)void 0!==b[e]&&(a[e]=b[e]);return a}a.data={attributes:{}};var c=this.index;null!==c&&(b=Array.prototype.slice.call(c.array),a.data.index={type:c.array.constructor.name,array:b});c=this.attributes;for(e in c){var d=c[e];b=Array.prototype.slice.call(d.array);a.data.attributes[e]=
{itemSize:d.itemSize,type:d.array.constructor.name,array:b,normalized:d.normalized}}var e=this.groups;0<e.length&&(a.data.groups=JSON.parse(JSON.stringify(e)));e=this.boundingSphere;null!==e&&(a.data.boundingSphere={center:e.center.toArray(),radius:e.radius});return a},clone:function(){return(new I).copy(this)},copy:function(a){var b;this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.name=a.name;var c=a.index;null!==c&&this.setIndex(c.clone());
c=a.attributes;for(g in c)this.addAttribute(g,c[g].clone());var d=a.morphAttributes;for(g in d){var e=[],f=d[g];c=0;for(b=f.length;c<b;c++)e.push(f[c].clone());this.morphAttributes[g]=e}var g=a.groups;c=0;for(b=g.length;c<b;c++)d=g[c],this.addGroup(d.start,d.count,d.materialIndex);g=a.boundingBox;null!==g&&(this.boundingBox=g.clone());g=a.boundingSphere;null!==g&&(this.boundingSphere=g.clone());this.drawRange.start=a.drawRange.start;this.drawRange.count=a.drawRange.count;this.userData=a.userData;
return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Kb.prototype=Object.create(M.prototype);Kb.prototype.constructor=Kb;mb.prototype=Object.create(I.prototype);mb.prototype.constructor=mb;wc.prototype=Object.create(M.prototype);wc.prototype.constructor=wc;nb.prototype=Object.create(I.prototype);nb.prototype.constructor=nb;var Jf=0;H.prototype=Object.assign(Object.create(ea.prototype),{constructor:H,isMaterial:!0,onBeforeCompile:function(){},setValues:function(a){if(void 0!==a)for(var b in a){var c=
a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else if("shading"===b)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===c?!0:!1;else{var d=this[b];void 0===d?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]="overdraw"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=
a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||"string"===typeof a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());1!==
this.emissiveIntensity&&(d.emissiveIntensity=this.emissiveIntensity);this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);void 0!==this.clearCoat&&(d.clearCoat=this.clearCoat);void 0!==this.clearCoatRoughness&&(d.clearCoatRoughness=this.clearCoatRoughness);this.map&&this.map.isTexture&&(d.map=this.map.toJSON(a).uuid);this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap&&this.lightMap.isTexture&&
(d.lightMap=this.lightMap.toJSON(a).uuid);this.aoMap&&this.aoMap.isTexture&&(d.aoMap=this.aoMap.toJSON(a).uuid,d.aoMapIntensity=this.aoMapIntensity);this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalMapType=this.normalMapType,d.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,
d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&
(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(a).uuid);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);!0===this.flatShading&&(d.flatShading=this.flatShading);0!==this.side&&(d.side=this.side);0!==this.vertexColors&&(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);
!0===this.transparent&&(d.transparent=this.transparent);d.depthFunc=this.depthFunc;d.depthTest=this.depthTest;d.depthWrite=this.depthWrite;0!==this.rotation&&(d.rotation=this.rotation);!0===this.polygonOffset&&(d.polygonOffset=!0);0!==this.polygonOffsetFactor&&(d.polygonOffsetFactor=this.polygonOffsetFactor);0!==this.polygonOffsetUnits&&(d.polygonOffsetUnits=this.polygonOffsetUnits);1!==this.linewidth&&(d.linewidth=this.linewidth);void 0!==this.dashSize&&(d.dashSize=this.dashSize);void 0!==this.gapSize&&
(d.gapSize=this.gapSize);void 0!==this.scale&&(d.scale=this.scale);!0===this.dithering&&(d.dithering=!0);0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);
!0===this.morphTargets&&(d.morphTargets=!0);!0===this.skinning&&(d.skinning=!0);!1===this.visible&&(d.visible=!1);"{}"!==JSON.stringify(this.userData)&&(d.userData=this.userData);c&&(c=b(a.textures),a=b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.flatShading=a.flatShading;this.vertexColors=a.vertexColors;
this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;
this.dithering=a.dithering;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.userData=JSON.parse(JSON.stringify(a.userData));this.clipShadows=a.clipShadows;this.clipIntersection=a.clipIntersection;var b=a.clippingPlanes,c=null;if(null!==b){var d=b.length;c=Array(d);for(var e=0;e!==d;++e)c[e]=b[e].clone()}this.clippingPlanes=c;this.shadowSide=a.shadowSide;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
ka.prototype=Object.create(H.prototype);ka.prototype.constructor=ka;ka.prototype.isMeshBasicMaterial=!0;ka.prototype.copy=function(a){H.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=
a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};ua.prototype=Object.create(H.prototype);ua.prototype.constructor=ua;ua.prototype.isShaderMaterial=!0;ua.prototype.copy=function(a){H.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=Ba.clone(a.uniforms);this.defines=Object.assign({},
a.defines);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};ua.prototype.toJSON=function(a){var b=H.prototype.toJSON.call(this,a);b.uniforms={};for(var c in this.uniforms){var d=this.uniforms[c].value;b.uniforms[c]=d.isTexture?{type:"t",value:d.toJSON(a).uuid}:d.isColor?{type:"c",value:d.getHex()}:
d.isVector2?{type:"v2",value:d.toArray()}:d.isVector3?{type:"v3",value:d.toArray()}:d.isVector4?{type:"v4",value:d.toArray()}:d.isMatrix4?{type:"m4",value:d.toArray()}:{value:d}}0<Object.keys(this.defines).length&&(b.defines=this.defines);b.vertexShader=this.vertexShader;b.fragmentShader=this.fragmentShader;return b};Object.assign(ob.prototype,{set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);
this.direction.copy(a.direction);return this},at:function(a,b){void 0===b&&(console.warn("THREE.Ray: .at() target is now required"),b=new p);return b.copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new p;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){void 0===b&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),
b=new p);b.subVectors(a,this.origin);a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new p;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=
new p,b=new p,c=new p;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),m=c.dot(this.direction),l=-c.dot(b),n=c.lengthSq(),q=Math.abs(1-k*k);if(0<q){d=k*l-m;e=k*m-l;var p=h*q;0<=d?e>=-p?e<=p?(h=1/q,d*=h,e*=h,k=d*(d+k*e+2*m)+e*(k*d+e+2*l)+n):(e=h,d=Math.max(0,-(k*e+m)),k=-d*d+e*(e+2*l)+n):(e=-h,d=Math.max(0,-(k*e+m)),k=-d*d+e*(e+2*l)+n):e<=-p?(d=Math.max(0,-(-k*h+m)),e=0<d?-h:Math.min(Math.max(-h,
-l),h),k=-d*d+e*(e+2*l)+n):e<=p?(d=0,e=Math.min(Math.max(-h,-l),h),k=e*(e+2*l)+n):(d=Math.max(0,-(k*h+m)),e=0<d?h:Math.min(Math.max(-h,-l),h),k=-d*d+e*(e+2*l)+n)}else e=0<k?-h:h,d=Math.max(0,-(k*e+m)),k=-d*d+e*(e+2*l)+n;f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return k}}(),intersectSphere:function(){var a=new p;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d;b=b.radius*b.radius;if(e>b)return null;
b=Math.sqrt(b-e);e=d-b;d+=b;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);
return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x;if(0<=d){var h=(a.min.y-f.y)*d;d*=a.max.y-f.y}else h=(a.max.y-f.y)*d,d*=a.min.y-f.y;if(g>d||h>c)return null;if(h>g||g!==g)g=h;if(d<c||c!==c)c=d;0<=e?(h=(a.min.z-f.z)*e,a=(a.max.z-f.z)*e):(h=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e);if(g>a||h>c)return null;
if(h>g||g!==g)g=h;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=g?g:c,b)},intersectsBox:function(){var a=new p;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new p,b=new p,c=new p,d=new p;return function(e,f,g,h,k){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;
g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}});Object.assign(da,{getNormal:function(){var a=new p;return function(b,c,d,e){void 0===e&&(console.warn("THREE.Triangle: .getNormal() target is now required"),e=new p);e.subVectors(d,c);a.subVectors(b,
c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}(),getBarycoord:function(){var a=new p,b=new p,c=new p;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var k=b.dot(b);g=b.dot(c);var m=d*k-e*e;void 0===h&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),h=new p);if(0===m)return h.set(-2,-1,-1);m=1/m;k=(k*f-e*g)*m;d=(d*g-e*f)*m;return h.set(1-k-d,d,k)}}(),containsPoint:function(){var a=
new p;return function(b,c,d,e){da.getBarycoord(b,c,d,e,a);return 0<=a.x&&0<=a.y&&1>=a.x+a.y}}(),getUV:function(){var a=new p;return function(b,c,d,e,f,g,h,k){this.getBarycoord(b,c,d,e,a);k.set(0,0);k.addScaledVector(f,a.x);k.addScaledVector(g,a.y);k.addScaledVector(h,a.z);return k}}()});Object.assign(da.prototype,{set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},
clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},getArea:function(){var a=new p,b=new p;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),getMidpoint:function(a){void 0===a&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),a=new p);return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(a){return da.getNormal(this.a,
this.b,this.c,a)},getPlane:function(a){void 0===a&&(console.warn("THREE.Triangle: .getPlane() target is now required"),a=new p);return a.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(a,b){return da.getBarycoord(a,this.a,this.b,this.c,b)},containsPoint:function(a){return da.containsPoint(a,this.a,this.b,this.c)},getUV:function(a,b,c,d,e){return da.getUV(a,this.a,this.b,this.c,b,c,d,e)},intersectsBox:function(a){return a.intersectsTriangle(this)},closestPointToPoint:function(){var a=
new p,b=new p,c=new p,d=new p,e=new p,f=new p;return function(g,h){void 0===h&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),h=new p);var k=this.a,m=this.b,l=this.c;a.subVectors(m,k);b.subVectors(l,k);d.subVectors(g,k);var n=a.dot(d),q=b.dot(d);if(0>=n&&0>=q)return h.copy(k);e.subVectors(g,m);var u=a.dot(e),r=b.dot(e);if(0<=u&&r<=u)return h.copy(m);var v=n*r-u*q;if(0>=v&&0<=n&&0>=u)return m=n/(n-u),h.copy(k).addScaledVector(a,m);f.subVectors(g,l);g=a.dot(f);var y=
b.dot(f);if(0<=y&&g<=y)return h.copy(l);n=g*q-n*y;if(0>=n&&0<=q&&0>=y)return v=q/(q-y),h.copy(k).addScaledVector(b,v);q=u*y-g*r;if(0>=q&&0<=r-u&&0<=g-y)return c.subVectors(l,m),v=(r-u)/(r-u+(g-y)),h.copy(m).addScaledVector(c,v);l=1/(q+n+v);m=n*l;v*=l;return h.copy(k).addScaledVector(a,m).addScaledVector(b,v)}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}});ta.prototype=Object.assign(Object.create(B.prototype),{constructor:ta,isMesh:!0,setDrawMode:function(a){this.drawMode=
a},copy:function(a){B.prototype.copy.call(this,a);this.drawMode=a.drawMode;void 0!==a.morphTargetInfluences&&(this.morphTargetInfluences=a.morphTargetInfluences.slice());void 0!==a.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary));return this},updateMorphTargets:function(){var a=this.geometry;if(a.isBufferGeometry){a=a.morphAttributes;var b=Object.keys(a);if(0<b.length){var c=a[b[0]];if(void 0!==c)for(this.morphTargetInfluences=[],this.morphTargetDictionary=
{},a=0,b=c.length;a<b;a++){var d=c[a].name||String(a);this.morphTargetInfluences.push(0);this.morphTargetDictionary[d]=a}}}else if(c=a.morphTargets,void 0!==c&&0<c.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},a=0,b=c.length;a<b;a++)d=c[a].name||String(a),this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=a},raycast:function(){function a(a,b,c,d,e,f,g,h){if(null===(1===b.side?d.intersectTriangle(g,f,e,!0,h):d.intersectTriangle(e,f,g,2!==b.side,h)))return null;
v.copy(h);v.applyMatrix4(a.matrixWorld);b=c.ray.origin.distanceTo(v);return b<c.near||b>c.far?null:{distance:b,point:v.clone(),object:a}}function b(b,c,d,e,k,m,l,t,p){f.fromBufferAttribute(k,l);g.fromBufferAttribute(k,t);h.fromBufferAttribute(k,p);if(b=a(b,c,d,e,f,g,h,r))m&&(n.fromBufferAttribute(m,l),q.fromBufferAttribute(m,t),u.fromBufferAttribute(m,p),b.uv=da.getUV(r,f,g,h,n,q,u,new z)),m=new Va(l,t,p),da.getNormal(f,g,h,m.normal),b.face=m;return b}var c=new J,d=new ob,e=new Ea,f=new p,g=new p,
h=new p,k=new p,m=new p,l=new p,n=new z,q=new z,u=new z,r=new p,v=new p;return function(t,p){var v=this.geometry,y=this.material,x=this.matrixWorld;if(void 0!==y&&(null===v.boundingSphere&&v.computeBoundingSphere(),e.copy(v.boundingSphere),e.applyMatrix4(x),!1!==t.ray.intersectsSphere(e)&&(c.getInverse(x),d.copy(t.ray).applyMatrix4(c),null===v.boundingBox||!1!==d.intersectsBox(v.boundingBox))))if(v.isBufferGeometry){var A=v.index,B=v.attributes.position,E=v.attributes.uv,I=v.groups;v=v.drawRange;
var H;if(null!==A)if(Array.isArray(y)){var F=0;for(H=I.length;F<H;F++){var P=I[F];var L=y[P.materialIndex];x=Math.max(P.start,v.start);var M=Math.min(P.start+P.count,v.start+v.count);for(P=x;P<M;P+=3){x=A.getX(P);var J=A.getX(P+1);var K=A.getX(P+2);if(x=b(this,L,t,d,B,E,x,J,K))x.faceIndex=Math.floor(P/3),p.push(x)}}}else for(x=Math.max(0,v.start),M=Math.min(A.count,v.start+v.count),F=x,H=M;F<H;F+=3){if(x=A.getX(F),J=A.getX(F+1),K=A.getX(F+2),x=b(this,y,t,d,B,E,x,J,K))x.faceIndex=Math.floor(F/3),p.push(x)}else if(void 0!==
B)if(Array.isArray(y))for(F=0,H=I.length;F<H;F++)for(P=I[F],L=y[P.materialIndex],x=Math.max(P.start,v.start),M=Math.min(P.start+P.count,v.start+v.count),P=x;P<M;P+=3){if(x=P,J=P+1,K=P+2,x=b(this,L,t,d,B,E,x,J,K))x.faceIndex=Math.floor(P/3),p.push(x)}else for(x=Math.max(0,v.start),M=Math.min(B.count,v.start+v.count),F=x,H=M;F<H;F+=3)if(x=F,J=F+1,K=F+2,x=b(this,y,t,d,B,E,x,J,K))x.faceIndex=Math.floor(F/3),p.push(x)}else if(v.isGeometry)for(B=Array.isArray(y),E=v.vertices,I=v.faces,x=v.faceVertexUvs[0],
0<x.length&&(A=x),P=0,M=I.length;P<M;P++)if(J=I[P],x=B?y[J.materialIndex]:y,void 0!==x){F=E[J.a];H=E[J.b];L=E[J.c];if(!0===x.morphTargets){K=v.morphTargets;var R=this.morphTargetInfluences;f.set(0,0,0);g.set(0,0,0);h.set(0,0,0);for(var Q=0,T=K.length;Q<T;Q++){var U=R[Q];if(0!==U){var V=K[Q].vertices;f.addScaledVector(k.subVectors(V[J.a],F),U);g.addScaledVector(m.subVectors(V[J.b],H),U);h.addScaledVector(l.subVectors(V[J.c],L),U)}}f.add(F);g.add(H);h.add(L);F=f;H=g;L=h}if(x=a(this,x,t,d,F,H,L,r))A&&
A[P]&&(K=A[P],n.copy(K[0]),q.copy(K[1]),u.copy(K[2]),x.uv=da.getUV(r,F,H,L,n,q,u,new z)),x.face=J,x.faceIndex=P,p.push(x)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Wa.prototype=Object.create(T.prototype);Wa.prototype.constructor=Wa;Wa.prototype.isCubeTexture=!0;Object.defineProperty(Wa.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});var Le=new T,Me=new Wa,Fe=[],He=[],Ke=new Float32Array(16),Je=new Float32Array(9),
Ie=new Float32Array(4);Qe.prototype.updateCache=function(a){var b=this.cache;a instanceof Float32Array&&b.length!==a.length&&(this.cache=new Float32Array(a.length));ra(b,a)};Re.prototype.setValue=function(a,b,c){for(var d=this.seq,e=0,f=d.length;e!==f;++e){var g=d[e];g.setValue(a,b[g.id],c)}};var Ud=/([\w\d_]+)(\])?(\[|\.)?/g;$a.prototype.setValue=function(a,b,c){b=this.map[b];void 0!==b&&b.setValue(a,c,this.renderer)};$a.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,
b)};$a.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};$a.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};var xg=0,Gg=0;ab.prototype=Object.create(H.prototype);ab.prototype.constructor=ab;ab.prototype.isMeshDepthMaterial=!0;ab.prototype.copy=function(a){H.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;
this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};bb.prototype=Object.create(H.prototype);bb.prototype.constructor=bb;bb.prototype.isMeshDistanceMaterial=!0;bb.prototype.copy=function(a){H.prototype.copy.call(this,a);this.referencePosition.copy(a.referencePosition);this.nearDistance=a.nearDistance;this.farDistance=
a.farDistance;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;return this};Mb.prototype=Object.assign(Object.create(B.prototype),{constructor:Mb,isGroup:!0});X.prototype=Object.assign(Object.create(Pa.prototype),{constructor:X,isPerspectiveCamera:!0,copy:function(a,b){Pa.prototype.copy.call(this,a,b);this.fov=a.fov;this.zoom=a.zoom;
this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*K.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*K.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*K.RAD2DEG*Math.atan(Math.tan(.5*K.DEG2RAD*this.fov)/this.zoom)},
getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b;null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=a;this.view.fullHeight=b;this.view.offsetX=c;this.view.offsetY=d;this.view.width=e;this.view.height=f;this.updateProjectionMatrix()},clearViewOffset:function(){null!==
this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*K.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==this.view&&this.view.enabled){var g=f.fullWidth,h=f.fullHeight;e+=f.offsetX*d/g;b-=f.offsetY*c/h;d*=f.width/g;c*=f.height/h}f=this.filmOffset;0!==f&&(e+=a*f/this.getFilmWidth());this.projectionMatrix.makePerspective(e,e+d,b,b-c,a,this.far);this.projectionMatrixInverse.getInverse(this.projectionMatrix)},
toJSON:function(a){a=B.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});Ac.prototype=Object.assign(Object.create(X.prototype),{constructor:Ac,isArrayCamera:!0});Nb.prototype.isFogExp2=!0;Nb.prototype.clone=function(){return new Nb(this.color,
this.density)};Nb.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};Ob.prototype.isFog=!0;Ob.prototype.clone=function(){return new Ob(this.color,this.near,this.far)};Ob.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};rd.prototype=Object.assign(Object.create(B.prototype),{constructor:rd,copy:function(a,b){B.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());
null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this},toJSON:function(a){var b=B.prototype.toJSON.call(this,a);null!==this.background&&(b.object.background=this.background.toJSON(a));null!==this.fog&&(b.object.fog=this.fog.toJSON());return b}});Object.defineProperty(qb.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(qb.prototype,
{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==a?a.length/this.stride:0;this.array=a;return this},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var d=0,e=this.stride;d<
e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(a){this.onUploadCallback=a;return this}});Object.defineProperties(Bc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(Bc.prototype,{isInterleavedBufferAttribute:!0,setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},
setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*
this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return this}});eb.prototype=Object.create(H.prototype);eb.prototype.constructor=
eb;eb.prototype.isSpriteMaterial=!0;eb.prototype.copy=function(a){H.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;this.sizeAttenuation=a.sizeAttenuation;return this};var Pb;Cc.prototype=Object.assign(Object.create(B.prototype),{constructor:Cc,isSprite:!0,raycast:function(){function a(a,b,c,d,h,k){e.subVectors(a,c).addScalar(.5).multiply(d);void 0!==h?(f.x=k*e.x-h*e.y,f.y=h*e.x+k*e.y):f.copy(e);a.copy(b);a.x+=f.x;a.y+=f.y;a.applyMatrix4(g)}var b=new p,
c=new p,d=new p,e=new z,f=new z,g=new J,h=new p,k=new p,m=new p,l=new z,n=new z,q=new z;return function(e,f){c.setFromMatrixScale(this.matrixWorld);g.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld);d.setFromMatrixPosition(this.modelViewMatrix);var t=this.material.rotation;if(0!==t){var p=Math.cos(t);var r=Math.sin(t)}t=this.center;a(h.set(-.5,-.5,0),d,t,c,r,p);a(k.set(.5,-.5,0),d,t,c,r,p);a(m.set(.5,.5,0),d,t,c,r,p);l.set(0,0);n.set(1,0);q.set(1,1);var u=e.ray.intersectTriangle(h,k,
m,!1,b);if(null===u&&(a(k.set(-.5,.5,0),d,t,c,r,p),n.set(0,1),u=e.ray.intersectTriangle(h,m,k,!1,b),null===u))return;r=e.ray.origin.distanceTo(b);r<e.near||r>e.far||f.push({distance:r,point:b.clone(),uv:da.getUV(b,h,k,m,l,n,q,new z),face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)},copy:function(a){B.prototype.copy.call(this,a);void 0!==a.center&&this.center.copy(a.center);return this}});Dc.prototype=Object.assign(Object.create(B.prototype),{constructor:Dc,
copy:function(a){B.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var d=a[b];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,d=0;d<c.length&&!(b<c[d].distance);d++);c.splice(d,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,c=1,d=b.length;c<d&&!(a<b[c].distance);c++);return b[c-1].object},raycast:function(){var a=new p;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);
var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),update:function(){var a=new p,b=new p;return function(c){var d=this.levels;if(1<d.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);d[0].object.visible=!0;for(var e=1,f=d.length;e<f;e++)if(c>=d[e].distance)d[e-1].object.visible=!1,d[e].object.visible=!0;else break;for(;e<f;e++)d[e].object.visible=!1}}}(),toJSON:function(a){a=B.prototype.toJSON.call(this,a);a.object.levels=
[];for(var b=this.levels,c=0,d=b.length;c<d;c++){var e=b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return a}});Object.assign(Ec.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new J;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){var a,b;var c=0;for(b=this.bones.length;c<b;c++)(a=this.bones[c])&&a.matrixWorld.getInverse(this.boneInverses[c]);c=0;for(b=this.bones.length;c<
b;c++)if(a=this.bones[c])a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new J,b=new J;return function(){for(var c=this.bones,d=this.boneInverses,e=this.boneMatrices,f=this.boneTexture,g=0,h=c.length;g<h;g++)a.multiplyMatrices(c[g]?c[g].matrixWorld:b,d[g]),a.toArray(e,16*g);void 0!==f&&(f.needsUpdate=!0)}}(),clone:function(){return new Ec(this.bones,
this.boneInverses)},getBoneByName:function(a){for(var b=0,c=this.bones.length;b<c;b++){var d=this.bones[b];if(d.name===a)return d}}});sd.prototype=Object.assign(Object.create(B.prototype),{constructor:sd,isBone:!0});td.prototype=Object.assign(Object.create(ta.prototype),{constructor:td,isSkinnedMesh:!0,initBones:function(){var a=[],b;if(this.geometry&&void 0!==this.geometry.bones){var c=0;for(b=this.geometry.bones.length;c<b;c++){var d=this.geometry.bones[c];var e=new sd;a.push(e);e.name=d.name;e.position.fromArray(d.pos);
e.quaternion.fromArray(d.rotq);void 0!==d.scl&&e.scale.fromArray(d.scl)}c=0;for(b=this.geometry.bones.length;c<b;c++)d=this.geometry.bones[c],-1!==d.parent&&null!==d.parent&&void 0!==a[d.parent]?a[d.parent].add(a[c]):this.add(a[c])}this.updateMatrixWorld(!0);return a},bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var a;
if(this.geometry&&this.geometry.isGeometry)for(a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a];var c=1/b.manhattanLength();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){b=new aa;var d=this.geometry.attributes.skinWeight;for(a=0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.manhattanLength(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)}},updateMatrixWorld:function(a){ta.prototype.updateMatrixWorld.call(this,
a);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});V.prototype=Object.create(H.prototype);V.prototype.constructor=V;V.prototype.isLineBasicMaterial=!0;V.prototype.copy=function(a){H.prototype.copy.call(this,a);this.color.copy(a.color);
this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};oa.prototype=Object.assign(Object.create(B.prototype),{constructor:oa,isLine:!0,computeLineDistances:function(){var a=new p,b=new p;return function(){var c=this.geometry;if(c.isBufferGeometry)if(null===c.index){for(var d=c.attributes.position,e=[0],f=1,g=d.count;f<g;f++)a.fromBufferAttribute(d,f-1),b.fromBufferAttribute(d,f),e[f]=e[f-1],e[f]+=a.distanceTo(b);c.addAttribute("lineDistance",new A(e,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");
else if(c.isGeometry)for(d=c.vertices,e=c.lineDistances,e[0]=0,f=1,g=d.length;f<g;f++)e[f]=e[f-1],e[f]+=d[f-1].distanceTo(d[f]);return this}}(),raycast:function(){var a=new J,b=new ob,c=new Ea;return function(d,e){var f=d.linePrecision,g=this.geometry,h=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(h);c.radius+=f;if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);b.copy(d.ray).applyMatrix4(a);f/=(this.scale.x+this.scale.y+this.scale.z)/
3;f*=f;var k=new p,m=new p;h=new p;var l=new p,n=this&&this.isLineSegments?2:1;if(g.isBufferGeometry){var q=g.index,u=g.attributes.position.array;if(null!==q){q=q.array;g=0;for(var r=q.length-1;g<r;g+=n){var v=q[g+1];k.fromArray(u,3*q[g]);m.fromArray(u,3*v);v=b.distanceSqToSegment(k,m,l,h);v>f||(l.applyMatrix4(this.matrixWorld),v=d.ray.origin.distanceTo(l),v<d.near||v>d.far||e.push({distance:v,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}else for(g=
0,r=u.length/3-1;g<r;g+=n)k.fromArray(u,3*g),m.fromArray(u,3*g+3),v=b.distanceSqToSegment(k,m,l,h),v>f||(l.applyMatrix4(this.matrixWorld),v=d.ray.origin.distanceTo(l),v<d.near||v>d.far||e.push({distance:v,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g.isGeometry)for(k=g.vertices,m=k.length,g=0;g<m-1;g+=n)v=b.distanceSqToSegment(k[g],k[g+1],l,h),v>f||(l.applyMatrix4(this.matrixWorld),v=d.ray.origin.distanceTo(l),v<d.near||v>d.far||e.push({distance:v,
point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Z.prototype=Object.assign(Object.create(oa.prototype),{constructor:Z,isLineSegments:!0,computeLineDistances:function(){var a=new p,b=new p;return function(){var c=this.geometry;if(c.isBufferGeometry)if(null===c.index){for(var d=c.attributes.position,e=[],f=0,g=d.count;f<g;f+=2)a.fromBufferAttribute(d,f),b.fromBufferAttribute(d,
f+1),e[f]=0===f?0:e[f-1],e[f+1]=e[f]+a.distanceTo(b);c.addAttribute("lineDistance",new A(e,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(c.isGeometry)for(d=c.vertices,e=c.lineDistances,f=0,g=d.length;f<g;f+=2)a.copy(d[f]),b.copy(d[f+1]),e[f]=0===f?0:e[f-1],e[f+1]=e[f]+a.distanceTo(b);return this}}()});ud.prototype=Object.assign(Object.create(oa.prototype),{constructor:ud,isLineLoop:!0});Fa.prototype=Object.create(H.prototype);
Fa.prototype.constructor=Fa;Fa.prototype.isPointsMaterial=!0;Fa.prototype.copy=function(a){H.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;this.morphTargets=a.morphTargets;return this};Qb.prototype=Object.assign(Object.create(B.prototype),{constructor:Qb,isPoints:!0,raycast:function(){var a=new J,b=new ob,c=new Ea;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);f<l&&(b.closestPointToPoint(a,n),n.applyMatrix4(k),
a=d.ray.origin.distanceTo(n),a<d.near||a>d.far||e.push({distance:a,distanceToRay:Math.sqrt(f),point:n.clone(),index:c,face:null,object:g}))}var g=this,h=this.geometry,k=this.matrixWorld,m=d.params.Points.threshold;null===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(k);c.radius+=m;if(!1!==d.ray.intersectsSphere(c)){a.getInverse(k);b.copy(d.ray).applyMatrix4(a);m/=(this.scale.x+this.scale.y+this.scale.z)/3;var l=m*m;m=new p;var n=new p;if(h.isBufferGeometry){var q=
h.index;h=h.attributes.position.array;if(null!==q){var u=q.array;q=0;for(var r=u.length;q<r;q++){var v=u[q];m.fromArray(h,3*v);f(m,v)}}else for(q=0,u=h.length/3;q<u;q++)m.fromArray(h,3*q),f(m,q)}else for(m=h.vertices,q=0,u=m.length;q<u;q++)f(m[q],q)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Zd.prototype=Object.assign(Object.create(T.prototype),{constructor:Zd,isVideoTexture:!0,update:function(){var a=this.image;a.readyState>=a.HAVE_CURRENT_DATA&&
(this.needsUpdate=!0)}});Rb.prototype=Object.create(T.prototype);Rb.prototype.constructor=Rb;Rb.prototype.isCompressedTexture=!0;Fc.prototype=Object.create(T.prototype);Fc.prototype.constructor=Fc;Fc.prototype.isCanvasTexture=!0;Gc.prototype=Object.create(T.prototype);Gc.prototype.constructor=Gc;Gc.prototype.isDepthTexture=!0;Sb.prototype=Object.create(I.prototype);Sb.prototype.constructor=Sb;Hc.prototype=Object.create(M.prototype);Hc.prototype.constructor=Hc;Tb.prototype=Object.create(I.prototype);
Tb.prototype.constructor=Tb;Ic.prototype=Object.create(M.prototype);Ic.prototype.constructor=Ic;la.prototype=Object.create(I.prototype);la.prototype.constructor=la;Jc.prototype=Object.create(M.prototype);Jc.prototype.constructor=Jc;Ub.prototype=Object.create(la.prototype);Ub.prototype.constructor=Ub;Kc.prototype=Object.create(M.prototype);Kc.prototype.constructor=Kc;rb.prototype=Object.create(la.prototype);rb.prototype.constructor=rb;Lc.prototype=Object.create(M.prototype);Lc.prototype.constructor=
Lc;Vb.prototype=Object.create(la.prototype);Vb.prototype.constructor=Vb;Mc.prototype=Object.create(M.prototype);Mc.prototype.constructor=Mc;Wb.prototype=Object.create(la.prototype);Wb.prototype.constructor=Wb;Nc.prototype=Object.create(M.prototype);Nc.prototype.constructor=Nc;Xb.prototype=Object.create(I.prototype);Xb.prototype.constructor=Xb;Oc.prototype=Object.create(M.prototype);Oc.prototype.constructor=Oc;Yb.prototype=Object.create(I.prototype);Yb.prototype.constructor=Yb;Pc.prototype=Object.create(M.prototype);
Pc.prototype.constructor=Pc;Zb.prototype=Object.create(I.prototype);Zb.prototype.constructor=Zb;var Tg={triangulate:function(a,b,c){c=c||2;var d=b&&b.length,e=d?b[0]*c:a.length,f=af(a,0,e,c,!0),g=[];if(!f)return g;var h;if(d){var k=c;d=[];var m;var l=0;for(m=b.length;l<m;l++){var n=b[l]*k;var q=l<m-1?b[l+1]*k:a.length;n=af(a,n,q,k,!1);n===n.next&&(n.steiner=!0);d.push(Og(n))}d.sort(Mg);for(l=0;l<d.length;l++){b=d[l];k=f;if(k=Ng(b,k))b=df(k,b),Rc(b,b.next);f=Rc(f,f.next)}}if(a.length>80*c){var p=h=
a[0];var r=d=a[1];for(k=c;k<e;k+=c)l=a[k],b=a[k+1],l<p&&(p=l),b<r&&(r=b),l>h&&(h=l),b>d&&(d=b);h=Math.max(h-p,d-r);h=0!==h?1/h:0}Sc(f,g,c,p,r,h);return g}},Xa={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},isClockWise:function(a){return 0>Xa.area(a)},triangulateShape:function(a,b){var c=[],d=[],e=[];ef(a);ff(c,a);var f=a.length;b.forEach(ef);for(a=0;a<b.length;a++)d.push(f),f+=b[a].length,ff(c,b[a]);b=Tg.triangulate(c,d);for(a=0;a<b.length;a+=
3)e.push(b.slice(a,a+3));return e}};tb.prototype=Object.create(M.prototype);tb.prototype.constructor=tb;tb.prototype.toJSON=function(){var a=M.prototype.toJSON.call(this);return gf(this.parameters.shapes,this.parameters.options,a)};Qa.prototype=Object.create(I.prototype);Qa.prototype.constructor=Qa;Qa.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);return gf(this.parameters.shapes,this.parameters.options,a)};var Pg={generateTopUV:function(a,b,c,d,e){a=b[3*d];d=b[3*d+1];var f=b[3*e];
e=b[3*e+1];return[new z(b[3*c],b[3*c+1]),new z(a,d),new z(f,e)]},generateSideWallUV:function(a,b,c,d,e,f){a=b[3*c];var g=b[3*c+1];c=b[3*c+2];var h=b[3*d],k=b[3*d+1];d=b[3*d+2];var m=b[3*e],l=b[3*e+1];e=b[3*e+2];var n=b[3*f],q=b[3*f+1];b=b[3*f+2];return.01>Math.abs(g-k)?[new z(a,1-c),new z(h,1-d),new z(m,1-e),new z(n,1-b)]:[new z(g,1-c),new z(k,1-d),new z(l,1-e),new z(q,1-b)]}};Uc.prototype=Object.create(M.prototype);Uc.prototype.constructor=Uc;$b.prototype=Object.create(Qa.prototype);$b.prototype.constructor=
$b;Vc.prototype=Object.create(M.prototype);Vc.prototype.constructor=Vc;ub.prototype=Object.create(I.prototype);ub.prototype.constructor=ub;Wc.prototype=Object.create(M.prototype);Wc.prototype.constructor=Wc;ac.prototype=Object.create(I.prototype);ac.prototype.constructor=ac;Xc.prototype=Object.create(M.prototype);Xc.prototype.constructor=Xc;bc.prototype=Object.create(I.prototype);bc.prototype.constructor=bc;vb.prototype=Object.create(M.prototype);vb.prototype.constructor=vb;vb.prototype.toJSON=function(){var a=
M.prototype.toJSON.call(this);return hf(this.parameters.shapes,a)};wb.prototype=Object.create(I.prototype);wb.prototype.constructor=wb;wb.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);return hf(this.parameters.shapes,a)};cc.prototype=Object.create(I.prototype);cc.prototype.constructor=cc;xb.prototype=Object.create(M.prototype);xb.prototype.constructor=xb;Ya.prototype=Object.create(I.prototype);Ya.prototype.constructor=Ya;Yc.prototype=Object.create(xb.prototype);Yc.prototype.constructor=
Yc;Zc.prototype=Object.create(Ya.prototype);Zc.prototype.constructor=Zc;$c.prototype=Object.create(M.prototype);$c.prototype.constructor=$c;dc.prototype=Object.create(I.prototype);dc.prototype.constructor=dc;var za=Object.freeze({WireframeGeometry:Sb,ParametricGeometry:Hc,ParametricBufferGeometry:Tb,TetrahedronGeometry:Jc,TetrahedronBufferGeometry:Ub,OctahedronGeometry:Kc,OctahedronBufferGeometry:rb,IcosahedronGeometry:Lc,IcosahedronBufferGeometry:Vb,DodecahedronGeometry:Mc,DodecahedronBufferGeometry:Wb,
PolyhedronGeometry:Ic,PolyhedronBufferGeometry:la,TubeGeometry:Nc,TubeBufferGeometry:Xb,TorusKnotGeometry:Oc,TorusKnotBufferGeometry:Yb,TorusGeometry:Pc,TorusBufferGeometry:Zb,TextGeometry:Uc,TextBufferGeometry:$b,SphereGeometry:Vc,SphereBufferGeometry:ub,RingGeometry:Wc,RingBufferGeometry:ac,PlaneGeometry:wc,PlaneBufferGeometry:nb,LatheGeometry:Xc,LatheBufferGeometry:bc,ShapeGeometry:vb,ShapeBufferGeometry:wb,ExtrudeGeometry:tb,ExtrudeBufferGeometry:Qa,EdgesGeometry:cc,ConeGeometry:Yc,ConeBufferGeometry:Zc,
CylinderGeometry:xb,CylinderBufferGeometry:Ya,CircleGeometry:$c,CircleBufferGeometry:dc,BoxGeometry:Kb,BoxBufferGeometry:mb});yb.prototype=Object.create(H.prototype);yb.prototype.constructor=yb;yb.prototype.isShadowMaterial=!0;yb.prototype.copy=function(a){H.prototype.copy.call(this,a);this.color.copy(a.color);return this};ec.prototype=Object.create(ua.prototype);ec.prototype.constructor=ec;ec.prototype.isRawShaderMaterial=!0;Ra.prototype=Object.create(H.prototype);Ra.prototype.constructor=Ra;Ra.prototype.isMeshStandardMaterial=
!0;Ra.prototype.copy=function(a){H.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=
a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=
a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};zb.prototype=Object.create(Ra.prototype);zb.prototype.constructor=zb;zb.prototype.isMeshPhysicalMaterial=!0;zb.prototype.copy=function(a){Ra.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};Ga.prototype=Object.create(H.prototype);Ga.prototype.constructor=
Ga;Ga.prototype.isMeshPhongMaterial=!0;Ga.prototype.copy=function(a){H.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;
this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=
a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};Ab.prototype=Object.create(Ga.prototype);Ab.prototype.constructor=Ab;Ab.prototype.isMeshToonMaterial=!0;Ab.prototype.copy=function(a){Ga.prototype.copy.call(this,a);this.gradientMap=a.gradientMap;return this};Bb.prototype=Object.create(H.prototype);Bb.prototype.constructor=Bb;Bb.prototype.isMeshNormalMaterial=!0;Bb.prototype.copy=function(a){H.prototype.copy.call(this,a);this.bumpMap=
a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};Cb.prototype=Object.create(H.prototype);Cb.prototype.constructor=Cb;
Cb.prototype.isMeshLambertMaterial=!0;Cb.prototype.copy=function(a){H.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=
a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};Db.prototype=Object.create(V.prototype);Db.prototype.constructor=Db;Db.prototype.isLineDashedMaterial=!0;Db.prototype.copy=function(a){V.prototype.copy.call(this,a);this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;
return this};var Ug=Object.freeze({ShadowMaterial:yb,SpriteMaterial:eb,RawShaderMaterial:ec,ShaderMaterial:ua,PointsMaterial:Fa,MeshPhysicalMaterial:zb,MeshStandardMaterial:Ra,MeshPhongMaterial:Ga,MeshToonMaterial:Ab,MeshNormalMaterial:Bb,MeshLambertMaterial:Cb,MeshDepthMaterial:ab,MeshDistanceMaterial:bb,MeshBasicMaterial:ka,LineDashedMaterial:Db,LineBasicMaterial:V,Material:H}),Hb={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},
remove:function(a){delete this.files[a]},clear:function(){this.files={}}},wa=new be,Na={};Object.assign(Ha.prototype,{load:function(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);var e=this,f=Hb.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;if(void 0!==Na[a])Na[a].push({onLoad:b,onProgress:c,onError:d});else{var g=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(g){c=g[1];var h=!!g[2];g=g[3];g=window.decodeURIComponent(g);
h&&(g=window.atob(g));try{var k=(this.responseType||"").toLowerCase();switch(k){case "arraybuffer":case "blob":var m=new Uint8Array(g.length);for(h=0;h<g.length;h++)m[h]=g.charCodeAt(h);var l="blob"===k?new Blob([m.buffer],{type:c}):m.buffer;break;case "document":l=(new DOMParser).parseFromString(g,c);break;case "json":l=JSON.parse(g);break;default:l=g}window.setTimeout(function(){b&&b(l);e.manager.itemEnd(a)},0)}catch(q){window.setTimeout(function(){d&&d(q);e.manager.itemEnd(a);e.manager.itemError(a)},
0)}}else{Na[a]=[];Na[a].push({onLoad:b,onProgress:c,onError:d});var n=new XMLHttpRequest;n.open("GET",a,!0);n.addEventListener("load",function(b){var c=this.response;Hb.add(a,c);var d=Na[a];delete Na[a];if(200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var f=0,g=d.length;f<g;f++){var h=d[f];if(h.onLoad)h.onLoad(c)}e.manager.itemEnd(a)}else{f=0;for(g=d.length;f<g;f++)if(h=d[f],h.onError)h.onError(b);e.manager.itemEnd(a);e.manager.itemError(a)}},
!1);n.addEventListener("progress",function(b){for(var c=Na[a],d=0,e=c.length;d<e;d++){var f=c[d];if(f.onProgress)f.onProgress(b)}},!1);n.addEventListener("error",function(b){var c=Na[a];delete Na[a];for(var d=0,f=c.length;d<f;d++){var g=c[d];if(g.onError)g.onError(b)}e.manager.itemEnd(a);e.manager.itemError(a)},!1);n.addEventListener("abort",function(b){var c=Na[a];delete Na[a];for(var d=0,f=c.length;d<f;d++){var g=c[d];if(g.onError)g.onError(b)}e.manager.itemEnd(a);e.manager.itemError(a)},!1);void 0!==
this.responseType&&(n.responseType=this.responseType);void 0!==this.withCredentials&&(n.withCredentials=this.withCredentials);n.overrideMimeType&&n.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(h in this.requestHeader)n.setRequestHeader(h,this.requestHeader[h]);n.send(null)}e.manager.itemStart(a);return n}},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},
setMimeType:function(a){this.mimeType=a;return this},setRequestHeader:function(a){this.requestHeader=a;return this}});Object.assign(jf.prototype,{load:function(a,b,c,d){function e(e){k.load(a[e],function(a){a=f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};m+=1;6===m&&(1===a.mipmapCount&&(h.minFilter=1006),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var f=this,g=[],h=new Rb;h.image=g;var k=new Ha(this.manager);k.setPath(this.path);k.setResponseType("arraybuffer");
if(Array.isArray(a))for(var m=0,l=0,n=a.length;l<n;++l)e(l);else k.load(a,function(a){a=f._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){g[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),g[d].format=a.format,g[d].width=a.width,g[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=1006);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return h},setPath:function(a){this.path=
a;return this}});Object.assign(ce.prototype,{load:function(a,b,c,d){var e=this,f=new ib,g=new Ha(this.manager);g.setResponseType("arraybuffer");g.load(a,function(a){if(a=e._parser(a))void 0!==a.image?f.image=a.image:void 0!==a.data&&(f.image.width=a.width,f.image.height=a.height,f.image.data=a.data),f.wrapS=void 0!==a.wrapS?a.wrapS:1001,f.wrapT=void 0!==a.wrapT?a.wrapT:1001,f.magFilter=void 0!==a.magFilter?a.magFilter:1006,f.minFilter=void 0!==a.minFilter?a.minFilter:1008,f.anisotropy=void 0!==a.anisotropy?
a.anisotropy:1,void 0!==a.format&&(f.format=a.format),void 0!==a.type&&(f.type=a.type),void 0!==a.mipmaps&&(f.mipmaps=a.mipmaps),1===a.mipmapCount&&(f.minFilter=1006),f.needsUpdate=!0,b&&b(f,a)},c,d);return f}});Object.assign(ad.prototype,{crossOrigin:"anonymous",load:function(a,b,c,d){function e(){k.removeEventListener("load",e,!1);k.removeEventListener("error",f,!1);Hb.add(a,this);b&&b(this);g.manager.itemEnd(a)}function f(b){k.removeEventListener("load",e,!1);k.removeEventListener("error",f,!1);
d&&d(b);g.manager.itemEnd(a);g.manager.itemError(a)}void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);var g=this,h=Hb.get(a);if(void 0!==h)return g.manager.itemStart(a),setTimeout(function(){b&&b(h);g.manager.itemEnd(a)},0),h;var k=document.createElementNS("http://www.w3.org/1999/xhtml","img");k.addEventListener("load",e,!1);k.addEventListener("error",f,!1);"data:"!==a.substr(0,5)&&void 0!==this.crossOrigin&&(k.crossOrigin=this.crossOrigin);g.manager.itemStart(a);
k.src=a;return k},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(de.prototype,{crossOrigin:"anonymous",load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new Wa,g=new ad(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);var h=0;for(c=0;c<a.length;++c)e(c);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=
a;return this}});Object.assign(wd.prototype,{crossOrigin:"anonymous",load:function(a,b,c,d){var e=new T,f=new ad(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);f.load(a,function(c){e.image=c;c=0<a.search(/\.jpe?g$/i)||0===a.search(/^data:image\/jpeg/);e.format=c?1022:1023;e.needsUpdate=!0;void 0!==b&&b(e)},c,d);return e},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(L.prototype,{getPoint:function(){console.warn("THREE.Curve: .getPoint() not implemented.");
return null},getPointAt:function(a,b){a=this.getUtoTmapping(a);return this.getPoint(a,b)},getPoints:function(a){void 0===a&&(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));return b},getSpacedPoints:function(a){void 0===a&&(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){void 0===a&&(a=this.arcLengthDivisions);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;
this.needsUpdate=!1;var b=[],c=this.getPoint(0),d,e=0;b.push(0);for(d=1;d<=a;d++){var f=this.getPoint(d/a);e+=f.distanceTo(c);b.push(e);c=f}return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),d=c.length;b=b?b:a*c[d-1];for(var e=0,f=d-1,g;e<=f;)if(a=Math.floor(e+(f-e)/2),g=c[a]-b,0>g)e=a+1;else if(0<g)f=a-1;else{f=a;break}a=f;if(c[a]===b)return a/(d-1);e=c[a];return(a+(b-e)/(c[a+1]-e))/(d-1)},getTangent:function(a){var b=
a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)},computeFrenetFrames:function(a,b){var c=new p,d=[],e=[],f=[],g=new p,h=new J,k;for(k=0;k<=a;k++){var m=k/a;d[k]=this.getTangentAt(m);d[k].normalize()}e[0]=new p;f[0]=new p;k=Number.MAX_VALUE;m=Math.abs(d[0].x);var l=Math.abs(d[0].y),n=Math.abs(d[0].z);m<=k&&(k=m,c.set(1,0,0));l<=k&&(k=l,c.set(0,1,0));n<=k&&c.set(0,
0,1);g.crossVectors(d[0],c).normalize();e[0].crossVectors(d[0],g);f[0].crossVectors(d[0],e[0]);for(k=1;k<=a;k++)e[k]=e[k-1].clone(),f[k]=f[k-1].clone(),g.crossVectors(d[k-1],d[k]),g.length()>Number.EPSILON&&(g.normalize(),c=Math.acos(K.clamp(d[k-1].dot(d[k]),-1,1)),e[k].applyMatrix4(h.makeRotationAxis(g,c))),f[k].crossVectors(d[k],e[k]);if(!0===b)for(c=Math.acos(K.clamp(e[0].dot(e[a]),-1,1)),c/=a,0<d[0].dot(g.crossVectors(e[0],e[a]))&&(c=-c),k=1;k<=a;k++)e[k].applyMatrix4(h.makeRotationAxis(d[k],
c*k)),f[k].crossVectors(d[k],e[k]);return{tangents:d,normals:e,binormals:f}},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.arcLengthDivisions=a.arcLengthDivisions;return this},toJSON:function(){var a={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};a.arcLengthDivisions=this.arcLengthDivisions;a.type=this.type;return a},fromJSON:function(a){this.arcLengthDivisions=a.arcLengthDivisions;return this}});Aa.prototype=Object.create(L.prototype);Aa.prototype.constructor=
Aa;Aa.prototype.isEllipseCurve=!0;Aa.prototype.getPoint=function(a,b){b=b||new z;for(var c=2*Math.PI,d=this.aEndAngle-this.aStartAngle,e=Math.abs(d)<Number.EPSILON;0>d;)d+=c;for(;d>c;)d-=c;d<Number.EPSILON&&(d=e?0:c);!0!==this.aClockwise||e||(d=d===c?-c:d-c);c=this.aStartAngle+a*d;a=this.aX+this.xRadius*Math.cos(c);var f=this.aY+this.yRadius*Math.sin(c);0!==this.aRotation&&(c=Math.cos(this.aRotation),d=Math.sin(this.aRotation),e=a-this.aX,f-=this.aY,a=e*c-f*d+this.aX,f=e*d+f*c+this.aY);return b.set(a,
f)};Aa.prototype.copy=function(a){L.prototype.copy.call(this,a);this.aX=a.aX;this.aY=a.aY;this.xRadius=a.xRadius;this.yRadius=a.yRadius;this.aStartAngle=a.aStartAngle;this.aEndAngle=a.aEndAngle;this.aClockwise=a.aClockwise;this.aRotation=a.aRotation;return this};Aa.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.aX=this.aX;a.aY=this.aY;a.xRadius=this.xRadius;a.yRadius=this.yRadius;a.aStartAngle=this.aStartAngle;a.aEndAngle=this.aEndAngle;a.aClockwise=this.aClockwise;a.aRotation=
this.aRotation;return a};Aa.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.aX=a.aX;this.aY=a.aY;this.xRadius=a.xRadius;this.yRadius=a.yRadius;this.aStartAngle=a.aStartAngle;this.aEndAngle=a.aEndAngle;this.aClockwise=a.aClockwise;this.aRotation=a.aRotation;return this};fc.prototype=Object.create(Aa.prototype);fc.prototype.constructor=fc;fc.prototype.isArcCurve=!0;var Pd=new p,ze=new ee,Ae=new ee,Be=new ee;ja.prototype=Object.create(L.prototype);ja.prototype.constructor=ja;ja.prototype.isCatmullRomCurve3=
!0;ja.prototype.getPoint=function(a,b){b=b||new p;var c=this.points,d=c.length;a*=d-(this.closed?0:1);var e=Math.floor(a);a-=e;this.closed?e+=0<e?0:(Math.floor(Math.abs(e)/d)+1)*d:0===a&&e===d-1&&(e=d-2,a=1);if(this.closed||0<e)var f=c[(e-1)%d];else Pd.subVectors(c[0],c[1]).add(c[0]),f=Pd;var g=c[e%d];var h=c[(e+1)%d];this.closed||e+2<d?c=c[(e+2)%d]:(Pd.subVectors(c[d-1],c[d-2]).add(c[d-1]),c=Pd);if("centripetal"===this.curveType||"chordal"===this.curveType){var k="chordal"===this.curveType?.5:.25;
d=Math.pow(f.distanceToSquared(g),k);e=Math.pow(g.distanceToSquared(h),k);k=Math.pow(h.distanceToSquared(c),k);1E-4>e&&(e=1);1E-4>d&&(d=e);1E-4>k&&(k=e);ze.initNonuniformCatmullRom(f.x,g.x,h.x,c.x,d,e,k);Ae.initNonuniformCatmullRom(f.y,g.y,h.y,c.y,d,e,k);Be.initNonuniformCatmullRom(f.z,g.z,h.z,c.z,d,e,k)}else"catmullrom"===this.curveType&&(ze.initCatmullRom(f.x,g.x,h.x,c.x,this.tension),Ae.initCatmullRom(f.y,g.y,h.y,c.y,this.tension),Be.initCatmullRom(f.z,g.z,h.z,c.z,this.tension));b.set(ze.calc(a),
Ae.calc(a),Be.calc(a));return b};ja.prototype.copy=function(a){L.prototype.copy.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++)this.points.push(a.points[b].clone());this.closed=a.closed;this.curveType=a.curveType;this.tension=a.tension;return this};ja.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.points=[];for(var b=0,c=this.points.length;b<c;b++)a.points.push(this.points[b].toArray());a.closed=this.closed;a.curveType=this.curveType;a.tension=this.tension;return a};
ja.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push((new p).fromArray(d))}this.closed=a.closed;this.curveType=a.curveType;this.tension=a.tension;return this};Ia.prototype=Object.create(L.prototype);Ia.prototype.constructor=Ia;Ia.prototype.isCubicBezierCurve=!0;Ia.prototype.getPoint=function(a,b){b=b||new z;var c=this.v0,d=this.v1,e=this.v2,f=this.v3;b.set(cd(a,c.x,d.x,e.x,f.x),cd(a,c.y,d.y,e.y,
f.y));return b};Ia.prototype.copy=function(a){L.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);this.v3.copy(a.v3);return this};Ia.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();a.v3=this.v3.toArray();return a};Ia.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);this.v3.fromArray(a.v3);return this};
Sa.prototype=Object.create(L.prototype);Sa.prototype.constructor=Sa;Sa.prototype.isCubicBezierCurve3=!0;Sa.prototype.getPoint=function(a,b){b=b||new p;var c=this.v0,d=this.v1,e=this.v2,f=this.v3;b.set(cd(a,c.x,d.x,e.x,f.x),cd(a,c.y,d.y,e.y,f.y),cd(a,c.z,d.z,e.z,f.z));return b};Sa.prototype.copy=function(a){L.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);this.v3.copy(a.v3);return this};Sa.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.v0=this.v0.toArray();
a.v1=this.v1.toArray();a.v2=this.v2.toArray();a.v3=this.v3.toArray();return a};Sa.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);this.v3.fromArray(a.v3);return this};xa.prototype=Object.create(L.prototype);xa.prototype.constructor=xa;xa.prototype.isLineCurve=!0;xa.prototype.getPoint=function(a,b){b=b||new z;1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1));return b};xa.prototype.getPointAt=
function(a,b){return this.getPoint(a,b)};xa.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()};xa.prototype.copy=function(a){L.prototype.copy.call(this,a);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};xa.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};xa.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Ja.prototype=
Object.create(L.prototype);Ja.prototype.constructor=Ja;Ja.prototype.isLineCurve3=!0;Ja.prototype.getPoint=function(a,b){b=b||new p;1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1));return b};Ja.prototype.getPointAt=function(a,b){return this.getPoint(a,b)};Ja.prototype.copy=function(a){L.prototype.copy.call(this,a);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};Ja.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.v1=this.v1.toArray();a.v2=this.v2.toArray();
return a};Ja.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Ka.prototype=Object.create(L.prototype);Ka.prototype.constructor=Ka;Ka.prototype.isQuadraticBezierCurve=!0;Ka.prototype.getPoint=function(a,b){b=b||new z;var c=this.v0,d=this.v1,e=this.v2;b.set(bd(a,c.x,d.x,e.x),bd(a,c.y,d.y,e.y));return b};Ka.prototype.copy=function(a){L.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};
Ka.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};Ka.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Ta.prototype=Object.create(L.prototype);Ta.prototype.constructor=Ta;Ta.prototype.isQuadraticBezierCurve3=!0;Ta.prototype.getPoint=function(a,b){b=b||new p;var c=this.v0,d=this.v1,e=this.v2;b.set(bd(a,c.x,
d.x,e.x),bd(a,c.y,d.y,e.y),bd(a,c.z,d.z,e.z));return b};Ta.prototype.copy=function(a){L.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};Ta.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};Ta.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};La.prototype=Object.create(L.prototype);
La.prototype.constructor=La;La.prototype.isSplineCurve=!0;La.prototype.getPoint=function(a,b){b=b||new z;var c=this.points,d=(c.length-1)*a;a=Math.floor(d);d-=a;var e=c[0===a?a:a-1],f=c[a],g=c[a>c.length-2?c.length-1:a+1];c=c[a>c.length-3?c.length-1:a+2];b.set(kf(d,e.x,f.x,g.x,c.x),kf(d,e.y,f.y,g.y,c.y));return b};La.prototype.copy=function(a){L.prototype.copy.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++)this.points.push(a.points[b].clone());return this};La.prototype.toJSON=function(){var a=
L.prototype.toJSON.call(this);a.points=[];for(var b=0,c=this.points.length;b<c;b++)a.points.push(this.points[b].toArray());return a};La.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push((new z).fromArray(d))}return this};var zf=Object.freeze({ArcCurve:fc,CatmullRomCurve3:ja,CubicBezierCurve:Ia,CubicBezierCurve3:Sa,EllipseCurve:Aa,LineCurve:xa,LineCurve3:Ja,QuadraticBezierCurve:Ka,QuadraticBezierCurve3:Ta,
SplineCurve:La});Za.prototype=Object.assign(Object.create(L.prototype),{constructor:Za,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new xa(b,a))},getPoint:function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],c=a.getLength(),a.getPointAt(0===c?0:1-b/c);a++}return null},getLength:function(){var a=this.getCurveLengths();
return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},getSpacedPoints:function(a){void 0===a&&(a=40);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=
a||12;for(var b=[],c,d=0,e=this.curves;d<e.length;d++){var f=e[d];f=f.getPoints(f&&f.isEllipseCurve?2*a:f&&(f.isLineCurve||f.isLineCurve3)?1:f&&f.isSplineCurve?a*f.points.length:a);for(var g=0;g<f.length;g++){var h=f[g];c&&c.equals(h)||(b.push(h),c=h)}}this.autoClose&&1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b},copy:function(a){L.prototype.copy.call(this,a);this.curves=[];for(var b=0,c=a.curves.length;b<c;b++)this.curves.push(a.curves[b].clone());this.autoClose=a.autoClose;return this},
toJSON:function(){var a=L.prototype.toJSON.call(this);a.autoClose=this.autoClose;a.curves=[];for(var b=0,c=this.curves.length;b<c;b++)a.curves.push(this.curves[b].toJSON());return a},fromJSON:function(a){L.prototype.fromJSON.call(this,a);this.autoClose=a.autoClose;this.curves=[];for(var b=0,c=a.curves.length;b<c;b++){var d=a.curves[b];this.curves.push((new zf[d.type]).fromJSON(d))}return this}});Ma.prototype=Object.assign(Object.create(Za.prototype),{constructor:Ma,setFromPoints:function(a){this.moveTo(a[0].x,
a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.currentPoint.set(a,b)},lineTo:function(a,b){var c=new xa(this.currentPoint.clone(),new z(a,b));this.curves.push(c);this.currentPoint.set(a,b)},quadraticCurveTo:function(a,b,c,d){a=new Ka(this.currentPoint.clone(),new z(a,b),new z(c,d));this.curves.push(a);this.currentPoint.set(c,d)},bezierCurveTo:function(a,b,c,d,e,f){a=new Ia(this.currentPoint.clone(),new z(a,b),new z(c,d),new z(e,f));this.curves.push(a);
this.currentPoint.set(e,f)},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a);b=new La(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1])},arc:function(a,b,c,d,e,f){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,h){this.absellipse(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f,g,h)},absellipse:function(a,b,c,d,e,f,g,h){a=new Aa(a,b,c,d,e,f,g,h);0<this.curves.length&&
(b=a.getPoint(0),b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)},copy:function(a){Za.prototype.copy.call(this,a);this.currentPoint.copy(a.currentPoint);return this},toJSON:function(){var a=Za.prototype.toJSON.call(this);a.currentPoint=this.currentPoint.toArray();return a},fromJSON:function(a){Za.prototype.fromJSON.call(this,a);this.currentPoint.fromArray(a.currentPoint);return this}});fb.prototype=Object.assign(Object.create(Ma.prototype),
{constructor:fb,getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},copy:function(a){Ma.prototype.copy.call(this,a);this.holes=[];for(var b=0,c=a.holes.length;b<c;b++)this.holes.push(a.holes[b].clone());return this},toJSON:function(){var a=Ma.prototype.toJSON.call(this);a.uuid=this.uuid;a.holes=[];for(var b=0,c=this.holes.length;b<c;b++)a.holes.push(this.holes[b].toJSON());
return a},fromJSON:function(a){Ma.prototype.fromJSON.call(this,a);this.uuid=a.uuid;this.holes=[];for(var b=0,c=a.holes.length;b<c;b++){var d=a.holes[b];this.holes.push((new Ma).fromJSON(d))}return this}});fa.prototype=Object.assign(Object.create(B.prototype),{constructor:fa,isLight:!0,copy:function(a){B.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=B.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=
this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON());return a}});xd.prototype=Object.assign(Object.create(fa.prototype),{constructor:xd,isHemisphereLight:!0,copy:function(a){fa.prototype.copy.call(this,
a);this.groundColor.copy(a.groundColor);return this}});Object.assign(Eb.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};0!==this.bias&&(a.bias=this.bias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;
return a}});yd.prototype=Object.assign(Object.create(Eb.prototype),{constructor:yd,isSpotLightShadow:!0,update:function(a){var b=this.camera,c=2*K.RAD2DEG*a.angle,d=this.mapSize.width/this.mapSize.height;a=a.distance||b.far;if(c!==b.fov||d!==b.aspect||a!==b.far)b.fov=c,b.aspect=d,b.far=a,b.updateProjectionMatrix()}});zd.prototype=Object.assign(Object.create(fa.prototype),{constructor:zd,isSpotLight:!0,copy:function(a){fa.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=
a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});Ad.prototype=Object.assign(Object.create(fa.prototype),{constructor:Ad,isPointLight:!0,copy:function(a){fa.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});Bd.prototype=Object.assign(Object.create(Eb.prototype),{constructor:Bd});Cd.prototype=Object.assign(Object.create(fa.prototype),{constructor:Cd,isDirectionalLight:!0,copy:function(a){fa.prototype.copy.call(this,
a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});Dd.prototype=Object.assign(Object.create(fa.prototype),{constructor:Dd,isAmbientLight:!0});Ed.prototype=Object.assign(Object.create(fa.prototype),{constructor:Ed,isRectAreaLight:!0,copy:function(a){fa.prototype.copy.call(this,a);this.width=a.width;this.height=a.height;return this},toJSON:function(a){a=fa.prototype.toJSON.call(this,a);a.object.width=this.width;a.object.height=this.height;return a}});var qa={arraySlice:function(a,
b,c){return qa.isTypedArray(a)?new a.constructor(a.subarray(b,void 0!==c?c:a.length)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),d=0;d!==b;++d)c[d]=d;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,b,c){for(var d=a.length,e=
new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,k=0;k!==b;++k)e[g++]=a[h+k];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g)){do g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f)}else if(void 0!==g.toArray){do g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f)}else{do g=f[d],void 0!==g&&(b.push(f.time),c.push(g)),f=a[e++];
while(void 0!==f)}}}};Object.assign(ya.prototype,{evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var f=c+2;;){if(void 0===d){if(a<e)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,e)}if(c===f)break;e=d;d=b[++c];if(a<d)break b}d=b.length;break c}if(a>=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a>=e)break b}d=c;c=
0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,e,a)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var e=0;e!==d;++e)b[e]=
c[a+e];return b},interpolate_:function(){throw Error("call to abstract method");},intervalChanged_:function(){}});Object.assign(ya.prototype,{beforeStart_:ya.prototype.copySampleValue_,afterEnd_:ya.prototype.copySampleValue_});Fd.prototype=Object.assign(Object.create(ya.prototype),{constructor:Fd,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case 2401:e=
a;g=2*b-c;break;case 2402:e=d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case 2401:f=a;h=2*c-b;break;case 2402:f=1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g,k=this._offsetPrev,m=this._offsetNext,l=this._weightPrev,n=this._weightNext,
q=(c-b)/(d-b);c=q*q;d=c*q;b=-l*d+2*l*c-l*q;l=(1+l)*d+(-1.5-2*l)*c+(-.5+l)*q+1;q=(-1-n)*d+(1.5+n)*c+.5*q;n=n*d-n*c;for(c=0;c!==g;++c)e[c]=b*f[k+c]+l*f[h+c]+q*f[a+c]+n*f[m+c];return e}});dd.prototype=Object.assign(Object.create(ya.prototype),{constructor:dd,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g;b=(c-b)/(d-b);c=1-b;for(d=0;d!==g;++d)e[d]=f[h+d]*c+f[a+d]*b;return e}});Gd.prototype=Object.assign(Object.create(ya.prototype),{constructor:Gd,
interpolate_:function(a){return this.copySampleValue_(a-1)}});Object.assign(pa,{toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);else{b={name:a.name,times:qa.convertArray(a.times,Array),values:qa.convertArray(a.values,Array)};var c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b}});Object.assign(pa.prototype,{constructor:pa,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(a){return new Gd(this.times,
this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new dd(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new Fd(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){switch(a){case 2300:var b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+
" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(b);console.warn("THREE.KeyframeTrack:",b);return this}this.createInterpolant=b;return this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/
this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),a=this.getValueSize(),this.times=qa.arraySlice(c,e,f),this.values=qa.arraySlice(this.values,e*a,f*a);return this},validate:function(){var a=
!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);var c=this.times;b=this.values;var d=c.length;0===d&&(console.error("THREE.KeyframeTrack: Track is empty.",this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if("number"===typeof g&&isNaN(g)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,g);a=!1;break}if(null!==e&&e>g){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,g,e);a=!1;break}e=
g}if(void 0!==b&&qa.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,f,d);a=!1;break}return a},optimize:function(){for(var a=this.times,b=this.values,c=this.getValueSize(),d=2302===this.getInterpolation(),e=1,f=a.length-1,g=1;g<f;++g){var h=!1,k=a[g];if(k!==a[g+1]&&(1!==g||k!==k[0]))if(d)h=!0;else{var m=g*c,l=m-c,n=m+c;for(k=0;k!==c;++k){var q=b[m+k];if(q!==b[l+k]||q!==b[n+k]){h=!0;break}}}if(h){if(g!==e)for(a[e]=
a[g],h=g*c,m=e*c,k=0;k!==c;++k)b[m+k]=b[h+k];++e}}if(0<f){a[e]=a[f];h=f*c;m=e*c;for(k=0;k!==c;++k)b[m+k]=b[h+k];++e}e!==a.length&&(this.times=qa.arraySlice(a,0,e),this.values=qa.arraySlice(b,0,e*c));return this}});Hd.prototype=Object.assign(Object.create(pa.prototype),{constructor:Hd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Id.prototype=Object.assign(Object.create(pa.prototype),{constructor:Id,
ValueTypeName:"color"});gc.prototype=Object.assign(Object.create(pa.prototype),{constructor:gc,ValueTypeName:"number"});Jd.prototype=Object.assign(Object.create(ya.prototype),{constructor:Jd,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;b=(c-b)/(d-b);for(c=a+g;a!==c;a+=4)ha.slerpFlat(e,0,f,a-g,f,a,b);return e}});ed.prototype=Object.assign(Object.create(pa.prototype),{constructor:ed,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(a){return new Jd(this.times,
this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});Kd.prototype=Object.assign(Object.create(pa.prototype),{constructor:Kd,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});hc.prototype=Object.assign(Object.create(pa.prototype),{constructor:hc,ValueTypeName:"vector"});Object.assign(Da,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(Rg(c[e]).scale(d));
return new Da(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b,uuid:a.uuid};for(var d=0,e=c.length;d!==e;++d)b.push(pa.toJSON(c[d]));return a},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],k=[];h.push((g+e-1)%e,g,(g+1)%e);k.push(0,1,0);var m=qa.getKeyframeOrder(h);h=qa.sortedArray(h,1,m);k=qa.sortedArray(k,1,m);d||0!==h[0]||(h.push(e),k.push(k[0]));f.push((new gc(".morphTargetInfluences["+b[g].name+
"]",h,k)).scale(1/c))}return new Da(a,-1,f)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(a=0;a<c.length;a++)if(c[a].name===b)return c[a];return null},CreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],k=h.name.match(e);if(k&&1<k.length){var m=k[1];(k=d[m])||(d[m]=k=[]);k.push(h)}}a=[];for(m in d)a.push(Da.CreateFromMorphTargetSequence(m,d[m],b,c));return a},parseAnimation:function(a,
b){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];qa.flattenJSON(c,f,g,d);0!==f.length&&e.push(new a(b,f,g))}},d=[],e=a.name||"default",f=a.length||-1,g=a.fps||30;a=a.hierarchy||[];for(var h=0;h<a.length;h++){var k=a[h].keys;if(k&&0!==k.length)if(k[0].morphTargets){f={};for(var m=0;m<k.length;m++)if(k[m].morphTargets)for(var l=0;l<k[m].morphTargets.length;l++)f[k[m].morphTargets[l]]=-1;for(var n in f){var q=
[],p=[];for(l=0;l!==k[m].morphTargets.length;++l){var r=k[m];q.push(r.time);p.push(r.morphTarget===n?1:0)}d.push(new gc(".morphTargetInfluence["+n+"]",q,p))}f=f.length*(g||1)}else m=".bones["+b[h].name+"]",c(hc,m+".position",k,"pos",d),c(ed,m+".quaternion",k,"rot",d),c(hc,m+".scale",k,"scl",d)}return 0===d.length?null:new Da(e,f,d)}});Object.assign(Da.prototype,{resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b){var d=this.tracks[b];a=Math.max(a,d.times[d.times.length-1])}this.duration=
a;return this},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},validate:function(){for(var a=!0,b=0;b<this.tracks.length;b++)a=a&&this.tracks[b].validate();return a},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}});Object.assign(Ld.prototype,{load:function(a,b,c,d){var e=this;(new Ha(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setTextures:function(a){this.textures=a},parse:function(a){function b(a){void 0===
c[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a);return c[a]}var c=this.textures,d=new Ug[a.type];void 0!==a.uuid&&(d.uuid=a.uuid);void 0!==a.name&&(d.name=a.name);void 0!==a.color&&d.color.setHex(a.color);void 0!==a.roughness&&(d.roughness=a.roughness);void 0!==a.metalness&&(d.metalness=a.metalness);void 0!==a.emissive&&d.emissive.setHex(a.emissive);void 0!==a.specular&&d.specular.setHex(a.specular);void 0!==a.shininess&&(d.shininess=a.shininess);void 0!==a.clearCoat&&(d.clearCoat=
a.clearCoat);void 0!==a.clearCoatRoughness&&(d.clearCoatRoughness=a.clearCoatRoughness);void 0!==a.vertexColors&&(d.vertexColors=a.vertexColors);void 0!==a.fog&&(d.fog=a.fog);void 0!==a.flatShading&&(d.flatShading=a.flatShading);void 0!==a.blending&&(d.blending=a.blending);void 0!==a.side&&(d.side=a.side);void 0!==a.opacity&&(d.opacity=a.opacity);void 0!==a.transparent&&(d.transparent=a.transparent);void 0!==a.alphaTest&&(d.alphaTest=a.alphaTest);void 0!==a.depthTest&&(d.depthTest=a.depthTest);void 0!==
a.depthWrite&&(d.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(d.colorWrite=a.colorWrite);void 0!==a.wireframe&&(d.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(d.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&(d.wireframeLinecap=a.wireframeLinecap);void 0!==a.wireframeLinejoin&&(d.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.rotation&&(d.rotation=a.rotation);1!==a.linewidth&&(d.linewidth=a.linewidth);void 0!==a.dashSize&&(d.dashSize=a.dashSize);void 0!==a.gapSize&&
(d.gapSize=a.gapSize);void 0!==a.scale&&(d.scale=a.scale);void 0!==a.polygonOffset&&(d.polygonOffset=a.polygonOffset);void 0!==a.polygonOffsetFactor&&(d.polygonOffsetFactor=a.polygonOffsetFactor);void 0!==a.polygonOffsetUnits&&(d.polygonOffsetUnits=a.polygonOffsetUnits);void 0!==a.skinning&&(d.skinning=a.skinning);void 0!==a.morphTargets&&(d.morphTargets=a.morphTargets);void 0!==a.dithering&&(d.dithering=a.dithering);void 0!==a.visible&&(d.visible=a.visible);void 0!==a.userData&&(d.userData=a.userData);
if(void 0!==a.uniforms)for(var e in a.uniforms){var f=a.uniforms[e];d.uniforms[e]={};switch(f.type){case "t":d.uniforms[e].value=b(f.value);break;case "c":d.uniforms[e].value=(new F).setHex(f.value);break;case "v2":d.uniforms[e].value=(new z).fromArray(f.value);break;case "v3":d.uniforms[e].value=(new p).fromArray(f.value);break;case "v4":d.uniforms[e].value=(new aa).fromArray(f.value);break;case "m4":d.uniforms[e].value=(new J).fromArray(f.value);break;default:d.uniforms[e].value=f.value}}void 0!==
a.defines&&(d.defines=a.defines);void 0!==a.vertexShader&&(d.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(d.fragmentShader=a.fragmentShader);void 0!==a.shading&&(d.flatShading=1===a.shading);void 0!==a.size&&(d.size=a.size);void 0!==a.sizeAttenuation&&(d.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(d.map=b(a.map));void 0!==a.alphaMap&&(d.alphaMap=b(a.alphaMap),d.transparent=!0);void 0!==a.bumpMap&&(d.bumpMap=b(a.bumpMap));void 0!==a.bumpScale&&(d.bumpScale=a.bumpScale);void 0!==
a.normalMap&&(d.normalMap=b(a.normalMap));void 0!==a.normalMapType&&(d.normalMapType=a.normalMapType);void 0!==a.normalScale&&(e=a.normalScale,!1===Array.isArray(e)&&(e=[e,e]),d.normalScale=(new z).fromArray(e));void 0!==a.displacementMap&&(d.displacementMap=b(a.displacementMap));void 0!==a.displacementScale&&(d.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(d.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(d.roughnessMap=b(a.roughnessMap));void 0!==a.metalnessMap&&
(d.metalnessMap=b(a.metalnessMap));void 0!==a.emissiveMap&&(d.emissiveMap=b(a.emissiveMap));void 0!==a.emissiveIntensity&&(d.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(d.specularMap=b(a.specularMap));void 0!==a.envMap&&(d.envMap=b(a.envMap));void 0!==a.reflectivity&&(d.reflectivity=a.reflectivity);void 0!==a.lightMap&&(d.lightMap=b(a.lightMap));void 0!==a.lightMapIntensity&&(d.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(d.aoMap=b(a.aoMap));void 0!==a.aoMapIntensity&&
(d.aoMapIntensity=a.aoMapIntensity);void 0!==a.gradientMap&&(d.gradientMap=b(a.gradientMap));return d}});Object.assign(fe.prototype,{load:function(a,b,c,d){var e=this;(new Ha(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},parse:function(a){var b=new I,c=a.data.index;void 0!==c&&(c=new Af[c.type](c.array),b.setIndex(new Q(c,1)));var d=a.data.attributes;for(f in d){var e=d[f];c=new Af[e.type](e.array);b.addAttribute(f,new Q(c,e.itemSize,e.normalized))}var f=a.data.groups||a.data.drawcalls||
a.data.offsets;if(void 0!==f)for(c=0,d=f.length;c!==d;++c)e=f[c],b.addGroup(e.start,e.count,e.materialIndex);a=a.data.boundingSphere;void 0!==a&&(f=new p,void 0!==a.center&&f.fromArray(a.center),b.boundingSphere=new Ea(f,a.radius));return b}});var Af={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};
ic.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var e=b[c+1];if(b[c].test(a))return e}return null}};Object.assign(ic.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(a,b,c){for(var d=[],e=0;e<a.length;++e)d[e]=this.createMaterial(a[e],b,c);return d},createMaterial:function(){var a={NoBlending:0,NormalBlending:1,AdditiveBlending:2,
SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},b=new F,c=new wd,d=new Ld;return function(e,f,g){function h(a,b,d,e,h){a=f+a;var m=ic.Handlers.get(a);null!==m?a=m.load(a):(c.setCrossOrigin(g),a=c.load(a));void 0!==b&&(a.repeat.fromArray(b),1!==b[0]&&(a.wrapS=1E3),1!==b[1]&&(a.wrapT=1E3));void 0!==d&&a.offset.fromArray(d);void 0!==e&&("repeat"===e[0]&&(a.wrapS=1E3),"mirror"===e[0]&&(a.wrapS=1002),"repeat"===e[1]&&(a.wrapT=1E3),"mirror"===e[1]&&(a.wrapT=1002));void 0!==h&&(a.anisotropy=h);
b=K.generateUUID();k[b]=a;return b}var k={},m={uuid:K.generateUUID(),type:"MeshLambertMaterial"},l;for(l in e){var n=e[l];switch(l){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":m.name=n;break;case "blending":m.blending=a[n];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case "colorDiffuse":m.color=b.fromArray(n).getHex();break;case "colorSpecular":m.specular=b.fromArray(n).getHex();
break;case "colorEmissive":m.emissive=b.fromArray(n).getHex();break;case "specularCoef":m.shininess=n;break;case "shading":"basic"===n.toLowerCase()&&(m.type="MeshBasicMaterial");"phong"===n.toLowerCase()&&(m.type="MeshPhongMaterial");"standard"===n.toLowerCase()&&(m.type="MeshStandardMaterial");break;case "mapDiffuse":m.map=h(n,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;
case "mapEmissive":m.emissiveMap=h(n,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":m.lightMap=h(n,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;case "mapAO":m.aoMap=h(n,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,
e.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":m.bumpMap=h(n,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case "mapBumpScale":m.bumpScale=n;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;case "mapNormal":m.normalMap=h(n,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case "mapNormalFactor":m.normalScale=n;break;
case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":m.specularMap=h(n,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":m.metalnessMap=h(n,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;
case "mapRoughness":m.roughnessMap=h(n,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":m.alphaMap=h(n,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;case "flipSided":m.side=1;break;case "doubleSided":m.side=
2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");m.opacity=n;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":m[l]=n;break;case "vertexColors":!0===n&&(m.vertexColors=2);"face"===n&&(m.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,n)}}"MeshBasicMaterial"===m.type&&delete m.emissive;"MeshPhongMaterial"!==
m.type&&delete m.specular;1>m.opacity&&(m.transparent=!0);d.setTextures(k);return d.parse(m)}}()});var Ce={decodeText:function(a){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(a);for(var b="",c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);return decodeURIComponent(escape(b))},extractUrlBase:function(a){var b=a.lastIndexOf("/");return-1===b?"./":a.substr(0,b+1)}};Object.assign(ge.prototype,{crossOrigin:"anonymous",load:function(a,b,c,d){var e=this,f=this.texturePath&&"string"===
typeof this.texturePath?this.texturePath:Ce.extractUrlBase(a),g=new Ha(this.manager);g.setWithCredentials(this.withCredentials);g.load(a,function(c){c=JSON.parse(c);var d=c.metadata;if(void 0!==d&&(d=d.type,void 0!==d&&"object"===d.toLowerCase())){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}c=e.parse(c,f);b(c.geometry,c.materials)},c,d)},setCrossOrigin:function(a){this.crossOrigin=a;return this},setTexturePath:function(a){this.texturePath=a;return this},
parse:function(){return function(a,b){void 0!==a.data&&(a=a.data);a.scale=void 0!==a.scale?1/a.scale:1;var c=new M,d=a,e,f,g,h=d.faces;var k=d.vertices;var m=d.normals,l=d.colors;var n=d.scale;var q=0;if(void 0!==d.uvs){for(e=0;e<d.uvs.length;e++)d.uvs[e].length&&q++;for(e=0;e<q;e++)c.faceVertexUvs[e]=[]}var u=0;for(g=k.length;u<g;)e=new p,e.x=k[u++]*n,e.y=k[u++]*n,e.z=k[u++]*n,c.vertices.push(e);u=0;for(g=h.length;u<g;){k=h[u++];var r=k&1;var v=k&2;e=k&8;var y=k&16;var x=k&32;n=k&64;k&=128;if(r){r=
new Va;r.a=h[u];r.b=h[u+1];r.c=h[u+3];var w=new Va;w.a=h[u+1];w.b=h[u+2];w.c=h[u+3];u+=4;v&&(v=h[u++],r.materialIndex=v,w.materialIndex=v);v=c.faces.length;if(e)for(e=0;e<q;e++){var A=d.uvs[e];c.faceVertexUvs[e][v]=[];c.faceVertexUvs[e][v+1]=[];for(f=0;4>f;f++){var D=h[u++];var B=A[2*D];D=A[2*D+1];B=new z(B,D);2!==f&&c.faceVertexUvs[e][v].push(B);0!==f&&c.faceVertexUvs[e][v+1].push(B)}}y&&(y=3*h[u++],r.normal.set(m[y++],m[y++],m[y]),w.normal.copy(r.normal));if(x)for(e=0;4>e;e++)y=3*h[u++],x=new p(m[y++],
m[y++],m[y]),2!==e&&r.vertexNormals.push(x),0!==e&&w.vertexNormals.push(x);n&&(n=h[u++],n=l[n],r.color.setHex(n),w.color.setHex(n));if(k)for(e=0;4>e;e++)n=h[u++],n=l[n],2!==e&&r.vertexColors.push(new F(n)),0!==e&&w.vertexColors.push(new F(n));c.faces.push(r);c.faces.push(w)}else{r=new Va;r.a=h[u++];r.b=h[u++];r.c=h[u++];v&&(v=h[u++],r.materialIndex=v);v=c.faces.length;if(e)for(e=0;e<q;e++)for(A=d.uvs[e],c.faceVertexUvs[e][v]=[],f=0;3>f;f++)D=h[u++],B=A[2*D],D=A[2*D+1],B=new z(B,D),c.faceVertexUvs[e][v].push(B);
y&&(y=3*h[u++],r.normal.set(m[y++],m[y++],m[y]));if(x)for(e=0;3>e;e++)y=3*h[u++],x=new p(m[y++],m[y++],m[y]),r.vertexNormals.push(x);n&&(n=h[u++],r.color.setHex(l[n]));if(k)for(e=0;3>e;e++)n=h[u++],r.vertexColors.push(new F(l[n]));c.faces.push(r)}}d=a;u=void 0!==d.influencesPerVertex?d.influencesPerVertex:2;if(d.skinWeights)for(g=0,h=d.skinWeights.length;g<h;g+=u)c.skinWeights.push(new aa(d.skinWeights[g],1<u?d.skinWeights[g+1]:0,2<u?d.skinWeights[g+2]:0,3<u?d.skinWeights[g+3]:0));if(d.skinIndices)for(g=
0,h=d.skinIndices.length;g<h;g+=u)c.skinIndices.push(new aa(d.skinIndices[g],1<u?d.skinIndices[g+1]:0,2<u?d.skinIndices[g+2]:0,3<u?d.skinIndices[g+3]:0));c.bones=d.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.");g=a;h=g.scale;if(void 0!==g.morphTargets)for(d=
0,u=g.morphTargets.length;d<u;d++)for(c.morphTargets[d]={},c.morphTargets[d].name=g.morphTargets[d].name,c.morphTargets[d].vertices=[],m=c.morphTargets[d].vertices,l=g.morphTargets[d].vertices,q=0,k=l.length;q<k;q+=3)n=new p,n.x=l[q]*h,n.y=l[q+1]*h,n.z=l[q+2]*h,m.push(n);if(void 0!==g.morphColors&&0<g.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),h=c.faces,g=g.morphColors[0].colors,d=0,u=h.length;d<u;d++)h[d].color.fromArray(g,
3*d);g=a;d=[];u=[];void 0!==g.animation&&u.push(g.animation);void 0!==g.animations&&(g.animations.length?u=u.concat(g.animations):u.push(g.animations));for(g=0;g<u.length;g++)(h=Da.parseAnimation(u[g],c.bones))&&d.push(h);c.morphTargets&&(u=Da.CreateClipsFromMorphTargetSequences(c.morphTargets,10),d=d.concat(u));0<d.length&&(c.animations=d);c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};a=ic.prototype.initMaterials(a.materials,b,
this.crossOrigin);return{geometry:c,materials:a}}}()});Object.assign(lf.prototype,{crossOrigin:"anonymous",load:function(a,b,c,d){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var e=this;(new Ha(e.manager)).load(a,function(c){var f=null;try{f=JSON.parse(c)}catch(h){void 0!==d&&d(h);console.error("THREE:ObjectLoader: Can't parse "+a+".",h.message);return}c=f.metadata;void 0===c||void 0===c.type||"geometry"===c.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+
a+". Use THREE.JSONLoader instead."):e.parse(f,b)},c,d)},setTexturePath:function(a){this.texturePath=a;return this},setCrossOrigin:function(a){this.crossOrigin=a;return this},parse:function(a,b){var c=this.parseShape(a.shapes);c=this.parseGeometries(a.geometries,c);var d=this.parseImages(a.images,function(){void 0!==b&&b(e)});d=this.parseTextures(a.textures,d);d=this.parseMaterials(a.materials,d);var e=this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));
void 0!==a.images&&0!==a.images.length||void 0===b||b(e);return e},parseShape:function(a){var b={};if(void 0!==a)for(var c=0,d=a.length;c<d;c++){var e=(new fb).fromJSON(a[c]);b[e.uuid]=e}return b},parseGeometries:function(a,b){var c={};if(void 0!==a)for(var d=new ge,e=new fe,f=0,g=a.length;f<g;f++){var h=a[f];switch(h.type){case "PlaneGeometry":case "PlaneBufferGeometry":var k=new za[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":k=
new za[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":k=new za[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":k=new za[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":k=new za[h.type](h.radius,h.height,h.radialSegments,
h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":k=new za[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case "DodecahedronGeometry":case "DodecahedronBufferGeometry":case "IcosahedronGeometry":case "IcosahedronBufferGeometry":case "OctahedronGeometry":case "OctahedronBufferGeometry":case "TetrahedronGeometry":case "TetrahedronBufferGeometry":k=new za[h.type](h.radius,h.detail);
break;case "RingGeometry":case "RingBufferGeometry":k=new za[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":k=new za[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":k=new za[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case "LatheGeometry":case "LatheBufferGeometry":k=new za[h.type](h.points,
h.segments,h.phiStart,h.phiLength);break;case "PolyhedronGeometry":case "PolyhedronBufferGeometry":k=new za[h.type](h.vertices,h.indices,h.radius,h.details);break;case "ShapeGeometry":case "ShapeBufferGeometry":k=[];for(var m=0,l=h.shapes.length;m<l;m++){var n=b[h.shapes[m]];k.push(n)}k=new za[h.type](k,h.curveSegments);break;case "ExtrudeGeometry":case "ExtrudeBufferGeometry":k=[];m=0;for(l=h.shapes.length;m<l;m++)n=b[h.shapes[m]],k.push(n);m=h.options.extrudePath;void 0!==m&&(h.options.extrudePath=
(new zf[m.type]).fromJSON(m));k=new za[h.type](k,h.options);break;case "BufferGeometry":k=e.parse(h);break;case "Geometry":k=d.parse(h,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}k.uuid=h.uuid;void 0!==h.name&&(k.name=h.name);!0===k.isBufferGeometry&&void 0!==h.userData&&(k.userData=h.userData);c[h.uuid]=k}return c},parseMaterials:function(a,b){var c={};if(void 0!==a){var d=new Ld;d.setTextures(b);b=0;for(var e=a.length;b<
e;b++){var f=a[b];if("MultiMaterial"===f.type){for(var g=[],h=0;h<f.materials.length;h++)g.push(d.parse(f.materials[h]));c[f.uuid]=g}else c[f.uuid]=d.parse(f)}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=Da.parse(d);void 0!==d.uuid&&(e.uuid=d.uuid);b.push(e)}return b},parseImages:function(a,b){function c(a){d.manager.itemStart(a);return f.load(a,function(){d.manager.itemEnd(a)},void 0,function(){d.manager.itemEnd(a);d.manager.itemError(a)})}var d=this,e={};
if(void 0!==a&&0<a.length){b=new be(b);var f=new ad(b);f.setCrossOrigin(this.crossOrigin);b=0;for(var g=a.length;b<g;b++){var h=a[b],k=h.url;if(Array.isArray(k)){e[h.uuid]=[];for(var m=0,l=k.length;m<l;m++){var n=k[m];n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:d.texturePath+n;e[h.uuid].push(c(n))}}else n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:d.texturePath+h.url,e[h.uuid]=c(n)}}return e},parseTextures:function(a,b){function c(a,b){if("number"===typeof a)return a;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",
a);return b[a]}var d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid);void 0===b[g.image]&&console.warn("THREE.ObjectLoader: Undefined image",g.image);var h=Array.isArray(b[g.image])?new Wa(b[g.image]):new T(b[g.image]);h.needsUpdate=!0;h.uuid=g.uuid;void 0!==g.name&&(h.name=g.name);void 0!==g.mapping&&(h.mapping=c(g.mapping,Vg));void 0!==g.offset&&h.offset.fromArray(g.offset);void 0!==g.repeat&&h.repeat.fromArray(g.repeat);
void 0!==g.center&&h.center.fromArray(g.center);void 0!==g.rotation&&(h.rotation=g.rotation);void 0!==g.wrap&&(h.wrapS=c(g.wrap[0],Bf),h.wrapT=c(g.wrap[1],Bf));void 0!==g.format&&(h.format=g.format);void 0!==g.minFilter&&(h.minFilter=c(g.minFilter,Cf));void 0!==g.magFilter&&(h.magFilter=c(g.magFilter,Cf));void 0!==g.anisotropy&&(h.anisotropy=g.anisotropy);void 0!==g.flipY&&(h.flipY=g.flipY);d[g.uuid]=h}return d},parseObject:function(a,b,c){function d(a){void 0===b[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",
a);return b[a]}function e(a){if(void 0!==a){if(Array.isArray(a)){for(var b=[],d=0,e=a.length;d<e;d++){var f=a[d];void 0===c[f]&&console.warn("THREE.ObjectLoader: Undefined material",f);b.push(c[f])}return b}void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined material",a);return c[a]}}switch(a.type){case "Scene":var f=new rd;void 0!==a.background&&Number.isInteger(a.background)&&(f.background=new F(a.background));void 0!==a.fog&&("Fog"===a.fog.type?f.fog=new Ob(a.fog.color,a.fog.near,a.fog.far):
"FogExp2"===a.fog.type&&(f.fog=new Nb(a.fog.color,a.fog.density)));break;case "PerspectiveCamera":f=new X(a.fov,a.aspect,a.near,a.far);void 0!==a.focus&&(f.focus=a.focus);void 0!==a.zoom&&(f.zoom=a.zoom);void 0!==a.filmGauge&&(f.filmGauge=a.filmGauge);void 0!==a.filmOffset&&(f.filmOffset=a.filmOffset);void 0!==a.view&&(f.view=Object.assign({},a.view));break;case "OrthographicCamera":f=new Jb(a.left,a.right,a.top,a.bottom,a.near,a.far);void 0!==a.zoom&&(f.zoom=a.zoom);void 0!==a.view&&(f.view=Object.assign({},
a.view));break;case "AmbientLight":f=new Dd(a.color,a.intensity);break;case "DirectionalLight":f=new Cd(a.color,a.intensity);break;case "PointLight":f=new Ad(a.color,a.intensity,a.distance,a.decay);break;case "RectAreaLight":f=new Ed(a.color,a.intensity,a.width,a.height);break;case "SpotLight":f=new zd(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case "HemisphereLight":f=new xd(a.color,a.groundColor,a.intensity);break;case "SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");
case "Mesh":f=d(a.geometry);var g=e(a.material);f=f.bones&&0<f.bones.length?new td(f,g):new ta(f,g);break;case "LOD":f=new Dc;break;case "Line":f=new oa(d(a.geometry),e(a.material),a.mode);break;case "LineLoop":f=new ud(d(a.geometry),e(a.material));break;case "LineSegments":f=new Z(d(a.geometry),e(a.material));break;case "PointCloud":case "Points":f=new Qb(d(a.geometry),e(a.material));break;case "Sprite":f=new Cc(e(a.material));break;case "Group":f=new Mb;break;default:f=new B}f.uuid=a.uuid;void 0!==
a.name&&(f.name=a.name);void 0!==a.matrix?(f.matrix.fromArray(a.matrix),void 0!==a.matrixAutoUpdate&&(f.matrixAutoUpdate=a.matrixAutoUpdate),f.matrixAutoUpdate&&f.matrix.decompose(f.position,f.quaternion,f.scale)):(void 0!==a.position&&f.position.fromArray(a.position),void 0!==a.rotation&&f.rotation.fromArray(a.rotation),void 0!==a.quaternion&&f.quaternion.fromArray(a.quaternion),void 0!==a.scale&&f.scale.fromArray(a.scale));void 0!==a.castShadow&&(f.castShadow=a.castShadow);void 0!==a.receiveShadow&&
(f.receiveShadow=a.receiveShadow);a.shadow&&(void 0!==a.shadow.bias&&(f.shadow.bias=a.shadow.bias),void 0!==a.shadow.radius&&(f.shadow.radius=a.shadow.radius),void 0!==a.shadow.mapSize&&f.shadow.mapSize.fromArray(a.shadow.mapSize),void 0!==a.shadow.camera&&(f.shadow.camera=this.parseObject(a.shadow.camera)));void 0!==a.visible&&(f.visible=a.visible);void 0!==a.frustumCulled&&(f.frustumCulled=a.frustumCulled);void 0!==a.renderOrder&&(f.renderOrder=a.renderOrder);void 0!==a.userData&&(f.userData=a.userData);
void 0!==a.layers&&(f.layers.mask=a.layers);if(void 0!==a.children){g=a.children;for(var h=0;h<g.length;h++)f.add(this.parseObject(g[h],b,c))}if("LOD"===a.type)for(a=a.levels,g=0;g<a.length;g++){h=a[g];var k=f.getObjectByProperty("uuid",h.object);void 0!==k&&f.addLevel(k,h.distance)}return f}});var Vg={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,
CubeUVRefractionMapping:307},Bf={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Cf={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};he.prototype={constructor:he,setOptions:function(a){this.options=a;return this},load:function(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);var e=this,f=Hb.get(a);if(void 0!==f)return e.manager.itemStart(a),
setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;fetch(a).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,e.options)}).then(function(c){Hb.add(a,c);b&&b(c);e.manager.itemEnd(a)}).catch(function(b){d&&d(b);e.manager.itemEnd(a);e.manager.itemError(a)})},setCrossOrigin:function(){return this},setPath:function(a){this.path=a;return this}};Object.assign(ie.prototype,{moveTo:function(a,b){this.currentPath=new Ma;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,
b)},lineTo:function(a,b){this.currentPath.lineTo(a,b)},quadraticCurveTo:function(a,b,c,d){this.currentPath.quadraticCurveTo(a,b,c,d)},bezierCurveTo:function(a,b,c,d,e,f){this.currentPath.bezierCurveTo(a,b,c,d,e,f)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new fb;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,m=h.y-g.y;if(Math.abs(m)>
Number.EPSILON){if(0>m&&(g=b[f],k=-k,h=b[e],m=-m),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=m*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var e=Xa.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===b)return c(f);b=[];if(1===f.length){var g=f[0];var h=new fb;h.curves=g.curves;b.push(h);return b}var k=!e(f[0].getPoints());k=a?!k:k;h=[];var m=[],l=[],n=0;m[n]=void 0;l[n]=[];for(var p=
0,u=f.length;p<u;p++){g=f[p];var r=g.getPoints();var v=e(r);(v=a?!v:v)?(!k&&m[n]&&n++,m[n]={s:new fb,p:r},m[n].s.curves=g.curves,k&&n++,l[n]=[]):l[n].push({h:g,p:r[0]})}if(!m[0])return c(f);if(1<m.length){p=!1;a=[];e=0;for(f=m.length;e<f;e++)h[e]=[];e=0;for(f=m.length;e<f;e++)for(g=l[e],v=0;v<g.length;v++){k=g[v];n=!0;for(r=0;r<m.length;r++)d(k.p,m[r].p)&&(e!==r&&a.push({froms:e,tos:r,hole:v}),n?(n=!1,h[r].push(k)):p=!0);n&&h[e].push(k)}0<a.length&&(p||(l=h))}p=0;for(e=m.length;p<e;p++)for(h=m[p].s,
b.push(h),a=l[p],f=0,g=a.length;f<g;f++)h.holes.push(a[f].h);return b}});Object.assign(je.prototype,{isFont:!0,generateShapes:function(a,b){void 0===b&&(b=100);var c=[],d=b;b=this.data;var e=Array.from?Array.from(a):String(a).split("");d/=b.resolution;var f=(b.boundingBox.yMax-b.boundingBox.yMin+b.underlineThickness)*d;a=[];for(var g=0,h=0,k=0;k<e.length;k++){var m=e[k];if("\n"===m)g=0,h-=f;else{var l=d;var n=g,p=h;if(m=b.glyphs[m]||b.glyphs["?"]){var u=new ie;if(m.o)for(var r=m._cachedOutline||(m._cachedOutline=
m.o.split(" ")),v=0,y=r.length;v<y;)switch(r[v++]){case "m":var x=r[v++]*l+n;var w=r[v++]*l+p;u.moveTo(x,w);break;case "l":x=r[v++]*l+n;w=r[v++]*l+p;u.lineTo(x,w);break;case "q":var z=r[v++]*l+n;var A=r[v++]*l+p;var B=r[v++]*l+n;var F=r[v++]*l+p;u.quadraticCurveTo(B,F,z,A);break;case "b":z=r[v++]*l+n,A=r[v++]*l+p,B=r[v++]*l+n,F=r[v++]*l+p,x=r[v++]*l+n,w=r[v++]*l+p,u.bezierCurveTo(B,F,x,w,z,A)}l={offsetX:m.ha*l,path:u}}else l=void 0;g+=l.offsetX;a.push(l.path)}}b=0;for(e=a.length;b<e;b++)Array.prototype.push.apply(c,
a[b].toShapes());return c}});Object.assign(mf.prototype,{load:function(a,b,c,d){var e=this,f=new Ha(this.manager);f.setPath(this.path);f.load(a,function(a){try{var c=JSON.parse(a)}catch(k){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),c=JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return new je(a)},setPath:function(a){this.path=a;return this}});var Qd,me={getContext:function(){void 0===Qd&&(Qd=new (window.AudioContext||
window.webkitAudioContext));return Qd},setContext:function(a){Qd=a}};Object.assign(ke.prototype,{load:function(a,b,c,d){var e=new Ha(this.manager);e.setResponseType("arraybuffer");e.load(a,function(a){a=a.slice(0);me.getContext().decodeAudioData(a,function(a){b(a)})},c,d)}});Object.assign(nf.prototype,{update:function(){var a,b,c,d,e,f,g,h,k=new J,m=new J;return function(l){if(a!==this||b!==l.focus||c!==l.fov||d!==l.aspect*this.aspect||e!==l.near||f!==l.far||g!==l.zoom||h!==this.eyeSep){a=this;b=
l.focus;c=l.fov;d=l.aspect*this.aspect;e=l.near;f=l.far;g=l.zoom;var n=l.projectionMatrix.clone();h=this.eyeSep/2;var p=h*e/b,t=e*Math.tan(K.DEG2RAD*c*.5)/g;m.elements[12]=-h;k.elements[12]=h;var r=-t*d+p;var v=t*d+p;n.elements[0]=2*e/(v-r);n.elements[8]=(v+r)/(v-r);this.cameraL.projectionMatrix.copy(n);r=-t*d-p;v=t*d-p;n.elements[0]=2*e/(v-r);n.elements[8]=(v+r)/(v-r);this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(l.matrixWorld).multiply(m);this.cameraR.matrixWorld.copy(l.matrixWorld).multiply(k)}}()});
fd.prototype=Object.create(B.prototype);fd.prototype.constructor=fd;le.prototype=Object.assign(Object.create(B.prototype),{constructor:le,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null);return this},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):
this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination);return this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01);return this},updateMatrixWorld:function(){var a=new p,b=new ha,c=new p,d=new p;return function(e){B.prototype.updateMatrixWorld.call(this,e);e=this.context.listener;var f=this.up;this.matrixWorld.decompose(a,
b,c);d.set(0,0,-1).applyQuaternion(b);e.positionX?(e.positionX.setValueAtTime(a.x,this.context.currentTime),e.positionY.setValueAtTime(a.y,this.context.currentTime),e.positionZ.setValueAtTime(a.z,this.context.currentTime),e.forwardX.setValueAtTime(d.x,this.context.currentTime),e.forwardY.setValueAtTime(d.y,this.context.currentTime),e.forwardZ.setValueAtTime(d.z,this.context.currentTime),e.upX.setValueAtTime(f.x,this.context.currentTime),e.upY.setValueAtTime(f.y,this.context.currentTime),e.upZ.setValueAtTime(f.z,
this.context.currentTime)):(e.setPosition(a.x,a.y,a.z),e.setOrientation(d.x,d.y,d.z,f.x,f.y,f.z))}}()});jc.prototype=Object.assign(Object.create(B.prototype),{constructor:jc,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setMediaElementSource:function(a){this.hasPlaybackControl=!1;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(a);this.connect();return this},
setBuffer:function(a){this.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var a=this.context.createBufferSource();a.buffer=this.buffer;a.loop=this.loop;a.onended=this.onEnded.bind(this);a.playbackRate.setValueAtTime(this.playbackRate,this.startTime);this.startTime=this.context.currentTime;
a.start(this.startTime,this.offset);this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),
this.source.onended=null,this.offset=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].disconnect(this.filters[a]);
this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.playbackRate=a,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=
a,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(a){this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01);return this}});ne.prototype=Object.assign(Object.create(jc.prototype),{constructor:ne,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a;return this},getRolloffFactor:function(){return this.panner.rolloffFactor},
setRolloffFactor:function(a){this.panner.rolloffFactor=a;return this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=a;return this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a;return this},setDirectionalCone:function(a,b,c){this.panner.coneInnerAngle=a;this.panner.coneOuterAngle=b;this.panner.coneOuterGain=c;return this},updateMatrixWorld:function(){var a=new p,
b=new ha,c=new p,d=new p;return function(e){B.prototype.updateMatrixWorld.call(this,e);e=this.panner;this.matrixWorld.decompose(a,b,c);d.set(0,0,1).applyQuaternion(b);e.setPosition(a.x,a.y,a.z);e.setOrientation(d.x,d.y,d.z)}}()});Object.assign(oe.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=b[c];return a/b.length}});Object.assign(pe.prototype,{accumulate:function(a,
b){var c=this.buffer,d=this.valueSize;a=a*d+d;var e=this.cumulativeWeight;if(0===e){for(e=0;e!==d;++e)c[a+e]=c[e];e=b}else e+=b,this._mixBufferRegion(c,a,0,b/e,d);this.cumulativeWeight=e},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,3*b,1-d,b);d=b;for(var f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);break}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,
c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d){ha.slerpFlat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}}});Object.assign(of.prototype,{getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,
b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}});Object.assign(sa,{Composite:of,create:function(a,b,c){return a&&a.isAnimationObjectGroup?new sa.Composite(a,b,c):new sa(a,b,c)},sanitizeNodeName:function(){var a=
/[\[\]\.:\/]/g;return function(b){return b.replace(/\s/g,"_").replace(a,"")}}(),parseTrackName:function(){var a="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",b=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]");a=/(WCOD+)?/.source.replace("WCOD",a);var c=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),d=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),e=new RegExp("^"+b+a+c+d+"$"),f=["material","materials","bones"];return function(a){var b=e.exec(a);if(!b)throw Error("PropertyBinding: Cannot parse trackName: "+
a);b={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]};var c=b.nodeName&&b.nodeName.lastIndexOf(".");if(void 0!==c&&-1!==c){var d=b.nodeName.substring(c+1);-1!==f.indexOf(d)&&(b.nodeName=b.nodeName.substring(0,c),b.objectName=d)}if(null===b.propertyName||0===b.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+a);return b}}(),findNode:function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;
if(a.skeleton){var c=a.skeleton.getBoneByName(b);if(void 0!==c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var e=a[c];if(e.name===b||e.uuid===b||(e=d(e.children)))return e}return null};if(a=d(a.children))return a}return null}});Object.assign(sa.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,
b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.targetObject[this.propertyName]=a[b]},function(a,b){this.targetObject[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.targetObject[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=
!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,
b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,
d=b.propertyName,e=b.propertyIndex;a||(this.node=a=sa.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var f=b.objectIndex;switch(c){case "materials":if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",
this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void 0===a[c]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}a=a[c]}if(void 0!==f){if(void 0===a[f]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",
this,a);return}a=a[f]}}f=a[d];if(void 0===f)console.error("THREE.PropertyBinding: Trying to update property for track: "+b.nodeName+"."+d+" but it wasn't found.",a);else{b=this.Versioning.None;this.targetObject=a;void 0!==a.needsUpdate?b=this.Versioning.NeedsUpdate:void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate);c=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===d){if(!a.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",
this);return}if(a.geometry.isBufferGeometry){if(!a.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(c=0;c<this.node.geometry.morphAttributes.position.length;c++)if(a.geometry.morphAttributes.position[c].name===e){e=c;break}}else{if(!a.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",
this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=f):Array.isArray(f)?(c=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+
this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}});Object.assign(sa.prototype,{_getValue_unbound:sa.prototype.getValue,_setValue_unbound:sa.prototype.setValue});Object.assign(pf.prototype,{isAnimationObjectGroup:!0,add:function(){for(var a=this._objects,b=a.length,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._paths,f=this._parsedPaths,g=this._bindings,h=g.length,k=void 0,m=0,l=arguments.length;m!==
l;++m){var n=arguments[m],p=n.uuid,u=d[p];if(void 0===u){u=b++;d[p]=u;a.push(n);p=0;for(var r=h;p!==r;++p)g[p].push(new sa(n,e[p],f[p]))}else if(u<c){k=a[u];var v=--c;r=a[v];d[r.uuid]=u;a[u]=r;d[p]=v;a[v]=n;p=0;for(r=h;p!==r;++p){var y=g[p],x=y[u];y[u]=y[v];void 0===x&&(x=new sa(n,e[p],f[p]));y[v]=x}}else a[u]!==k&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=
c},remove:function(){for(var a=this._objects,b=this.nCachedObjects_,c=this._indicesByUUID,d=this._bindings,e=d.length,f=0,g=arguments.length;f!==g;++f){var h=arguments[f],k=h.uuid,m=c[k];if(void 0!==m&&m>=b){var l=b++,n=a[l];c[n.uuid]=m;a[m]=n;c[k]=l;a[l]=h;h=0;for(k=e;h!==k;++h){n=d[h];var p=n[m];n[m]=n[l];n[l]=p}}}this.nCachedObjects_=b},uncache:function(){for(var a=this._objects,b=a.length,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,h=arguments.length;g!==h;++g){var k=
arguments[g].uuid,l=d[k];if(void 0!==l)if(delete d[k],l<c){k=--c;var p=a[k],n=--b,q=a[n];d[p.uuid]=l;a[l]=p;d[q.uuid]=k;a[k]=q;a.pop();p=0;for(q=f;p!==q;++p){var u=e[p],r=u[n];u[l]=u[k];u[k]=r;u.pop()}}else for(n=--b,q=a[n],d[q.uuid]=l,a[l]=q,a.pop(),p=0,q=f;p!==q;++p)u=e[p],u[l]=u[n],u.pop()}this.nCachedObjects_=c},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,
l=Array(h.length);d=e.length;c[a]=d;f.push(a);g.push(b);e.push(l);c=k;for(d=h.length;c!==d;++c)l[c]=new sa(h[c],a,b);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}});Object.assign(qf.prototype,{play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},
reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;
this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var d=a._clip.duration,e=c/d;a.warp(1,d/c,b);this.warp(e,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;
null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,
0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(this._timeScaleInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;d[1]=e+c;f[0]=a/g;f[1]=b/g;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||
this._mixer._root},_update:function(a,b,c,d){if(this.enabled){var e=this._startTime;if(null!==e){b=(a-e)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;e=this._propertyBindings;for(var f=0,g=b.length;f!==g;++f)b[f].evaluate(c),e[f].accumulate(d,a)}}else this._updateWeight(a)},_updateWeight:function(a){var b=0;if(this.enabled){b=this.weight;var c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0];
b*=d;a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){b=this.timeScale;var c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0];b*=d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a,c=this._clip.duration,d=this.loop,e=this._loopCount,f=2202===d;if(0===a)return-1===
e?b:f&&1===(e&1)?c-b:b;if(2200===d)a:{if(-1===e&&(this._loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,f)):this._setEndings(0===this.repetitions,!0,f));if(b>=c||0>b){d=Math.floor(b/c);b-=c*d;e+=Math.abs(d);var g=this.repetitions-e;0>=g?(this.clampWhenFinished?this.paused=!0:
this.enabled=!1,b=0<a?c:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1})):(1===g?(a=0>a,this._setEndings(a,!a,f)):this._setEndings(!1,!1,f),this._loopCount=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:d}))}if(f&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,b,c){var d=this._interpolantSettings;c?(d.endingStart=2401,d.endingEnd=2401):(d.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,d.endingEnd=b?this.zeroSlopeAtEnd?2401:
2400:2402)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}});qe.prototype=Object.assign(Object.create(ea.prototype),{constructor:qe,_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings;a=a._interpolants;var g=c.uuid,h=this._bindingsByRootAndName,k=h[g];void 0===
k&&(k={},h[g]=k);for(h=0;h!==e;++h){var l=d[h],p=l.name,n=k[p];if(void 0===n){n=f[h];if(void 0!==n){null===n._cacheIndex&&(++n.referenceCount,this._addInactiveBinding(n,g,p));continue}n=new pe(sa.create(c,p,b&&b._propertyBindings[h].binding.parsedPath),l.ValueTypeName,l.getValueSize());++n.referenceCount;this._addInactiveBinding(n,g,p)}f[h]=n;a[h].resultBuffer=n.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,
d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=
[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},
_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f):(b=f.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;b=a._clip.uuid;
c=this._actionsByClip;d=c[b];var e=d.knownActions,f=e[e.length-1],g=a._byClipCacheIndex;f._byClipCacheIndex=g;e[g]=f;e.pop();a._byClipCacheIndex=null;delete d.actionByRoot[(a._localRoot||this._root).uuid];0===e.length&&delete c[b];this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,
d=this._nActiveActions++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,e=d[b],f=this._bindings;void 0===e&&(e={},d[b]=e);e[c]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid;c=c.path;var e=this._bindingsByRootAndName,
f=e[d],g=b[b.length-1];a=a._cacheIndex;g._cacheIndex=a;b[a]=g;b.pop();delete f[c];a:{for(var h in f)break a;delete e[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,
c=a[b];void 0===c&&(c=new dd(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(a,b){var c=b||this._root,d=c.uuid;c="string"===typeof a?Da.findByName(c,a):a;a=null!==c?c.uuid:a;var e=
this._actionsByClip[a],f=null;if(void 0!==e){f=e.actionByRoot[d];if(void 0!==f)return f;f=e.knownActions[0];null===c&&(c=f._clip)}if(null===c)return null;b=new qf(this,c,b);this._bindAction(b,f);this._addInactiveAction(b,a,d);return b},existingAction:function(a,b){var c=b||this._root;b=c.uuid;c="string"===typeof a?Da.findByName(c,a):a;a=this._actionsByClip[c?c.uuid:a];return void 0!==a?a.actionByRoot[b]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=this._bindings,
d=this._nActiveBindings,e=this._nActiveBindings=this._nActiveActions=0;e!==b;++e)a[e].reset();for(e=0;e!==d;++e)c[e].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g)b[g]._update(d,a,e,f);a=this._bindings;b=this._nActiveBindings;for(g=0;g!==b;++g)a[g].apply(f);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,
d=c[a];if(void 0!==d){d=d.knownActions;for(var e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var h=g._cacheIndex,k=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;k._cacheIndex=h;b[h]=k;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip;for(d in b){var c=b[d].actionByRoot[a];void 0!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}var d=this._bindingsByRootAndName[a];if(void 0!==d)for(var e in d)a=
d[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){a=this.existingAction(a,b);null!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}});Md.prototype.clone=function(){return new Md(void 0===this.value.clone?this.value:this.value.clone())};re.prototype=Object.assign(Object.create(I.prototype),{constructor:re,isInstancedBufferGeometry:!0,copy:function(a){I.prototype.copy.call(this,a);this.maxInstancedCount=a.maxInstancedCount;return this},clone:function(){return(new this.constructor).copy(this)}});
se.prototype=Object.assign(Object.create(qb.prototype),{constructor:se,isInstancedInterleavedBuffer:!0,copy:function(a){qb.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this}});te.prototype=Object.assign(Object.create(Q.prototype),{constructor:te,isInstancedBufferAttribute:!0,copy:function(a){Q.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this}});Object.assign(rf.prototype,{linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(a,
b){b&&b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize()):b&&b.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,b,c){c=c||[];ue(a,this,c,b);c.sort(sf);return c},intersectObjects:function(a,b,c){c=c||
[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),c;for(var d=0,e=a.length;d<e;d++)ue(a[d],this,c,b);c.sort(sf);return c}});Object.assign(tf.prototype,{start:function(){this.oldTime=this.startTime=("undefined"===typeof performance?Date:performance).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.autoStart=this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=
0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var b=("undefined"===typeof performance?Date:performance).now();a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}});Object.assign(uf.prototype,{set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.phi=a.phi;this.theta=a.theta;return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-
1E-6,this.phi));return this},setFromVector3:function(a){return this.setFromCartesianCoords(a.x,a.y,a.z)},setFromCartesianCoords:function(a,b,c){this.radius=Math.sqrt(a*a+b*b+c*c);0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a,c),this.phi=Math.acos(K.clamp(b/this.radius,-1,1)));return this}});Object.assign(vf.prototype,{set:function(a,b,c){this.radius=a;this.theta=b;this.y=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;
this.theta=a.theta;this.y=a.y;return this},setFromVector3:function(a){return this.setFromCartesianCoords(a.x,a.y,a.z)},setFromCartesianCoords:function(a,b,c){this.radius=Math.sqrt(a*a+c*c);this.theta=Math.atan2(a,c);this.y=b;return this}});Object.assign(ve.prototype,{set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new z;return function(b,
c){c=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(c);this.max.copy(b).add(c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){void 0===a&&(console.warn("THREE.Box2: .getCenter() target is now required"),a=new z);
return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){void 0===a&&(console.warn("THREE.Box2: .getSize() target is now required"),a=new z);return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<
this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,b){void 0===b&&(console.warn("THREE.Box2: .getParameter() target is now required"),b=new z);return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?
!1:!0},clampPoint:function(a,b){void 0===b&&(console.warn("THREE.Box2: .clampPoint() target is now required"),b=new z);return b.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new z;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&
a.max.equals(this.max)}});Object.assign(we.prototype,{set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},getCenter:function(a){void 0===a&&(console.warn("THREE.Line3: .getCenter() target is now required"),a=new p);return a.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){void 0===a&&(console.warn("THREE.Line3: .delta() target is now required"),
a=new p);return a.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){void 0===b&&(console.warn("THREE.Line3: .at() target is now required"),b=new p);return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new p,b=new p;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&
(c=K.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);void 0===c&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),c=new p);return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}});gd.prototype=Object.create(B.prototype);gd.prototype.constructor=gd;gd.prototype.isImmediateRenderObject=
!0;hd.prototype=Object.create(Z.prototype);hd.prototype.constructor=hd;hd.prototype.update=function(){var a=new p,b=new p,c=new na;return function(){var d=["a","b","c"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g&&g.isGeometry)for(var h=g.vertices,k=g.faces,l=g=0,p=k.length;l<p;l++)for(var n=k[l],q=0,u=n.vertexNormals.length;q<u;q++){var r=n.vertexNormals[q];a.copy(h[n[d[q]]]).applyMatrix4(e);
b.copy(r).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);f.setXYZ(g,a.x,a.y,a.z);g+=1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else if(g&&g.isBufferGeometry)for(d=g.attributes.position,h=g.attributes.normal,q=g=0,u=d.count;q<u;q++)a.set(d.getX(q),d.getY(q),d.getZ(q)).applyMatrix4(e),b.set(h.getX(q),h.getY(q),h.getZ(q)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0}}();kc.prototype=Object.create(B.prototype);
kc.prototype.constructor=kc;kc.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};kc.prototype.update=function(){var a=new p,b=new p;return function(){this.light.updateMatrixWorld();var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));void 0!==this.color?this.cone.material.color.set(this.color):
this.cone.material.color.copy(this.light.color)}}();lc.prototype=Object.create(Z.prototype);lc.prototype.constructor=lc;lc.prototype.updateMatrixWorld=function(){var a=new p,b=new J,c=new J;return function(d){var e=this.bones,f=this.geometry,g=f.getAttribute("position");c.getInverse(this.root.matrixWorld);for(var h=0,k=0;h<e.length;h++){var l=e[h];l.parent&&l.parent.isBone&&(b.multiplyMatrices(c,l.matrixWorld),a.setFromMatrixPosition(b),g.setXYZ(k,a.x,a.y,a.z),b.multiplyMatrices(c,l.parent.matrixWorld),
a.setFromMatrixPosition(b),g.setXYZ(k+1,a.x,a.y,a.z),k+=2)}f.getAttribute("position").needsUpdate=!0;B.prototype.updateMatrixWorld.call(this,d)}}();mc.prototype=Object.create(ta.prototype);mc.prototype.constructor=mc;mc.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};mc.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};nc.prototype=Object.create(B.prototype);nc.prototype.constructor=nc;nc.prototype.dispose=
function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};nc.prototype.update=function(){var a=.5*this.light.width,b=.5*this.light.height,c=this.line.geometry.attributes.position,d=c.array;d[0]=a;d[1]=-b;d[2]=0;d[3]=a;d[4]=b;d[5]=0;d[6]=-a;d[7]=b;d[8]=0;d[9]=-a;d[10]=-b;d[11]=0;d[12]=a;d[13]=-b;d[14]=0;c.needsUpdate=!0;void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)};oc.prototype=Object.create(B.prototype);oc.prototype.constructor=
oc;oc.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};oc.prototype.update=function(){var a=new p,b=new F,c=new F;return function(){var d=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=d.geometry.getAttribute("color");b.copy(this.light.color);c.copy(this.light.groundColor);for(var f=0,g=e.count;f<g;f++){var h=f<g/2?b:c;e.setXYZ(f,h.r,h.g,h.b)}e.needsUpdate=!0}d.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate())}}();
id.prototype=Object.create(Z.prototype);id.prototype.constructor=id;Nd.prototype=Object.create(Z.prototype);Nd.prototype.constructor=Nd;jd.prototype=Object.create(Z.prototype);jd.prototype.constructor=jd;jd.prototype.update=function(){var a=new p,b=new p,c=new na;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var d=this.object.matrixWorld,e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices;f=f.faces;for(var h=0,k=0,l=f.length;k<l;k++){var p=
f[k],n=p.normal;a.copy(g[p.a]).add(g[p.b]).add(g[p.c]).divideScalar(3).applyMatrix4(d);b.copy(n).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);e.setXYZ(h,a.x,a.y,a.z);h+=1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0}}();pc.prototype=Object.create(B.prototype);pc.prototype.constructor=pc;pc.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};pc.prototype.update=function(){var a=
new p,b=new p,c=new p;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);this.lightPlane.lookAt(c);void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color));this.targetLine.lookAt(c);this.targetLine.scale.z=c.length()}}();kd.prototype=Object.create(Z.prototype);
kd.prototype.constructor=kd;kd.prototype.update=function(){function a(a,g,h,k){d.set(g,h,k).unproject(e);a=c[a];if(void 0!==a)for(g=b.getAttribute("position"),h=0,k=a.length;h<k;h++)g.setXYZ(a[h],d.x,d.y,d.z)}var b,c,d=new p,e=new Pa;return function(){b=this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,
-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.getAttribute("position").needsUpdate=!0}}();Fb.prototype=Object.create(Z.prototype);Fb.prototype.constructor=Fb;Fb.prototype.update=function(){var a=new Ua;return function(b){void 0!==b&&console.warn("THREE.BoxHelper: .update() has no longer arguments.");void 0!==this.object&&a.setFromObject(this.object);if(!a.isEmpty()){b=a.min;var c=
a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();Fb.prototype.setFromObject=function(a){this.object=a;this.update();return this};ld.prototype=Object.create(Z.prototype);ld.prototype.constructor=ld;ld.prototype.updateMatrixWorld=
function(a){var b=this.box;b.isEmpty()||(b.getCenter(this.position),b.getSize(this.scale),this.scale.multiplyScalar(.5),B.prototype.updateMatrixWorld.call(this,a))};md.prototype=Object.create(oa.prototype);md.prototype.constructor=md;md.prototype.updateMatrixWorld=function(a){var b=-this.plane.constant;1E-8>Math.abs(b)&&(b=1E-8);this.scale.set(.5*this.size,.5*this.size,b);this.children[0].material.side=0>b?1:0;this.lookAt(this.plane.normal);B.prototype.updateMatrixWorld.call(this,a)};var Od,xe;Gb.prototype=
Object.create(B.prototype);Gb.prototype.constructor=Gb;Gb.prototype.setDirection=function(){var a=new p,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();Gb.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};
Gb.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};nd.prototype=Object.create(Z.prototype);nd.prototype.constructor=nd;L.create=function(a,b){console.log("THREE.Curve.create() has been deprecated");a.prototype=Object.create(L.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};Object.assign(Za.prototype,{createPointsGeometry:function(a){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");
a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");a=this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var b=new M,c=0,d=a.length;c<d;c++){var e=a[c];b.vertices.push(new p(e.x,
e.y,e.z||0))}return b}});Object.assign(Ma.prototype,{fromPoints:function(a){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");this.setFromPoints(a)}});xf.prototype=Object.create(ja.prototype);yf.prototype=Object.create(ja.prototype);ye.prototype=Object.create(ja.prototype);Object.assign(ye.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},
reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});id.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};lc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(ic.prototype,{extractUrlBase:function(a){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");
return Ce.extractUrlBase(a)}});Object.assign(ve.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");
return this.getSize(a)}});Object.assign(Ua.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");
return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});we.prototype.center=function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(a)};Object.assign(K,{random16:function(){console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead.");return Math.random()},nearestPowerOfTwo:function(a){console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().");
return K.floorPowerOfTwo(a)},nextPowerOfTwo:function(a){console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().");return K.ceilPowerOfTwo(a)}});Object.assign(na.prototype,{flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,b)},multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(a){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(a)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(J.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");
return this.copyPosition(a)},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new p);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");
return this.makeRotationFromQuaternion(a)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},
rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},
rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(a){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(a)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(a,b,c,d,e,f){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");
return this.makePerspective(a,b,d,c,e,f)}});Oa.prototype.isIntersectionLine=function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)};ha.prototype.multiplyVector3=function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)};Object.assign(ob.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");
return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(da.prototype,{area:function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()},barycoordFromPoint:function(a,
b){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(a,b)},midpoint:function(a){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");return this.getMidpoint(a)},normal:function(a){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return this.getNormal(a)},plane:function(a){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(a)}});Object.assign(da,
{barycoordFromPoint:function(a,b,c,d,e){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return da.getBarycoord(a,b,c,d,e)},normal:function(a,b,c,d){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return da.getNormal(a,b,c,d)}});Object.assign(fb.prototype,{extractAllPoints:function(a){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(a)},extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");
return new tb(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new vb(this,a)}});Object.assign(z.prototype,{fromAttribute:function(a,b,c){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,b,c)},distanceToManhattan:function(a){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(a)},
lengthManhattan:function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(p.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");
return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,a)},applyProjection:function(a){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(a)},
fromAttribute:function(a,b,c){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,b,c)},distanceToManhattan:function(a){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(a)},lengthManhattan:function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(aa.prototype,
{fromAttribute:function(a,b,c){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,b,c)},lengthManhattan:function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(M.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}});
Object.assign(B.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}});
Object.defineProperties(B.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});
Object.defineProperties(Dc.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Object.defineProperty(Ec.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Object.defineProperty(L.prototype,"__arcLengthDivisions",{get:function(){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");
return this.arcLengthDivisions},set:function(a){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");this.arcLengthDivisions=a}});X.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};Object.defineProperties(fa.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");
this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");
this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");
this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(Q.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");
return this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}});Object.assign(I.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)},
clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(I.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");
return this.groups}}});Object.assign(Qa.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(Md.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},
onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(H.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE.Material: .wrapRGB has been removed.");return new F}},shading:{get:function(){console.error("THREE."+this.type+
": .shading has been removed. Use the boolean .flatShading instead.")},set:function(a){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=1===a}}});Object.defineProperties(Ga.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});
Object.defineProperties(ua.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});Object.assign(Yd.prototype,{animate:function(a){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop().");this.setAnimationLoop(a)},getCurrentRenderTarget:function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");
return this.getRenderTarget()},getMaxAnisotropy:function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()},getPrecision:function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision},resetGLState:function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()},supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");
return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");
return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");
return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},
addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}});Object.defineProperties(Yd.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");
this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Ye.prototype,
{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},
renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(hb.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");
this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=
a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=
a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");
return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},
set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});Object.defineProperties($e.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}});jc.prototype.load=function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var b=this;(new ke).load(a,
function(a){b.setBuffer(a)});return this};oe.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};fd.prototype.updateCubeMap=function(a,b){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(a,b)};gb.crossOrigin=void 0;gb.loadTexture=function(a,b,c,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var e=new wd;e.setCrossOrigin(this.crossOrigin);
a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a};gb.loadTextureCube=function(a,b,c,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var e=new de;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a};gb.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};gb.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};
l.WebGLRenderTargetCube=Ib;l.WebGLRenderTarget=hb;l.WebGLRenderer=Yd;l.ShaderLib=pb;l.UniformsLib=R;l.UniformsUtils=Ba;l.ShaderChunk=U;l.FogExp2=Nb;l.Fog=Ob;l.Scene=rd;l.Sprite=Cc;l.LOD=Dc;l.SkinnedMesh=td;l.Skeleton=Ec;l.Bone=sd;l.Mesh=ta;l.LineSegments=Z;l.LineLoop=ud;l.Line=oa;l.Points=Qb;l.Group=Mb;l.VideoTexture=Zd;l.DataTexture=ib;l.CompressedTexture=Rb;l.CubeTexture=Wa;l.CanvasTexture=Fc;l.DepthTexture=Gc;l.Texture=T;l.CompressedTextureLoader=jf;l.DataTextureLoader=ce;l.CubeTextureLoader=de;
l.TextureLoader=wd;l.ObjectLoader=lf;l.MaterialLoader=Ld;l.BufferGeometryLoader=fe;l.DefaultLoadingManager=wa;l.LoadingManager=be;l.JSONLoader=ge;l.ImageLoader=ad;l.ImageBitmapLoader=he;l.FontLoader=mf;l.FileLoader=Ha;l.Loader=ic;l.LoaderUtils=Ce;l.Cache=Hb;l.AudioLoader=ke;l.SpotLightShadow=yd;l.SpotLight=zd;l.PointLight=Ad;l.RectAreaLight=Ed;l.HemisphereLight=xd;l.DirectionalLightShadow=Bd;l.DirectionalLight=Cd;l.AmbientLight=Dd;l.LightShadow=Eb;l.Light=fa;l.StereoCamera=nf;l.PerspectiveCamera=
X;l.OrthographicCamera=Jb;l.CubeCamera=fd;l.ArrayCamera=Ac;l.Camera=Pa;l.AudioListener=le;l.PositionalAudio=ne;l.AudioContext=me;l.AudioAnalyser=oe;l.Audio=jc;l.VectorKeyframeTrack=hc;l.StringKeyframeTrack=Kd;l.QuaternionKeyframeTrack=ed;l.NumberKeyframeTrack=gc;l.ColorKeyframeTrack=Id;l.BooleanKeyframeTrack=Hd;l.PropertyMixer=pe;l.PropertyBinding=sa;l.KeyframeTrack=pa;l.AnimationUtils=qa;l.AnimationObjectGroup=pf;l.AnimationMixer=qe;l.AnimationClip=Da;l.Uniform=Md;l.InstancedBufferGeometry=re;l.BufferGeometry=
I;l.Geometry=M;l.InterleavedBufferAttribute=Bc;l.InstancedInterleavedBuffer=se;l.InterleavedBuffer=qb;l.InstancedBufferAttribute=te;l.Face3=Va;l.Object3D=B;l.Raycaster=rf;l.Layers=Sd;l.EventDispatcher=ea;l.Clock=tf;l.QuaternionLinearInterpolant=Jd;l.LinearInterpolant=dd;l.DiscreteInterpolant=Gd;l.CubicInterpolant=Fd;l.Interpolant=ya;l.Triangle=da;l.Math=K;l.Spherical=uf;l.Cylindrical=vf;l.Plane=Oa;l.Frustum=od;l.Sphere=Ea;l.Ray=ob;l.Matrix4=J;l.Matrix3=na;l.Box3=Ua;l.Box2=ve;l.Line3=we;l.Euler=jb;
l.Vector4=aa;l.Vector3=p;l.Vector2=z;l.Quaternion=ha;l.Color=F;l.ImmediateRenderObject=gd;l.VertexNormalsHelper=hd;l.SpotLightHelper=kc;l.SkeletonHelper=lc;l.PointLightHelper=mc;l.RectAreaLightHelper=nc;l.HemisphereLightHelper=oc;l.GridHelper=id;l.PolarGridHelper=Nd;l.FaceNormalsHelper=jd;l.DirectionalLightHelper=pc;l.CameraHelper=kd;l.BoxHelper=Fb;l.Box3Helper=ld;l.PlaneHelper=md;l.ArrowHelper=Gb;l.AxesHelper=nd;l.Shape=fb;l.Path=Ma;l.ShapePath=ie;l.Font=je;l.CurvePath=Za;l.Curve=L;l.ImageUtils=
gb;l.ShapeUtils=Xa;l.WebGLUtils=Ze;l.WireframeGeometry=Sb;l.ParametricGeometry=Hc;l.ParametricBufferGeometry=Tb;l.TetrahedronGeometry=Jc;l.TetrahedronBufferGeometry=Ub;l.OctahedronGeometry=Kc;l.OctahedronBufferGeometry=rb;l.IcosahedronGeometry=Lc;l.IcosahedronBufferGeometry=Vb;l.DodecahedronGeometry=Mc;l.DodecahedronBufferGeometry=Wb;l.PolyhedronGeometry=Ic;l.PolyhedronBufferGeometry=la;l.TubeGeometry=Nc;l.TubeBufferGeometry=Xb;l.TorusKnotGeometry=Oc;l.TorusKnotBufferGeometry=Yb;l.TorusGeometry=Pc;
l.TorusBufferGeometry=Zb;l.TextGeometry=Uc;l.TextBufferGeometry=$b;l.SphereGeometry=Vc;l.SphereBufferGeometry=ub;l.RingGeometry=Wc;l.RingBufferGeometry=ac;l.PlaneGeometry=wc;l.PlaneBufferGeometry=nb;l.LatheGeometry=Xc;l.LatheBufferGeometry=bc;l.ShapeGeometry=vb;l.ShapeBufferGeometry=wb;l.ExtrudeGeometry=tb;l.ExtrudeBufferGeometry=Qa;l.EdgesGeometry=cc;l.ConeGeometry=Yc;l.ConeBufferGeometry=Zc;l.CylinderGeometry=xb;l.CylinderBufferGeometry=Ya;l.CircleGeometry=$c;l.CircleBufferGeometry=dc;l.BoxGeometry=
Kb;l.BoxBufferGeometry=mb;l.ShadowMaterial=yb;l.SpriteMaterial=eb;l.RawShaderMaterial=ec;l.ShaderMaterial=ua;l.PointsMaterial=Fa;l.MeshPhysicalMaterial=zb;l.MeshStandardMaterial=Ra;l.MeshPhongMaterial=Ga;l.MeshToonMaterial=Ab;l.MeshNormalMaterial=Bb;l.MeshLambertMaterial=Cb;l.MeshDepthMaterial=ab;l.MeshDistanceMaterial=bb;l.MeshBasicMaterial=ka;l.LineDashedMaterial=Db;l.LineBasicMaterial=V;l.Material=H;l.Float64BufferAttribute=vc;l.Float32BufferAttribute=A;l.Uint32BufferAttribute=lb;l.Int32BufferAttribute=
uc;l.Uint16BufferAttribute=kb;l.Int16BufferAttribute=tc;l.Uint8ClampedBufferAttribute=sc;l.Uint8BufferAttribute=rc;l.Int8BufferAttribute=qc;l.BufferAttribute=Q;l.ArcCurve=fc;l.CatmullRomCurve3=ja;l.CubicBezierCurve=Ia;l.CubicBezierCurve3=Sa;l.EllipseCurve=Aa;l.LineCurve=xa;l.LineCurve3=Ja;l.QuadraticBezierCurve=Ka;l.QuadraticBezierCurve3=Ta;l.SplineCurve=La;l.REVISION="96";l.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};l.CullFaceNone=0;l.CullFaceBack=1;l.CullFaceFront=2;l.CullFaceFrontBack=3;l.FrontFaceDirectionCW=
0;l.FrontFaceDirectionCCW=1;l.BasicShadowMap=0;l.PCFShadowMap=1;l.PCFSoftShadowMap=2;l.FrontSide=0;l.BackSide=1;l.DoubleSide=2;l.FlatShading=1;l.SmoothShading=2;l.NoColors=0;l.FaceColors=1;l.VertexColors=2;l.NoBlending=0;l.NormalBlending=1;l.AdditiveBlending=2;l.SubtractiveBlending=3;l.MultiplyBlending=4;l.CustomBlending=5;l.AddEquation=100;l.SubtractEquation=101;l.ReverseSubtractEquation=102;l.MinEquation=103;l.MaxEquation=104;l.ZeroFactor=200;l.OneFactor=201;l.SrcColorFactor=202;l.OneMinusSrcColorFactor=
203;l.SrcAlphaFactor=204;l.OneMinusSrcAlphaFactor=205;l.DstAlphaFactor=206;l.OneMinusDstAlphaFactor=207;l.DstColorFactor=208;l.OneMinusDstColorFactor=209;l.SrcAlphaSaturateFactor=210;l.NeverDepth=0;l.AlwaysDepth=1;l.LessDepth=2;l.LessEqualDepth=3;l.EqualDepth=4;l.GreaterEqualDepth=5;l.GreaterDepth=6;l.NotEqualDepth=7;l.MultiplyOperation=0;l.MixOperation=1;l.AddOperation=2;l.NoToneMapping=0;l.LinearToneMapping=1;l.ReinhardToneMapping=2;l.Uncharted2ToneMapping=3;l.CineonToneMapping=4;l.UVMapping=300;
l.CubeReflectionMapping=301;l.CubeRefractionMapping=302;l.EquirectangularReflectionMapping=303;l.EquirectangularRefractionMapping=304;l.SphericalReflectionMapping=305;l.CubeUVReflectionMapping=306;l.CubeUVRefractionMapping=307;l.RepeatWrapping=1E3;l.ClampToEdgeWrapping=1001;l.MirroredRepeatWrapping=1002;l.NearestFilter=1003;l.NearestMipMapNearestFilter=1004;l.NearestMipMapLinearFilter=1005;l.LinearFilter=1006;l.LinearMipMapNearestFilter=1007;l.LinearMipMapLinearFilter=1008;l.UnsignedByteType=1009;
l.ByteType=1010;l.ShortType=1011;l.UnsignedShortType=1012;l.IntType=1013;l.UnsignedIntType=1014;l.FloatType=1015;l.HalfFloatType=1016;l.UnsignedShort4444Type=1017;l.UnsignedShort5551Type=1018;l.UnsignedShort565Type=1019;l.UnsignedInt248Type=1020;l.AlphaFormat=1021;l.RGBFormat=1022;l.RGBAFormat=1023;l.LuminanceFormat=1024;l.LuminanceAlphaFormat=1025;l.RGBEFormat=1023;l.DepthFormat=1026;l.DepthStencilFormat=1027;l.RGB_S3TC_DXT1_Format=33776;l.RGBA_S3TC_DXT1_Format=33777;l.RGBA_S3TC_DXT3_Format=33778;
l.RGBA_S3TC_DXT5_Format=33779;l.RGB_PVRTC_4BPPV1_Format=35840;l.RGB_PVRTC_2BPPV1_Format=35841;l.RGBA_PVRTC_4BPPV1_Format=35842;l.RGBA_PVRTC_2BPPV1_Format=35843;l.RGB_ETC1_Format=36196;l.RGBA_ASTC_4x4_Format=37808;l.RGBA_ASTC_5x4_Format=37809;l.RGBA_ASTC_5x5_Format=37810;l.RGBA_ASTC_6x5_Format=37811;l.RGBA_ASTC_6x6_Format=37812;l.RGBA_ASTC_8x5_Format=37813;l.RGBA_ASTC_8x6_Format=37814;l.RGBA_ASTC_8x8_Format=37815;l.RGBA_ASTC_10x5_Format=37816;l.RGBA_ASTC_10x6_Format=37817;l.RGBA_ASTC_10x8_Format=37818;
l.RGBA_ASTC_10x10_Format=37819;l.RGBA_ASTC_12x10_Format=37820;l.RGBA_ASTC_12x12_Format=37821;l.LoopOnce=2200;l.LoopRepeat=2201;l.LoopPingPong=2202;l.InterpolateDiscrete=2300;l.InterpolateLinear=2301;l.InterpolateSmooth=2302;l.ZeroCurvatureEnding=2400;l.ZeroSlopeEnding=2401;l.WrapAroundEnding=2402;l.TrianglesDrawMode=0;l.TriangleStripDrawMode=1;l.TriangleFanDrawMode=2;l.LinearEncoding=3E3;l.sRGBEncoding=3001;l.GammaEncoding=3007;l.RGBEEncoding=3002;l.LogLuvEncoding=3003;l.RGBM7Encoding=3004;l.RGBM16Encoding=
3005;l.RGBDEncoding=3006;l.BasicDepthPacking=3200;l.RGBADepthPacking=3201;l.TangentSpaceNormalMap=0;l.ObjectSpaceNormalMap=1;l.CubeGeometry=Kb;l.Face4=function(a,b,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new Va(a,b,c,e,f,g)};l.LineStrip=0;l.LinePieces=1;l.MeshFaceMaterial=function(a){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return a};l.MultiMaterial=function(a){void 0===a&&(a=[]);console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");
a.isMultiMaterial=!0;a.materials=a;a.clone=function(){return a.slice()};return a};l.PointCloud=function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Qb(a,b)};l.Particle=function(a){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Cc(a)};l.ParticleSystem=function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Qb(a,b)};l.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");
return new Fa(a)};l.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Fa(a)};l.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Fa(a)};l.Vertex=function(a,b,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new p(a,b,c)};l.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");
return(new Q(a,b)).setDynamic(!0)};l.Int8Attribute=function(a,b){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new qc(a,b)};l.Uint8Attribute=function(a,b){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new rc(a,b)};l.Uint8ClampedAttribute=function(a,b){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new sc(a,
b)};l.Int16Attribute=function(a,b){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new tc(a,b)};l.Uint16Attribute=function(a,b){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new kb(a,b)};l.Int32Attribute=function(a,b){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new uc(a,b)};l.Uint32Attribute=function(a,b){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");
return new lb(a,b)};l.Float32Attribute=function(a,b){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new A(a,b)};l.Float64Attribute=function(a,b){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new vc(a,b)};l.ClosedSplineCurve3=xf;l.SplineCurve3=yf;l.Spline=ye;l.AxisHelper=function(a){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new nd(a)};
l.BoundingBoxHelper=function(a,b){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new Fb(a,b)};l.EdgesHelper=function(a,b){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new Z(new cc(a.geometry),new V({color:void 0!==b?b:16777215}))};l.WireframeHelper=function(a,b){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new Z(new Sb(a.geometry),new V({color:void 0!==
b?b:16777215}))};l.XHRLoader=function(a){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new Ha(a)};l.BinaryTextureLoader=function(a){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new ce(a)};l.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");if(b.isMesh){b.matrixAutoUpdate&&b.updateMatrix();
var d=b.matrix;b=b.geometry}a.merge(b,d,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};l.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");
a.unproject(b)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};l.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};l.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},
detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};l.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")};Object.defineProperty(l,"__esModule",{value:!0})});

!function(t){var e;"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():("undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.CANNON=t())}(function(){return function t(e,o,i){function n(r,a){if(!o[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var l=o[r]={exports:{}};e[r][0].call(l.exports,function(t){var o=e[r][1][t];return n(o||t)},l,l.exports,t,e,o,i)}return o[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}({1:[function(t,e,o){e.exports={name:"cannon",version:"0.6.3",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./src/Cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,e,o){e.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Transform:t("./math/Transform"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":10,"./collision/RaycastResult":11,"./collision/SAPBroadphase":12,"./constraints/ConeTwistConstraint":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/HingeConstraint":16,"./constraints/LockConstraint":17,"./constraints/PointToPointConstraint":18,"./equations/ContactEquation":20,"./equations/Equation":21,"./equations/FrictionEquation":22,"./equations/RotationalEquation":23,"./equations/RotationalMotorEquation":24,"./material/ContactMaterial":25,"./material/Material":26,"./math/Mat3":28,"./math/Quaternion":29,"./math/Transform":30,"./math/Vec3":31,"./objects/Body":32,"./objects/RaycastVehicle":33,"./objects/RigidVehicle":34,"./objects/SPHSystem":35,"./objects/Spring":36,"./shapes/Box":38,"./shapes/ConvexPolyhedron":39,"./shapes/Cylinder":40,"./shapes/Heightfield":41,"./shapes/Particle":42,"./shapes/Plane":43,"./shapes/Shape":44,"./shapes/Sphere":45,"./shapes/Trimesh":46,"./solver/GSSolver":47,"./solver/Solver":48,"./solver/SplitSolver":49,"./utils/EventTarget":50,"./utils/Pool":52,"./utils/Vec3Pool":55,"./world/Narrowphase":56,"./world/World":57}],3:[function(t,e,o){var i=t("../math/Vec3");t("../utils/Utils");function n(t){t=t||{},this.lowerBound=new i,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new i,t.upperBound&&this.upperBound.copy(t.upperBound)}e.exports=n;var s=new i;n.prototype.setFromPoints=function(t,e,o,i){var n=this.lowerBound,r=this.upperBound,a=o;n.copy(t[0]),a&&a.vmult(n,n),r.copy(n);for(var h=1;h<t.length;h++){var l=t[h];a&&(a.vmult(l,s),l=s),l.x>r.x&&(r.x=l.x),l.x<n.x&&(n.x=l.x),l.y>r.y&&(r.y=l.y),l.y<n.y&&(n.y=l.y),l.z>r.z&&(r.z=l.z),l.z<n.z&&(n.z=l.z)}return e&&(e.vadd(n,n),e.vadd(r,r)),i&&(n.x-=i,n.y-=i,n.z-=i,r.x+=i,r.y+=i,r.z+=i),this},n.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},n.prototype.clone=function(){return(new n).copy(this)},n.prototype.extend=function(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)},n.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound,s=i.x<=o.x&&o.x<=n.x||e.x<=n.x&&n.x<=o.x,r=i.y<=o.y&&o.y<=n.y||e.y<=n.y&&n.y<=o.y,a=i.z<=o.z&&o.z<=n.z||e.z<=n.z&&n.z<=o.z;return s&&r&&a},n.prototype.volume=function(){var t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)},n.prototype.contains=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound;return e.x<=i.x&&o.x>=n.x&&e.y<=i.y&&o.y>=n.y&&e.z<=i.z&&o.z>=n.z},n.prototype.getCorners=function(t,e,o,i,n,s,r,a){var h=this.lowerBound,l=this.upperBound;t.copy(h),e.set(l.x,h.y,h.z),o.set(l.x,l.y,h.z),i.set(h.x,l.y,l.z),n.set(l.x,h.y,h.z),s.set(h.x,l.y,h.z),r.set(h.x,h.y,l.z),a.copy(l)};var r=[new i,new i,new i,new i,new i,new i,new i,new i];n.prototype.toLocalFrame=function(t,e){var o=r,i=o[0],n=o[1],s=o[2],a=o[3],h=o[4],l=o[5],p=o[6],c=o[7];this.getCorners(i,n,s,a,h,l,p,c);for(var u=0;8!==u;u++){var d=o[u];t.pointToLocal(d,d)}return e.setFromPoints(o)},n.prototype.toWorldFrame=function(t,e){var o=r,i=o[0],n=o[1],s=o[2],a=o[3],h=o[4],l=o[5],p=o[6],c=o[7];this.getCorners(i,n,s,a,h,l,p,c);for(var u=0;8!==u;u++){var d=o[u];t.pointToWorld(d,d)}return e.setFromPoints(o)},n.prototype.overlapsRay=function(t){var e=1/t._direction.x,o=1/t._direction.y,i=1/t._direction.z,n=(this.lowerBound.x-t.from.x)*e,s=(this.upperBound.x-t.from.x)*e,r=(this.lowerBound.y-t.from.y)*o,a=(this.upperBound.y-t.from.y)*o,h=(this.lowerBound.z-t.from.z)*i,l=(this.upperBound.z-t.from.z)*i,p=Math.max(Math.max(Math.min(n,s),Math.min(r,a)),Math.min(h,l)),c=Math.min(Math.min(Math.max(n,s),Math.max(r,a)),Math.max(h,l));return!(c<0)&&!(p>c)}},{"../math/Vec3":31,"../utils/Utils":54}],4:[function(t,e,o){function i(){this.matrix=[]}e.exports=i,i.prototype.get=function(t,e){if(t=t.index,(e=e.index)>t){var o=e;e=t,t=o}return this.matrix[(t*(t+1)>>1)+e-1]},i.prototype.set=function(t,e,o){if(t=t.index,(e=e.index)>t){var i=e;e=t,t=i}this.matrix[(t*(t+1)>>1)+e-1]=o?1:0},i.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},i.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e,o){var i=t("../objects/Body"),n=t("../math/Vec3"),s=t("../math/Quaternion");t("../shapes/Shape"),t("../shapes/Plane");function r(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}e.exports=r,r.prototype.collisionPairs=function(t,e,o){throw new Error("collisionPairs not implemented for this BroadPhase class!")},r.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&i.STATIC)&&t.sleepState!==i.SLEEPING||0==(e.type&i.STATIC)&&e.sleepState!==i.SLEEPING)},r.prototype.intersectionTest=function(t,e,o,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,o,i):this.doBoundingSphereBroadphase(t,e,o,i)};var a=new n;new n,new s,new n;r.prototype.doBoundingSphereBroadphase=function(t,e,o,i){var n=a;e.position.vsub(t.position,n);var s=Math.pow(t.boundingRadius+e.boundingRadius,2);n.norm2()<s&&(o.push(t),i.push(e))},r.prototype.doBoundingBoxBroadphase=function(t,e,o,i){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(o.push(t),i.push(e))};var h={keys:[]},l=[],p=[];r.prototype.makePairsUnique=function(t,e){for(var o=h,i=l,n=p,s=t.length,r=0;r!==s;r++)i[r]=t[r],n[r]=e[r];t.length=0,e.length=0;for(r=0;r!==s;r++){var a=i[r].id,c=n[r].id;o[u=a<c?a+","+c:c+","+a]=r,o.keys.push(u)}for(r=0;r!==o.keys.length;r++){var u,d=o[u=o.keys.pop()];t.push(i[d]),e.push(n[d]),delete o[u]}},r.prototype.setWorld=function(t){};var c=new n;r.boundingSphereCheck=function(t,e){var o=c;return t.position.vsub(e.position,o),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>o.norm2()},r.prototype.aabbQuery=function(t,e,o){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":29,"../math/Vec3":31,"../objects/Body":32,"../shapes/Plane":43,"../shapes/Shape":44}],6:[function(t,e,o){e.exports=r;var i=t("./Broadphase"),n=t("../math/Vec3"),s=t("../shapes/Shape");function r(t,e,o,s,r){i.apply(this),this.nx=o||10,this.ny=s||10,this.nz=r||10,this.aabbMin=t||new n(100,100,100),this.aabbMax=e||new n(-100,-100,-100);var a=this.nx*this.ny*this.nz;if(a<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=a,this.binLengths.length=a;for(var h=0;h<a;h++)this.bins[h]=[],this.binLengths[h]=0}r.prototype=new i,r.prototype.constructor=r;var a=new n;new n;r.prototype.collisionPairs=function(t,e,o){for(var i=t.numObjects(),n=t.bodies,r=this.aabbMax,h=this.aabbMin,l=this.nx,p=this.ny,c=this.nz,u=p*c,d=c,v=1,y=r.x,f=r.y,m=r.z,w=h.x,x=h.y,g=h.z,b=l/(y-w),B=p/(f-x),A=c/(m-g),E=(y-w)/l,S=(f-x)/p,z=(m-g)/c,M=.5*Math.sqrt(E*E+S*S+z*z),C=s.types,q=C.SPHERE,F=C.PLANE,R=(C.BOX,C.COMPOUND,C.CONVEXPOLYHEDRON,this.bins),P=this.binLengths,T=this.bins.length,V=0;V!==T;V++)P[V]=0;var I=Math.ceil;h=Math.min,r=Math.max;function N(t,e,o,i,n,s,r){var a=(t-w)*b|0,h=(e-x)*B|0,y=(o-g)*A|0,f=I((i-w)*b),m=I((n-x)*B),E=I((s-g)*A);a<0?a=0:a>=l&&(a=l-1),h<0?h=0:h>=p&&(h=p-1),y<0?y=0:y>=c&&(y=c-1),f<0?f=0:f>=l&&(f=l-1),m<0?m=0:m>=p&&(m=p-1),E<0?E=0:E>=c&&(E=c-1),h*=d,y*=v,f*=u,m*=d,E*=v;for(var S=a*=u;S<=f;S+=u)for(var z=h;z<=m;z+=d)for(var M=y;M<=E;M+=v){var C=S+z+M;R[C][P[C]++]=r}}for(V=0;V!==i;V++){var L=(ot=n[V]).shape;switch(L.type){case q:var W=ot.position.x,j=ot.position.y,O=ot.position.z,k=L.radius;N(W-k,j-k,O-k,W+k,j+k,O+k,ot);break;case F:L.worldNormalNeedsUpdate&&L.computeWorldNormal(ot.quaternion);var _=L.worldNormal,U=w+.5*E-ot.position.x,H=x+.5*S-ot.position.y,D=g+.5*z-ot.position.z,G=a;G.set(U,H,D);for(var X=0,Q=0;X!==l;X++,Q+=u,G.y=H,G.x+=E)for(var Y=0,Z=0;Y!==p;Y++,Z+=d,G.z=D,G.y+=S)for(var K=0,J=0;K!==c;K++,J+=v,G.z+=z)if(G.dot(_)<M){var $=Q+Z+J;R[$][P[$]++]=ot}break;default:ot.aabbNeedsUpdate&&ot.computeAABB(),N(ot.aabb.lowerBound.x,ot.aabb.lowerBound.y,ot.aabb.lowerBound.z,ot.aabb.upperBound.x,ot.aabb.upperBound.y,ot.aabb.upperBound.z,ot)}}for(V=0;V!==T;V++){var tt=P[V];if(tt>1){var et=R[V];for(X=0;X!==tt;X++){var ot=et[X];for(Y=0;Y!==X;Y++){var it=et[Y];this.needBroadphaseCollision(ot,it)&&this.intersectionTest(ot,it,e,o)}}}}this.makePairsUnique(e,o)}},{"../math/Vec3":31,"../shapes/Shape":44,"./Broadphase":5}],7:[function(t,e,o){e.exports=s;var i=t("./Broadphase"),n=t("./AABB");function s(){i.apply(this)}s.prototype=new i,s.prototype.constructor=s,s.prototype.collisionPairs=function(t,e,o){var i,n,s,r,a=t.bodies,h=a.length;for(i=0;i!==h;i++)for(n=0;n!==i;n++)s=a[i],r=a[n],this.needBroadphaseCollision(s,r)&&this.intersectionTest(s,r,e,o)};new n;s.prototype.aabbQuery=function(t,e,o){o=o||[];for(var i=0;i<t.bodies.length;i++){var n=t.bodies[i];n.aabbNeedsUpdate&&n.computeAABB(),n.aabb.overlaps(e)&&o.push(n)}return o}},{"./AABB":3,"./Broadphase":5}],8:[function(t,e,o){function i(){this.matrix={}}e.exports=i,i.prototype.get=function(t,e){if(t=t.id,(e=e.id)>t){var o=e;e=t,t=o}return t+"-"+e in this.matrix},i.prototype.set=function(t,e,o){if(t=t.id,(e=e.id)>t){var i=e;e=t,t=i}o?this.matrix[t+"-"+e]=!0:delete this.matrix[t+"-"+e]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(t){}},{}],9:[function(t,e,o){function i(){this.current=[],this.previous=[]}function n(t,e){t.push((4294901760&e)>>16,65535&e)}e.exports=i,i.prototype.getKey=function(t,e){if(e<t){var o=e;e=t,t=o}return t<<16|e},i.prototype.set=function(t,e){for(var o=this.getKey(t,e),i=this.current,n=0;o>i[n];)n++;if(o!==i[n]){for(e=i.length-1;e>=n;e--)i[e+1]=i[e];i[n]=o}},i.prototype.tick=function(){var t=this.current;this.current=this.previous,this.previous=t,this.current.length=0},i.prototype.getDiff=function(t,e){for(var o=this.current,i=this.previous,s=o.length,r=i.length,a=0,h=0;h<s;h++){for(var l=o[h];l>i[a];)a++;l===i[a]||n(t,l)}a=0;for(h=0;h<r;h++){for(var p=i[h];p>o[a];)a++;o[a]===p||n(e,p)}}},{}],10:[function(t,e,o){e.exports=l;var i=t("../math/Vec3"),n=t("../math/Quaternion"),s=t("../math/Transform"),r=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),a=t("../shapes/Shape"),h=t("../collision/AABB");function l(t,e){this.from=t?t.clone():new i,this.to=e?e.clone():new i,this._direction=new i,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=l.ANY,this.result=new r,this.hasHit=!1,this.callback=function(t){}}l.prototype.constructor=l,l.CLOSEST=1,l.ANY=2,l.ALL=4;var p=new h,c=[];l.prototype.intersectWorld=function(t,e){return this.mode=e.mode||l.ANY,this.result=e.result||new r,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(p),c.length=0,t.broadphase.aabbQuery(t,p,c),this.intersectBodies(c),this.hasHit};var u=new i,d=new i;function v(t,e,o,i){i.vsub(e,L),o.vsub(e,u),t.vsub(e,d);var n,s,r=L.dot(L),a=L.dot(u),h=L.dot(d),l=u.dot(u),p=u.dot(d);return(n=l*h-a*p)>=0&&(s=r*p-a*h)>=0&&n+s<r*l-a*a}l.pointInTriangle=v;var y=new i,f=new n;l.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var o=this.checkCollisionResponse;if((!o||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var i=y,n=f,s=0,r=t.shapes.length;s<r;s++){var a=t.shapes[s];if((!o||a.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[s],n),t.quaternion.vmult(t.shapeOffsets[s],i),i.vadd(t.position,i),this.intersectShape(a,n,i,t),this.result._shouldStop))break}},l.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var o=0,i=t.length;!this.result._shouldStop&&o<i;o++)this.intersectBody(t[o])},l.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},l.prototype.intersectShape=function(t,e,o,i){if(!(function(t,e,o){o.vsub(t,L);var i=L.dot(e);return e.mult(i,W),W.vadd(t,W),o.distanceTo(W)}(this.from,this._direction,o)>t.boundingSphereRadius)){var n=this[t.type];n&&n.call(this,t,e,o,i,t)}};new i,new i;var m=new i,w=new i,x=new i,g=new i;new i,new r;l.prototype.intersectBox=function(t,e,o,i,n){return this.intersectConvex(t.convexPolyhedronRepresentation,e,o,i,n)},l.prototype[a.types.BOX]=l.prototype.intersectBox,l.prototype.intersectPlane=function(t,e,o,n,s){var r=this.from,a=this.to,h=this._direction,l=new i(0,0,1);e.vmult(l,l);var p=new i;r.vsub(o,p);var c=p.dot(l);if(a.vsub(o,p),!(c*p.dot(l)>0||r.distanceTo(a)<c)){var u=l.dot(h);if(!(Math.abs(u)<this.precision)){var d=new i,v=new i,y=new i;r.vsub(o,d);var f=-l.dot(d)/u;h.scale(f,v),r.vadd(v,y),this.reportIntersection(l,y,s,n,-1)}}},l.prototype[a.types.PLANE]=l.prototype.intersectPlane,l.prototype.getAABB=function(t){var e=this.to,o=this.from;t.lowerBound.x=Math.min(e.x,o.x),t.lowerBound.y=Math.min(e.y,o.y),t.lowerBound.z=Math.min(e.z,o.z),t.upperBound.x=Math.max(e.x,o.x),t.upperBound.y=Math.max(e.y,o.y),t.upperBound.z=Math.max(e.z,o.z)};var b={faceList:[0]},B=new i,A=new l,E=[];l.prototype.intersectHeightfield=function(t,e,o,i,n){t.data,t.elementSize;var r=A;r.from.copy(this.from),r.to.copy(this.to),s.pointToLocalFrame(o,e,r.from,r.from),s.pointToLocalFrame(o,e,r.to,r.to),r._updateDirection();var a,l,p,c,u=E;a=l=0,p=c=t.data.length-1;var d=new h;r.getAABB(d),t.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,u,!0),a=Math.max(a,u[0]),l=Math.max(l,u[1]),t.getIndexOfPosition(d.upperBound.x,d.upperBound.y,u,!0),p=Math.min(p,u[0]+1),c=Math.min(c,u[1]+1);for(var v=a;v<p;v++)for(var y=l;y<c;y++){if(this.result._shouldStop)return;if(t.getAabbAtIndex(v,y,d),d.overlapsRay(r)){if(t.getConvexTrianglePillar(v,y,!1),s.pointToWorldFrame(o,e,t.pillarOffset,B),this.intersectConvex(t.pillarConvex,e,B,i,n,b),this.result._shouldStop)return;t.getConvexTrianglePillar(v,y,!0),s.pointToWorldFrame(o,e,t.pillarOffset,B),this.intersectConvex(t.pillarConvex,e,B,i,n,b)}}},l.prototype[a.types.HEIGHTFIELD]=l.prototype.intersectHeightfield;var S=new i,z=new i;l.prototype.intersectSphere=function(t,e,o,i,n){var s=this.from,r=this.to,a=t.radius,h=Math.pow(r.x-s.x,2)+Math.pow(r.y-s.y,2)+Math.pow(r.z-s.z,2),l=2*((r.x-s.x)*(s.x-o.x)+(r.y-s.y)*(s.y-o.y)+(r.z-s.z)*(s.z-o.z)),p=Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2)+Math.pow(s.z-o.z,2)-Math.pow(a,2),c=Math.pow(l,2)-4*h*p,u=S,d=z;if(!(c<0))if(0===c)s.lerp(r,c,u),u.vsub(o,d),d.normalize(),this.reportIntersection(d,u,n,i,-1);else{var v=(-l-Math.sqrt(c))/(2*h),y=(-l+Math.sqrt(c))/(2*h);if(v>=0&&v<=1&&(s.lerp(r,v,u),u.vsub(o,d),d.normalize(),this.reportIntersection(d,u,n,i,-1)),this.result._shouldStop)return;y>=0&&y<=1&&(s.lerp(r,y,u),u.vsub(o,d),d.normalize(),this.reportIntersection(d,u,n,i,-1))}},l.prototype[a.types.SPHERE]=l.prototype.intersectSphere;var M=new i,C=(new i,new i,new i);l.prototype.intersectConvex=function(t,e,o,i,n,s){for(var r=M,a=C,h=s&&s.faceList||null,l=t.faces,p=t.vertices,c=t.faceNormals,u=this._direction,d=this.from,y=this.to,f=d.distanceTo(y),b=h?h.length:l.length,B=this.result,A=0;!B._shouldStop&&A<b;A++){var E=h?h[A]:A,S=l[E],z=c[E],q=e,F=o;a.copy(p[S[0]]),q.vmult(a,a),a.vadd(F,a),a.vsub(d,a),q.vmult(z,r);var R=u.dot(r);if(!(Math.abs(R)<this.precision)){var P=r.dot(a)/R;if(!(P<0)){u.mult(P,m),m.vadd(d,m),w.copy(p[S[0]]),q.vmult(w,w),F.vadd(w,w);for(var T=1;!B._shouldStop&&T<S.length-1;T++){x.copy(p[S[T]]),g.copy(p[S[T+1]]),q.vmult(x,x),q.vmult(g,g),F.vadd(x,x),F.vadd(g,g);var V=m.distanceTo(d);!v(m,w,x,g)&&!v(m,x,w,g)||V>f||this.reportIntersection(r,m,n,i,E)}}}}},l.prototype[a.types.CONVEXPOLYHEDRON]=l.prototype.intersectConvex;var q=new i,F=new i,R=new i,P=new i,T=new i,V=new i,I=(new h,[]),N=new s;l.prototype.intersectTrimesh=function(t,e,o,i,n,r){var a=q,h=I,l=N,p=C,c=F,u=R,d=P,y=V,f=T,b=(r&&r.faceList,t.indices),B=(t.vertices,t.faceNormals,this.from),A=this.to,E=this._direction;l.position.copy(o),l.quaternion.copy(e),s.vectorToLocalFrame(o,e,E,c),s.pointToLocalFrame(o,e,B,u),s.pointToLocalFrame(o,e,A,d),d.x*=t.scale.x,d.y*=t.scale.y,d.z*=t.scale.z,u.x*=t.scale.x,u.y*=t.scale.y,u.z*=t.scale.z,d.vsub(u,c),c.normalize();var S=u.distanceSquared(d);t.tree.rayQuery(this,l,h);for(var z=0,M=h.length;!this.result._shouldStop&&z!==M;z++){var L=h[z];t.getNormal(L,a),t.getVertex(b[3*L],w),w.vsub(u,p);var W=c.dot(a),j=a.dot(p)/W;if(!(j<0)){c.scale(j,m),m.vadd(u,m),t.getVertex(b[3*L+1],x),t.getVertex(b[3*L+2],g);var O=m.distanceSquared(u);!v(m,x,w,g)&&!v(m,w,x,g)||O>S||(s.vectorToWorldFrame(e,a,f),s.pointToWorldFrame(o,e,m,y),this.reportIntersection(f,y,n,i,L))}}h.length=0},l.prototype[a.types.TRIMESH]=l.prototype.intersectTrimesh,l.prototype.reportIntersection=function(t,e,o,i,n){var s=this.from,r=this.to,a=s.distanceTo(e),h=this.result;if(!(this.skipBackfaces&&t.dot(this._direction)>0))switch(h.hitFaceIndex=void 0!==n?n:-1,this.mode){case l.ALL:this.hasHit=!0,h.set(s,r,t,e,o,i,a),h.hasHit=!0,this.callback(h);break;case l.CLOSEST:(a<h.distance||!h.hasHit)&&(this.hasHit=!0,h.hasHit=!0,h.set(s,r,t,e,o,i,a));break;case l.ANY:this.hasHit=!0,h.hasHit=!0,h.set(s,r,t,e,o,i,a),h._shouldStop=!0}};var L=new i,W=new i},{"../collision/AABB":3,"../collision/RaycastResult":11,"../math/Quaternion":29,"../math/Transform":30,"../math/Vec3":31,"../shapes/Box":38,"../shapes/ConvexPolyhedron":39,"../shapes/Shape":44}],11:[function(t,e,o){var i=t("../math/Vec3");function n(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}e.exports=n,n.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},n.prototype.abort=function(){this._shouldStop=!0},n.prototype.set=function(t,e,o,i,n,s,r){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(o),this.hitPointWorld.copy(i),this.shape=n,this.body=s,this.distance=r}},{"../math/Vec3":31}],12:[function(t,e,o){t("../shapes/Shape");var i=t("../collision/Broadphase");function n(t){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var o=e.indexOf(t.body);-1!==o&&e.splice(o,1)},t&&this.setWorld(t)}e.exports=n,n.prototype=new i,n.prototype.setWorld=function(t){this.axisList.length=0;for(var e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},n.insertionSortX=function(t){for(var e=1,o=t.length;e<o;e++){for(var i=t[e],n=e-1;n>=0&&!(t[n].aabb.lowerBound.x<=i.aabb.lowerBound.x);n--)t[n+1]=t[n];t[n+1]=i}return t},n.insertionSortY=function(t){for(var e=1,o=t.length;e<o;e++){for(var i=t[e],n=e-1;n>=0&&!(t[n].aabb.lowerBound.y<=i.aabb.lowerBound.y);n--)t[n+1]=t[n];t[n+1]=i}return t},n.insertionSortZ=function(t){for(var e=1,o=t.length;e<o;e++){for(var i=t[e],n=e-1;n>=0&&!(t[n].aabb.lowerBound.z<=i.aabb.lowerBound.z);n--)t[n+1]=t[n];t[n+1]=i}return t},n.prototype.collisionPairs=function(t,e,o){var i,s,r=this.axisList,a=r.length,h=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==a;i++){var l=r[i];for(s=i+1;s<a;s++){var p=r[s];if(this.needBroadphaseCollision(l,p)){if(!n.checkBounds(l,p,h))break;this.intersectionTest(l,p,e,o)}}}},n.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,o=t.length,i=0;i!==o;i++){var s=t[i];s.aabbNeedsUpdate&&s.computeAABB()}0===e?n.insertionSortX(t):1===e?n.insertionSortY(t):2===e&&n.insertionSortZ(t)},n.checkBounds=function(t,e,o){var i,n;0===o?(i=t.position.x,n=e.position.x):1===o?(i=t.position.y,n=e.position.y):2===o&&(i=t.position.z,n=e.position.z);var s=t.boundingRadius,r=e.boundingRadius;return n-r<i+s},n.prototype.autoDetectAxis=function(){for(var t=0,e=0,o=0,i=0,n=0,s=0,r=this.axisList,a=r.length,h=1/a,l=0;l!==a;l++){var p=r[l],c=p.position.x;t+=c,e+=c*c;var u=p.position.y;o+=u,i+=u*u;var d=p.position.z;n+=d,s+=d*d}var v=e-t*t*h,y=i-o*o*h,f=s-n*n*h;this.axisIndex=v>y?v>f?0:2:y>f?1:2},n.prototype.aabbQuery=function(t,e,o){o=o||[],this.dirty&&(this.sortList(),this.dirty=!1);var i=this.axisIndex,n="x";1===i&&(n="y"),2===i&&(n="z");for(var s=this.axisList,r=(e.lowerBound[n],e.upperBound[n],0);r<s.length;r++){var a=s[r];a.aabbNeedsUpdate&&a.computeAABB(),a.aabb.overlaps(e)&&o.push(a)}return o}},{"../collision/Broadphase":5,"../shapes/Shape":44}],13:[function(t,e,o){e.exports=a;t("./Constraint");var i=t("./PointToPointConstraint"),n=t("../equations/ConeEquation"),s=t("../equations/RotationalEquation"),r=(t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,o){var a=void 0!==(o=o||{}).maxForce?o.maxForce:1e6,h=o.pivotA?o.pivotA.clone():new r,l=o.pivotB?o.pivotB.clone():new r;this.axisA=o.axisA?o.axisA.clone():new r,this.axisB=o.axisB?o.axisB.clone():new r,i.call(this,t,h,e,l,a),this.collideConnected=!!o.collideConnected,this.angle=void 0!==o.angle?o.angle:0;var p=this.coneEquation=new n(t,e,o),c=this.twistEquation=new s(t,e,o);this.twistAngle=void 0!==o.twistAngle?o.twistAngle:0,p.maxForce=0,p.minForce=-a,c.maxForce=0,c.minForce=-a,this.equations.push(p,c)}a.prototype=new i,a.constructor=a;new r,new r;a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.coneEquation,n=this.twistEquation;i.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,o.axisA),e.vectorToWorldFrame(this.axisB,o.axisB),this.axisA.tangents(n.axisA,n.axisA),t.vectorToWorldFrame(n.axisA,n.axisA),this.axisB.tangents(n.axisB,n.axisB),e.vectorToWorldFrame(n.axisB,n.axisB),o.angle=this.angle,n.maxAngle=this.twistAngle}},{"../equations/ConeEquation":19,"../equations/ContactEquation":20,"../equations/RotationalEquation":23,"../math/Vec3":31,"./Constraint":14,"./PointToPointConstraint":18}],14:[function(t,e,o){e.exports=n;var i=t("../utils/Utils");function n(t,e,o){o=i.defaults(o,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=n.idCounter++,this.collideConnected=o.collideConnected,o.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},n.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},n.idCounter=0},{"../utils/Utils":54}],15:[function(t,e,o){e.exports=s;var i=t("./Constraint"),n=t("../equations/ContactEquation");function s(t,e,o,s){i.call(this,t,e),void 0===o&&(o=t.position.distanceTo(e.position)),void 0===s&&(s=1e6),this.distance=o;var r=this.distanceEquation=new n(t,e);this.equations.push(r),r.minForce=-s,r.maxForce=s}s.prototype=new i,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.distanceEquation,i=.5*this.distance,n=o.ni;e.position.vsub(t.position,n),n.normalize(),n.mult(i,o.ri),n.mult(-i,o.rj)}},{"../equations/ContactEquation":20,"./Constraint":14}],16:[function(t,e,o){e.exports=a;t("./Constraint");var i=t("./PointToPointConstraint"),n=t("../equations/RotationalEquation"),s=t("../equations/RotationalMotorEquation"),r=(t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,o){var a=void 0!==(o=o||{}).maxForce?o.maxForce:1e6,h=o.pivotA?o.pivotA.clone():new r,l=o.pivotB?o.pivotB.clone():new r;i.call(this,t,h,e,l,a),(this.axisA=o.axisA?o.axisA.clone():new r(1,0,0)).normalize(),(this.axisB=o.axisB?o.axisB.clone():new r(1,0,0)).normalize();var p=this.rotationalEquation1=new n(t,e,o),c=this.rotationalEquation2=new n(t,e,o),u=this.motorEquation=new s(t,e,a);u.enabled=!1,this.equations.push(p,c,u)}a.prototype=new i,a.constructor=a,a.prototype.enableMotor=function(){this.motorEquation.enabled=!0},a.prototype.disableMotor=function(){this.motorEquation.enabled=!1},a.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},a.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var h=new r,l=new r;a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.motorEquation,n=this.rotationalEquation1,s=this.rotationalEquation2,r=h,a=l,p=this.axisA,c=this.axisB;i.prototype.update.call(this),t.quaternion.vmult(p,r),e.quaternion.vmult(c,a),r.tangents(n.axisA,s.axisA),n.axisB.copy(a),s.axisB.copy(a),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,o.axisA),e.quaternion.vmult(this.axisB,o.axisB))}},{"../equations/ContactEquation":20,"../equations/RotationalEquation":23,"../equations/RotationalMotorEquation":24,"../math/Vec3":31,"./Constraint":14,"./PointToPointConstraint":18}],17:[function(t,e,o){e.exports=r;t("./Constraint");var i=t("./PointToPointConstraint"),n=t("../equations/RotationalEquation"),s=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function r(t,e,o){var r=void 0!==(o=o||{}).maxForce?o.maxForce:1e6,a=new s,h=new s,l=new s;t.position.vadd(e.position,l),l.scale(.5,l),e.pointToLocalFrame(l,h),t.pointToLocalFrame(l,a),i.call(this,t,a,e,h,r),this.xA=t.vectorToLocalFrame(s.UNIT_X),this.xB=e.vectorToLocalFrame(s.UNIT_X),this.yA=t.vectorToLocalFrame(s.UNIT_Y),this.yB=e.vectorToLocalFrame(s.UNIT_Y),this.zA=t.vectorToLocalFrame(s.UNIT_Z),this.zB=e.vectorToLocalFrame(s.UNIT_Z);var p=this.rotationalEquation1=new n(t,e,o),c=this.rotationalEquation2=new n(t,e,o),u=this.rotationalEquation3=new n(t,e,o);this.equations.push(p,c,u)}r.prototype=new i,r.constructor=r;new s,new s;r.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=(this.motorEquation,this.rotationalEquation1),n=this.rotationalEquation2,s=this.rotationalEquation3;i.prototype.update.call(this),t.vectorToWorldFrame(this.xA,o.axisA),e.vectorToWorldFrame(this.yB,o.axisB),t.vectorToWorldFrame(this.yA,n.axisA),e.vectorToWorldFrame(this.zB,n.axisB),t.vectorToWorldFrame(this.zA,s.axisA),e.vectorToWorldFrame(this.xB,s.axisB)}},{"../equations/ContactEquation":20,"../equations/RotationalEquation":23,"../equations/RotationalMotorEquation":24,"../math/Vec3":31,"./Constraint":14,"./PointToPointConstraint":18}],18:[function(t,e,o){e.exports=r;var i=t("./Constraint"),n=t("../equations/ContactEquation"),s=t("../math/Vec3");function r(t,e,o,r,a){i.call(this,t,o),a=void 0!==a?a:1e6,this.pivotA=e?e.clone():new s,this.pivotB=r?r.clone():new s;var h=this.equationX=new n(t,o),l=this.equationY=new n(t,o),p=this.equationZ=new n(t,o);this.equations.push(h,l,p),h.minForce=l.minForce=p.minForce=-a,h.maxForce=l.maxForce=p.maxForce=a,h.ni.set(1,0,0),l.ni.set(0,1,0),p.ni.set(0,0,1)}r.prototype=new i,r.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.equationX,i=this.equationY,n=this.equationZ;t.quaternion.vmult(this.pivotA,o.ri),e.quaternion.vmult(this.pivotB,o.rj),i.ri.copy(o.ri),i.rj.copy(o.rj),n.ri.copy(o.ri),n.rj.copy(o.rj)}},{"../equations/ContactEquation":20,"../math/Vec3":31,"./Constraint":14}],19:[function(t,e,o){e.exports=s;var i=t("../math/Vec3"),n=(t("../math/Mat3"),t("./Equation"));function s(t,e,o){var s=void 0!==(o=o||{}).maxForce?o.maxForce:1e6;n.call(this,t,e,-s,s),this.axisA=o.axisA?o.axisA.clone():new i(1,0,0),this.axisB=o.axisB?o.axisB.clone():new i(0,1,0),this.angle=void 0!==o.angle?o.angle:0}s.prototype=new n,s.prototype.constructor=s;var r=new i,a=new i;s.prototype.computeB=function(t){var e=this.a,o=this.b,i=this.axisA,n=this.axisB,s=r,h=a,l=this.jacobianElementA,p=this.jacobianElementB;return i.cross(n,s),n.cross(i,h),l.rotational.copy(h),p.rotational.copy(s),-(Math.cos(this.angle)-i.dot(n))*e-this.computeGW()*o-t*this.computeGiMf()}},{"../math/Mat3":28,"../math/Vec3":31,"./Equation":21}],20:[function(t,e,o){e.exports=s;var i=t("./Equation"),n=t("../math/Vec3");t("../math/Mat3");function s(t,e,o){o=void 0!==o?o:1e6,i.call(this,t,e,0,o),this.restitution=0,this.ri=new n,this.rj=new n,this.ni=new n}s.prototype=new i,s.prototype.constructor=s;var r=new n,a=new n,h=new n;s.prototype.computeB=function(t){var e=this.a,o=this.b,i=this.bi,n=this.bj,s=this.ri,l=this.rj,p=r,c=a,u=i.velocity,d=i.angularVelocity,v=(i.force,i.torque,n.velocity),y=n.angularVelocity,f=(n.force,n.torque,h),m=this.jacobianElementA,w=this.jacobianElementB,x=this.ni;s.cross(x,p),l.cross(x,c),x.negate(m.spatial),p.negate(m.rotational),w.spatial.copy(x),w.rotational.copy(c),f.copy(n.position),f.vadd(l,f),f.vsub(i.position,f),f.vsub(s,f);var g=x.dot(f),b=this.restitution+1;return-g*e-(b*v.dot(x)-b*u.dot(x)+y.dot(c)-d.dot(p))*o-t*this.computeGiMf()};var l=new n,p=new n,c=new n,u=new n,d=new n;s.prototype.getImpactVelocityAlongNormal=function(){var t=l,e=p,o=c,i=u,n=d;return this.bi.position.vadd(this.ri,o),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(o,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,n),this.ni.dot(n)}},{"../math/Mat3":28,"../math/Vec3":31,"./Equation":21}],21:[function(t,e,o){e.exports=s;var i=t("../math/JacobianElement"),n=t("../math/Vec3");function s(t,e,o,n){this.id=s.id++,this.minForce=void 0===o?-1e6:o,this.maxForce=void 0===n?1e6:n,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new i,this.jacobianElementB=new i,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}s.prototype.constructor=s,s.id=0,s.prototype.setSpookParams=function(t,e,o){var i=e,n=t,s=o;this.a=4/(s*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(s*s*n*(1+4*i))},s.prototype.computeB=function(t,e,o){var i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*o},s.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.position,s=i.position;return t.spatial.dot(n)+e.spatial.dot(s)};new n;s.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.velocity,s=i.velocity,r=o.angularVelocity,a=i.angularVelocity;return t.multiplyVectors(n,r)+e.multiplyVectors(s,a)},s.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.vlambda,s=i.vlambda,r=o.wlambda,a=i.wlambda;return t.multiplyVectors(n,r)+e.multiplyVectors(s,a)};var r=new n,a=new n,h=new n,l=new n;s.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.force,s=o.torque,p=i.force,c=i.torque,u=o.invMassSolve,d=i.invMassSolve;return n.scale(u,r),p.scale(d,a),o.invInertiaWorldSolve.vmult(s,h),i.invInertiaWorldSolve.vmult(c,l),t.multiplyVectors(r,h)+e.multiplyVectors(a,l)};var p=new n;s.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.invMassSolve,s=i.invMassSolve,r=o.invInertiaWorldSolve,a=i.invInertiaWorldSolve,h=n+s;return r.vmult(t.rotational,p),h+=p.dot(t.rotational),a.vmult(e.rotational,p),h+=p.dot(e.rotational)};var c=new n;new n,new n,new n,new n,new n;s.prototype.addToWlambda=function(t){var e=this.jacobianElementA,o=this.jacobianElementB,i=this.bi,n=this.bj,s=c;i.vlambda.addScaledVector(i.invMassSolve*t,e.spatial,i.vlambda),n.vlambda.addScaledVector(n.invMassSolve*t,o.spatial,n.vlambda),i.invInertiaWorldSolve.vmult(e.rotational,s),i.wlambda.addScaledVector(t,s,i.wlambda),n.invInertiaWorldSolve.vmult(o.rotational,s),n.wlambda.addScaledVector(t,s,n.wlambda)},s.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":27,"../math/Vec3":31}],22:[function(t,e,o){e.exports=s;var i=t("./Equation"),n=t("../math/Vec3");t("../math/Mat3");function s(t,e,o){i.call(this,t,e,-o,o),this.ri=new n,this.rj=new n,this.t=new n}s.prototype=new i,s.prototype.constructor=s;var r=new n,a=new n;s.prototype.computeB=function(t){this.a;var e=this.b,o=(this.bi,this.bj,this.ri),i=this.rj,n=r,s=a,h=this.t;o.cross(h,n),i.cross(h,s);var l=this.jacobianElementA,p=this.jacobianElementB;return h.negate(l.spatial),n.negate(l.rotational),p.spatial.copy(h),p.rotational.copy(s),-this.computeGW()*e-t*this.computeGiMf()}},{"../math/Mat3":28,"../math/Vec3":31,"./Equation":21}],23:[function(t,e,o){e.exports=s;var i=t("../math/Vec3"),n=(t("../math/Mat3"),t("./Equation"));function s(t,e,o){var s=void 0!==(o=o||{}).maxForce?o.maxForce:1e6;n.call(this,t,e,-s,s),this.axisA=o.axisA?o.axisA.clone():new i(1,0,0),this.axisB=o.axisB?o.axisB.clone():new i(0,1,0),this.maxAngle=Math.PI/2}s.prototype=new n,s.prototype.constructor=s;var r=new i,a=new i;s.prototype.computeB=function(t){var e=this.a,o=this.b,i=this.axisA,n=this.axisB,s=r,h=a,l=this.jacobianElementA,p=this.jacobianElementB;return i.cross(n,s),n.cross(i,h),l.rotational.copy(h),p.rotational.copy(s),-(Math.cos(this.maxAngle)-i.dot(n))*e-this.computeGW()*o-t*this.computeGiMf()}},{"../math/Mat3":28,"../math/Vec3":31,"./Equation":21}],24:[function(t,e,o){e.exports=s;var i=t("../math/Vec3"),n=(t("../math/Mat3"),t("./Equation"));function s(t,e,o){o=void 0!==o?o:1e6,n.call(this,t,e,-o,o),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}s.prototype=new n,s.prototype.constructor=s,s.prototype.computeB=function(t){this.a;var e=this.b,o=(this.bi,this.bj,this.axisA),i=this.axisB,n=this.jacobianElementA,s=this.jacobianElementB;return n.rotational.copy(o),i.negate(s.rotational),-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}},{"../math/Mat3":28,"../math/Vec3":31,"./Equation":21}],25:[function(t,e,o){var i=t("../utils/Utils");function n(t,e,o){o=i.defaults(o,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n.idCounter++,this.materials=[t,e],this.friction=o.friction,this.restitution=o.restitution,this.contactEquationStiffness=o.contactEquationStiffness,this.contactEquationRelaxation=o.contactEquationRelaxation,this.frictionEquationStiffness=o.frictionEquationStiffness,this.frictionEquationRelaxation=o.frictionEquationRelaxation}e.exports=n,n.idCounter=0},{"../utils/Utils":54}],26:[function(t,e,o){function i(t){var e="";"string"==typeof(t=t||{})?(e=t,t={}):"object"==typeof t&&(e=""),this.name=e,this.id=i.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}e.exports=i,i.idCounter=0},{}],27:[function(t,e,o){e.exports=n;var i=t("./Vec3");function n(){this.spatial=new i,this.rotational=new i}n.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},n.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{"./Vec3":31}],28:[function(t,e,o){e.exports=n;var i=t("./Vec3");function n(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}n.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},n.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},n.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},n.prototype.getTrace=function(t){t=t||new i;var e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},n.prototype.vmult=function(t,e){e=e||new i;var o=this.elements,n=t.x,s=t.y,r=t.z;return e.x=o[0]*n+o[1]*s+o[2]*r,e.y=o[3]*n+o[4]*s+o[5]*r,e.z=o[6]*n+o[7]*s+o[8]*r,e},n.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},n.prototype.mmult=function(t,e){for(var o=e||new n,i=0;i<3;i++)for(var s=0;s<3;s++){for(var r=0,a=0;a<3;a++)r+=t.elements[i+3*a]*this.elements[a+3*s];o.elements[i+3*s]=r}return o},n.prototype.scale=function(t,e){e=e||new n;for(var o=this.elements,i=e.elements,s=0;3!==s;s++)i[3*s+0]=t.x*o[3*s+0],i[3*s+1]=t.y*o[3*s+1],i[3*s+2]=t.z*o[3*s+2];return e},n.prototype.solve=function(t,e){e=e||new i;for(var o,n=[],s=0;s<12;s++)n.push(0);for(s=0;s<3;s++)for(o=0;o<3;o++)n[s+4*o]=this.elements[s+3*o];n[3]=t.x,n[7]=t.y,n[11]=t.z;var r,a,h=3,l=h;do{if(0===n[(s=l-h)+4*s])for(o=s+1;o<l;o++)if(0!==n[s+4*o]){r=4;do{n[(a=4-r)+4*s]+=n[a+4*o]}while(--r);break}if(0!==n[s+4*s])for(o=s+1;o<l;o++){var p=n[s+4*o]/n[s+4*s];r=4;do{n[(a=4-r)+4*o]=a<=s?0:n[a+4*o]-n[a+4*s]*p}while(--r)}}while(--h);if(e.z=n[11]/n[10],e.y=(n[7]-n[6]*e.z)/n[5],e.x=(n[3]-n[2]*e.z-n[1]*e.y)/n[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},n.prototype.e=function(t,e,o){if(void 0===o)return this.elements[e+3*t];this.elements[e+3*t]=o},n.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},n.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},n.prototype.reverse=function(t){t=t||new n;for(var e,o=[],i=0;i<18;i++)o.push(0);for(i=0;i<3;i++)for(e=0;e<3;e++)o[i+6*e]=this.elements[i+3*e];o[3]=1,o[9]=0,o[15]=0,o[4]=0,o[10]=1,o[16]=0,o[5]=0,o[11]=0,o[17]=1;var s,r,a=3,h=a;do{if(0===o[(i=h-a)+6*i])for(e=i+1;e<h;e++)if(0!==o[i+6*e]){s=6;do{o[(r=6-s)+6*i]+=o[r+6*e]}while(--s);break}if(0!==o[i+6*i])for(e=i+1;e<h;e++){var l=o[i+6*e]/o[i+6*i];s=6;do{o[(r=6-s)+6*e]=r<=i?0:o[r+6*e]-o[r+6*i]*l}while(--s)}}while(--a);i=2;do{e=i-1;do{l=o[i+6*e]/o[i+6*i];s=6;do{o[(r=6-s)+6*e]=o[r+6*e]-o[r+6*i]*l}while(--s)}while(e--)}while(--i);i=2;do{l=1/o[i+6*i];s=6;do{o[(r=6-s)+6*i]=o[r+6*i]*l}while(--s)}while(i--);i=2;do{e=2;do{if(r=o[3+e+6*i],isNaN(r)||r===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(i,e,r)}while(e--)}while(i--);return t},n.prototype.setRotationFromQuaternion=function(t){var e=t.x,o=t.y,i=t.z,n=t.w,s=e+e,r=o+o,a=i+i,h=e*s,l=e*r,p=e*a,c=o*r,u=o*a,d=i*a,v=n*s,y=n*r,f=n*a,m=this.elements;return m[0]=1-(c+d),m[1]=l-f,m[2]=p+y,m[3]=l+f,m[4]=1-(h+d),m[5]=u-v,m[6]=p-y,m[7]=u+v,m[8]=1-(h+c),this},n.prototype.transpose=function(t){for(var e=(t=t||new n).elements,o=this.elements,i=0;3!==i;i++)for(var s=0;3!==s;s++)e[3*i+s]=o[3*s+i];return t}},{"./Vec3":31}],29:[function(t,e,o){e.exports=n;var i=t("./Vec3");function n(t,e,o,i){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==o?o:0,this.w=void 0!==i?i:1}n.prototype.set=function(t,e,o,i){return this.x=t,this.y=e,this.z=o,this.w=i,this},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(t,e){var o=Math.sin(.5*e);return this.x=t.x*o,this.y=t.y*o,this.z=t.z*o,this.w=Math.cos(.5*e),this},n.prototype.toAxisAngle=function(t){t=t||new i,this.normalize();var e=2*Math.acos(this.w),o=Math.sqrt(1-this.w*this.w);return o<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/o,t.y=this.y/o,t.z=this.z/o),[t,e]};var s=new i,r=new i;n.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var o=s,i=r;t.tangents(o,i),this.setFromAxisAngle(o,Math.PI)}else{var n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}return this};new i,new i,new i;n.prototype.mult=function(t,e){e=e||new n;var o=this.x,i=this.y,s=this.z,r=this.w,a=t.x,h=t.y,l=t.z,p=t.w;return e.x=o*p+r*a+i*l-s*h,e.y=i*p+r*h+s*a-o*l,e.z=s*p+r*l+o*h-i*a,e.w=r*p-o*a-i*h-s*l,e},n.prototype.inverse=function(t){var e=this.x,o=this.y,i=this.z,s=this.w;t=t||new n,this.conjugate(t);var r=1/(e*e+o*o+i*i+s*s);return t.x*=r,t.y*=r,t.z*=r,t.w*=r,t},n.prototype.conjugate=function(t){return(t=t||new n).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},n.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},n.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},n.prototype.vmult=function(t,e){e=e||new i;var o=t.x,n=t.y,s=t.z,r=this.x,a=this.y,h=this.z,l=this.w,p=l*o+a*s-h*n,c=l*n+h*o-r*s,u=l*s+r*n-a*o,d=-r*o-a*n-h*s;return e.x=p*l+d*-r+c*-h-u*-a,e.y=c*l+d*-a+u*-r-p*-h,e.z=u*l+d*-h+p*-a-c*-r,e},n.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.prototype.toEuler=function(t,e){var o,i,n;e=e||"YZX";var s=this.x,r=this.y,a=this.z,h=this.w;switch(e){case"YZX":var l=s*r+a*h;if(l>.499&&(o=2*Math.atan2(s,h),i=Math.PI/2,n=0),l<-.499&&(o=-2*Math.atan2(s,h),i=-Math.PI/2,n=0),isNaN(o)){var p=s*s,c=r*r,u=a*a;o=Math.atan2(2*r*h-2*s*a,1-2*c-2*u),i=Math.asin(2*l),n=Math.atan2(2*s*h-2*r*a,1-2*p-2*u)}break;default:throw new Error("Euler order "+e+" not supported yet.")}t.y=o,t.z=i,t.x=n},n.prototype.setFromEuler=function(t,e,o,i){i=i||"XYZ";var n=Math.cos(t/2),s=Math.cos(e/2),r=Math.cos(o/2),a=Math.sin(t/2),h=Math.sin(e/2),l=Math.sin(o/2);return"XYZ"===i?(this.x=a*s*r+n*h*l,this.y=n*h*r-a*s*l,this.z=n*s*l+a*h*r,this.w=n*s*r-a*h*l):"YXZ"===i?(this.x=a*s*r+n*h*l,this.y=n*h*r-a*s*l,this.z=n*s*l-a*h*r,this.w=n*s*r+a*h*l):"ZXY"===i?(this.x=a*s*r-n*h*l,this.y=n*h*r+a*s*l,this.z=n*s*l+a*h*r,this.w=n*s*r-a*h*l):"ZYX"===i?(this.x=a*s*r-n*h*l,this.y=n*h*r+a*s*l,this.z=n*s*l-a*h*r,this.w=n*s*r+a*h*l):"YZX"===i?(this.x=a*s*r+n*h*l,this.y=n*h*r+a*s*l,this.z=n*s*l-a*h*r,this.w=n*s*r-a*h*l):"XZY"===i&&(this.x=a*s*r-n*h*l,this.y=n*h*r-a*s*l,this.z=n*s*l+a*h*r,this.w=n*s*r+a*h*l),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.slerp=function(t,e,o){o=o||new n;var i,s,r,a,h,l=this.x,p=this.y,c=this.z,u=this.w,d=t.x,v=t.y,y=t.z,f=t.w;return(s=l*d+p*v+c*y+u*f)<0&&(s=-s,d=-d,v=-v,y=-y,f=-f),1-s>1e-6?(i=Math.acos(s),r=Math.sin(i),a=Math.sin((1-e)*i)/r,h=Math.sin(e*i)/r):(a=1-e,h=e),o.x=a*l+h*d,o.y=a*p+h*v,o.z=a*c+h*y,o.w=a*u+h*f,o},n.prototype.integrate=function(t,e,o,i){i=i||new n;var s=t.x*o.x,r=t.y*o.y,a=t.z*o.z,h=this.x,l=this.y,p=this.z,c=this.w,u=.5*e;return i.x+=u*(s*c+r*p-a*l),i.y+=u*(r*c+a*h-s*p),i.z+=u*(a*c+s*l-r*h),i.w+=u*(-s*h-r*l-a*p),i}},{"./Vec3":31}],30:[function(t,e,o){var i=t("./Vec3"),n=t("./Quaternion");function s(t){t=t||{},this.position=new i,t.position&&this.position.copy(t.position),this.quaternion=new n,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=s;var r=new n;s.pointToLocalFrame=function(t,e,o,n){n=n||new i;return o.vsub(t,n),e.conjugate(r),r.vmult(n,n),n},s.prototype.pointToLocal=function(t,e){return s.pointToLocalFrame(this.position,this.quaternion,t,e)},s.pointToWorldFrame=function(t,e,o,n){n=n||new i;return e.vmult(o,n),n.vadd(t,n),n},s.prototype.pointToWorld=function(t,e){return s.pointToWorldFrame(this.position,this.quaternion,t,e)},s.prototype.vectorToWorldFrame=function(t,e){e=e||new i;return this.quaternion.vmult(t,e),e},s.vectorToWorldFrame=function(t,e,o){return t.vmult(e,o),o},s.vectorToLocalFrame=function(t,e,o,n){n=n||new i;return e.w*=-1,e.vmult(o,n),e.w*=-1,n}},{"./Quaternion":29,"./Vec3":31}],31:[function(t,e,o){e.exports=n;var i=t("./Mat3");function n(t,e,o){this.x=t||0,this.y=e||0,this.z=o||0}n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1),n.prototype.cross=function(t,e){var o=t.x,i=t.y,s=t.z,r=this.x,a=this.y,h=this.z;return(e=e||new n).x=a*s-h*i,e.y=h*o-r*s,e.z=r*i-a*o,e},n.prototype.set=function(t,e,o){return this.x=t,this.y=e,this.z=o,this},n.prototype.setZero=function(){this.x=this.y=this.z=0},n.prototype.vadd=function(t,e){if(!e)return new n(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},n.prototype.vsub=function(t,e){if(!e)return new n(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},n.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},n.prototype.normalize=function(){var t=this.x,e=this.y,o=this.z,i=Math.sqrt(t*t+e*e+o*o);if(i>0){var n=1/i;this.x*=n,this.y*=n,this.z*=n}else this.x=0,this.y=0,this.z=0;return i},n.prototype.unit=function(t){t=t||new n;var e=this.x,o=this.y,i=this.z,s=Math.sqrt(e*e+o*o+i*i);return s>0?(s=1/s,t.x=e*s,t.y=o*s,t.z=i*s):(t.x=1,t.y=0,t.z=0),t},n.prototype.norm=function(){var t=this.x,e=this.y,o=this.z;return Math.sqrt(t*t+e*e+o*o)},n.prototype.length=n.prototype.norm,n.prototype.norm2=function(){return this.dot(this)},n.prototype.lengthSquared=n.prototype.norm2,n.prototype.distanceTo=function(t){var e=this.x,o=this.y,i=this.z,n=t.x,s=t.y,r=t.z;return Math.sqrt((n-e)*(n-e)+(s-o)*(s-o)+(r-i)*(r-i))},n.prototype.distanceSquared=function(t){var e=this.x,o=this.y,i=this.z,n=t.x,s=t.y,r=t.z;return(n-e)*(n-e)+(s-o)*(s-o)+(r-i)*(r-i)},n.prototype.mult=function(t,e){e=e||new n;var o=this.x,i=this.y,s=this.z;return e.x=t*o,e.y=t*i,e.z=t*s,e},n.prototype.vmul=function(t,e){return(e=e||new n).x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e},n.prototype.scale=n.prototype.mult,n.prototype.addScaledVector=function(t,e,o){return(o=o||new n).x=this.x+t*e.x,o.y=this.y+t*e.y,o.z=this.z+t*e.z,o},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.negate=function(t){return(t=t||new n).x=-this.x,t.y=-this.y,t.z=-this.z,t};var s=new n,r=new n;n.prototype.tangents=function(t,e){var o=this.norm();if(o>0){var i=s,n=1/o;i.set(this.x*n,this.y*n,this.z*n);var a=r;Math.abs(i.x)<.9?(a.set(1,0,0),i.cross(a,t)):(a.set(0,1,0),i.cross(a,t)),i.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)},n.prototype.toString=function(){return this.x+","+this.y+","+this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.prototype.lerp=function(t,e,o){var i=this.x,n=this.y,s=this.z;o.x=i+(t.x-i)*e,o.y=n+(t.y-n)*e,o.z=s+(t.z-s)*e},n.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},n.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var a=new n;n.prototype.isAntiparallelTo=function(t,e){return this.negate(a),a.almostEquals(t,e)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)}},{"./Mat3":28}],32:[function(t,e,o){e.exports=l;var i=t("../utils/EventTarget"),n=(t("../shapes/Shape"),t("../math/Vec3")),s=t("../math/Mat3"),r=t("../math/Quaternion"),a=(t("../material/Material"),t("../collision/AABB")),h=t("../shapes/Box");function l(t){t=t||{},i.apply(this),this.id=l.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new n,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionResponse=!0,this.position=new n,this.previousPosition=new n,this.interpolatedPosition=new n,this.initPosition=new n,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new n,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new n,this.force=new n;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?l.STATIC:l.DYNAMIC,typeof t.type==typeof l.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new n,this.quaternion=new r,this.initQuaternion=new r,this.previousQuaternion=new r,this.interpolatedQuaternion=new r,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new n,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new n,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new n,this.invInertia=new n,this.invInertiaWorld=new s,this.invMassSolve=0,this.invInertiaSolve=new n,this.invInertiaWorldSolve=new s,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.linearFactor=new n(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new n(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new a,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new n,t.shape&&this.addShape(t.shape),this.updateMassProperties()}l.prototype=new i,l.prototype.constructor=l,l.COLLIDE_EVENT_NAME="collide",l.DYNAMIC=1,l.STATIC=2,l.KINEMATIC=4,l.AWAKE=0,l.SLEEPY=1,l.SLEEPING=2,l.idCounter=0,l.wakeupEvent={type:"wakeup"},l.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,this._wakeUpAfterNarrowphase=!1,t===l.SLEEPING&&this.dispatchEvent(l.wakeupEvent)},l.prototype.sleep=function(){this.sleepState=l.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this._wakeUpAfterNarrowphase=!1},l.sleepyEvent={type:"sleepy"},l.sleepEvent={type:"sleep"},l.prototype.sleepTick=function(t){if(this.allowSleep){var e=this.sleepState,o=this.velocity.norm2()+this.angularVelocity.norm2(),i=Math.pow(this.sleepSpeedLimit,2);e===l.AWAKE&&o<i?(this.sleepState=l.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(l.sleepyEvent)):e===l.SLEEPY&&o>i?this.wakeUp():e===l.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(l.sleepEvent))}},l.prototype.updateSolveMassProperties=function(){this.sleepState===l.SLEEPING||this.type===l.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},l.prototype.pointToLocalFrame=function(t,e){e=e||new n;return t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},l.prototype.vectorToLocalFrame=function(t,e){e=e||new n;return this.quaternion.conjugate().vmult(t,e),e},l.prototype.pointToWorldFrame=function(t,e){e=e||new n;return this.quaternion.vmult(t,e),e.vadd(this.position,e),e},l.prototype.vectorToWorldFrame=function(t,e){e=e||new n;return this.quaternion.vmult(t,e),e};var p=new n,c=new r;l.prototype.addShape=function(t,e,o){var i=new n,s=new r;return e&&i.copy(e),o&&s.copy(o),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this},l.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,o=t.length,i=0,n=0;n!==o;n++){var s=t[n];s.updateBoundingSphereRadius();var r=e[n].norm(),a=s.boundingSphereRadius;r+a>i&&(i=r+a)}this.boundingRadius=i};var u=new a;l.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,o=this.shapeOrientations,i=t.length,n=p,s=c,r=this.quaternion,a=this.aabb,h=u,l=0;l!==i;l++){var d=t[l];r.vmult(e[l],n),n.vadd(this.position,n),o[l].mult(r,s),d.calculateWorldAABB(n,s,h.lowerBound,h.upperBound),0===l?a.copy(h):a.extend(h)}this.aabbNeedsUpdate=!1};var d=new s,v=new s;new s;l.prototype.updateInertiaWorld=function(t){var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var o=d,i=v;o.setRotationFromQuaternion(this.quaternion),o.transpose(i),o.scale(e,o),o.mmult(i,this.invInertiaWorld)}else;};new n;var y=new n;l.prototype.applyForce=function(t,e){if(this.type===l.DYNAMIC){var o=y;e.cross(t,o),this.force.vadd(t,this.force),this.torque.vadd(o,this.torque)}};var f=new n,m=new n;l.prototype.applyLocalForce=function(t,e){if(this.type===l.DYNAMIC){var o=f,i=m;this.vectorToWorldFrame(t,o),this.vectorToWorldFrame(e,i),this.applyForce(o,i)}};new n;var w=new n,x=new n;l.prototype.applyImpulse=function(t,e){if(this.type===l.DYNAMIC){var o=e,i=w;i.copy(t),i.mult(this.invMass,i),this.velocity.vadd(i,this.velocity);var n=x;o.cross(t,n),this.invInertiaWorld.vmult(n,n),this.angularVelocity.vadd(n,this.angularVelocity)}};var g=new n,b=new n;l.prototype.applyLocalImpulse=function(t,e){if(this.type===l.DYNAMIC){var o=g,i=b;this.vectorToWorldFrame(t,o),this.vectorToWorldFrame(e,i),this.applyImpulse(o,i)}};var B=new n;l.prototype.updateMassProperties=function(){var t=B;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,o=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),h.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!o?1/e.x:0,e.y>0&&!o?1/e.y:0,e.z>0&&!o?1/e.z:0),this.updateInertiaWorld(!0)},l.prototype.getVelocityAtWorldPoint=function(t,e){var o=new n;return t.vsub(this.position,o),this.angularVelocity.cross(o,e),this.velocity.vadd(e,e),e};new n,new n,new r,new r;l.prototype.integrate=function(t,e,o){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===l.DYNAMIC||this.type===l.KINEMATIC)&&this.sleepState!==l.SLEEPING){var i=this.velocity,n=this.angularVelocity,s=this.position,r=this.force,a=this.torque,h=this.quaternion,p=this.invMass,c=this.invInertiaWorld,u=this.linearFactor,d=p*t;i.x+=r.x*d*u.x,i.y+=r.y*d*u.y,i.z+=r.z*d*u.z;var v=c.elements,y=this.angularFactor,f=a.x*y.x,m=a.y*y.y,w=a.z*y.z;n.x+=t*(v[0]*f+v[1]*m+v[2]*w),n.y+=t*(v[3]*f+v[4]*m+v[5]*w),n.z+=t*(v[6]*f+v[7]*m+v[8]*w),s.x+=i.x*t,s.y+=i.y*t,s.z+=i.z*t,h.integrate(this.angularVelocity,t,this.angularFactor,h),e&&(o?h.normalizeFast():h.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}},{"../collision/AABB":3,"../material/Material":26,"../math/Mat3":28,"../math/Quaternion":29,"../math/Vec3":31,"../shapes/Box":38,"../shapes/Shape":44,"../utils/EventTarget":50}],33:[function(t,e,o){t("./Body");var i=t("../math/Vec3"),n=t("../math/Quaternion"),s=(t("../collision/RaycastResult"),t("../collision/Ray")),r=t("../objects/WheelInfo");function a(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=a;new i,new i,new i;var h=new i,l=new i,p=new i;new s;a.prototype.addWheel=function(t){var e=new r(t=t||{}),o=this.wheelInfos.length;return this.wheelInfos.push(e),o},a.prototype.setSteeringValue=function(t,e){this.wheelInfos[e].steering=t};new i;a.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},a.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},a.prototype.addToWorld=function(t){this.constraints;t.addBody(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},a.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},a.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,o=e.length,n=this.chassisBody,s=0;s<o;s++)this.updateWheelTransform(s);this.currentVehicleSpeedKmHour=3.6*n.velocity.norm();var r=new i;this.getVehicleAxisWorld(this.indexForwardAxis,r),r.dot(n.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(s=0;s<o;s++)this.castRay(e[s]);this.updateSuspension(t);var a=new i,h=new i;for(s=0;s<o;s++){var l=(d=e[s]).suspensionForce;l>d.maxSuspensionForce&&(l=d.maxSuspensionForce),d.raycastResult.hitNormalWorld.scale(l*t,a),d.raycastResult.hitPointWorld.vsub(n.position,h),n.applyImpulse(a,h)}this.updateFriction(t);var p=new i,c=new i,u=new i;for(s=0;s<o;s++){var d=e[s];n.getVelocityAtWorldPoint(d.chassisConnectionPointWorld,u);var v=1;switch(this.indexUpAxis){case 1:v=-1}if(d.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,c);var y=c.dot(d.raycastResult.hitNormalWorld);d.raycastResult.hitNormalWorld.scale(y,p),c.vsub(p,c);var f=c.dot(u);d.deltaRotation=v*f*t/d.radius}!d.sliding&&d.isInContact||0===d.engineForce||!d.useCustomSlidingRotationalSpeed||(d.deltaRotation=(d.engineForce>0?1:-1)*d.customSlidingRotationalSpeed*t),Math.abs(d.brake)>Math.abs(d.engineForce)&&(d.deltaRotation=0),d.rotation+=d.deltaRotation,d.deltaRotation*=.99}},a.prototype.updateSuspension=function(t){for(var e=this.chassisBody.mass,o=this.wheelInfos,i=o.length,n=0;n<i;n++){var s=o[n];if(s.isInContact){var r,a=s.suspensionRestLength-s.suspensionLength;r=s.suspensionStiffness*a*s.clippedInvContactDotSuspension;var h=s.suspensionRelativeVelocity;r-=(h<0?s.dampingCompression:s.dampingRelaxation)*h,s.suspensionForce=r*e,s.suspensionForce<0&&(s.suspensionForce=0)}else s.suspensionForce=0}},a.prototype.removeFromWorld=function(t){this.constraints;t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var c=new i,u=new i;a.prototype.castRay=function(t){var e=c,o=u;this.updateWheelTransformWorld(t);var n=this.chassisBody,s=-1,r=t.suspensionRestLength+t.radius;t.directionWorld.scale(r,e);var a=t.chassisConnectionPointWorld;a.vadd(e,o);var h=t.raycastResult;h.reset();var l=n.collisionResponse;n.collisionResponse=!1,this.world.rayTest(a,o,h),n.collisionResponse=l;var p=h.body;if(t.raycastResult.groundObject=0,p){s=h.distance,t.raycastResult.hitNormalWorld=h.hitNormalWorld,t.isInContact=!0;var d=h.distance;t.suspensionLength=d-t.radius;var v=t.suspensionRestLength-t.maxSuspensionTravel,y=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<v&&(t.suspensionLength=v),t.suspensionLength>y&&(t.suspensionLength=y,t.raycastResult.reset());var f=t.raycastResult.hitNormalWorld.dot(t.directionWorld),m=new i;n.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,m);var w=t.raycastResult.hitNormalWorld.dot(m);if(f>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var x=-1/f;t.suspensionRelativeVelocity=w*x,t.clippedInvContactDotSuspension=x}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return s},a.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},a.prototype.updateWheelTransform=function(t){var e=h,o=l,i=p,s=this.wheelInfos[t];this.updateWheelTransformWorld(s),s.directionLocal.scale(-1,e),o.copy(s.axleLocal),e.cross(o,i),i.normalize(),o.normalize();var r=s.steering,a=new n;a.setFromAxisAngle(e,r);var c=new n;c.setFromAxisAngle(o,s.rotation);var u=s.worldTransform.quaternion;this.chassisBody.quaternion.mult(a,u),u.mult(c,u),u.normalize();var d=s.worldTransform.position;d.copy(s.directionWorld),d.scale(s.suspensionLength,d),d.vadd(s.chassisConnectionPointWorld,d)};var d=[new i(1,0,0),new i(0,1,0),new i(0,0,1)];a.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var v=new i,y=[],f=[];a.prototype.updateFriction=function(t){for(var e=v,o=this.wheelInfos,n=o.length,s=this.chassisBody,r=f,a=y,h=0;h<n;h++){(u=(z=o[h]).raycastResult.body)&&0,z.sideImpulse=0,z.forwardImpulse=0,r[h]||(r[h]=new i),a[h]||(a[h]=new i)}for(h=0;h<n;h++){if(u=(z=o[h]).raycastResult.body){var l=a[h];this.getWheelTransformWorld(h).vectorToWorldFrame(d[this.indexRightAxis],l);var p=z.raycastResult.hitNormalWorld,c=l.dot(p);p.scale(c,e),l.vsub(e,l),l.normalize(),p.cross(l,r[h]),r[h].normalize(),z.sideImpulse=q(s,z.raycastResult.hitPointWorld,u,z.raycastResult.hitPointWorld,l),z.sideImpulse*=1}}this.sliding=!1;for(h=0;h<n;h++){var u=(z=o[h]).raycastResult.body,m=0;if(z.slipInfo=1,u){var w=z.brake?z.brake:0;m=g(s,u,z.raycastResult.hitPointWorld,r[h],w);var x=w/(m+=z.engineForce*t);z.slipInfo*=x}if(z.forwardImpulse=0,z.skidInfo=1,u){z.skidInfo=1;var b=z.suspensionForce*t*z.frictionSlip,B=b*b;z.forwardImpulse=m;var A=.5*z.forwardImpulse,E=1*z.sideImpulse,S=A*A+E*E;if(z.sliding=!1,S>B){this.sliding=!0,z.sliding=!0;x=b/Math.sqrt(S);z.skidInfo*=x}}}if(this.sliding)for(h=0;h<n;h++){0!==(z=o[h]).sideImpulse&&z.skidInfo<1&&(z.forwardImpulse*=z.skidInfo,z.sideImpulse*=z.skidInfo)}for(h=0;h<n;h++){var z=o[h],M=new i;if(z.raycastResult.hitPointWorld.vsub(s.position,M),0!==z.forwardImpulse){var C=new i;r[h].scale(z.forwardImpulse,C),s.applyImpulse(C,M)}if(0!==z.sideImpulse){u=z.raycastResult.body;var F=new i;z.raycastResult.hitPointWorld.vsub(u.position,F);var R=new i;a[h].scale(z.sideImpulse,R),s.vectorToLocalFrame(M,M),M["xyz"[this.indexUpAxis]]*=z.rollInfluence,s.vectorToWorldFrame(M,M),s.applyImpulse(R,M),R.scale(-1,R),u.applyImpulse(R,F)}}};var m=new i,w=new i,x=new i;function g(t,e,o,i,n){var s=0,r=o,a=m,h=w,l=x;t.getVelocityAtWorldPoint(r,a),e.getVelocityAtWorldPoint(r,h),a.vsub(h,l);return n<(s=-i.dot(l)*(1/(S(t,o,i)+S(e,o,i))))&&(s=n),s<-n&&(s=-n),s}var b=new i,B=new i,A=new i,E=new i;function S(t,e,o){var i=b,n=B,s=A,r=E;return e.vsub(t.position,i),i.cross(o,n),t.invInertiaWorld.vmult(n,r),r.cross(i,s),t.invMass+o.dot(s)}var z=new i,M=new i,C=new i;function q(t,e,o,i,n,s){if(n.norm2()>1.1)return 0;var r=z,a=M,h=C;t.getVelocityAtWorldPoint(e,r),o.getVelocityAtWorldPoint(i,a),r.vsub(a,h);return-.2*n.dot(h)*(1/(t.invMass+o.invMass))}},{"../collision/Ray":10,"../collision/RaycastResult":11,"../math/Quaternion":29,"../math/Vec3":31,"../objects/WheelInfo":37,"./Body":32}],34:[function(t,e,o){var i=t("./Body"),n=t("../shapes/Sphere"),s=t("../shapes/Box"),r=t("../math/Vec3"),a=t("../constraints/HingeConstraint");function h(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new r(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var e=new s(new r(5,2,.5));this.chassisBody=new i(1,e)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}e.exports=h,h.prototype.addWheel=function(t){var e=(t=t||{}).body;e||(e=new i(1,new n(1.2))),this.wheelBodies.push(e),this.wheelForces.push(0);new r;var o=void 0!==t.position?t.position.clone():new r,s=new r;this.chassisBody.pointToWorldFrame(o,s),e.position.set(s.x,s.y,s.z);var h=void 0!==t.axis?t.axis.clone():new r(0,1,0);this.wheelAxes.push(h);var l=new a(this.chassisBody,e,{pivotA:o,axisA:h,pivotB:r.ZERO,axisB:h,collideConnected:!1});return this.constraints.push(l),this.wheelBodies.length-1},h.prototype.setSteeringValue=function(t,e){var o=this.wheelAxes[e],i=Math.cos(t),n=Math.sin(t),s=o.x,r=o.y;this.constraints[e].axisA.set(i*s-n*r,n*s+i*r,0)},h.prototype.setMotorSpeed=function(t,e){var o=this.constraints[e];o.enableMotor(),o.motorTargetVelocity=t},h.prototype.disableMotor=function(t){this.constraints[t].disableMotor()};var l=new r;h.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},h.prototype.applyWheelForce=function(t,e){var o=this.wheelAxes[e],i=this.wheelBodies[e],n=i.torque;o.scale(t,l),i.vectorToWorldFrame(l,l),n.vadd(l,n)},h.prototype.addToWorld=function(t){for(var e=this.constraints,o=this.wheelBodies.concat([this.chassisBody]),i=0;i<o.length;i++)t.addBody(o[i]);for(i=0;i<e.length;i++)t.addConstraint(e[i]);t.addEventListener("preStep",this._update.bind(this))},h.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},h.prototype.removeFromWorld=function(t){for(var e=this.constraints,o=this.wheelBodies.concat([this.chassisBody]),i=0;i<o.length;i++)t.remove(o[i]);for(i=0;i<e.length;i++)t.removeConstraint(e[i])};var p=new r;h.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],o=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(e,p),o.dot(p)}},{"../constraints/HingeConstraint":16,"../math/Vec3":31,"../shapes/Box":38,"../shapes/Sphere":45,"./Body":32}],35:[function(t,e,o){e.exports=n;t("../shapes/Shape");var i=t("../math/Vec3");t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material");function n(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}n.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},n.prototype.remove=function(t){var e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var s=new i;n.prototype.getNeighbors=function(t,e){for(var o=this.particles.length,i=t.id,n=this.smoothingRadius*this.smoothingRadius,r=s,a=0;a!==o;a++){var h=this.particles[a];h.position.vsub(t.position,r),i!==h.id&&r.norm2()<n&&e.push(h)}};var r=new i,a=new i,h=new i,l=new i,p=new i,c=new i;n.prototype.update=function(){for(var t=this.particles.length,e=r,o=this.speedOfSound,i=this.eps,n=0;n!==t;n++){var s=this.particles[n];(S=this.neighbors[n]).length=0,this.getNeighbors(s,S),S.push(this.particles[n]);for(var u=S.length,d=0,v=0;v!==u;v++){s.position.vsub(S[v].position,e);var y=e.norm(),f=this.w(y);d+=S[v].mass*f}this.densities[n]=d,this.pressures[n]=o*o*(this.densities[n]-this.density)}var m=a,w=h,x=l,g=p,b=c;for(n=0;n!==t;n++){var B,A,E=this.particles[n];m.set(0,0,0),w.set(0,0,0);var S;for(u=(S=this.neighbors[n]).length,v=0;v!==u;v++){var z=S[v];E.position.vsub(z.position,g);var M=g.norm();B=-z.mass*(this.pressures[n]/(this.densities[n]*this.densities[n]+i)+this.pressures[v]/(this.densities[v]*this.densities[v]+i)),this.gradw(g,x),x.mult(B,x),m.vadd(x,m),z.velocity.vsub(E.velocity,b),b.mult(1/(1e-4+this.densities[n]*this.densities[v])*this.viscosity*z.mass,b),A=this.nablaw(M),b.mult(A,b),w.vadd(b,w)}w.mult(E.mass,w),m.mult(E.mass,m),E.force.vadd(w,E.force),E.force.vadd(m,E.force)}},n.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},n.prototype.gradw=function(t,e){var o=t.norm(),i=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(i,9))*Math.pow(i*i-o*o,2),e)},n.prototype.nablaw=function(t){var e=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e)}},{"../material/Material":26,"../math/Quaternion":29,"../math/Vec3":31,"../objects/Body":32,"../shapes/Particle":42,"../shapes/Shape":44}],36:[function(t,e,o){var i=t("../math/Vec3");function n(t,e,o){o=o||{},this.restLength="number"==typeof o.restLength?o.restLength:1,this.stiffness=o.stiffness||100,this.damping=o.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new i,this.localAnchorB=new i,o.localAnchorA&&this.localAnchorA.copy(o.localAnchorA),o.localAnchorB&&this.localAnchorB.copy(o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB)}e.exports=n,n.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},n.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},n.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},n.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var s=new i,r=new i,a=new i,h=new i,l=new i,p=new i,c=new i,u=new i,d=new i,v=new i,y=new i;n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restLength,i=this.bodyA,n=this.bodyB,f=s,m=r,w=a,x=h,g=y,b=l,B=p,A=c,E=u,S=d,z=v;this.getWorldAnchorA(b),this.getWorldAnchorB(B),b.vsub(i.position,A),B.vsub(n.position,E),B.vsub(b,f);var M=f.norm();m.copy(f),m.normalize(),n.velocity.vsub(i.velocity,w),n.angularVelocity.cross(E,g),w.vadd(g,w),i.angularVelocity.cross(A,g),w.vsub(g,w),m.mult(-t*(M-o)-e*w.dot(m),x),i.force.vsub(x,i.force),n.force.vadd(x,n.force),A.cross(x,S),E.cross(x,z),i.torque.vsub(S,i.torque),n.torque.vadd(z,n.torque)}},{"../math/Vec3":31}],37:[function(t,e,o){var i=t("../math/Vec3"),n=t("../math/Transform"),s=t("../collision/RaycastResult"),r=t("../utils/Utils");function a(t){t=r.defaults(t,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new s,this.worldTransform=new n,this.isInContact=!1}e.exports=a;var h=new i,l=new i;h=new i;a.prototype.updateWheel=function(t){var e=this.raycastResult;if(this.isInContact){var o=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,l),t.getVelocityAtWorldPoint(l,h);var i=e.hitNormalWorld.dot(h);if(o>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var n=-1/o;this.suspensionRelativeVelocity=i*n,this.clippedInvContactDotSuspension=n}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":11,"../math/Transform":30,"../math/Vec3":31,"../utils/Utils":54}],38:[function(t,e,o){e.exports=r;var i=t("./Shape"),n=t("../math/Vec3"),s=t("./ConvexPolyhedron");function r(t){i.call(this,{type:i.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}r.prototype=new i,r.prototype.constructor=r,r.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,o=this.halfExtents.z,i=n,r=[new i(-t,-e,-o),new i(t,-e,-o),new i(t,e,-o),new i(-t,e,-o),new i(-t,-e,o),new i(t,-e,o),new i(t,e,o),new i(-t,e,o)],a=(new i(0,0,1),new i(0,1,0),new i(1,0,0),new s(r,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=a,a.material=this.material},r.prototype.calculateLocalInertia=function(t,e){return e=e||new n,r.calculateInertia(this.halfExtents,t,e),e},r.calculateInertia=function(t,e,o){var i=t;o.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),o.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),o.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)},r.prototype.getSideNormals=function(t,e){var o=t,i=this.halfExtents;if(o[0].set(i.x,0,0),o[1].set(0,i.y,0),o[2].set(0,0,i.z),o[3].set(-i.x,0,0),o[4].set(0,-i.y,0),o[5].set(0,0,-i.z),void 0!==e)for(var n=0;n!==o.length;n++)e.vmult(o[n],o[n]);return o},r.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},r.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new n;new n;r.prototype.forEachWorldCorner=function(t,e,o){for(var i=this.halfExtents,n=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],s=0;s<n.length;s++)a.set(n[s][0],n[s][1],n[s][2]),e.vmult(a,a),t.vadd(a,a),o(a.x,a.y,a.z)};var h=[new n,new n,new n,new n,new n,new n,new n,new n];r.prototype.calculateWorldAABB=function(t,e,o,i){var n=this.halfExtents;h[0].set(n.x,n.y,n.z),h[1].set(-n.x,n.y,n.z),h[2].set(-n.x,-n.y,n.z),h[3].set(-n.x,-n.y,-n.z),h[4].set(n.x,-n.y,-n.z),h[5].set(n.x,n.y,-n.z),h[6].set(-n.x,n.y,-n.z),h[7].set(n.x,-n.y,n.z);var s=h[0];e.vmult(s,s),t.vadd(s,s),i.copy(s),o.copy(s);for(var r=1;r<8;r++){s=h[r];e.vmult(s,s),t.vadd(s,s);var a=s.x,l=s.y,p=s.z;a>i.x&&(i.x=a),l>i.y&&(i.y=l),p>i.z&&(i.z=p),a<o.x&&(o.x=a),l<o.y&&(o.y=l),p<o.z&&(o.z=p)}}},{"../math/Vec3":31,"./ConvexPolyhedron":39,"./Shape":44}],39:[function(t,e,o){e.exports=r;var i=t("./Shape"),n=t("../math/Vec3"),s=(t("../math/Quaternion"),t("../math/Transform"));function r(t,e,o){i.call(this,{type:i.types.CONVEXPOLYHEDRON}),this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=o?o.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}r.prototype=new i,r.prototype.constructor=r;var a=new n;r.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,o=(e.length,this.uniqueEdges);o.length=0;for(var i=a,n=0;n!==t.length;n++)for(var s=t[n],r=s.length,h=0;h!==r;h++){var l=(h+1)%r;e[s[h]].vsub(e[s[l]],i),i.normalize();for(var p=!1,c=0;c!==o.length;c++)if(o[c].almostEquals(i)||o[c].almostEquals(i)){p=!0;break}p||o.push(i.clone())}},r.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var o=this.faceNormals[t]||new n;this.getFaceNormal(t,o),o.negate(o),this.faceNormals[t]=o;var s=this.vertices[this.faces[t][0]];if(o.dot(s)<0&&i.printLog){console.error(".faceNormals["+t+"] = Vec3("+o.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}}};var h=new n,l=new n;r.computeNormal=function(t,e,o,i){e.vsub(t,l),o.vsub(e,h),h.cross(l,i),i.isZero()||i.normalize()},r.prototype.getFaceNormal=function(t,e){var o=this.faces[t],i=this.vertices[o[0]],n=this.vertices[o[1]],s=this.vertices[o[2]];return r.computeNormal(i,n,s,e)};var p=new n;r.prototype.clipAgainstHull=function(t,e,o,i,s,r,a,h,l){for(var c=p,u=-1,d=-Number.MAX_VALUE,v=0;v<o.faces.length;v++){c.copy(o.faceNormals[v]),s.vmult(c,c);var y=c.dot(r);y>d&&(d=y,u=v)}for(var f=[],m=o.faces[u],w=m.length,x=0;x<w;x++){var g=o.vertices[m[x]],b=new n;b.copy(g),s.vmult(b,b),i.vadd(b,b),f.push(b)}u>=0&&this.clipFaceAgainstHull(r,t,e,f,a,h,l)};var c=new n,u=new n,d=new n,v=new n,y=new n,f=new n;r.prototype.findSeparatingAxis=function(t,e,o,i,n,s,r,a){var h=c,l=u,p=d,m=v,w=y,x=f,g=Number.MAX_VALUE;if(this.uniqueAxes)for(B=0;B!==this.uniqueAxes.length;B++){if(o.vmult(this.uniqueAxes[B],h),!1===(S=this.testSepAxis(h,t,e,o,i,n)))return!1;S<g&&(g=S,s.copy(h))}else for(var b=r?r.length:this.faces.length,B=0;B<b;B++){var A=r?r[B]:B;if(h.copy(this.faceNormals[A]),o.vmult(h,h),!1===(S=this.testSepAxis(h,t,e,o,i,n)))return!1;S<g&&(g=S,s.copy(h))}if(t.uniqueAxes)for(B=0;B!==t.uniqueAxes.length;B++){if(n.vmult(t.uniqueAxes[B],l),0,!1===(S=this.testSepAxis(l,t,e,o,i,n)))return!1;S<g&&(g=S,s.copy(l))}else for(var E=a?a.length:t.faces.length,B=0;B<E;B++){var S;A=a?a[B]:B;if(l.copy(t.faceNormals[A]),n.vmult(l,l),0,!1===(S=this.testSepAxis(l,t,e,o,i,n)))return!1;S<g&&(g=S,s.copy(l))}for(var z=0;z!==this.uniqueEdges.length;z++){o.vmult(this.uniqueEdges[z],m);for(var M=0;M!==t.uniqueEdges.length;M++)if(n.vmult(t.uniqueEdges[M],w),m.cross(w,x),!x.almostZero()){x.normalize();var C=this.testSepAxis(x,t,e,o,i,n);if(!1===C)return!1;C<g&&(g=C,s.copy(x))}}return i.vsub(e,p),p.dot(s)>0&&s.negate(s),!0};var m=[],w=[];r.prototype.testSepAxis=function(t,e,o,i,n,s){r.project(this,t,o,i,m),r.project(e,t,n,s,w);var a=m[0],h=m[1],l=w[0],p=w[1];if(a<p||l<h)return!1;var c=a-p,u=l-h;return c<u?c:u};var x=new n,g=new n;r.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(x,g);var o=g.x-x.x,i=g.y-x.y,n=g.z-x.z;e.x=1/12*t*(2*i*2*i+2*n*2*n),e.y=1/12*t*(2*o*2*o+2*n*2*n),e.z=1/12*t*(2*i*2*i+2*o*2*o)},r.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],o=this.faceNormals[t],i=this.vertices[e[0]];return-o.dot(i)};var b=new n,B=new n,A=new n,E=new n,S=new n,z=new n,M=new n,C=new n;r.prototype.clipFaceAgainstHull=function(t,e,o,i,n,s,r){for(var a=b,h=B,l=A,p=E,c=S,u=z,d=M,v=C,y=i,f=[],m=-1,w=Number.MAX_VALUE,x=0;x<this.faces.length;x++){a.copy(this.faceNormals[x]),o.vmult(a,a);var g=a.dot(t);g<w&&(w=g,m=x)}if(!(m<0)){var q=this.faces[m];q.connectedFaces=[];for(var F=0;F<this.faces.length;F++)for(var R=0;R<this.faces[F].length;R++)-1!==q.indexOf(this.faces[F][R])&&F!==m&&-1===q.connectedFaces.indexOf(F)&&q.connectedFaces.push(F);y.length;for(var P=q.length,T=0;T<P;T++){var V=this.vertices[q[T]],I=this.vertices[q[(T+1)%P]];V.vsub(I,h),l.copy(h),o.vmult(l,l),e.vadd(l,l),p.copy(this.faceNormals[m]),o.vmult(p,p),e.vadd(p,p),l.cross(p,c),c.negate(c),u.copy(V),o.vmult(u,u),e.vadd(u,u);u.dot(c);var N=q.connectedFaces[T];d.copy(this.faceNormals[N]);var L=this.getPlaneConstantOfFace(N);v.copy(d),o.vmult(v,v);var W=L-v.dot(e);for(this.clipFaceAgainstPlane(y,f,v,W);y.length;)y.shift();for(;f.length;)y.push(f.shift())}d.copy(this.faceNormals[m]);L=this.getPlaneConstantOfFace(m);v.copy(d),o.vmult(v,v);for(W=L-v.dot(e),F=0;F<y.length;F++){var j=v.dot(y[F])+W;if(j<=n&&(console.log("clamped: depth="+j+" to minDist="+n),j=n),j<=s){var O=y[F];if(j<=0){var k={point:O,normal:v,depth:j};r.push(k)}}}}},r.prototype.clipFaceAgainstPlane=function(t,e,o,i){var s,r,a=t.length;if(a<2)return e;var h=t[t.length-1],l=t[0];s=o.dot(h)+i;for(var p=0;p<a;p++){if(l=t[p],r=o.dot(l)+i,s<0)if(r<0){(c=new n).copy(l),e.push(c)}else{var c=new n;h.lerp(l,s/(s-r),c),e.push(c)}else if(r<0){c=new n;h.lerp(l,s/(s-r),c),e.push(c),e.push(l)}h=l,s=r}return e},r.prototype.computeWorldVertices=function(t,e){for(var o=this.vertices.length;this.worldVertices.length<o;)this.worldVertices.push(new n);for(var i=this.vertices,s=this.worldVertices,r=0;r!==o;r++)e.vmult(i[r],s[r]),t.vadd(s[r],s[r]);this.worldVerticesNeedsUpdate=!1};new n;r.prototype.computeLocalAABB=function(t,e){var o=this.vertices.length,i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var n=0;n<o;n++){var s=i[n];s.x<t.x?t.x=s.x:s.x>e.x&&(e.x=s.x),s.y<t.y?t.y=s.y:s.y>e.y&&(e.y=s.y),s.z<t.z?t.z=s.z:s.z>e.z&&(e.z=s.z)}},r.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new n);for(var o=this.faceNormals,i=this.worldFaceNormals,s=0;s!==e;s++)t.vmult(o[s],i[s]);this.worldFaceNormalsNeedsUpdate=!1},r.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,o=0,i=e.length;o!==i;o++){var n=e[o].norm2();n>t&&(t=n)}this.boundingSphereRadius=Math.sqrt(t)};var q=new n;r.prototype.calculateWorldAABB=function(t,e,o,i){for(var n,s,r,a,h,l,p=this.vertices.length,c=this.vertices,u=0;u<p;u++){q.copy(c[u]),e.vmult(q,q),t.vadd(q,q);var d=q;d.x<n||void 0===n?n=d.x:(d.x>a||void 0===a)&&(a=d.x),d.y<s||void 0===s?s=d.y:(d.y>h||void 0===h)&&(h=d.y),d.z<r||void 0===r?r=d.z:(d.z>l||void 0===l)&&(l=d.z)}o.set(n,s,r),i.set(a,h,l)},r.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},r.prototype.getAveragePointLocal=function(t){t=t||new n;for(var e=this.vertices.length,o=this.vertices,i=0;i<e;i++)t.vadd(o[i],t);return t.mult(1/e,t),t},r.prototype.transformAllPoints=function(t,e){var o=this.vertices.length,i=this.vertices;if(e){for(var n=0;n<o;n++){var s=i[n];e.vmult(s,s)}for(n=0;n<this.faceNormals.length;n++){s=this.faceNormals[n];e.vmult(s,s)}}if(t)for(n=0;n<o;n++){(s=i[n]).vadd(t,s)}};var F=new n,R=new n,P=new n;r.prototype.pointIsInside=function(t){var e=this.vertices.length,o=this.vertices,i=this.faces,n=this.faceNormals,s=this.faces.length,r=F;this.getAveragePointLocal(r);for(var a=0;a<s;a++){this.faces[a].length,e=n[a];var h=o[i[a][0]],l=R;t.vsub(h,l);var p=e.dot(l),c=P;r.vsub(h,c);var u=e.dot(c);if(p<0&&u>0||p>0&&u<0)return!1}return-1};new n;var T=new n,V=new n;r.project=function(t,e,o,i,n){var r=t.vertices.length,a=T,h=0,l=0,p=V,c=t.vertices;p.setZero(),s.vectorToLocalFrame(o,i,e,a),s.pointToLocalFrame(o,i,p,p);var u=p.dot(a);l=h=c[0].dot(a);for(var d=1;d<r;d++){var v=c[d].dot(a);v>h&&(h=v),v<l&&(l=v)}if((l-=u)>(h-=u)){var y=l;l=h,h=y}n[0]=h,n[1]=l}},{"../math/Quaternion":29,"../math/Transform":30,"../math/Vec3":31,"./Shape":44}],40:[function(t,e,o){e.exports=s;t("./Shape");var i=t("../math/Vec3"),n=(t("../math/Quaternion"),t("./ConvexPolyhedron"));function s(t,e,o,s){var r=s,a=[],h=[],l=[],p=[],c=[],u=Math.cos,d=Math.sin;a.push(new i(e*u(0),e*d(0),.5*-o)),p.push(0),a.push(new i(t*u(0),t*d(0),.5*o)),c.push(1);for(var v=0;v<r;v++){var y=2*Math.PI/r*(v+1),f=2*Math.PI/r*(v+.5);v<r-1?(a.push(new i(e*u(y),e*d(y),.5*-o)),p.push(2*v+2),a.push(new i(t*u(y),t*d(y),.5*o)),c.push(2*v+3),l.push([2*v+2,2*v+3,2*v+1,2*v])):l.push([0,1,2*v+1,2*v]),(r%2==1||v<r/2)&&h.push(new i(u(f),d(f),0))}l.push(c),h.push(new i(0,0,1));var m=[];for(v=0;v<p.length;v++)m.push(p[p.length-v-1]);l.push(m),n.call(this,a,l,h)}s.prototype=new n},{"../math/Quaternion":29,"../math/Vec3":31,"./ConvexPolyhedron":39,"./Shape":44}],41:[function(t,e,o){var i=t("./Shape"),n=t("./ConvexPolyhedron"),s=t("../math/Vec3"),r=t("../utils/Utils");function a(t,e){e=r.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this,{type:i.types.HEIGHTFIELD}),this.pillarConvex=new n,this.pillarOffset=new s,this.updateBoundingSphereRadius(),this._cachedPillars={}}e.exports=a,a.prototype=new i,a.prototype.update=function(){this._cachedPillars={}},a.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],o=0;o!==t.length;o++)for(var i=0;i!==t[o].length;i++){var n=t[o][i];n<e&&(e=n)}this.minValue=e},a.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],o=0;o!==t.length;o++)for(var i=0;i!==t[o].length;i++){var n=t[o][i];n>e&&(e=n)}this.maxValue=e},a.prototype.setHeightValueAtIndex=function(t,e,o){this.data[t][e]=o,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},a.prototype.getRectMinMax=function(t,e,o,i,n){n=n||[];for(var s=this.data,r=this.minValue,a=t;a<=o;a++)for(var h=e;h<=i;h++){var l=s[a][h];l>r&&(r=l)}n[0]=this.minValue,n[1]=r},a.prototype.getIndexOfPosition=function(t,e,o,i){var n=this.elementSize,s=this.data,r=Math.floor(t/n),a=Math.floor(e/n);return o[0]=r,o[1]=a,i&&(r<0&&(r=0),a<0&&(a=0),r>=s.length-1&&(r=s.length-1),a>=s[0].length-1&&(a=s[0].length-1)),!(r<0||a<0||r>=s.length-1||a>=s[0].length-1)};var h=[],l=new s,p=new s,c=new s,u=new s;a.prototype.getTriangleAt=function(t,e,o,i,n,s){var r=h;this.getIndexOfPosition(t,e,r,o);var a=r[0],l=r[1],p=this.data;o&&(a=Math.min(p.length-2,Math.max(0,a)),l=Math.min(p[0].length-2,Math.max(0,l)));var c=this.elementSize,u=Math.pow(t/c-a,2)+Math.pow(e/c-l,2)>Math.pow(t/c-(a+1),2)+Math.pow(e/c-(l+1),2);return this.getTriangle(a,l,u,i,n,s),u};var d=new s,v=new s,y=new s,f=new s,m=new s;a.prototype.getNormalAt=function(t,e,o,i){var n=d,s=v,r=y,a=f,h=m;this.getTriangleAt(t,e,o,n,s,r),s.vsub(n,a),r.vsub(n,h),a.cross(h,i),i.normalize()},a.prototype.getAabbAtIndex=function(t,e,o){var i=this.data,n=this.elementSize;o.lowerBound.set(t*n,e*n,i[t][e]),o.upperBound.set((t+1)*n,(e+1)*n,i[t+1][e+1])},a.prototype.getHeightAt=function(t,e,o){var i=this.data,n=p,s=c,r=u,a=h;this.getIndexOfPosition(t,e,a,o);var d=a[0],v=a[1];o&&(d=Math.min(i.length-2,Math.max(0,d)),v=Math.min(i[0].length-2,Math.max(0,v)));var y=this.getTriangleAt(t,e,o,n,s,r);!function(t,e,o,i,n,s,r,a,h){h.x=((s-a)*(t-r)+(r-n)*(e-a))/((s-a)*(o-r)+(r-n)*(i-a)),h.y=((a-i)*(t-r)+(o-r)*(e-a))/((s-a)*(o-r)+(r-n)*(i-a)),h.z=1-h.x-h.y}(t,e,n.x,n.y,s.x,s.y,r.x,r.y,l);var f=l;return y?i[d+1][v+1]*f.x+i[d][v+1]*f.y+i[d+1][v]*f.z:i[d][v]*f.x+i[d+1][v]*f.y+i[d][v+1]*f.z},a.prototype.getCacheConvexTrianglePillarKey=function(t,e,o){return t+"_"+e+"_"+(o?1:0)},a.prototype.getCachedConvexTrianglePillar=function(t,e,o){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,o)]},a.prototype.setCachedConvexTrianglePillar=function(t,e,o,i,n){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,o)]={convex:i,offset:n}},a.prototype.clearCachedConvexTrianglePillar=function(t,e,o){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,o)]},a.prototype.getTriangle=function(t,e,o,i,n,s){var r=this.data,a=this.elementSize;o?(i.set((t+1)*a,(e+1)*a,r[t+1][e+1]),n.set(t*a,(e+1)*a,r[t][e+1]),s.set((t+1)*a,e*a,r[t+1][e])):(i.set(t*a,e*a,r[t][e]),n.set((t+1)*a,e*a,r[t+1][e]),s.set(t*a,(e+1)*a,r[t][e+1]))},a.prototype.getConvexTrianglePillar=function(t,e,o){var i=this.pillarConvex,r=this.pillarOffset;if(this.cacheEnabled){if(a=this.getCachedConvexTrianglePillar(t,e,o))return this.pillarConvex=a.convex,void(this.pillarOffset=a.offset);i=new n,r=new s,this.pillarConvex=i,this.pillarOffset=r}var a=this.data,h=this.elementSize,l=i.faces;i.vertices.length=6;for(var p=0;p<6;p++)i.vertices[p]||(i.vertices[p]=new s);l.length=5;for(p=0;p<5;p++)l[p]||(l[p]=[]);var c=i.vertices,u=(Math.min(a[t][e],a[t+1][e],a[t][e+1],a[t+1][e+1])-this.minValue)/2+this.minValue;o?(r.set((t+.75)*h,(e+.75)*h,u),c[0].set(.25*h,.25*h,a[t+1][e+1]-u),c[1].set(-.75*h,.25*h,a[t][e+1]-u),c[2].set(.25*h,-.75*h,a[t+1][e]-u),c[3].set(.25*h,.25*h,-u-1),c[4].set(-.75*h,.25*h,-u-1),c[5].set(.25*h,-.75*h,-u-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=2,l[2][1]=5,l[2][2]=3,l[2][3]=0,l[3][0]=3,l[3][1]=4,l[3][2]=1,l[3][3]=0,l[4][0]=1,l[4][1]=4,l[4][2]=5,l[4][3]=2):(r.set((t+.25)*h,(e+.25)*h,u),c[0].set(-.25*h,-.25*h,a[t][e]-u),c[1].set(.75*h,-.25*h,a[t+1][e]-u),c[2].set(-.25*h,.75*h,a[t][e+1]-u),c[3].set(-.25*h,-.25*h,-u-1),c[4].set(.75*h,-.25*h,-u-1),c[5].set(-.25*h,.75*h,-u-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=0,l[2][1]=2,l[2][2]=5,l[2][3]=3,l[3][0]=1,l[3][1]=0,l[3][2]=3,l[3][3]=4,l[4][0]=4,l[4][1]=5,l[4][2]=2,l[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,o,i,r)},a.prototype.calculateLocalInertia=function(t,e){return(e=e||new s).set(0,0,0),e},a.prototype.volume=function(){return Number.MAX_VALUE},a.prototype.calculateWorldAABB=function(t,e,o,i){o.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new s(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()},a.prototype.setHeightsFromImage=function(t,e){var o=document.createElement("canvas");o.width=t.width,o.height=t.height;var i=o.getContext("2d");i.drawImage(t,0,0);var n=i.getImageData(0,0,t.width,t.height),s=this.data;s.length=0,this.elementSize=Math.abs(e.x)/n.width;for(var r=0;r<n.height;r++){for(var a=[],h=0;h<n.width;h++){var l=(n.data[4*(r*n.height+h)]+n.data[4*(r*n.height+h)+1]+n.data[4*(r*n.height+h)+2])/4/255*e.z;e.x<0?a.push(l):a.unshift(l)}e.y<0?s.unshift(a):s.push(a)}this.updateMaxValue(),this.updateMinValue(),this.update()}},{"../math/Vec3":31,"../utils/Utils":54,"./ConvexPolyhedron":39,"./Shape":44}],42:[function(t,e,o){e.exports=s;var i=t("./Shape"),n=t("../math/Vec3");function s(){i.call(this,{type:i.types.PARTICLE})}s.prototype=new i,s.prototype.constructor=s,s.prototype.calculateLocalInertia=function(t,e){return(e=e||new n).set(0,0,0),e},s.prototype.volume=function(){return 0},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},s.prototype.calculateWorldAABB=function(t,e,o,i){o.copy(t),i.copy(t)}},{"../math/Vec3":31,"./Shape":44}],43:[function(t,e,o){e.exports=s;var i=t("./Shape"),n=t("../math/Vec3");function s(){i.call(this,{type:i.types.PLANE}),this.worldNormal=new n,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}s.prototype=new i,s.prototype.constructor=s,s.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},s.prototype.calculateLocalInertia=function(t,e){return e=e||new n},s.prototype.volume=function(){return Number.MAX_VALUE};var r=new n;s.prototype.calculateWorldAABB=function(t,e,o,i){r.set(0,0,1),e.vmult(r,r);var n=Number.MAX_VALUE;o.set(-n,-n,-n),i.set(n,n,n),1===r.x&&(i.x=t.x),1===r.y&&(i.y=t.y),1===r.z&&(i.z=t.z),-1===r.x&&(o.x=t.x),-1===r.y&&(o.y=t.y),-1===r.z&&(o.z=t.z)},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":31,"./Shape":44}],44:[function(t,e,o){e.exports=i;var i=t("./Shape");t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material");function i(t){t=t||{},this.id=i.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}i.prototype.constructor=i,i.printLog=!0,i.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},i.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},i.prototype.calculateLocalInertia=function(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type},i.idCounter=0,i.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":26,"../math/Quaternion":29,"../math/Vec3":31,"./Shape":44}],45:[function(t,e,o){e.exports=s;var i=t("./Shape"),n=t("../math/Vec3");function s(t){if(i.call(this,{type:i.types.SPHERE}),this.radius=void 0!==t?t:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}s.prototype=new i,s.prototype.constructor=s,s.prototype.calculateLocalInertia=function(t,e){e=e||new n;var o=2*t*this.radius*this.radius/5;return e.x=o,e.y=o,e.z=o,e},s.prototype.volume=function(){return 4*Math.PI*this.radius/3},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},s.prototype.calculateWorldAABB=function(t,e,o,i){for(var n=this.radius,s=["x","y","z"],r=0;r<s.length;r++){var a=s[r];o[a]=t[a]-n,i[a]=t[a]+n}}},{"../math/Vec3":31,"./Shape":44}],46:[function(t,e,o){e.exports=h;var i=t("./Shape"),n=t("../math/Vec3"),s=(t("../math/Quaternion"),t("../math/Transform")),r=t("../collision/AABB"),a=t("../utils/Octree");function h(t,e){i.call(this,{type:i.types.TRIMESH}),this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new r,this.edges=null,this.scale=new n(1,1,1),this.tree=new a,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}h.prototype=new i,h.prototype.constructor=h;var l=new n;h.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var o=new r,i=new n,s=new n,a=new n,h=[i,s,a],l=0;l<this.indices.length/3;l++){var p=3*l;this._getUnscaledVertex(this.indices[p],i),this._getUnscaledVertex(this.indices[p+1],s),this._getUnscaledVertex(this.indices[p+2],a),o.setFromPoints(h),t.insert(o,l)}t.removeEmptyNodes()};var p=new r;h.prototype.getTrianglesInAABB=function(t,e){p.copy(t);var o=this.scale,i=o.x,n=o.y,s=o.z,r=p.lowerBound,a=p.upperBound;return r.x/=i,r.y/=n,r.z/=s,a.x/=i,a.y/=n,a.z/=s,this.tree.aabbQuery(p,e)},h.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,o=t.x===t.y===t.z;e&&o||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},h.prototype.updateNormals=function(){for(var t=l,e=this.normals,o=0;o<this.indices.length/3;o++){var i=3*o,n=this.indices[i],s=this.indices[i+1],r=this.indices[i+2];this.getVertex(n,y),this.getVertex(s,f),this.getVertex(r,m),h.computeNormal(f,y,m,t),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z}},h.prototype.updateEdges=function(){for(var t={},e=function(e,o){t[n<s?n+"_"+s:s+"_"+n]=!0},o=0;o<this.indices.length/3;o++){var i=3*o,n=this.indices[i],s=this.indices[i+1];this.indices[i+2];e(),e(),e()}var r=Object.keys(t);this.edges=new Int16Array(2*r.length);for(o=0;o<r.length;o++){var a=r[o].split("_");this.edges[2*o]=parseInt(a[0],10),this.edges[2*o+1]=parseInt(a[1],10)}},h.prototype.getEdgeVertex=function(t,e,o){var i=this.edges[2*t+(e?1:0)];this.getVertex(i,o)};var c=new n,u=new n;h.prototype.getEdgeVector=function(t,e){var o=c,i=u;this.getEdgeVertex(t,0,o),this.getEdgeVertex(t,1,i),i.vsub(o,e)};var d=new n,v=new n;h.computeNormal=function(t,e,o,i){e.vsub(t,v),o.vsub(e,d),d.cross(v,i),i.isZero()||i.normalize()};var y=new n,f=new n,m=new n;h.prototype.getVertex=function(t,e){var o=this.scale;return this._getUnscaledVertex(t,e),e.x*=o.x,e.y*=o.y,e.z*=o.z,e},h.prototype._getUnscaledVertex=function(t,e){var o=3*t,i=this.vertices;return e.set(i[o],i[o+1],i[o+2])},h.prototype.getWorldVertex=function(t,e,o,i){return this.getVertex(t,i),s.pointToWorldFrame(e,o,i,i),i},h.prototype.getTriangleVertices=function(t,e,o,i){var n=3*t;this.getVertex(this.indices[n],e),this.getVertex(this.indices[n+1],o),this.getVertex(this.indices[n+2],i)},h.prototype.getNormal=function(t,e){var o=3*t;return e.set(this.normals[o],this.normals[o+1],this.normals[o+2])};var w=new r;h.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(w);var o=w.upperBound.x-w.lowerBound.x,i=w.upperBound.y-w.lowerBound.y,n=w.upperBound.z-w.lowerBound.z;return e.set(1/12*t*(2*i*2*i+2*n*2*n),1/12*t*(2*o*2*o+2*n*2*n),1/12*t*(2*i*2*i+2*o*2*o))};var x=new n;h.prototype.computeLocalAABB=function(t){var e=t.lowerBound,o=t.upperBound,i=this.vertices.length,n=(this.vertices,x);this.getVertex(0,n),e.copy(n),o.copy(n);for(var s=0;s!==i;s++)this.getVertex(s,n),n.x<e.x?e.x=n.x:n.x>o.x&&(o.x=n.x),n.y<e.y?e.y=n.y:n.y>o.y&&(o.y=n.y),n.z<e.z?e.z=n.z:n.z>o.z&&(o.z=n.z)},h.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},h.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,o=new n,i=0,s=e.length/3;i!==s;i++){this.getVertex(i,o);var r=o.norm2();r>t&&(t=r)}this.boundingSphereRadius=Math.sqrt(t)};new n;var g=new s,b=new r;h.prototype.calculateWorldAABB=function(t,e,o,i){var n=g,s=b;n.position=t,n.quaternion=e,this.aabb.toWorldFrame(n,s),o.copy(s.lowerBound),i.copy(s.upperBound)},h.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},h.createTorus=function(t,e,o,i,n){t=t||1,e=e||.5,o=o||8,i=i||6,n=n||2*Math.PI;for(var s=[],r=[],a=0;a<=o;a++)for(var l=0;l<=i;l++){var p=l/i*n,c=a/o*Math.PI*2,u=(t+e*Math.cos(c))*Math.cos(p),d=(t+e*Math.cos(c))*Math.sin(p),v=e*Math.sin(c);s.push(u,d,v)}for(a=1;a<=o;a++)for(l=1;l<=i;l++){var y=(i+1)*a+l-1,f=(i+1)*(a-1)+l-1,m=(i+1)*(a-1)+l,w=(i+1)*a+l;r.push(y,f,w),r.push(f,m,w)}return new h(s,r)}},{"../collision/AABB":3,"../math/Quaternion":29,"../math/Transform":30,"../math/Vec3":31,"../utils/Octree":51,"./Shape":44}],47:[function(t,e,o){e.exports=n;t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver");function n(){i.call(this),this.iterations=10,this.tolerance=1e-7}n.prototype=new i;var s=[],r=[],a=[];n.prototype.solve=function(t,e){var o,i,n,h,l,p=0,c=this.iterations,u=this.tolerance*this.tolerance,d=this.equations,v=d.length,y=e.bodies,f=y.length,m=t;if(0!==v)for(var w=0;w!==f;w++)y[w].updateSolveMassProperties();var x=r,g=a,b=s;x.length=v,g.length=v,b.length=v;for(w=0;w!==v;w++){var B=d[w];b[w]=0,g[w]=B.computeB(m),x[w]=1/B.computeC()}if(0!==v){for(w=0;w!==f;w++){var A=(z=y[w]).vlambda,E=z.wlambda;A.set(0,0,0),E.set(0,0,0)}for(p=0;p!==c;p++){h=0;for(var S=0;S!==v;S++){B=d[S];o=g[S],i=x[S],(l=b[S])+(n=i*(o-B.computeGWlambda()-B.eps*l))<B.minForce?n=B.minForce-l:l+n>B.maxForce&&(n=B.maxForce-l),b[S]+=n,h+=n>0?n:-n,B.addToWlambda(n)}if(h*h<u)break}for(w=0;w!==f;w++){var z,M=(z=y[w]).velocity,C=z.angularVelocity;z.vlambda.vmul(z.linearFactor,z.vlambda),M.vadd(z.vlambda,M),z.wlambda.vmul(z.angularFactor,z.wlambda),C.vadd(z.wlambda,C)}for(var q=d.length,F=1/m;q--;)d[q].multiplier=b[q]*F}return p}},{"../math/Quaternion":29,"../math/Vec3":31,"./Solver":48}],48:[function(t,e,o){function i(){this.equations=[]}e.exports=i,i.prototype.solve=function(t,e){return 0},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.removeEquation=function(t){var e=this.equations,o=e.indexOf(t);-1!==o&&e.splice(o,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],49:[function(t,e,o){e.exports=s;t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver"),n=t("../objects/Body");function s(t){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}s.prototype=new i;var r=[],a=[],h={bodies:[]},l=n.STATIC;function p(t){for(var e=t.length,o=0;o!==e;o++){var i=t[o];if(!(i.visited||i.body.type&l))return i}return!1}var c=[];function u(t,e,o,i){for(c.push(t),t.visited=!0,e(t,o,i);c.length;)for(var n,s=c.pop();n=p(s.children);)n.visited=!0,e(n,o,i),c.push(n)}function d(t,e,o){e.push(t.body);for(var i=t.eqs.length,n=0;n!==i;n++){var s=t.eqs[n];-1===o.indexOf(s)&&o.push(s)}}function v(t,e){return e.id-t.id}s.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},s.prototype.solve=function(t,e){for(var o=r,i=this.nodePool,n=e.bodies,s=this.equations,l=s.length,c=n.length,y=this.subsolver;i.length<c;)i.push(this.createNode());o.length=c;for(var f=0;f<c;f++)o[f]=i[f];for(f=0;f!==c;f++){var m=o[f];m.body=n[f],m.children.length=0,m.eqs.length=0,m.visited=!1}for(var w=0;w!==l;w++){var x=s[w],g=(f=n.indexOf(x.bi),n.indexOf(x.bj)),b=o[f],B=o[g];b.children.push(B),b.eqs.push(x),B.children.push(b),B.eqs.push(x)}var A,E=0,S=a;y.tolerance=this.tolerance,y.iterations=this.iterations;for(var z=h;A=p(o);){S.length=0,z.bodies.length=0,u(A,d,z.bodies,S);var M=S.length;S=S.sort(v);for(f=0;f!==M;f++)y.addEquation(S[f]);y.solve(t,z);y.removeAllEquations(),E++}return E}},{"../math/Quaternion":29,"../math/Vec3":31,"../objects/Body":32,"./Solver":48}],50:[function(t,e,o){var i=function(){};e.exports=i,i.prototype={constructor:i,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),-1===o[t].indexOf(e)&&o[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;return void 0!==o[t]&&-1!==o[t].indexOf(e)},hasAnyEventListener:function(t){return void 0!==this._listeners&&void 0!==this._listeners[t]},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var o=this._listeners;if(void 0===o[t])return this;var i=o[t].indexOf(e);return-1!==i&&o[t].splice(i,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var o=0,i=e.length;o<i;o++)e[o].call(this,t)}return this}}},{}],51:[function(t,e,o){var i=t("../collision/AABB"),n=t("../math/Vec3");function s(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new i,this.data=[],this.children=[]}function r(t,e){(e=e||{}).root=null,e.aabb=t,s.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}e.exports=r,r.prototype=new s,s.prototype.reset=function(t,e){this.children.length=this.data.length=0},s.prototype.insert=function(t,e,o){var i=this.data;if(o=o||0,!this.aabb.contains(t))return!1;var n=this.children;if(o<(this.maxDepth||this.root.maxDepth)){var s=!1;n.length||(this.subdivide(),s=!0);for(var r=0;8!==r;r++)if(n[r].insert(t,e,o+1))return!0;s&&(n.length=0)}return i.push(e),!0};var a=new n;s.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,o=t.upperBound,r=this.children;r.push(new s({aabb:new i({lowerBound:new n(0,0,0)})}),new s({aabb:new i({lowerBound:new n(1,0,0)})}),new s({aabb:new i({lowerBound:new n(1,1,0)})}),new s({aabb:new i({lowerBound:new n(1,1,1)})}),new s({aabb:new i({lowerBound:new n(0,1,1)})}),new s({aabb:new i({lowerBound:new n(0,0,1)})}),new s({aabb:new i({lowerBound:new n(1,0,1)})}),new s({aabb:new i({lowerBound:new n(0,1,0)})})),o.vsub(e,a),a.scale(.5,a);for(var h=this.root||this,l=0;8!==l;l++){var p=r[l];p.root=h;var c=p.aabb.lowerBound;c.x*=a.x,c.y*=a.y,c.z*=a.z,c.vadd(e,c),c.vadd(a,p.aabb.upperBound)}},s.prototype.aabbQuery=function(t,e){this.data,this.children;for(var o=[this];o.length;){var i=o.pop();i.aabb.overlaps(t)&&Array.prototype.push.apply(e,i.data),Array.prototype.push.apply(o,i.children)}return e};var h=new i;s.prototype.rayQuery=function(t,e,o){return t.getAABB(h),h.toLocalFrame(e,h),this.aabbQuery(h,o),o},s.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var e=t.pop(),o=e.children.length-1;o>=0;o--)e.children[o].data.length||e.children.splice(o,1);Array.prototype.push.apply(t,e.children)}}},{"../collision/AABB":3,"../math/Vec3":31}],52:[function(t,e,o){function i(){this.objects=[],this.type=Object}e.exports=i,i.prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e]);return this},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")},i.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}},{}],53:[function(t,e,o){function i(){this.data={keys:[]}}e.exports=i,i.prototype.get=function(t,e){if(t>e){var o=e;e=t,t=o}return this.data[t+"-"+e]},i.prototype.set=function(t,e,o){if(t>e){var i=e;e=t,t=i}var n=t+"-"+e;this.get(t,e)||this.data.keys.push(n),this.data[n]=o},i.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;){delete t[e.pop()]}}},{}],54:[function(t,e,o){function i(){}e.exports=i,i.defaults=function(t,e){for(var o in t=t||{},e)o in t||(t[o]=e[o]);return t}},{}],55:[function(t,e,o){e.exports=s;var i=t("../math/Vec3"),n=t("./Pool");function s(){n.call(this),this.type=i}s.prototype=new n,s.prototype.constructObject=function(){return new i}},{"../math/Vec3":31,"./Pool":52}],56:[function(t,e,o){e.exports=d;var i=t("../collision/AABB"),n=t("../objects/Body"),s=t("../shapes/Shape"),r=t("../collision/Ray"),a=t("../math/Vec3"),h=t("../math/Transform"),l=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),p=(t("../solver/Solver"),t("../utils/Vec3Pool")),c=t("../equations/ContactEquation"),u=t("../equations/FrictionEquation");function d(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new p,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}d.prototype.createContactEquation=function(t,e,o,i,n,s){var r;this.contactPointPool.length?((r=this.contactPointPool.pop()).bi=t,r.bj=e):r=new c(t,e),r.enabled=t.collisionResponse&&e.collisionResponse&&o.collisionResponse&&i.collisionResponse;var a=this.currentContactMaterial;r.restitution=a.restitution,r.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);var h=o.material||t.material,l=i.material||e.material;return h&&l&&h.restitution>=0&&l.restitution>=0&&(r.restitution=h.restitution*l.restitution),r.si=n||o,r.sj=s||i,r},d.prototype.createFrictionEquationsFromContact=function(t,e){var o=t.bi,i=t.bj,n=t.si,s=t.sj,r=this.world,a=this.currentContactMaterial,h=a.friction,l=n.material||o.material,p=s.material||i.material;if(l&&p&&l.friction>=0&&p.friction>=0&&(h=l.friction*p.friction),h>0){var c=h*r.gravity.length(),d=o.invMass+i.invMass;d>0&&(d=1/d);var v=this.frictionEquationPool,y=v.length?v.pop():new u(o,i,c*d),f=v.length?v.pop():new u(o,i,c*d);return y.bi=f.bi=o,y.bj=f.bj=i,y.minForce=f.minForce=-c*d,y.maxForce=f.maxForce=c*d,y.ri.copy(t.ri),y.rj.copy(t.rj),f.ri.copy(t.ri),f.rj.copy(t.rj),t.ni.tangents(y.t,f.t),y.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,r.dt),f.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,r.dt),y.enabled=f.enabled=t.enabled,e.push(y,f),!0}return!1};var v=new a,y=new a,f=new a;d.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var o=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];v.setZero(),y.setZero(),f.setZero();for(var n=e.bi,s=(e.bj,0);s!==t;s++)(e=this.result[this.result.length-1-s]).bodyA!==n?(v.vadd(e.ni,v),y.vadd(e.ri,y),f.vadd(e.rj,f)):(v.vsub(e.ni,v),y.vadd(e.rj,y),f.vadd(e.ri,f));var r=1/t;y.scale(r,o.ri),f.scale(r,o.rj),i.ri.copy(o.ri),i.rj.copy(o.rj),v.normalize(),v.tangents(o.t,i.t)}};var m=new a,w=new a,x=new l,g=new l;d.prototype.getContacts=function(t,e,o,i,s,r,a){this.contactPointPool=s,this.frictionEquationPool=a,this.result=i,this.frictionResult=r;for(var h=x,l=g,p=m,c=w,u=0,d=t.length;u!==d;u++){var v=t[u],y=e[u],f=null;v.material&&y.material&&(f=o.getContactMaterial(v.material,y.material)||null);for(var b=v.type&n.KINEMATIC&&y.type&n.STATIC||v.type&n.STATIC&&y.type&n.KINEMATIC||v.type&n.KINEMATIC&&y.type&n.KINEMATIC,B=0;B<v.shapes.length;B++){v.quaternion.mult(v.shapeOrientations[B],h),v.quaternion.vmult(v.shapeOffsets[B],p),p.vadd(v.position,p);for(var A=v.shapes[B],E=0;E<y.shapes.length;E++){y.quaternion.mult(y.shapeOrientations[E],l),y.quaternion.vmult(y.shapeOffsets[E],c),c.vadd(y.position,c);var S=y.shapes[E];if(A.collisionFilterMask&S.collisionFilterGroup&&S.collisionFilterMask&A.collisionFilterGroup&&!(p.distanceTo(c)>A.boundingSphereRadius+S.boundingSphereRadius)){var z=null;A.material&&S.material&&(z=o.getContactMaterial(A.material,S.material)||null),this.currentContactMaterial=z||f||o.defaultContactMaterial;var M=this[A.type|S.type];if(M){(A.type<S.type?M.call(this,A,S,p,c,h,l,v,y,A,S,b):M.call(this,S,A,c,p,l,h,y,v,A,S,b))&&b&&(o.shapeOverlapKeeper.set(A.id,S.id),o.bodyOverlapKeeper.set(v.id,y.id))}}}}}};d.prototype[s.types.BOX|s.types.BOX]=d.prototype.boxBox=function(t,e,o,i,n,s,r,a,h,l,p){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,o,i,n,s,r,a,t,e,p)},d.prototype[s.types.BOX|s.types.CONVEXPOLYHEDRON]=d.prototype.boxConvex=function(t,e,o,i,n,s,r,a,h,l,p){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,o,i,n,s,r,a,t,e,p)},d.prototype[s.types.BOX|s.types.PARTICLE]=d.prototype.boxParticle=function(t,e,o,i,n,s,r,a,h,l,p){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,o,i,n,s,r,a,t,e,p)},d.prototype[s.types.SPHERE]=d.prototype.sphereSphere=function(t,e,o,i,n,s,r,a,h,l,p){if(p)return o.distanceSquared(i)<Math.pow(t.radius+e.radius,2);var c=this.createContactEquation(r,a,t,e,h,l);i.vsub(o,c.ni),c.ni.normalize(),c.ri.copy(c.ni),c.rj.copy(c.ni),c.ri.mult(t.radius,c.ri),c.rj.mult(-e.radius,c.rj),c.ri.vadd(o,c.ri),c.ri.vsub(r.position,c.ri),c.rj.vadd(i,c.rj),c.rj.vsub(a.position,c.rj),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)};var b=new a,B=new a,A=new a;d.prototype[s.types.PLANE|s.types.TRIMESH]=d.prototype.planeTrimesh=function(t,e,o,i,n,s,r,l,p,c,u){var d=new a,v=b;v.set(0,0,1),n.vmult(v,v);for(var y=0;y<e.vertices.length/3;y++){e.getVertex(y,d);var f=new a;f.copy(d),h.pointToWorldFrame(i,s,f,d);var m=B;if(d.vsub(o,m),v.dot(m)<=0){if(u)return!0;var w=this.createContactEquation(r,l,t,e,p,c);w.ni.copy(v);var x=A;v.scale(m.dot(v),x),d.vsub(x,x),w.ri.copy(x),w.ri.vsub(r.position,w.ri),w.rj.copy(d),w.rj.vsub(l.position,w.rj),this.result.push(w),this.createFrictionEquationsFromContact(w,this.frictionResult)}}};var E=new a,S=new a,z=(new a,new a),M=new a,C=new a,q=new a,F=new a,R=new a,P=new a,T=new a,V=new a,I=new a,N=new a,L=new i,W=[];d.prototype[s.types.SPHERE|s.types.TRIMESH]=d.prototype.sphereTrimesh=function(t,e,o,i,n,s,a,l,p,c,u){var d=C,v=q,y=F,f=R,m=P,w=T,x=L,g=M,b=S,B=W;h.pointToLocalFrame(i,s,o,m);var A=t.radius;x.lowerBound.set(m.x-A,m.y-A,m.z-A),x.upperBound.set(m.x+A,m.y+A,m.z+A),e.getTrianglesInAABB(x,B);for(var j=z,O=t.radius*t.radius,k=0;k<B.length;k++)for(var _=0;_<3;_++)if(e.getVertex(e.indices[3*B[k]+_],j),j.vsub(m,b),b.norm2()<=O){if(g.copy(j),h.pointToWorldFrame(i,s,g,j),j.vsub(o,b),u)return!0;(D=this.createContactEquation(a,l,t,e,p,c)).ni.copy(b),D.ni.normalize(),D.ri.copy(D.ni),D.ri.scale(t.radius,D.ri),D.ri.vadd(o,D.ri),D.ri.vsub(a.position,D.ri),D.rj.copy(j),D.rj.vsub(l.position,D.rj),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult)}for(k=0;k<B.length;k++)for(_=0;_<3;_++){e.getVertex(e.indices[3*B[k]+_],d),e.getVertex(e.indices[3*B[k]+(_+1)%3],v),v.vsub(d,y),m.vsub(v,w);var U=w.dot(y);m.vsub(d,w);var H=w.dot(y);if(H>0&&U<0)if(m.vsub(d,w),f.copy(y),f.normalize(),H=w.dot(f),f.scale(H,w),w.vadd(d,w),(K=w.distanceTo(m))<t.radius){if(u)return!0;var D=this.createContactEquation(a,l,t,e,p,c);w.vsub(m,D.ni),D.ni.normalize(),D.ni.scale(t.radius,D.ri),h.pointToWorldFrame(i,s,w,w),w.vsub(l.position,D.rj),h.vectorToWorldFrame(s,D.ni,D.ni),h.vectorToWorldFrame(s,D.ri,D.ri),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult)}}for(var G=V,X=I,Q=N,Y=E,Z=(k=0,B.length);k!==Z;k++){e.getTriangleVertices(B[k],G,X,Q),e.getNormal(B[k],Y),m.vsub(G,w);var K=w.dot(Y);if(Y.scale(K,w),m.vsub(w,w),K=w.distanceTo(m),r.pointInTriangle(w,G,X,Q)&&K<t.radius){if(u)return!0;D=this.createContactEquation(a,l,t,e,p,c);w.vsub(m,D.ni),D.ni.normalize(),D.ni.scale(t.radius,D.ri),h.pointToWorldFrame(i,s,w,w),w.vsub(l.position,D.rj),h.vectorToWorldFrame(s,D.ni,D.ni),h.vectorToWorldFrame(s,D.ri,D.ri),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult)}}B.length=0};var j=new a,O=new a;d.prototype[s.types.SPHERE|s.types.PLANE]=d.prototype.spherePlane=function(t,e,o,i,n,s,r,a,h,l,p){var c=this.createContactEquation(r,a,t,e,h,l);if(c.ni.set(0,0,1),s.vmult(c.ni,c.ni),c.ni.negate(c.ni),c.ni.normalize(),c.ni.mult(t.radius,c.ri),o.vsub(i,j),c.ni.mult(c.ni.dot(j),O),j.vsub(O,c.rj),-j.dot(c.ni)<=t.radius){if(p)return!0;var u=c.ri,d=c.rj;u.vadd(o,u),u.vsub(r.position,u),d.vadd(i,d),d.vsub(a.position,d),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var k=new a,_=new a,U=new a;function H(t,e,o){for(var i=null,n=t.length,s=0;s!==n;s++){var r=t[s],a=k;t[(s+1)%n].vsub(r,a);var h=_;a.cross(e,h);var l=U;o.vsub(r,l);var p=h.dot(l);if(!(null===i||p>0&&!0===i||p<=0&&!1===i))return!1;null===i&&(i=p>0)}return!0}var D=new a,G=new a,X=new a,Q=new a,Y=[new a,new a,new a,new a,new a,new a],Z=new a,K=new a,J=new a,$=new a;d.prototype[s.types.SPHERE|s.types.BOX]=d.prototype.sphereBox=function(t,e,o,i,n,s,r,a,h,l,p){var c=this.v3pool,u=Y;o.vsub(i,D),e.getSideNormals(u,s);for(var d=t.radius,v=!1,y=K,f=J,m=$,w=null,x=0,g=0,b=0,B=null,A=0,E=u.length;A!==E&&!1===v;A++){var S=G;S.copy(u[A]);var z=S.norm();S.normalize();var M=D.dot(S);if(M<z+d&&M>0){var C=X,q=Q;C.copy(u[(A+1)%3]),q.copy(u[(A+2)%3]);var F=C.norm(),R=q.norm();C.normalize(),q.normalize();var P=D.dot(C),T=D.dot(q);if(P<F&&P>-F&&T<R&&T>-R){var V=Math.abs(M-z-d);if((null===B||V<B)&&(B=V,g=P,b=T,w=z,y.copy(S),f.copy(C),m.copy(q),x++,p))return!0}}}if(x){v=!0;var I=this.createContactEquation(r,a,t,e,h,l);y.mult(-d,I.ri),I.ni.copy(y),I.ni.negate(I.ni),y.mult(w,y),f.mult(g,f),y.vadd(f,y),m.mult(b,m),y.vadd(m,I.rj),I.ri.vadd(o,I.ri),I.ri.vsub(r.position,I.ri),I.rj.vadd(i,I.rj),I.rj.vsub(a.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult)}for(var N=c.get(),L=Z,W=0;2!==W&&!v;W++)for(var j=0;2!==j&&!v;j++)for(var O=0;2!==O&&!v;O++)if(N.set(0,0,0),W?N.vadd(u[0],N):N.vsub(u[0],N),j?N.vadd(u[1],N):N.vsub(u[1],N),O?N.vadd(u[2],N):N.vsub(u[2],N),i.vadd(N,L),L.vsub(o,L),L.norm2()<d*d){if(p)return!0;v=!0,(I=this.createContactEquation(r,a,t,e,h,l)).ri.copy(L),I.ri.normalize(),I.ni.copy(I.ri),I.ri.mult(d,I.ri),I.rj.copy(N),I.ri.vadd(o,I.ri),I.ri.vsub(r.position,I.ri),I.rj.vadd(i,I.rj),I.rj.vsub(a.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult)}c.release(N),N=null;var k=c.get(),_=c.get(),U=(I=c.get(),c.get()),H=(V=c.get(),u.length);for(W=0;W!==H&&!v;W++)for(j=0;j!==H&&!v;j++)if(W%3!=j%3){u[j].cross(u[W],k),k.normalize(),u[W].vadd(u[j],_),I.copy(o),I.vsub(_,I),I.vsub(i,I);var tt=I.dot(k);k.mult(tt,U);for(O=0;O===W%3||O===j%3;)O++;V.copy(o),V.vsub(U,V),V.vsub(_,V),V.vsub(i,V);var et=Math.abs(tt),ot=V.norm();if(et<u[O].norm()&&ot<d){if(p)return!0;v=!0;var it=this.createContactEquation(r,a,t,e,h,l);_.vadd(U,it.rj),it.rj.copy(it.rj),V.negate(it.ni),it.ni.normalize(),it.ri.copy(it.rj),it.ri.vadd(i,it.ri),it.ri.vsub(o,it.ri),it.ri.normalize(),it.ri.mult(d,it.ri),it.ri.vadd(o,it.ri),it.ri.vsub(r.position,it.ri),it.rj.vadd(i,it.rj),it.rj.vsub(a.position,it.rj),this.result.push(it),this.createFrictionEquationsFromContact(it,this.frictionResult)}}c.release(k,_,I,U,V)};var tt=new a,et=new a,ot=new a,it=new a,nt=new a,st=new a,rt=new a,at=new a,ht=new a,lt=new a;d.prototype[s.types.SPHERE|s.types.CONVEXPOLYHEDRON]=d.prototype.sphereConvex=function(t,e,o,i,n,s,r,a,h,l,p){var c=this.v3pool;o.vsub(i,tt);for(var u=e.faceNormals,d=e.faces,v=e.vertices,y=t.radius,f=0;f!==v.length;f++){var m=v[f],w=nt;s.vmult(m,w),i.vadd(w,w);var x=it;if(w.vsub(o,x),x.norm2()<y*y)return!!p||(g=!0,(V=this.createContactEquation(r,a,t,e,h,l)).ri.copy(x),V.ri.normalize(),V.ni.copy(V.ri),V.ri.mult(y,V.ri),w.vsub(i,V.rj),V.ri.vadd(o,V.ri),V.ri.vsub(r.position,V.ri),V.rj.vadd(i,V.rj),V.rj.vsub(a.position,V.rj),this.result.push(V),void this.createFrictionEquationsFromContact(V,this.frictionResult))}for(var g=!1,b=(f=0,d.length);f!==b&&!1===g;f++){var B=u[f],A=d[f],E=st;s.vmult(B,E);var S=rt;s.vmult(v[A[0]],S),S.vadd(i,S);var z=at;E.mult(-y,z),o.vadd(z,z);var M=ht;z.vsub(S,M);var C=M.dot(E),q=lt;if(o.vsub(S,q),C<0&&q.dot(E)>0){for(var F=[],R=0,P=A.length;R!==P;R++){var T=c.get();s.vmult(v[A[R]],T),i.vadd(T,T),F.push(T)}if(H(F,E,o)){if(p)return!0;g=!0;var V=this.createContactEquation(r,a,t,e,h,l);E.mult(-y,V.ri),E.negate(V.ni);var I=c.get();E.mult(-C,I);var N=c.get();E.mult(-y,N),o.vsub(i,V.rj),V.rj.vadd(N,V.rj),V.rj.vadd(I,V.rj),V.rj.vadd(i,V.rj),V.rj.vsub(a.position,V.rj),V.ri.vadd(o,V.ri),V.ri.vsub(r.position,V.ri),c.release(I),c.release(N),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult);R=0;for(var L=F.length;R!==L;R++)c.release(F[R]);return}for(R=0;R!==A.length;R++){var W=c.get(),j=c.get();s.vmult(v[A[(R+1)%A.length]],W),s.vmult(v[A[(R+2)%A.length]],j),i.vadd(W,W),i.vadd(j,j);var O=et;j.vsub(W,O);var k=ot;O.unit(k);var _=c.get(),U=c.get();o.vsub(W,U);var D=U.dot(k);k.mult(D,_),_.vadd(W,_);var G=c.get();if(_.vsub(o,G),D>0&&D*D<O.norm2()&&G.norm2()<y*y){if(p)return!0;V=this.createContactEquation(r,a,t,e,h,l);_.vsub(i,V.rj),_.vsub(o,V.ni),V.ni.normalize(),V.ni.mult(y,V.ri),V.rj.vadd(i,V.rj),V.rj.vsub(a.position,V.rj),V.ri.vadd(o,V.ri),V.ri.vsub(r.position,V.ri),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult);for(R=0,L=F.length;R!==L;R++)c.release(F[R]);return c.release(W),c.release(j),c.release(_),c.release(G),void c.release(U)}c.release(W),c.release(j),c.release(_),c.release(G),c.release(U)}for(R=0,L=F.length;R!==L;R++)c.release(F[R])}}};new a,new a;d.prototype[s.types.PLANE|s.types.BOX]=d.prototype.planeBox=function(t,e,o,i,n,s,r,a,h,l,p){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,o,i,n,s,r,a,t,e,p)};var pt=new a,ct=new a,ut=new a,dt=new a;d.prototype[s.types.PLANE|s.types.CONVEXPOLYHEDRON]=d.prototype.planeConvex=function(t,e,o,i,n,s,r,a,h,l,p){var c=pt,u=ct;u.set(0,0,1),n.vmult(u,u);for(var d=0,v=ut,y=0;y!==e.vertices.length;y++){if(c.copy(e.vertices[y]),s.vmult(c,c),i.vadd(c,c),c.vsub(o,v),u.dot(v)<=0){if(p)return!0;var f=this.createContactEquation(r,a,t,e,h,l),m=dt;u.mult(u.dot(v),m),c.vsub(m,m),m.vsub(o,f.ri),f.ni.copy(u),c.vsub(i,f.rj),f.ri.vadd(o,f.ri),f.ri.vsub(r.position,f.ri),f.rj.vadd(i,f.rj),f.rj.vsub(a.position,f.rj),this.result.push(f),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(f,this.frictionResult)}}this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)};var vt=new a,yt=new a;d.prototype[s.types.CONVEXPOLYHEDRON]=d.prototype.convexConvex=function(t,e,o,i,n,s,r,a,h,l,p,c,u){var d=vt;if(!(o.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,o,n,i,s,d,c,u)){var v=[],y=yt;t.clipAgainstHull(o,n,e,i,s,d,-100,100,v);for(var f=0,m=0;m!==v.length;m++){if(p)return!0;var w=this.createContactEquation(r,a,t,e,h,l),x=w.ri,g=w.rj;d.negate(w.ni),v[m].normal.negate(y),y.mult(v[m].depth,y),v[m].point.vadd(y,x),g.copy(v[m].point),x.vsub(o,x),g.vsub(i,g),x.vadd(o,x),x.vsub(r.position,x),g.vadd(i,g),g.vsub(a.position,g),this.result.push(w),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(w,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}};var ft=new a,mt=new a,wt=new a;d.prototype[s.types.PLANE|s.types.PARTICLE]=d.prototype.planeParticle=function(t,e,o,i,n,s,r,a,h,l,p){var c=ft;c.set(0,0,1),r.quaternion.vmult(c,c);var u=mt;if(i.vsub(r.position,u),c.dot(u)<=0){if(p)return!0;var d=this.createContactEquation(a,r,e,t,h,l);d.ni.copy(c),d.ni.negate(d.ni),d.ri.set(0,0,0);var v=wt;c.mult(c.dot(i),v),i.vsub(v,v),d.rj.copy(v),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}};var xt=new a;d.prototype[s.types.PARTICLE|s.types.SPHERE]=d.prototype.sphereParticle=function(t,e,o,i,n,s,r,a,h,l,p){var c=xt;if(c.set(0,0,1),i.vsub(o,c),c.norm2()<=t.radius*t.radius){if(p)return!0;var u=this.createContactEquation(a,r,e,t,h,l);c.normalize(),u.rj.copy(c),u.rj.mult(t.radius,u.rj),u.ni.copy(c),u.ni.negate(u.ni),u.ri.set(0,0,0),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}};var gt=new l,bt=new a,Bt=(new a,new a),At=new a,Et=new a;d.prototype[s.types.PARTICLE|s.types.CONVEXPOLYHEDRON]=d.prototype.convexParticle=function(t,e,o,i,n,s,r,a,h,l,p){var c=-1,u=Bt,d=Et,v=null,y=bt;if(y.copy(i),y.vsub(o,y),n.conjugate(gt),gt.vmult(y,y),t.pointIsInside(y)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(o,n),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(n);for(var f=0,m=t.faces.length;f!==m;f++){var w=[t.worldVertices[t.faces[f][0]]],x=t.worldFaceNormals[f];i.vsub(w[0],At);var g=-x.dot(At);if(null===v||Math.abs(g)<Math.abs(v)){if(p)return!0;v=g,c=f,u.copy(x),0}}if(-1!==c){var b=this.createContactEquation(a,r,e,t,h,l);u.mult(v,d),d.vadd(i,d),d.vsub(o,d),b.rj.copy(d),u.negate(b.ni),b.ri.set(0,0,0);var B=b.ri,A=b.rj;B.vadd(i,B),B.vsub(a.position,B),A.vadd(o,A),A.vsub(r.position,A),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},d.prototype[s.types.BOX|s.types.HEIGHTFIELD]=d.prototype.boxHeightfield=function(t,e,o,i,n,s,r,a,h,l,p){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,o,i,n,s,r,a,t,e,p)};var St=new a,zt=new a,Mt=[0];d.prototype[s.types.CONVEXPOLYHEDRON|s.types.HEIGHTFIELD]=d.prototype.convexHeightfield=function(t,e,o,i,n,s,r,a,l,p,c){var u=e.data,d=e.elementSize,v=t.boundingSphereRadius,y=zt,f=Mt,m=St;h.pointToLocalFrame(i,s,o,m);var w=Math.floor((m.x-v)/d)-1,x=Math.ceil((m.x+v)/d)+1,g=Math.floor((m.y-v)/d)-1,b=Math.ceil((m.y+v)/d)+1;if(!(x<0||b<0||w>u.length||g>u[0].length)){w<0&&(w=0),x<0&&(x=0),g<0&&(g=0),b<0&&(b=0),w>=u.length&&(w=u.length-1),x>=u.length&&(x=u.length-1),b>=u[0].length&&(b=u[0].length-1),g>=u[0].length&&(g=u[0].length-1);var B=[];e.getRectMinMax(w,g,x,b,B);var A=B[0],E=B[1];if(!(m.z-v>E||m.z+v<A))for(var S=w;S<x;S++)for(var z=g;z<b;z++){var M=!1;if(e.getConvexTrianglePillar(S,z,!1),h.pointToWorldFrame(i,s,e.pillarOffset,y),o.distanceTo(y)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(M=this.convexConvex(t,e.pillarConvex,o,y,n,s,r,a,null,null,c,f,null)),c&&M)return!0;if(e.getConvexTrianglePillar(S,z,!0),h.pointToWorldFrame(i,s,e.pillarOffset,y),o.distanceTo(y)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(M=this.convexConvex(t,e.pillarConvex,o,y,n,s,r,a,null,null,c,f,null)),c&&M)return!0}}};var Ct=new a,qt=new a;d.prototype[s.types.SPHERE|s.types.HEIGHTFIELD]=d.prototype.sphereHeightfield=function(t,e,o,i,n,s,r,a,l,p,c){var u=e.data,d=t.radius,v=e.elementSize,y=qt,f=Ct;h.pointToLocalFrame(i,s,o,f);var m=Math.floor((f.x-d)/v)-1,w=Math.ceil((f.x+d)/v)+1,x=Math.floor((f.y-d)/v)-1,g=Math.ceil((f.y+d)/v)+1;if(!(w<0||g<0||m>u.length||g>u[0].length)){m<0&&(m=0),w<0&&(w=0),x<0&&(x=0),g<0&&(g=0),m>=u.length&&(m=u.length-1),w>=u.length&&(w=u.length-1),g>=u[0].length&&(g=u[0].length-1),x>=u[0].length&&(x=u[0].length-1);var b=[];e.getRectMinMax(m,x,w,g,b);var B=b[0],A=b[1];if(!(f.z-d>A||f.z+d<B))for(var E=this.result,S=m;S<w;S++)for(var z=x;z<g;z++){var M=E.length,C=!1;if(e.getConvexTrianglePillar(S,z,!1),h.pointToWorldFrame(i,s,e.pillarOffset,y),o.distanceTo(y)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(C=this.sphereConvex(t,e.pillarConvex,o,y,n,s,r,a,t,e,c)),c&&C)return!0;if(e.getConvexTrianglePillar(S,z,!0),h.pointToWorldFrame(i,s,e.pillarOffset,y),o.distanceTo(y)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(C=this.sphereConvex(t,e.pillarConvex,o,y,n,s,r,a,t,e,c)),c&&C)return!0;if(E.length-M>2)return}}}},{"../collision/AABB":3,"../collision/Ray":10,"../equations/ContactEquation":20,"../equations/FrictionEquation":22,"../math/Quaternion":29,"../math/Transform":30,"../math/Vec3":31,"../objects/Body":32,"../shapes/ConvexPolyhedron":39,"../shapes/Shape":44,"../solver/Solver":48,"../utils/Vec3Pool":55}],57:[function(t,e,o){e.exports=w;t("../shapes/Shape");var i=t("../math/Vec3"),n=t("../math/Quaternion"),s=t("../solver/GSSolver"),r=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),a=t("../utils/EventTarget"),h=t("../collision/ArrayCollisionMatrix"),l=t("../collision/OverlapKeeper"),p=t("../material/Material"),c=t("../material/ContactMaterial"),u=t("../objects/Body"),d=t("../utils/TupleDictionary"),v=t("../collision/RaycastResult"),y=t("../collision/AABB"),f=t("../collision/Ray"),m=t("../collision/NaiveBroadphase");function w(t){t=t||{},a.apply(this),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==t.quatNormalizeSkip?t.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==t.quatNormalizeFast&&t.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,t.gravity&&this.gravity.copy(t.gravity),this.broadphase=void 0!==t.broadphase?t.broadphase:new m,this.bodies=[],this.solver=void 0!==t.solver?t.solver:new s,this.constraints=[],this.narrowphase=new r(this),this.collisionMatrix=new h,this.collisionMatrixPrevious=new h,this.bodyOverlapKeeper=new l,this.shapeOverlapKeeper=new l,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new d,this.defaultMaterial=new p("default"),this.defaultContactMaterial=new c(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}w.prototype=new a;new y;var x=new f;if(w.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},w.prototype.numObjects=function(){return this.bodies.length},w.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()},w.prototype.add=w.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof u&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))},w.prototype.addConstraint=function(t){this.constraints.push(t)},w.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},w.prototype.rayTest=function(t,e,o){o instanceof v?this.raycastClosest(t,e,{skipBackfaces:!0},o):this.raycastAll(t,e,{skipBackfaces:!0},o)},w.prototype.raycastAll=function(t,e,o,i){return o.mode=f.ALL,o.from=t,o.to=e,o.callback=i,x.intersectWorld(this,o)},w.prototype.raycastAny=function(t,e,o,i){return o.mode=f.ANY,o.from=t,o.to=e,o.result=i,x.intersectWorld(this,o)},w.prototype.raycastClosest=function(t,e,o,i){return o.mode=f.CLOSEST,o.from=t,o.to=e,o.result=i,x.intersectWorld(this,o)},w.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,o=this.bodies,i=o.indexOf(t);if(-1!==i){o.splice(i,1);for(var n=0;n!==o.length;n++)o[n].index=n;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}},w.prototype.removeBody=w.prototype.remove,w.prototype.getBodyById=function(t){return this.idToBodyMap[t]},w.prototype.getShapeById=function(t){for(var e=this.bodies,o=0,i=e.length;o<i;o++)for(var n=e[o].shapes,s=0,r=n.length;s<r;s++){var a=n[s];if(a.id===t)return a}},w.prototype.addMaterial=function(t){this.materials.push(t)},w.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),!performance.now){var g=Date.now();performance.timing&&performance.timing.navigationStart&&(g=performance.timing.navigationStart),performance.now=function(){return Date.now()-g}}new i;w.prototype.step=function(t,e,o){if(o=o||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var i=0;this.accumulator>=t&&i<o;)this.internalStep(t),this.accumulator-=t,i++;for(var n=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var r=this.bodies[s];r.previousPosition.lerp(r.position,n,r.interpolatedPosition),r.previousQuaternion.slerp(r.quaternion,n,r.interpolatedQuaternion),r.previousQuaternion.normalize()}this.time+=e}};var b,B,A,E,S,z,M={type:"postStep"},C={type:"preStep"},q={type:u.COLLIDE_EVENT_NAME,body:null,contact:null},F=[],R=[],P=[],T=[];new i,new i,new i,new i,new i,new i,new i,new i,new i,new n,new n,new n,new i;w.prototype.internalStep=function(t){this.dt=t;var e,o=this.contacts,i=P,n=T,s=this.numObjects(),r=this.bodies,a=this.solver,h=this.gravity,l=this.doProfiling,p=this.profile,c=u.DYNAMIC,d=this.constraints,v=R,y=(h.norm(),h.x),f=h.y,m=h.z,w=0;for(l&&(e=performance.now()),w=0;w!==s;w++){if((N=r[w]).type===c){var x=N.force,g=N.mass;x.x+=g*y,x.y+=g*f,x.z+=g*m}}w=0;for(var b=this.subsystems.length;w!==b;w++)this.subsystems[w].update();l&&(e=performance.now()),i.length=0,n.length=0,this.broadphase.collisionPairs(this,i,n),l&&(p.broadphase=performance.now()-e);var B=d.length;for(w=0;w!==B;w++){if(!(O=d[w]).collideConnected)for(var A=i.length-1;A>=0;A-=1)(O.bodyA===i[A]&&O.bodyB===n[A]||O.bodyB===i[A]&&O.bodyA===n[A])&&(i.splice(A,1),n.splice(A,1))}this.collisionMatrixTick(),l&&(e=performance.now());var E=F,S=o.length;for(w=0;w!==S;w++)E.push(o[w]);o.length=0;var z=this.frictionEquations.length;for(w=0;w!==z;w++)v.push(this.frictionEquations[w]);this.frictionEquations.length=0,this.narrowphase.getContacts(i,n,this,o,E,this.frictionEquations,v),l&&(p.narrowphase=performance.now()-e),l&&(e=performance.now());for(w=0;w<this.frictionEquations.length;w++)a.addEquation(this.frictionEquations[w]);for(var V=o.length,I=0;I!==V;I++){var N=(O=o[I]).bi,L=O.bj,W=O.si,j=O.sj;(N.material&&L.material&&this.getContactMaterial(N.material,L.material)||this.defaultContactMaterial).friction;if(N.material&&L.material&&(N.material.friction>=0&&L.material.friction>=0&&N.material.friction*L.material.friction,N.material.restitution>=0&&L.material.restitution>=0&&(O.restitution=N.material.restitution*L.material.restitution)),a.addEquation(O),N.allowSleep&&N.type===u.DYNAMIC&&N.sleepState===u.SLEEPING&&L.sleepState===u.AWAKE&&L.type!==u.STATIC)L.velocity.norm2()+L.angularVelocity.norm2()>=2*Math.pow(L.sleepSpeedLimit,2)&&(N._wakeUpAfterNarrowphase=!0);if(L.allowSleep&&L.type===u.DYNAMIC&&L.sleepState===u.SLEEPING&&N.sleepState===u.AWAKE&&N.type!==u.STATIC)N.velocity.norm2()+N.angularVelocity.norm2()>=2*Math.pow(N.sleepSpeedLimit,2)&&(L._wakeUpAfterNarrowphase=!0);this.collisionMatrix.set(N,L,!0),this.collisionMatrixPrevious.get(N,L)||(q.body=L,q.contact=O,N.dispatchEvent(q),q.body=N,L.dispatchEvent(q)),this.bodyOverlapKeeper.set(N.id,L.id),this.shapeOverlapKeeper.set(W.id,j.id)}for(this.emitContactEvents(),l&&(p.makeContactConstraints=performance.now()-e,e=performance.now()),w=0;w!==s;w++){(N=r[w])._wakeUpAfterNarrowphase&&(N.wakeUp(),N._wakeUpAfterNarrowphase=!1)}B=d.length;for(w=0;w!==B;w++){var O;(O=d[w]).update();A=0;for(var k=O.equations.length;A!==k;A++){var _=O.equations[A];a.addEquation(_)}}a.solve(t,this),l&&(p.solve=performance.now()-e),a.removeAllEquations();var U=Math.pow;for(w=0;w!==s;w++){if((N=r[w]).type&c){var H=U(1-N.linearDamping,t),D=N.velocity;D.mult(H,D);var G=N.angularVelocity;if(G){var X=U(1-N.angularDamping,t);G.mult(X,G)}}}for(this.dispatchEvent(C),w=0;w!==s;w++){(N=r[w]).preStep&&N.preStep.call(N)}l&&(e=performance.now());var Q=this.stepnumber%(this.quatNormalizeSkip+1)==0,Y=this.quatNormalizeFast;for(w=0;w!==s;w++)r[w].integrate(t,Q,Y);for(this.clearForces(),this.broadphase.dirty=!0,l&&(p.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(M),w=0;w!==s;w++){var Z=(N=r[w]).postStep;Z&&Z.call(N)}if(this.allowSleep)for(w=0;w!==s;w++)r[w].sleepTick(this.time)},w.prototype.emitContactEvents=(b=[],B=[],A={type:"beginContact",bodyA:null,bodyB:null},E={type:"endContact",bodyA:null,bodyB:null},S={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},z={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},function(){var t=this.hasAnyEventListener("beginContact"),e=this.hasAnyEventListener("endContact");if((t||e)&&this.bodyOverlapKeeper.getDiff(b,B),t){for(var o=0,i=b.length;o<i;o+=2)A.bodyA=this.getBodyById(b[o]),A.bodyB=this.getBodyById(b[o+1]),this.dispatchEvent(A);A.bodyA=A.bodyB=null}if(e){for(o=0,i=B.length;o<i;o+=2)E.bodyA=this.getBodyById(B[o]),E.bodyB=this.getBodyById(B[o+1]),this.dispatchEvent(E);E.bodyA=E.bodyB=null}b.length=B.length=0;var n=this.hasAnyEventListener("beginShapeContact"),s=this.hasAnyEventListener("endShapeContact");if((n||s)&&this.shapeOverlapKeeper.getDiff(b,B),n){for(o=0,i=b.length;o<i;o+=2){var r=this.getShapeById(b[o]),a=this.getShapeById(b[o+1]);S.shapeA=r,S.shapeB=a,S.bodyA=r.body,S.bodyB=a.body,this.dispatchEvent(S)}S.bodyA=S.bodyB=S.shapeA=S.shapeB=null}if(s){for(o=0,i=B.length;o<i;o+=2)r=this.getShapeById(B[o]),a=this.getShapeById(B[o+1]),z.shapeA=r,z.shapeB=a,z.bodyA=r.body,z.bodyB=a.body,this.dispatchEvent(z);z.bodyA=z.bodyB=z.shapeA=z.shapeB=null}}),w.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,o=0;o!==e;o++){var i=t[o];i.force,i.torque;i.force.set(0,0,0),i.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/OverlapKeeper":9,"../collision/Ray":10,"../collision/RaycastResult":11,"../equations/ContactEquation":20,"../equations/FrictionEquation":22,"../material/ContactMaterial":25,"../material/Material":26,"../math/Quaternion":29,"../math/Vec3":31,"../objects/Body":32,"../shapes/Shape":44,"../solver/GSSolver":47,"../utils/EventTarget":50,"../utils/TupleDictionary":53,"./Narrowphase":56}]},{},[2])(2)});
//soccerboy v.0.1.0 2019-3-11 by https://gamebuilt.com

"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t){var e=function(){function t(t){this._howl=t,this.muted=!1}return t.prototype.play0=function(t,e){if(this.muted)return e&&e(),0;var i=this._howl.play(t);return null!=e&&this._howl.once("end",function(){e()},i),i},t.prototype.pause=function(t){this._howl.pause(t)},t.prototype.stop=function(t){this._howl.stop(t)},t.prototype.mute=function(t){this.muted=!0,this._howl.mute(!0,t)},t.prototype.unmute=function(t){this.muted=!1,this._howl.mute(!1,t)},t.prototype.fade=function(t,e,i,n,r){this.muted?r&&r():(this._howl.fade(t,e,i,n),r&&this._howl.once("fade",function(t){r()},n))},t.prototype.loop=function(t,e){this._howl.loop(t,e)},t.prototype.seek=function(t,e){return this._howl.seek(t,e)},t.prototype.rate=function(t,e){return this._howl.rate(t,e)},t.prototype.setVolume=function(t,e){this._howl.volume(t,e)},t.prototype.getVolume=function(){return this._howl.volume()},t}();t.AbstractSound=e}(plume||(plume={})),function(r){var t=function(){function e(t){this._visibilityManager=t,this._soundSprites={},this._musics={},this._enableMusics=!0,this._enableSoundsSprites=!0,this._musicWasEnable=!0,this._soundWasEnable=!0,this.musicStateChangeHandlers=new r.Handler,(e._INSTANCE=this)._visibilityManager.addVisibilityChangeHandler(this.onVisibilityChange.bind(this))}return e.prototype.loadSounds=function(t,e){new r.Loader2d(t).load(function(t){e(t)})},e.prototype.registerSoundsheet=function(t,e){var i=r.JSONS.safeJson(e);if(null!=i){i.src=i.urls;var n=new Howl(i);this.getSpriteCount(i.sprite)<=1?(r.logger.debug("Registering music: "+t),this.addMusic(t,new r.Music(n,i.sprite))):(r.logger.debug("Registering sound: "+t),this.addSoundSprite(t,new r.Sound(n)))}},e.prototype.getSpriteCount=function(t){if(null==t)return 0;var e=0;for(var i in t)e++;return e},e.prototype.mute=function(){Howler.mute(!0)},e.prototype.unmute=function(){Howler.mute(!1)},e.prototype.volume=function(t){Howler.volume(t)},e.prototype.addMusic=function(t,e){this._enableMusics||e.mute(),this._musics[t]=e},e.prototype.getMusic=function(t){var e=this._musics[t];return e||(r.logger.error("Can't find music with name: "+t),null)},e.prototype.muteMusics=function(){for(var t in r.logger.debug("muting musics "),this._musics)this._musics[t].mute();this._enableMusics=!1,this.musicStateChangeHandlers.fire(!1)},e.prototype.unmuteMusics=function(){for(var t in r.logger.debug("unmuting musics "),this._musics)this._musics[t].unmute();this._enableMusics=!0,this.musicStateChangeHandlers.fire(!0)},e.prototype.volumeMusics=function(t){for(var e in this._musics)this._musics[e].setVolume(t)},Object.defineProperty(e.prototype,"enableMusics",{get:function(){return this._enableMusics},set:function(t){t?this.unmuteMusics():this.muteMusics()},enumerable:!0,configurable:!0}),e.prototype.addSoundSprite=function(t,e){this._soundSprites[t]=e,this._enableSoundsSprites||e.mute()},e.prototype.getSoundSprite=function(t){var e=this._soundSprites[t];return e||(r.logger.error("Can't find sound sprite with name: "+t+". Sprite may not be loaded yet or load failed."),null)},e.prototype.muteSoundSprites=function(t,e){var i=this._soundSprites[t];null!=i&&(e?i.mute():i.unmute())},e.prototype.muteSoundsSprites=function(){for(var t in this._soundSprites)this._soundSprites[t].mute();this._enableSoundsSprites=!1},e.prototype.unmuteSoundsSprites=function(){for(var t in this._soundSprites)this._soundSprites[t].unmute();this._enableSoundsSprites=!0},e.prototype.volumeSoundsSprites=function(t){for(var e in this._soundSprites)this._soundSprites[e].setVolume(t)},Object.defineProperty(e.prototype,"enableSoundsSprites",{get:function(){return this._enableSoundsSprites},set:function(t){t?this.unmuteSoundsSprites():this.muteSoundsSprites()},enumerable:!0,configurable:!0}),e.prototype.onVisibilityChange=function(t){t?(this.enableMusics=this._musicWasEnable,this.enableSoundsSprites=this._soundWasEnable):(this._musicWasEnable=this._enableMusics,this._soundWasEnable=this._enableSoundsSprites,this.muteMusics(),this.muteSoundsSprites())},e.get=function(){return e._INSTANCE},e}();r.AudioManager=t}(plume||(plume={})),function(t){var e=function(r){function t(t,e){var i=r.call(this,t)||this;if((i._spriteName=null)!=e)for(var n in e){i._spriteName=n;break}return i}return __extends(t,r),t.prototype.play=function(t){return r.prototype.play0.call(this,this._spriteName,t)},t}(t.AbstractSound);t.Music=e}(plume||(plume={})),function(t){var e=function(i){function t(t){return i.call(this,t)||this}return __extends(t,i),t.prototype.play=function(t,e){return i.prototype.play0.call(this,t,e)},t}(t.AbstractSound);t.Sound=e}(plume||(plume={})),function(l){var t=function(){function n(t,e,i){void 0===i&&(i={}),this._lastTick=0,this._updatables=[],this._renderables=[],this.timeScale=1,this.physicsTimeScale=1,this._doingUpdate=!1,this._afterUpdate=[],this._trackStats=!1,n.instance=this,i.gameLoop=i.gameLoop||{},i.gameLoop.desiredFps=i.gameLoop.desiredFps||60,i.gameLoop.forceSetTimeout=i.gameLoop.forceSetTimeout||!1,i.gameLoop.smoothDelta=i.gameLoop.smoothDelta||!1,i.input=i.input||{},i.input.maxTouchPointer=i.input.maxTouchPointer||1,this._lastTick=performance.now(),this._bounds=new l.Rectangle(0,0,t,e),this.options=i,this.timeManager=l.TimeManager.get(),this.deviceManager=new l.DeviceManager,this.audioManager=this.newAudioManager()}return n.prototype.start=function(){var t=this;this.deviceManager.whenReady(function(){try{t.start0()}catch(t){l.logger.error("Error occured while starting game",t)}})},n.prototype.newAudioManager=function(){return new l.AudioManager(this.deviceManager.visibilityManager)},n.prototype.newScaleManager=function(){return new l.ScaleManager(this)},n.get=function(){return n.instance},n.options=function(){return n.instance.options},n.prototype.start0=function(){var t=this;this.scaleManager=this.newScaleManager(),this.mainLoop=new l.MainLoop(this.update.bind(this),this.render.bind(this)),this.mainLoop.start(),this.inputManager=new l.InputManager(this),this.onCreate(),window.addEventListener("load",function(){t.scaleManager.resize()}),window.parent&&document.addEventListener("click",function(){document.hasFocus()||window.focus()},!1)},n.prototype.initializeEngine=function(t){this._engine=t,this.inputManager.mouse.enableOnElement(t.canvas)},n.prototype.initializeGui=function(t){this._gui=t},n.prototype.initializeSimulation=function(t){this._simulation=t},n.prototype.onCreate=function(){},n.prototype.update=function(t,e){e*=this.timeScale;var i=this._lastTick;if(this._lastTick=performance.now(),this._trackStats){var n=this._lastTick-i;this._deltaStat.sum+=n,this._deltaStat.count+=1}l.Time._refresh(t);var r=performance.now();this._doingUpdate=!0;try{this.inputManager.update(e),this.timeManager.update(e);for(var o=0;o<this._updatables.length;o++)this._updatables[o].update(e);if(null!=this._simulation&&this._simulation.running&&this._simulation.update(e*this.physicsTimeScale),this._gui&&this._gui.update(e),this._doingUpdate=!1,0<this._afterUpdate.length){for(o=0;o<this._afterUpdate.length;o++)this._afterUpdate[o]();this._afterUpdate=[]}}catch(t){l.logger.error("Error occured in game update:"+t.message,t),this._doingUpdate=!1}var s=performance.now();if(this._trackStats){var a=s-r;this._updateStat.sum+=a,this._updateStat.count+=1}},n.prototype.render=function(t,e,i){e*=this.timeScale;var n=performance.now();try{for(var r=0;r<this._renderables.length;r++)this._renderables[r].render(i);this._engine&&this._engine.render(e,i),this._gui&&this._gui.render(e,i)}catch(t){l.logger.error("Error occured in game render: ",t)}var o=performance.now();if(this._trackStats){var s=o-n;this._renderStat.sum+=s,this._renderStat.count+=1}null!=l.ephemeralPool&&l.ephemeralPool.clean()},n.prototype.addRenderable=function(t){this._renderables.push(t)},n.prototype.removeRenderable=function(t){var e=this._renderables.indexOf(t);0<=e&&this._renderables.splice(e,1)},n.prototype.addUpdatable=function(t){if(this._doingUpdate){var e=this;this._afterUpdate.push(function(){e._updatables.push(t)})}else this._updatables.push(t)},n.prototype.removeUpdatable=function(t){if(this._doingUpdate){var e=this;this._afterUpdate.push(function(){e.removeUpdatable(t)})}else{var i=this._updatables.indexOf(t);0<=i&&this._updatables.splice(i,1)}},n.prototype.getGui=function(){return this._gui},Object.defineProperty(n.prototype,"engine",{get:function(){return this._engine},set:function(t){throw new Error("use initializeEngine()")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"simulation",{get:function(){return this._simulation},set:function(t){this._simulation=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"trackStats",{get:function(){return this._trackStats},set:function(t){this._trackStats=!0,this._updateStat={count:0,start:performance.now(),sum:0},this._renderStat={count:0,start:performance.now(),sum:0},this._deltaStat={count:0,start:performance.now(),sum:0}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._bounds.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._bounds.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0}),n}();l.Game=t}(plume||(plume={})),function(r){var o=function(){function t(t,e,i){void 0===i&&(i=60),this.callback=t,this.forceSetTimeOut=e,this._running=!1,this._setTimeoutSleep=1e3/i,this._onSetTimeoutCbBound=this._onSetTimeoutCb.bind(this),this._onRafCbBound=this._onRafCb.bind(this)}return t.prototype.start=function(){this._running||(this._running=!0,this._tick=performance.now(),this._timeoutId=this.forceSetTimeOut?window.setTimeout(this._onSetTimeoutCbBound,0):window.requestAnimationFrame(this._onRafCbBound))},t.prototype.stop=function(){this._running&&(this._running=!1,this.forceSetTimeOut?clearTimeout(this._timeoutId):window.cancelAnimationFrame(this._timeoutId))},t.prototype._onSetTimeoutCb=function(){this._tick=performance.now(),this.callback(this._tick);var t=Math.min(this._setTimeoutSleep,performance.now()-this._tick);this._timeoutId=window.setTimeout(this._onSetTimeoutCbBound,t)},t.prototype._onRafCb=function(t){this._tick=t,this.callback(t),this._timeoutId=window.requestAnimationFrame(this._onRafCbBound)},t}();r.RequestAnimationFrame=o;var t=function(){function t(t,e){this.updateCb=t,this.renderCb=e,this._started=!1,this._lastTime=0,this._deltaHistoryIndex=0,this._deltaHistoryCount=10,this._deltaHistory=[],this._frameDelta=0}return t.prototype.start=function(){if(!this._started){var t=r.Game.get().options.gameLoop,e=null!=t&&null!=t.desiredFps?t.desiredFps:60,i=null!=t&&null!=t.forceSetTimeout&&t.forceSetTimeout;if(this._started=!0,this._targetDeltaTime=1e3/e,this._timestep=1e3/e,this._lastTime=performance.now(),t.smoothDelta){this._raf=new o(this._ticksmooth.bind(this),i,e);for(var n=0;n<this._deltaHistoryCount;n++)this._deltaHistory[n]=this._targetDeltaTime}else this._raf=new o(this._tick.bind(this),i,e);this._raf.start()}},t.prototype._tick=function(t){var e=(t=performance.now())-this._lastTime;e=Math.min(e,100);var i=r.Mathf.clamp(this._targetDeltaTime/e,0,1);this._lastTime=t,this.updateCb(t,e),this.renderCb(t,e,i)},t.prototype._ticksmooth=function(t){var e=(t=performance.now())-this._lastTime;100<e&&(e=this._deltaHistory[this._deltaHistoryIndex]),this._deltaHistory[this._deltaHistoryIndex]=e,this._deltaHistoryIndex++,this._deltaHistoryIndex>=this._deltaHistoryCount&&(this._deltaHistoryIndex=0);for(var i=0,n=0;n<this._deltaHistoryCount;n++)i+=this._deltaHistory[n];var r=(i/=this._deltaHistoryCount)/e;this._lastTime=t,this.updateCb(t,i),this.renderCb(t,e,r)},t.prototype.stop=function(){this._started&&(this._started=!1,this._raf.stop())},t}();r.MainLoop=t}(plume||(plume={})),plume||(plume={}),function(t){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!t.performance||!t.performance.now){var e=Date.now();t.performance||(t.performance={}),t.performance.now=function(){return Date.now()-e}}for(var n=Date.now(),i=["ms","moz","webkit","o"],r=0;r<i.length&&!t.requestAnimationFrame;++r)t.requestAnimationFrame=t[i[r]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[r]+"CancelAnimationFrame"]||t[i[r]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),i=16+n-e;return i<0&&(i=0),n=e,setTimeout(function(){n=Date.now(),t(performance.now())},i)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(window),function(e){var t=function(){function t(t){this._pendingResize=!1,this.enable=!0,this.canvasToResize=[],this._game=t,this.init()}return t.prototype.init=function(){this._scalingStategy=new i;var t=this;window.addEventListener("resize",function(){t._pendingResize||(t._pendingResize=!0,window.setTimeout(function(){t.resize()},50))}),window.addEventListener("deviceOrientation",function(){t._pendingResize||(t._pendingResize=!0,window.setTimeout(function(){t.resize()},50))}),this.resizeHandler=new e.Handler,this.resize()},t.prototype.resize=function(){if(this._pendingResize=!1,this.enable){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;if(null!=this._windowSizeProvider){var i=this._windowSizeProvider();t=i.width,e=i.height}var n=this._game.bounds;this._currentScaling=this._scalingStategy.getScaling(n.width,n.height,t,e),window.scrollTo&&window.scrollTo(0,0),this.resizeHandler.fire({})}},t.prototype.setWindowSizeProvider=function(t){this._windowSizeProvider=t},t.prototype.setScalingStategy=function(t){this._scalingStategy=t},t.prototype.getAbsoluteGameSize=function(){var t=e.Game.get();return{width:t.width*this._currentScaling.scale,height:t.height*this._currentScaling.scale,marginX:this._currentScaling.x,marginY:this._currentScaling.y}},t.prototype.getWindowSize=function(){return{width:this._currentScaling.windowWidth,height:this._currentScaling.windowHeight}},t.prototype.getCurrentScaling=function(){return this._currentScaling},Object.defineProperty(t.prototype,"offsetX",{get:function(){return this._currentScaling.x},set:function(t){this._currentScaling.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return this._currentScaling.y},set:function(t){this._currentScaling.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._currentScaling.scale},set:function(t){this._currentScaling.scale=t},enumerable:!0,configurable:!0}),t}();e.ScaleManager=t;var i=function(){function t(){}return t.prototype.getScaling=function(t,e,i,n){var r=e/t<n/i?i/t:n/e;return{x:(i-t*r)/2,y:(n-e*r)/2,scale:r,windowWidth:i,windowHeight:n}},t}();e.FitScalingStrategy=i;var n=function(){function t(){}return t.prototype.getScaling=function(t,e,i,n){var r=n/i<e/t?i/t:n/e;return{x:(i-t*r)/2,y:(n-e*r)/2,scale:r,windowWidth:i,windowHeight:n}},t}();e.FillScalingStrategy=n}(plume||(plume={})),function(t){var e,i;e=t.core||(t.core={}),(i=e.shaders||(e.shaders={})).skydome_fragment="uniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float offset;\nuniform float exponent;\nvarying vec3 vWorldPosition;\nvoid main() {\nfloat h = normalize( vWorldPosition + offset ).y;\ngl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );\n}",i.skydome_vertex="varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"}(plume||(plume={})),function(i){var t=function(){function o(){}return o.merge=function(t,e){for(var i in t){var n=t[i],r=typeof n;"constructor"!==r&&"function"!=r&&(i in e&&"object"==typeof n?o.merge(n,e[i]):e[i]=n)}},o.safeJson=function(e,t){if(void 0===t&&(t=null),null==e||0==e.length)return t;try{return JSON.parse(e)}catch(t){i.logger.error("Failed to parse json data="+e,t)}return t},o}();i.JSONS=t}(plume||(plume={})),function(o){var t=function(){function r(){}return r.setAvailableLocales=function(t){r.availableLocales=t},r.registerTranslation=function(t,e){null==r.translations[t]&&(r.translations[t]={}),o.JSONS.merge(e,r.translations[t])},r.setDefaultLocale=function(t){r.defaultLocale=t},r.setLocale=function(t){r.locale=0<=r.availableLocales.indexOf(t)?t:r.defaultLocale},r.isAvailableLocale=function(t){return 0<=r.availableLocales.indexOf(t)},r.get=function(t,e){var i=r.translations[r.locale][t];if(i)return null!=e?o.Strings.interpolate(i,e):i;var n=r.translations[r.defaultLocale][t];return n?null!=e?o.Strings.interpolate(n,e):n:t},r.getPluralForm=function(t,e){null==e&&(e=r.locale);return"fr"==e?1<t?1:0:"lv"==e?0==t?0:t%10==1&&t%100!=11?1:2:"pl"==e?1==t?0:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?1:2:"ru"==e?t%10==1&&t%100!=11?0:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?1:2:1==t?0:1},r.getPlural=function(t,e,i){null==i&&(i={n:t});var n=r.getPluralForm(t);return r.get(e+"_F"+n,i)},r.availableLocales=[],r.defaultLocale="en",r.locale="en",r.translations=[],r}();o.I18N=t}(plume||(plume={})),function(e){var t=function(){function t(){this.isDown=!1,this.isUp=!0,this.isJustDown=!1,this.isJustUp=!1,this.timeDown=0,this.timeUp=0,this.downDuration=0,this.justUpdated=!1,this._duration=0}return t.prototype.update=function(){this.isDown&&(this.downDuration=e.Time.now()-this.timeDown),this.justUpdated?(this.isJustDown=this.isDown,this.isJustUp=this.isUp):(this.isJustDown=!1,this.isJustUp=!1),this.justUpdated=!1},t.prototype.onDown=function(){this.isDown||(this.justUpdated=!0,this.isDown=!0,this.isUp=!1,this.timeDown=e.Time.now(),this.downDuration=0)},t.prototype.onUp=function(){this.isUp||(this.justUpdated=!0,this.isDown=!1,this.isUp=!0,this.timeUp=e.Time.now())},t}();e.AbstractInput=t}(plume||(plume={})),function(e){var t=function(){function t(t){this._pointerDirty=!1,this._maxTouchPointer=1,this._disabled=!1,this.mouseEventInterpretors=[],this.noCursor=!1,this._maxTouchPointer=null==t.options.input?1:null==t.options.input.maxTouchPointer?1:t.options.input.maxTouchPointer,this.desktop=t.deviceManager.os.desktop,this.keyboard=new e.KeyboardHandler(t,this),this.mouse=new e.MouseHandler(t,this)}return t.prototype.update=function(t){if(!this._disabled){this.keyboard.update(),this.mouse.update();for(var e=0;e<this.mouseEventInterpretors.length;e++)this.mouseEventInterpretors[e].onUpdate()}},t.prototype.triggerImmediateClick=function(){for(var t=0;t<this.mouseEventInterpretors.length;t++)this.mouseEventInterpretors[t].onImmediate()},t.prototype._triggerMouseHit=function(){},Object.defineProperty(t.prototype,"maxTouchPointer",{get:function(){return this._maxTouchPointer},enumerable:!0,configurable:!0}),t.prototype.enable=function(){this._disabled=!1},t.prototype.disable=function(){this._disabled=!0,this.mouse.update()},t.prototype.hideCursor=function(){this.noCursor=!0},t}();e.InputManager=t}(plume||(plume={})),function(t){var e=function(){function t(){}return t.fromChar=function(t){return t.charCodeAt(0)-32},t.SHIFT=17,t.CTRL=17,t.ALT=18,t.SPACEBAR=32,t.LEFT=37,t.PAGEUP=33,t.PAGEDOWN=34,t.END=35,t.HOME=36,t.UP=38,t.RIGHT=39,t.DOWN=40,t.INSERT=45,t.DELETE=46,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t}();t.KeyCode=e}(plume||(plume={})),function(t){var e=function(i){function t(t){var e=i.call(this)||this;return e.keycode=t,e}return __extends(t,i),t.prototype.keyDown=function(t){this.isDown||(this.event=t,i.prototype.onDown.call(this))},t.prototype.keyUp=function(t){this.isUp||(this.event=t,i.prototype.onUp.call(this))},t}(t.AbstractInput);t.KeyInput=e}(plume||(plume={})),function(n){var t=function(){function t(t,e){var i=this;this._enable=!1,this.keys=[],this.keysByCode=new n.HashMap,this.propagatedKeys=[],this.propagateAllKeys=!1,this._keydown=function(t){var e=i._ensureKey(t.which,t.code);e.keyDown(t),i.keyDownHandlers.fire(e),i._stopEvent(t)},this._keyup=function(t){var e=i._ensureKey(t.which,t.code);e.keyUp(t),i.keyUpHandlers.fire(e),i._stopEvent(t)},this.enable(),this.propagatedKeys.push(n.KeyCode.F5),this.propagatedKeys.push(n.KeyCode.F12),this.keyUpHandlers=new n.Handler,this.keyDownHandlers=new n.Handler}return t.prototype.update=function(){if(this.enable)for(var t=0;t<this.keys.length;t++){var e=this.keys[t];null!=e&&e.update()}},t.prototype.enable=function(){this._enable||(this._enable=!0,window.addEventListener("keydown",this._keydown,!1),window.addEventListener("keyup",this._keyup,!1))},t.prototype.disable=function(){this._enable&&(this._enable=!1,window.removeEventListener("keydown",this._keydown),window.removeEventListener("keyup",this._keyup))},t.prototype.key=function(t){return this._getInput(t)},t.prototype.isDown=function(t){var e=this._getInput(t);return null!=e&&e.isDown},t.prototype.isUp=function(t){var e=this._getInput(t);return null==e||e.isUp},t.prototype.isJustDown=function(t){var e=this._getInput(t);return null!=e&&e.isJustDown},t.prototype.isJustUp=function(t){var e=this._getInput(t);return null!=e&&e.isJustUp},t.prototype._stopEvent=function(t){if(!this.propagateAllKeys){var e=t.which;e&&n.Collections.contains(this.propagatedKeys,e)||(t.preventDefault(),t.stopPropagation())}},t.prototype._ensureKey=function(t,e){var i=this.keys[t];return null==i&&(i=new n.KeyInput(t),this.keys[t]=i,this.keysByCode.put(e,i)),i},t.prototype._getInput=function(t){return"number"==typeof t?this.keys[t]:this.keysByCode.get(t)},t}();n.KeyboardHandler=t}(plume||(plume={})),function(n){var t=function(){function t(t,e){var r=this;this._enable=!1,this._touchEndFired=!1,this.propagateAllEvents=!1,this.wheelDelta=0,this._lastWheel=0,this._mousedown=function(t){r.pointer.mouseDown(t),r.inputManager._pointerDirty=!0,r._stopEvent(t)},this._mousemove=function(t){r.pointer.mouseMove(t),r.inputManager._pointerDirty=!0,r._stopEvent(t)},this._mouseup=function(t){r.pointer.mouseUp(t),r.inputManager._pointerDirty=!0,r._stopEvent(t)},this._mouseout=function(t){},this._contextmenu=function(t){r._stopEvent(t)},this._mousewheel=function(t){if(t.deltaY){var e=t.deltaY;e<-1?e=-1:1<e&&(e=1),0!=e&&(r._lastWheel=e,r.wheelDelta=e,r.mouseWheelHandlers.fire({delta:e,event:t}))}r._stopEvent(t)},this._touchstart=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n=r._getPointerOrFirstFree(i);null!=n&&n.touchDown(i)}r.inputManager._pointerDirty=!0,r._stopEvent(t)},this._touchmove=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n=r._getPointerOrFirstFree(i);null!=n&&n.touchMove(i)}r.inputManager._pointerDirty=!0,r._stopEvent(t)},this._touchend=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n=r._getPointerOrFirstFree(i);null!=n&&n.touchUp(i)}r.inputManager._pointerDirty=!0,r._touchEndFired?r._stopEvent(t):r._touchEndFired=!0},this._touchcancel=function(t){r._touchend(t)},this._touchleave=function(t){r._touchend(t)},this.game=t,this.inputManager=e,this.pointer=new n.PointerInput(t,e),this.pointers=new Array(e.maxTouchPointer),this.pointers[0]=this.pointer;for(var i=1;i<e.maxTouchPointer;i++)this.pointers[i]=new n.PointerInput(t,e);this.mouseWheelHandlers=new n.Handler}return t.prototype.update=function(){for(var t=0;t<this.pointers.length;t++)this.pointers[t].update();this.wheelDelta=this._lastWheel,this._lastWheel=0},t.prototype.enableOnElement=function(t){this.disable(),this._element=t,this.enable()},t.prototype.enable=function(){if(!this._enable){if(null==this._element)throw new Error("No element specified for mouse event handling");this._enable=!0,this._element.addEventListener("mousedown",this._mousedown),this._element.addEventListener("mousemove",this._mousemove),this._element.addEventListener("mouseup",this._mouseup),this._element.addEventListener("mouseout",this._mouseout),this._element.addEventListener("wheel",this._mousewheel),this._element.addEventListener("contextmenu",this._contextmenu),this._element.addEventListener("touchstart",this._touchstart),this._element.addEventListener("touchmove",this._touchmove),this._element.addEventListener("touchend",this._touchend),this._element.addEventListener("touchcancel",this._touchcancel),this._element.addEventListener("touchleave",this._touchleave)}},t.prototype.disable=function(){this._enable&&null!=this._element&&(this._enable=!1,this._element.removeEventListener("mousedown",this._mousedown),this._element.removeEventListener("mousemove",this._mousemove),this._element.removeEventListener("mouseup",this._mouseup),this._element.removeEventListener("mouseout",this._mouseout),this._element.removeEventListener("wheel",this._mousewheel),this._element.removeEventListener("contextmenu",this._contextmenu),this._element.removeEventListener("touchstart",this._touchstart),this._element.removeEventListener("touchmove",this._touchmove),this._element.removeEventListener("touchend",this._touchend),this._element.removeEventListener("touchcancel",this._touchcancel),this._element.removeEventListener("touchleave",this._touchleave))},Object.defineProperty(t.prototype,"isDown",{get:function(){return this.pointer.isDown},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUp",{get:function(){return this.pointer.isUp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isJustDown",{get:function(){return this.pointer.isJustDown},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isJustUp",{get:function(){return this.pointer.isJustUp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"downDuration",{get:function(){return this.pointer.downDuration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"downPosition",{get:function(){return this.pointer.downPosition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.pointer.position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upPosition",{get:function(){return this.pointer.upPosition},enumerable:!0,configurable:!0}),t.prototype._getPointerOrFirstFree=function(t){for(var e=t.identifier,i=null,n=null,r=0;r<this.pointers.length;r++){var o=this.pointers[r];if(null==o.identifier&&null==i)i=o;else if(o.identifier==e){n=o;break}}return null!=n?n:i},t.prototype._stopEvent=function(t){this.propagateAllEvents||(t.preventDefault(),t.stopPropagation())},t.prototype._debugTouch=function(t,e){for(var i="",n=0;n<e.changedTouches.length;n++)i+=""+e.changedTouches[n].identifier,n<e.changedTouches.length-1&&(i+=",");console.log("#### MouseHandler: "+t+", changes: "+i)},t}();n.MouseHandler=t}(plume||(plume={})),function(r){var t=function(n){function t(t,e){var i=n.call(this)||this;return i.downPosition=new r.Point(0,0),i.position=new r.Point(0,0),i.upPosition=new r.Point(0,0),i.diffPosition=new r.Point(0,0),i.mouseActive=!1,i._previousHit=null,i._lastDownTarget=null,i._touchInProgress=!1,i._touchEndTime=0,i._touchEndDebounce=4e3,i._prevMousePosition=new r.Point(-1,-1),i._prevMouseBState=-1,i._lastX=0,i._lastY=0,i.inputManager=e,i.scaleManager=t.scaleManager,i}return __extends(t,n),t.prototype.update=function(){n.prototype.update.call(this),null!=this._touchEndTime&&this._touchEndTime<r.Time.now()&&(this._touchEndTime=null,this._touchInProgress=!1),this.diffPosition.x=this.position.x-this._lastX,this.diffPosition.y=this.position.y-this._lastY,this._lastX=this.position.x,this._lastY=this.position.y,this.isUp&&null!=this.identifier&&this._releasePointer()},t.prototype.isActive=function(){return this.mouseActive||null!=this.identifier},t.prototype.mouseDown=function(t){this._touchInProgress||this.isDown||(n.prototype.onDown.call(this),this.downPosition.x=this._getXValue(t.pageX),this.downPosition.y=this._getYValue(t.pageY),this.position.x=this.downPosition.x,this.position.y=this.downPosition.y,this.diffPosition.x=0,this.diffPosition.y=0,this._lastX=this.position.x,this._lastY=this.position.y,this._lastMouseEvent=t)},t.prototype.mouseMove=function(t){this.position.x=this._getXValue(t.pageX),this.position.y=this._getYValue(t.pageY),this._lastMouseEvent=t,this.mouseActive=!0},t.prototype.mouseUp=function(t){this._touchInProgress||this.isUp||(n.prototype.onUp.call(this),this.upPosition.x=this._getXValue(t.pageX),this.upPosition.y=this._getYValue(t.pageY),this._lastMouseEvent=t,this.inputManager.triggerImmediateClick())},t.prototype.touchDown=function(t){this.isDown||null==this.identifier&&(n.prototype.onDown.call(this),this._touchInProgress=!0,this._touchEndTime=null,this.identifier=t.identifier,this.downPosition.x=this._getXValue(t.pageX),this.downPosition.y=this._getYValue(t.pageY),this.position.x=this.downPosition.x,this.position.y=this.downPosition.y,this._acquirePointer())},t.prototype.touchMove=function(t){this.isDown&&this.identifier==t.identifier&&(this._touchInProgress=!0,this.position.x=this._getXValue(t.pageX),this.position.y=this._getYValue(t.pageY))},t.prototype.touchUp=function(t){this.isUp||this.identifier==t.identifier&&(n.prototype.onUp.call(this),this._touchInProgress=!0,this._touchEndTime=r.Time.now()+this._touchEndDebounce,this.upPosition.x=this._getXValue(t.pageX),this.upPosition.y=this._getYValue(t.pageY),this.inputManager.triggerImmediateClick())},t.prototype._getXValue=function(t){return Math.round((t-this.scaleManager.offsetX)/this.scaleManager.scale)},t.prototype._getYValue=function(t){return Math.round((t-this.scaleManager.offsetY)/this.scaleManager.scale)},t.prototype._acquirePointer=function(){this._prevMousePosition.x=-1,this._prevMousePosition.y=-1,this._prevMouseBState=-1},t.prototype._releasePointer=function(){this.identifier=null},t.prototype.mouseChanged=function(){var t=!1,e=this.isDown?0:1,i=this.position.x,n=this.position.y;return e!=this._prevMouseBState&&(t=!0),t||this._prevMousePosition.x==i&&this._prevMousePosition.y==n||(t=!0),this._prevMouseBState=e,this._prevMousePosition.x=i,this._prevMousePosition.y=n,t},t.prototype.wasSwipe=function(){return 60<=r.Point.distance(this.upPosition,this.downPosition)},t.prototype.getLastMouseEvent=function(){return this._lastMouseEvent},t}(r.AbstractInput);r.PointerInput=t}(plume||(plume={})),function(t){var e=function(){function t(t,e,i){void 0===i&&(i=!0),this.object=t,this.domElement=e,this.handleMouseEvent=i,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._changeEvent={type:"change"},this._startEvent={type:"start"},this._endEvent={type:"end"},this._state=-1,this._EPS=1e-6,this._spherical=new THREE.Spherical,this._sphericalDelta=new THREE.Spherical,this._scale=1,this._panOffset=new THREE.Vector3,this._zoomChanged=!1,this._rotateStart=new THREE.Vector2,this._rotateEnd=new THREE.Vector2,this._rotateDelta=new THREE.Vector2,this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this._panDelta=new THREE.Vector2,this._dollyStart=new THREE.Vector2,this._dollyEnd=new THREE.Vector2,this._dollyDelta=new THREE.Vector2,null==e&&(this.domElement=window.document.body),this.handleMouseEvent&&(this._onContextMenuBound=this._onContextMenu.bind(this),this._onMouseDownBound=this._onMouseDown.bind(this),this._onMouseWheelBound=this._onMouseWheel.bind(this),this._onMouseMoveBound=this._onMouseMove.bind(this),this._onMouseUpBound=this._onMouseUp.bind(this),this._onTouchStartBound=this._onTouchStart.bind(this),this._onTouchMoveBound=this._onTouchMove.bind(this),this._onTouchEndBound=this._onTouchEnd.bind(this),this.domElement.addEventListener("contextmenu",this._onContextMenuBound,!1),this.domElement.addEventListener("mousedown",this._onMouseDownBound,!1),this.domElement.addEventListener("wheel",this._onMouseWheelBound,!1),this.domElement.addEventListener("touchstart",this._onTouchStartBound,!1),this.domElement.addEventListener("touchend",this._onTouchEndBound,!1),this.domElement.addEventListener("touchmove",this._onTouchMoveBound,!1)),this.update()}return t.prototype.getPolarAngle=function(){return this._spherical.phi},t.prototype.getAzimuthalAngle=function(){return this._spherical.theta},t.prototype.saveState=function(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom},t.prototype.reset=function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._DispatchEvent(this._changeEvent),this.update(),this._state=-1},t.prototype._DispatchEvent=function(t){},t.prototype.update=function(){var t=new THREE.Vector3,e=(new THREE.Quaternion).setFromUnitVectors(this.object.up,new THREE.Vector3(0,1,0)),i=e.clone().inverse(),n=new THREE.Vector3,r=new THREE.Quaternion,o=this.object.position;return t.copy(o).sub(this.target),t.applyQuaternion(e),this._spherical.setFromVector3(t),this.autoRotate&&-1===this._state&&this._rotateLeft(this._getAutoRotationAngle()),this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi,this._spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this._spherical.radius*=this._scale,this._spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this._spherical.radius)),this.target.add(this._panOffset),t.setFromSpherical(this._spherical),t.applyQuaternion(i),o.copy(this.target).add(t),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this._scale=1,!!(this._zoomChanged||1e-6<n.distanceToSquared(this.object.position)||1e-6<8*(1-r.dot(this.object.quaternion)))&&(this._DispatchEvent(this._changeEvent),n.copy(this.object.position),r.copy(this.object.quaternion),!(this._zoomChanged=!1))},t.prototype.dispose=function(){this.handleMouseEvent&&(this.domElement.removeEventListener("contextmenu",this._onContextMenuBound,!1),this.domElement.removeEventListener("mousedown",this._onMouseDownBound,!1),this.domElement.removeEventListener("wheel",this._onMouseWheelBound,!1),this.domElement.removeEventListener("touchstart",this._onTouchStartBound,!1),this.domElement.removeEventListener("touchend",this._onTouchEndBound,!1),this.domElement.removeEventListener("touchmove",this._onTouchMoveBound,!1),document.removeEventListener("mousemove",this._onMouseMoveBound,!1),document.removeEventListener("mouseup",this._onMouseUpBound,!1))},t.prototype._getAutoRotationAngle=function(){return 2*Math.PI/60/60*this.autoRotateSpeed},t.prototype._getZoomScale=function(){return Math.pow(.95,this.zoomSpeed)},t.prototype._rotateLeft=function(t){this._sphericalDelta.theta-=t},t.prototype._rotateUp=function(t){this._sphericalDelta.phi-=t},t.prototype._panLeft=function(t,e){var i=new THREE.Vector3;i.setFromMatrixColumn(e,0),i.multiplyScalar(-t),this._panOffset.add(i)},t.prototype._panUp=function(t,e){var i=new THREE.Vector3;!0===this.screenSpacePanning?i.setFromMatrixColumn(e,1):(i.setFromMatrixColumn(e,0),i.crossVectors(this.object.up,i)),i.multiplyScalar(t),this._panOffset.add(i)},t.prototype._pan0=function(t,e){var i=new THREE.Vector3,n=this.object.position;i.copy(n).sub(this.target);var r=i.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*r/this.domElement.clientHeight,this.object.matrix),this._panUp(2*e*r/this.domElement.clientHeight,this.object.matrix)},t.prototype.dollyIn=function(t,e){void 0===e&&(e=!0),this._scale/=t,e&&this.update()},t.prototype.dollyOut=function(t,e){void 0===e&&(e=!0),this._scale*=t,e&&this.update()},t.prototype.startRotate=function(t,e){this._rotateStart.set(t,e)},t.prototype.startDolly=function(t,e){this._dollyStart.set(t,e)},t.prototype.startPan=function(t,e){this._panStart.set(t,e)},t.prototype.rotate=function(t,e){this._rotateEnd.set(t,e),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);var i=this.domElement;this._rotateLeft(2*Math.PI*this._rotateDelta.x/i.clientHeight),this._rotateUp(2*Math.PI*this._rotateDelta.y/i.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()},t.prototype.dolly=function(t,e){this._dollyEnd.set(t,e),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),0<this._dollyDelta.y?this.dollyIn(this._getZoomScale(),!1):this._dollyDelta.y<0&&this.dollyOut(this._getZoomScale(),!1),this._dollyStart.copy(this._dollyEnd),this.update()},t.prototype.pan=function(t,e){this._panEnd.set(t,e),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan0(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()},t.prototype._handleMouseDownRotate=function(t){this.startRotate(t.clientX,t.clientY)},t.prototype._handleMouseDownDolly=function(t){this.startDolly(t.clientX,t.clientY)},t.prototype._handleMouseDownPan=function(t){this.startPan(t.clientX,t.clientY)},t.prototype._handleMouseMoveRotate=function(t){this.rotate(t.clientX,t.clientY)},t.prototype._handleMouseMoveDolly=function(t){this.dolly(t.clientX,t.clientY)},t.prototype._handleMouseMovePan=function(t){this.pan(t.clientX,t.clientY)},t.prototype._handleMouseUp=function(t){},t.prototype._handleMouseWheel=function(t){t.deltaY<0?this.dollyOut(this._getZoomScale(),!1):0<t.deltaY&&this.dollyIn(this._getZoomScale(),!1),this.update()},t.prototype._onMouseDown=function(t){if(!1!==this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this._state=0;break;case this.mouseButtons.ZOOM:if(!1===this.enableZoom)return;this._handleMouseDownDolly(t),this._state=1;break;case this.mouseButtons.PAN:if(!1===this.enablePan)return;this._handleMouseDownPan(t),this._state=2}-1!==this._state&&(document.addEventListener("mousemove",this._onMouseMoveBound,!1),document.addEventListener("mouseup",this._onMouseUpBound,!1),this._DispatchEvent(this._startEvent))}},t.prototype._onMouseMove=function(t){if(!1!==this.enabled)switch(this._state){case 0:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(t);break;case 1:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(t);break;case 2:if(!1===this.enablePan)return;this._handleMouseMovePan(t)}},t.prototype._onMouseUp=function(t){!1!==this.enabled&&(this._handleMouseUp(t),document.removeEventListener("mousemove",this._onMouseMoveBound,!1),document.removeEventListener("mouseup",this._onMouseUpBound,!1),this._DispatchEvent(this._endEvent),this._state=-1)},t.prototype._onMouseWheel=function(t){!1===this.enabled||!1===this.enableZoom||-1!==this._state&&0!==this._state||(this._DispatchEvent(this._startEvent),this._handleMouseWheel(t),this._DispatchEvent(this._endEvent))},t.prototype._onContextMenu=function(t){!1!==this.enabled&&t.preventDefault()},t.prototype._onTouchStart=function(t){if(!1!==this.enabled){switch(t.preventDefault(),t.touches.length){case 1:if(!1===this.enableRotate)return;this._handleTouchStartRotate(t),this._state=3;break;case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(t),this._state=4;break;default:this._state=-1}-1!==this._state&&this._DispatchEvent(this._startEvent)}},t.prototype._onTouchMove=function(t){if(!1!==this.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===this.enableRotate)return;if(3!==this._state)return;this._handleTouchMoveRotate(t);break;case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;if(4!==this._state)return;this._handleTouchMoveDollyPan(t);break;default:this._state=-1}},t.prototype._onTouchEnd=function(t){!1!==this.enabled&&(this._handleTouchEnd(t),this._DispatchEvent(this._endEvent),this._state=-1)},t.prototype._handleTouchStartRotate=function(t){this._rotateStart.set(t.touches[0].pageX,t.touches[0].pageY)},t.prototype._handleTouchStartDollyPan=function(t){if(this.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);this._dollyStart.set(0,n)}if(this.enablePan){var r=.5*(t.touches[0].pageX+t.touches[1].pageX),o=.5*(t.touches[0].pageY+t.touches[1].pageY);this._panStart.set(r,o)}},t.prototype._handleTouchMoveRotate=function(t){this._rotateEnd.set(t.touches[0].pageX,t.touches[0].pageY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);var e=this.domElement;this._rotateLeft(2*Math.PI*this._rotateDelta.x/e.clientHeight),this._rotateUp(2*Math.PI*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()},t.prototype._handleTouchMoveDollyPan=function(t){if(this.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);this._dollyEnd.set(0,n),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this.dollyIn(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd)}if(this.enablePan){var r=.5*(t.touches[0].pageX+t.touches[1].pageX),o=.5*(t.touches[0].pageY+t.touches[1].pageY);this.pan(r,o)}this.update()},t.prototype._handleTouchEnd=function(t){},t}();t.OrbitControls=e}(plume||(plume={})),function(t){var e=function(){function f(){}return f.clamp=function(t,e,i){return t<e?t=e:i<t&&(t=i),t},f.clamp01=function(t){return t<0?0:1<t?1:t},f.mod=function(t,e){return(t%e+e)%e},f.lerp=function(t,e,i){return i<=0?t:1<=i?e:(1-i)*t+i*e},f.inverseLerp=function(t,e,i){return t==e?0:(i-t)/(e-t)},f.sign=function(t){return 0<=t?1:-1},f.repeat=function(t,e){return this.mod(t,e)},f.pingPong=function(t,e){t<0&&(t=-t);var i=t%e;return Math.ceil(t/e)%2==0?0===i?0:e-i:0===i?e:i},f.map=function(t,e,i,n,r){return t<e?t=e:i<t&&(t=i),(t-e)*(r-n)/(i-e)+n},f.smoothStep=function(t,e,i){return e*(i=-2*(i=this.clamp01((i-t)/(e-t)))*i*i+3*i*i)+t*(1-i)},f.smoothDamp=function(t,e,i,n,r,o){var s=2/(n=Math.max(1e-4,n)),a=s*(o/=1e3),l=1/(1+a+.48*a*a+.235*a*a*a),h=t-e,u=e;if(null!=r){var c=r*n;h=f.clamp(h,-c,c)}var p=(i+s*h)*o;i=(i-s*p)*l;var d=(e=t-h)+(h+p)*l;return 0<u-t==u<d&&(i=((d=u)-u)/o),{smoothValue:d,newVelocity:i}},f.smoothDampAngle=function(t,e,i,n,r,o){return e=t+this.deltaAngle(t,e),this.smoothDamp(t,e,i,n,r,o)},f.deltaAngle=function(t,e){var i=f.repeat(e-t,this.PI2);return i>Math.PI&&(i-=this.PI2),i},f.PI2=Math.PI,f.DEG2RAD=Math.PI/180,f.RAD2DEG=180/Math.PI,f}();t.Mathf=e}(plume||(plume={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._x=t,this._y=e}return t.prototype.copy=function(){return new t(this._x,this._y)},t.prototype.equals=function(t){return null!=t&&(this.x==t.x&&this.y==t.y)},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this._x+","+this._y},t.distance=function(t,e){var i=0,n=0;return i=e.x-t.x,i*=i,n=e.y-t.y,n*=n,Math.sqrt(i+n)},t}();t.Point=e}(plume||(plume={})),function(e){var t=function(){function t(t,e,i,n){this._left=t,this._top=e,this._width=i,this._height=n}return t.prototype.getCenter=function(){return new e.Point(this._left+Math.round(this._width/2),this._top+Math.round(this._height/2))},t.prototype.containsPoint=function(t){return this.containsPoint2(t.x,t.y)},t.prototype.containsPoint2=function(t,e){return t>=this.left&&t<=this.right&&(e>=this.top&&e<=this.bottom)},t.prototype.overlap=function(t){return this.left<t.right&&this.right>t.left&&this.top<t.bottom&&this.bottom>t.top},t.prototype.toString=function(){return this.x+","+this.y+" | "+this._width+","+this._height},t.prototype.copy=function(){return new t(this._left,this._top,this._width,this._height)},Object.defineProperty(t.prototype,"x",{get:function(){return this._left},set:function(t){this._left=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._left+this._width},set:function(t){this._left=t-this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._top},set:function(t){this._top=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top},set:function(t){this._top=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this._top+this._height},set:function(t){this._top=t-this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!0,configurable:!0}),t}();e.Rectangle=t}(plume||(plume={})),function(t){var e=function(){function t(){}return t.setWorldQuaternion=function(t,e,i){if(null!=t.parent){var n=t.parent.getWorldQuaternion(this._q);n.inverse(),n.multiply(e),null!=i?i.copy(n):t.quaternion.copy(n)}else null!=i?i.copy(e):t.quaternion.copy(e)},t.setWorldPosition=function(t,e,i){if(null!=t.parent){var n=this._v3.copy(e),r=this._m4.getInverse(t.parent.matrixWorld);n.applyMatrix4(r),null!=i?i.copy(n):t.position.copy(n)}else null!=i?i.copy(e):t.position.copy(e)},t.setWorldScale=function(t,e,i){if(null!=t.parent){var n=t.parent.getWorldScale(this._v3);n.x=1/n.x,n.y=1/n.y,n.z=1/n.z,n.multiply(e),null!=i?i.copy(n):t.scale.copy(n)}else null!=i?i.copy(e):t.scale.copy(e)},t._q=new THREE.Quaternion,t._v3=new THREE.Vector3,t._m4=new THREE.Matrix4,t}();t.Transforms=e}(plume||(plume={})),function(t){var e=function(){function t(){}return t.prototype.get=function(t,e,i){var n=this;this._initHTTPRequest(i),this._xhrObject&&(n._xhrObject.open("GET",t,!0),n._xhrObject.onreadystatechange=function(){4==n._xhrObject.readyState&&(200==n._xhrObject.status?e(n._xhrObject.responseText):i("invalid status: "+n._xhrObject.status+" text="+n._xhrObject.responseText+" statusText: "+n._xhrObject.statusText),n._xhrObject.onreadystatechange=null),n._xhrObject.readyState<=0&&(i("invalid ready state: "+n._xhrObject.readyState),n._xhrObject.onreadystatechange=null)},this._xhrObject.onerror=function(t){i("XHR onerror statusText: "+n._xhrObject.statusText)},this._xhrObject.send(null))},t.prototype._initHTTPRequest=function(t){window.XMLHttpRequest?this._xhrObject=new XMLHttpRequest:t("Not Supported")},t.prototype.post=function(t,e,i,n){var r=this;this._initHTTPRequest(n),this._xhrObject&&(r._xhrObject.open("POST",t,!0),r._xhrObject.onreadystatechange=function(){4==r._xhrObject.readyState&&(200==r._xhrObject.status?(i(r._xhrObject.responseText),r._xhrObject.onreadystatechange=null):n("invalid status: "+r._xhrObject.status)),r._xhrObject.readyState<=0&&(n("invalid ready state: "+r._xhrObject.readyState),r._xhrObject.onreadystatechange=null)},this._xhrObject.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this._xhrObject.send(e))},t}();t.HttpRequest=e}(plume||(plume={})),function(o){var t=function(){function n(){}return n.prototype.evaluate=function(t,e){switch(void 0===t&&(t=0),void 0===e&&(e=0),this.mode){case 0:return this.color;case 1:return this.color.set(o.Mathf.lerp(this.colorMin.x,this.colorMax.x,e),o.Mathf.lerp(this.colorMin.y,this.colorMax.y,e),o.Mathf.lerp(this.colorMin.z,this.colorMax.z,e),o.Mathf.lerp(this.colorMin.w,this.colorMax.w,e)),this.color;case 2:return this.gradient.randomColor();case 3:return this.gradient.evaluate(t);case 4:return this.colorMin=this.gradientMin.evaluate(t),this.colorMax=this.gradientMax.evaluate(t),this.color.set(o.Mathf.lerp(this.colorMin.x,this.colorMax.x,e),o.Mathf.lerp(this.colorMin.y,this.colorMax.y,e),o.Mathf.lerp(this.colorMin.z,this.colorMax.z,e),o.Mathf.lerp(this.colorMin.w,this.colorMax.w,e)),this.color}return o.logger.warn("GradientRange mode not implemented "+this.mode),null},n.color=function(t){var e=new n;return e.mode=0,e.color=t,e},n.randomBetweenTwoColor=function(t,e){var i=new n;return i.mode=1,i.colorMin=t,i.colorMax=e,i.color=new THREE.Vector4,i},n.randomColor=function(t){var e=new n;return e.mode=2,e.gradient=t,e},n.gradient=function(t){var e=new n;return e.mode=3,e.gradient=t,e},n.randomBetweenTwoGradient=function(t,e){var i=new n;return i.mode=4,i.gradientMin=t,i.gradientMax=e,i.color=new THREE.Vector4,i},n}();o.GradientRange=t;var e=function(){function t(){this.rgb=new THREE.Color(1,1,1),this.rgba=new THREE.Vector4}return t.prototype.setKeys=function(t,e){return this._colorKeys=t,this._alphaKeys=e,this.sortKeys(),this},t.prototype.sortKeys=function(){1<this._colorKeys.length&&this._colorKeys.sort(function(t,e){return t.time-e.time}),1<this._alphaKeys.length&&this._alphaKeys.sort(function(t,e){return t.time-e.time})},t.prototype.getRGB=function(t){if(1<this._colorKeys.length){t=o.Mathf.repeat(t,1);for(var e=1;e<this._colorKeys.length;++e){var i=this._colorKeys[e-1].time,n=this._colorKeys[e].time;if(i<=t&&t<n){var r=(t-i)/(n-i);return this.rgb.copy(this._colorKeys[e-1].color),this.rgb.lerp(this._colorKeys[e].color,r),this.rgb}}return this.rgb}return 1===this._colorKeys.length?this._colorKeys[0].color:this.rgb},t.prototype.getAlpha=function(t){if(1<this._alphaKeys.length){t=o.Mathf.repeat(t,1);for(var e=1;e<this._alphaKeys.length;++e){var i=this._alphaKeys[e-1].time,n=this._alphaKeys[e].time;if(i<=t&&t<n){var r=(t-i)/(n-i);return this._alphaKeys[e-1].alpha*(1-r)+this._alphaKeys[e].alpha*r}}return this._alphaKeys[this._alphaKeys.length-1].alpha}return 1===this._alphaKeys.length?this._alphaKeys[0].alpha:1},t.prototype.evaluate=function(t){var e=this.getRGB(t);return this.rgba.set(e.r,e.g,e.b,this.getAlpha(t)),this.rgba},t.prototype.randomColor=function(){var t=this._colorKeys[Math.trunc(Math.random()*this._colorKeys.length)].color,e=this._alphaKeys[Math.trunc(Math.random()*this._alphaKeys.length)].alpha;return this.rgba.set(t.r,t.g,t.b,e),this.rgba},t}();o.Gradient=e;var i=function(t,e){this.color=t,this.time=e};o.GradientColorKey=i;var n=function(t,e){this.alpha=t,this.time=e};o.GradientAlphaKey=n}(plume||(plume={})),function(i){var t=function(){function r(){}return r.prototype.evaluate=function(t,e){switch(this.mode){case 0:return this.constant;case 3:return i.Mathf.lerp(this.constantMin,this.constantMax,e);case 1:return this.curve.evaluate(t)*this.multiplier;case 2:return i.Mathf.lerp(this.curveMin.evaluate(t),this.curveMax.evaluate(t),e)*this.multiplier}return i.logger.warn("MinMaxCurve mode not implemented "+this.mode),null},r.constant=function(t){var e=new r;return e.mode=0,e.constant=t,e},r.randomBetweenTwoConstant=function(t,e){var i=new r;return i.mode=3,i.constantMin=t,i.constantMax=e,i},r.curve=function(t,e){void 0===e&&(e=1);var i=new r;return i.mode=1,i.curve=t,i.multiplier=e,i},r.randomBetweenTwoCurve=function(t,e,i){void 0===i&&(i=1);var n=new r;return n.mode=2,n.curveMin=t,n.curveMax=e,n.multiplier=i,n},r}();i.MinMaxCurve=t}(plume||(plume={})),function(t){var e=function(){function t(){this._running=!1}return t.prototype.update=function(t){this._running},t.prototype.setGravity=function(t,e,i){},t.prototype.onStart=function(){},t.prototype.onStop=function(){},Object.defineProperty(t.prototype,"running",{get:function(){return this._running},set:function(t){this._running!=t&&(this._running=t,this._running?this.onStart():this.onStop())},enumerable:!0,configurable:!0}),t}();t.SimulationSupport=e}(plume||(plume={})),function(t){var e=function(){function t(t,e){this._factory=t,this._count=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t()}return Object.defineProperty(t.prototype,"length",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._count=0},t.prototype.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._factory()},t.prototype.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},t.prototype.remove=function(t){var e="number"==typeof t?t:this._data.indexOf(t);if(e>=this._count)return null;var i=this._count-1,n=this._data[e];return this._data[e]=this._data[i],this._data[i]=n,this._count-=1,n},t}();t.RecyclePool=e}(plume||(plume={})),function(e){var t=function(){function t(){this.vectors3=new e.RecyclePool(function(){return new THREE.Vector3},10),this.quaternions=new e.RecyclePool(function(){return new THREE.Quaternion},5),this.matrix4=new e.RecyclePool(function(){return new THREE.Matrix4},5)}return t.prototype.clean=function(){this.vectors3.reset(),this.quaternions.reset()},t.prototype.v3=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this.vectors3.add();return n.set(t,e,i),n},t.prototype.q=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1);var r=this.quaternions.add();return r.set(t,e,i,n),r},t.prototype.m4=function(){var t=this.matrix4.add();return t.identity(),t},t}();e.EphemeralPool=t,e.ephemeralPool=new t}(plume||(plume={})),function(t){var e=function(){function t(){}return t._applyStyle=function(e){["-webkit-","-khtml-","-moz-","-ms-",""].forEach(function(t){e.style[t+"user-select"]="none"}),e.style["-webkit-touch-callout"]="none",e.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)"},t}();t.Renderer=e}(plume||(plume={})),window.THREEEXT=THREE,function(o){var t=function(){function r(t){this._prerender=[],this._postrender=[];var e=this;performance.now();this.game=o.Game.get(),this._options=this._initOption(t),this._initCanvas(),r._INSTANCE=this;var i=window.innerWidth,n=window.innerHeight;this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera(50,i/n),this._camera.position.z=30,this._renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:this._options.antialias,alpha:this._options.alpha}),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(i,n),this._renderer.setClearColor(0,1),this._textureCache=new o.TextureCache,this._loader=new o.Loader3d,this.game.scaleManager.resizeHandler.add(function(){var t=e.game.scaleManager.getWindowSize();e.resize(t.width,t.height)})}return r.get=function(){return r._INSTANCE},r.prototype._initOption=function(t){return null==t&&(t={}),null==t.antialias&&(t.antialias=!0),null==t.alpha&&(t.alpha=!0),null==t.logarithmicDepthBuffer&&(t.logarithmicDepthBuffer=!1),t},r.prototype._initCanvas=function(){null!=this._options.canvasId?this.canvas=document.getElementById(this._options.canvasId):(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.id="canvas3D",document.body.appendChild(this.canvas))},r.prototype.render=function(t,e){if(null==this._effectComposer){for(var i=0;i<this._prerender.length;i++)this._prerender[i].execute(t);this._renderer.render(this._scene,this._camera);for(i=0;i<this._postrender.length;i++)this._postrender[i].execute(t)}else this._effectComposer.render(t)},r.prototype.resize=function(t,e){this._camera.aspect=t/e,this._camera.updateProjectionMatrix(),this._renderer.setSize(t,e)},r.prototype.addRenderable=function(t,e,i){var n=new o.ContextualCallback(t,i);return e?this._prerender.push(n):this._postrender.push(n),n},r.prototype.removeRenderable=function(t){var e=o.ContextualCallback.removeFromArray(t,this._postrender);return!!e||(e=o.ContextualCallback.removeFromArray(t,this._prerender))},Object.defineProperty(r.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scene",{get:function(){return this._scene},set:function(t){this._scene=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"effectComposer",{get:function(){return this._effectComposer},set:function(t){this._effectComposer=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"loader",{get:function(){return this._loader},set:function(t){this._loader=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textureCache",{get:function(){return this._textureCache},enumerable:!0,configurable:!0}),r}();o.Engine=t}(plume||(plume={})),function(v){var t=function(){function t(t){this.keyFrames=t,this.preWrapMode=3,this.postWrapMode=3}return t.prototype.addKey=function(t){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(t)},t.prototype.evaluate=function(t){if(1==this.keyFrames.length)return this.keyFrames[0].value;var e=t,i=t<0?this.preWrapMode:this.postWrapMode,n=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(i){case 1:e=v.Mathf.repeat(t-n,r-n)+n;break;case 2:e=v.Mathf.pingPong(t-n,r-n)+n;break;case 4:e=v.Mathf.clamp(t,n,r)}var o=0;if(e>this.keyFrames[0].time)if(e>=this.keyFrames[this.keyFrames.length-1].time)o=this.keyFrames.length-2;else for(var s=0;s<this.keyFrames.length-1;s++)if(e>=this.keyFrames[0].time&&e<=this.keyFrames[s+1].time){o=s;break}var a=this.keyFrames[o],l=this.keyFrames[o+1],h=v.Mathf.inverseLerp(a.time,l.time,e),u=l.time-a.time,c=a.outTangent*u,p=l.inTangent*u,d=h*h,f=d*h,m=f-2*d+h,y=f-d,g=-2*f+3*d;return(2*f-3*d+1)*a.value+m*c+y*p+g*l.value},t}();v.AnimationCurve=t;var e=function(){function t(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0}return t.prototype.setTime=function(t){return this.time=t,this},t.prototype.setValue=function(t){return this.value=t,this},t}();v.Keyframe=e}(plume||(plume={})),function(t){var e=function(){function t(){}return t.clone=function(t){var n=new Map,e=t.clone();return function t(e,i,n){n(e,i);for(var r=0;r<e.children.length;r++)t(e.children[r],i.children[r],n)}(t,e,function(t,e){n.set(t,e)}),t.traverse(function(t){if(t.isSkinnedMesh){var e=t.skeleton.bones,i=n.get(t);i.skeleton=t.skeleton.clone(),i.skeleton.bones=e.map(function(t){if(!n.has(t))throw new Error("THREE.AnimationUtils: Required bones are not descendants of the given object.");return n.get(t)}),i.bind(i.skeleton,t.bindMatrix)}}),e},t}();t.AnimUtils=e}(plume||(plume={})),function(s){var t=function(){function t(t,e,i){this._texture=t,this._xframes=e,this._yframes=i,this._curIndex=0,this._playing=!1,this._startTime=0,this._lastIndex=-1,this._repeats=1,this.fps=1e3/60,this.animationSpeed=1,this.destroyOnEnd=!0,this._tilesCount=e*i,this._texture.wrapS=t.wrapT=THREE.RepeatWrapping,this._texture.repeat.set(1/this._xframes,1/this._yframes),s.Game.get().addUpdatable(this)}return t.prototype.start=function(){this._playing=!0,this._totalFrames=this._tilesCount,this._curIndex=0,this._startTime=performance.now(),this._SetFrameIndex(0),this._repeats<0?this._lastIndex=-1:this._lastIndex=this._curIndex+this._totalFrames*this._repeats},t.prototype.stop=function(){this._playing=!1},t.prototype.destroy=function(){this.stop(),s.Game.get().removeUpdatable(this)},t.prototype.update=function(t){if(this._playing){var e=Math.floor((performance.now()-this._startTime)/this.fps);e=Math.floor(e*this.animationSpeed),this._SetActiveFrame(e)}},t.prototype.onEnd=function(t){null==this._onEnd&&(this._onEnd=new s.Handler),this._onEnd.add(t)},t.prototype._SetActiveFrame=function(t){if(null!=t){var e=t%this._totalFrames;e!=this._curIndex&&(this._curIndex=e,this._SetFrameIndex(this._curIndex),0<this._lastIndex&&(t=Math.abs(t))>=this._lastIndex&&(this._SetFrameIndex(this._tilesCount-1),this._OnAnimationEnded()))}},t.prototype._SetFrameIndex=function(t){var e=t%this._xframes,i=Math.floor(t/this._xframes);this._texture.offset.x=e/this._xframes,this._texture.offset.y=i/this._yframes},t.prototype._OnAnimationEnded=function(){this._playing=!1,null!=this._onEnd&&this._onEnd.fire({}),this.destroyOnEnd&&this.destroy()},t.prototype.repeat=function(t){void 0===t&&(t=0),this._repeats=t},t.prototype.isPlaying=function(){return this._playing},t.onPlane=function(t,e,i){var n=t.clone();n.needsUpdate=!0;var r=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshBasicMaterial({map:n,transparent:!0,side:THREE.DoubleSide})),o=new s.SpriteAnimation(n,e,i);return o.onEnd(function(){r.parent&&r.parent.remove(r)}),{mesh:r,animator:o,texture:n}},t.onSprite=function(t,e,i){var n=t.clone();n.needsUpdate=!0;var r=new THREE.Sprite(new THREE.SpriteMaterial({map:n,transparent:!0,side:THREE.DoubleSide})),o=new s.SpriteAnimation(n,e,i);return o.onEnd(function(){r.parent&&r.parent.remove(r)}),{mesh:r,animator:o,texture:n}},t}();s.SpriteAnimation=t}(plume||(plume={})),function(u){var t=function(){function t(t,e,i){this._width=t,this._depth=e,this._options=i,this.optFilterR=.3,this.optFilterG=.59,this.optFilterB=.11,this._loaded=!1}return t.prototype.fromImage=function(t){var e=this,i=new Image;i.src=t,i.onload=function(){e._readImg(i)},i.onerror=function(){u.logger.error("Failed to load "+t)},i.complete&&e._readImg(i)},t.prototype.fromPoints=function(t,e,i){this._createGeometry(t,e,i)},t.prototype._readImg=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),n=t.width,r=t.height;e.width=n,e.height=r,i.drawImage(t,0,0);for(var o=[],s=i.getImageData(0,0,n,r).data,a=0;a<s.length;a+=4){var l=s[a+0]/255,h=s[a+1]/255,u=s[a+2]/255,c=l*this.optFilterR+h*this.optFilterG+u*this.optFilterB;o.push(c)}this._createGeometry(n,r,o)},t.prototype._createGeometry=function(t,e,i){t*e!=i.length&&u.logger.warn("Invalid parameters (not enough or too much points)");var n=this._options.minHeight||0,r=this._options.maxHeight||1;this._geometry=new THREE.PlaneBufferGeometry(this._width,this._depth,t-1,e-1),this._geometry.rotateX(-Math.PI/2);for(var o=this._geometry.getAttribute("position").array,s=0,a=0,l=o.length;s<l;s++,a+=3){var h=n+(r-n)*i[s];o[a+1]=h}this._notifyLodead()},t.prototype._notifyLodead=function(){this._loaded=!0,null!=this._loadedCb&&this._loadedCb()},t.prototype.createMesh=function(t){return new THREE.Mesh(this._geometry,t)},t.prototype.getGeometry=function(){return this._geometry},t.prototype.isLoaded=function(){return this._loaded},t.prototype.onLoaded=function(t){this._loaded?t():this._loadedCb=t},t}();u.HeightMap=t}(plume||(plume={})),function(l){var t=function(){function t(){t._INST=this}return t.get=function(){return this._INST},t.prototype.initialize=function(t){t.manager.setURLModifier(this._getLocalUrl.bind(this)),t.onLoaded(this._onLoaded.bind(this)),this.assetByName=new l.HashMap;var e=window.__gb_assets;if(null!=e)for(var i=0;i<e.length;i++){var n=e[i];this.assetByName.get(n.name),this.assetByName.put(n.name,n)}var r=window.__gb_adshandler;if(null!=r){var o=r.assets;for(var s in o){var a=this.assetByName.get(s);null==a?l.logger.warn("No asset def found for "+s):(l.logger.debug("Replacing asset "+a.name),a.data=o[s])}}},t.prototype._getLocalUrl=function(t){var e=this.assetByName.get(t);if(null==e){var i=t.length,n=Math.min(i,100);return t&&"data"!=t.substring(0,4)&&l.logger.warn("No inline ressource found for "+t.slice(0,n)+"...(truncated)"),t}if("png"==e.t){if(null!=e.zlib)try{var r=e.data,o=atob(r),s=pako.inflate(o,{raw:!1});e.data=this._arrayBufferToBase64(s)}catch(t){l.logger.error("failed to decompress image",t)}return e.data}if("bin"==e.t){if(null!=e.zlib)try{r=e.data,o=atob(r),s=pako.inflate(o,{raw:!1});e.data=this._arrayBufferToBase64(s)}catch(t){l.logger.error("failed to decompress bin",t)}return"data:arraybuffer;base64,"+e.data}if("json"!=e.t)return l.logger.warn("unsupported type: "+e.t+" for "+e.name),t;if(null!=e.zlib)try{r=e.data,o=atob(r),s=pako.inflate(o,{raw:!1,to:"string"});e.data=s}catch(t){l.logger.error("failed to decompress json",t)}return"data:json,"+e.data},t.prototype._onLoaded=function(){},t.prototype._arrayBufferToBase64=function(t){for(var e="",i=new Uint8Array(t),n=i.byteLength,r=0;r<n;r++)e+=String.fromCharCode(i[r]);return window.btoa(e)},t}();l.InlineLoadingManager=t}(plume||(plume={})),function(o){var t=function(){function i(t){this._total=0,this._loaded=0,this._ressourceByName=new o.HashMap,this._textureByName=new o.HashMap,this._loadedHandler=new o.Handler;this._manager=new THREE.LoadingManager,this._textureLoaderManager=new o.TextureLoaderManager(this._manager),null!=t&&this._loadedHandler.once(t)}return i.prototype._fbxloader=function(){return new THREE.FBXLoader(this._manager)},i.prototype._objloader=function(){var t=new THREE.OBJLoader2(this._manager);return t.setLogging(!1,!1),t},i.prototype._gltfloader=function(){if(null==THREE.GLTFLoader)return t=new o.gltf.GLTFLoader(this._manager,this._textureLoaderManager);var t=new THREE.GLTFLoader(this._manager),e=THREE.DRACOLoader;return e&&(e.setDecoderPath(i.dracoLib),t.setDRACOLoader(new e)),t},i.prototype.setAvailableCompressionAndQuanlity=function(t){if(null==t||0==t.length)return null;for(var e=!1,i=0;i<t.length;i++){var n=t[i];if(1!=n.quality||1!=n.format){e=!0;break}}if(!e)return o.logger.warn("No compressed or low res textures registered."),null;this._total++;var r=new o.ProgressiveTextureLoaderManager(this._manager);return r.initialize(t,this),this._textureLoaderManager=r,this._total--,r},i.prototype.reset=function(){this._total=0,this._loaded=0},i.prototype.onLoaded=function(t){this.isLoaded()?t():this._loadedHandler.once(t)},i.prototype.isLoaded=function(){return this._loaded==this._total},i.prototype.getModel=function(t){return this._ressourceByName.get(t)},i.prototype.getTexture=function(t){return this._textureByName.get(t)},i.prototype.getCubeTexture=function(t){return this._textureByName.get(t)},i.prototype.loadTexture=function(t,e){var i=this;return this._total++,this._textureLoaderManager.load(t,function(t){i._textureByName.put(e,t),i._loaded++,i._checkLoadingComplete()})},i.prototype.loadCubeTexture=function(t,e){var i=this;return this._total++,new THREE.CubeTextureLoader(this._manager).load(t,function(t){i._textureByName.put(e,t),i._loaded++,i._checkLoadingComplete()})},i.prototype.loadObj=function(e,t,i){var n=this;this._total++;var r=this._objloader(),o=function(t){n._ressourceByName.put(i,t.detail.loaderRootNode),n._loaded++,n._checkLoadingComplete()};r.loadMtl(t,null,function(t){r.setModelName(i),r.setMaterials(t),r.load(e,o,null,null,null,!1)})},i.prototype.loadFbx=function(t,e){var i=this;this._total++,this._fbxloader().load(t,function(t){i._ressourceByName.put(e,t),i._loaded++,i._checkLoadingComplete()})},i.prototype.loadGltf=function(t,e,i){var n=this;this._total++;var r=this._gltfloader();null!=i&&i(r),r.load(t,function(t){n._ressourceByName.put(e,t),n._loaded++,n._checkLoadingComplete()},function(t){},function(t){o.logger.error("An error happened",t)})},i.prototype.addModel=function(t,e){this._ressourceByName.put(e,t)},Object.defineProperty(i.prototype,"manager",{get:function(){return this._manager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"progressiveLoader",{get:function(){return this._textureLoaderManager},enumerable:!0,configurable:!0}),i.prototype._checkLoadingComplete=function(){this.isLoaded()&&this._loadedHandler.fire(!0)},i.dracoLib="build/lib/draco/",i}();o.Loader3d=t}(plume||(plume={})),function(o){var t=function(){function t(t,e){this.manager=t,this.cache=e,this.crossOrigin="anonymous",null==t&&(this.manager=THREE.DefaultLoadingManager),null==e&&(this.cache=o.Engine.get().textureCache)}return t.prototype.load=function(t,e,i){var n=new THREE.CompressedTexture;return this._load0(t,n,e,i),n},t.prototype.swap=function(t,e,i,n){return this._load0(t,e,i,n),e},t.prototype._load0=function(t,s,a,e){var l=this,i=new THREE.FileLoader(this.manager);return i.setResponseType("arraybuffer"),i.load(t,function(t){var e=l._parse(t,!0);if(e.isCubemap){var i=[];s.image=i;for(var n=e.mipmaps.length/e.mipmapCount,r=0;r<n;r++){i[r]={mipmaps:[]};for(var o=0;o<e.mipmapCount;o++)i[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+o]),i[r].format=e.format,i[r].width=e.width,i[r].height=e.height}}else s.image.width=e.width,s.image.height=e.height,s.mipmaps=e.mipmaps;1===e.mipmapCount&&(s.minFilter=THREE.LinearFilter),s.format=e.format,s.needsUpdate=!0,a&&a(s)},null,e),s},t.prototype._parse=function(t,e){var i=new n(t,1);return{mipmaps:i.mipmaps(e),width:i.pixelWidth,height:i.pixelHeight,format:i.glInternalFormat,isCubemap:6===i.numberOfFaces,mipmapCount:i.numberOfMipmapLevels}},t}();o.KTXLoader=t;var n=function(){function u(t,e){this.arrayBuffer=t;var i=new Uint8Array(this.arrayBuffer,0,12);if(171===i[0]&&75===i[1]&&84===i[2]&&88===i[3]&&32===i[4]&&49===i[5]&&49===i[6]&&187===i[7]&&13===i[8]&&10===i[9]&&26===i[10]&&10===i[11]){var n=new Int32Array(this.arrayBuffer,12,13),r=16909060===n[0];this.glType=r?this.switchEndainness(n[1]):n[1],this.glTypeSize=r?this.switchEndainness(n[2]):n[2],this.glFormat=r?this.switchEndainness(n[3]):n[3],this.glInternalFormat=r?this.switchEndainness(n[4]):n[4],this.glBaseInternalFormat=r?this.switchEndainness(n[5]):n[5],this.pixelWidth=r?this.switchEndainness(n[6]):n[6],this.pixelHeight=r?this.switchEndainness(n[7]):n[7],this.pixelDepth=r?this.switchEndainness(n[8]):n[8],this.numberOfArrayElements=r?this.switchEndainness(n[9]):n[9],this.numberOfFaces=r?this.switchEndainness(n[10]):n[10],this.numberOfMipmapLevels=r?this.switchEndainness(n[11]):n[11],this.bytesOfKeyValueData=r?this.switchEndainness(n[12]):n[12],0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===e?this.loadType=u.COMPRESSED_2D:o.logger.warn("number of faces expected"+e+", but found "+this.numberOfFaces):o.logger.warn("texture arrays not currently supported"):o.logger.warn("only 2D textures currently supported")):o.logger.warn("only compressed formats currently supported")}else o.logger.error("texture missing KTX identifier")}return u.prototype.switchEndainness=function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255},u.prototype.mipmaps=function(t){for(var e=[],i=u.HEADER_LEN+this.bytesOfKeyValueData,n=this.pixelWidth,r=this.pixelHeight,o=t?this.numberOfMipmapLevels:1,s=0;s<o;s++){for(var a=new Int32Array(this.arrayBuffer,i,1)[0],l=0;l<this.numberOfFaces;l++){var h=new Uint8ClampedArray(this.arrayBuffer,i+4,a);e.push({data:h,width:n,height:r}),i+=a+4,i+=3-(a+3)%4}n=Math.max(1,.5*n),r=Math.max(1,.5*r)}return e},u.HEADER_LEN=64,u.COMPRESSED_2D=0,u.COMPRESSED_3D=1,u.TEX_2D=2,u.TEX_3D=3,u}()}(plume||(plume={})),function(r){var t=function(){function t(t,e){this.manager=t,this.cache=e,null==t&&(this.manager=THREE.DefaultLoadingManager),null==e&&(this.cache=r.Engine.get().textureCache)}return t.prototype.load=function(t,e,i){var n=new r.TextureLoader(this.manager).load(t,e,i);return this.cache.add(t,n),n},t}();r.TextureLoaderManager=t;var e=function(){function t(){this._textureByUrl=new r.HashMap}return t.prototype.add=function(t,e){this._textureByUrl.put(t,e)},t.prototype.get=function(t){return this._textureByUrl.get(t)},t}();r.TextureCache=e}(plume||(plume={})),function(c){var t=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._phase=1,t._infoByPath=new c.HashMap,t._imageDataByPath=new c.HashMap,t._nextPhaseUrls=new Array,t._compressionFormat=null,t.progressiveLoadingEnabled=!0,t}return __extends(n,e),n.prototype.initialize=function(t,e){for(var i=this,n=1,r=(c.Engine.get().renderer,0);r<t.length;r++){var o=t[r];this._infoByPath.put(o.path,o),n|=o.format;var s=o.path.lastIndexOf("."),a=o.path.lastIndexOf("/"),l={path:o.path.substring(0,a),name:o.path.substring(a+1,s),ext:o.path.substring(s+1)};this._imageDataByPath.put(o.path,l)}e.onLoaded(function(){i._onFirstLoadComplete()});var h=[2,8,4,16];for(r=0;r<h.length;r++){var u=h[r];if(this._isSupported(u,n)){this._compressionFormat=u;break}}},n.prototype._isSupported=function(t,e){if((e&t)!=t)return!1;var i=n.GLEXTENSION_BY_TEXTURECOMPRESSION[t];return null!=c.Engine.get().renderer.extensions.get(i)},n.prototype.load=function(t,e,i){var n=t,r=!1,o=this._infoByPath.get(t);if(null!=o){var s=this._getLowRes(o),a=this._getCompressionExt(o),l=this._imageDataByPath.get(t);if(n=l.path+"/"+l.name,s&&(n+="_LOW"),null!=a?(n+="_"+a+".ktx",r=!0):n+="."+l.ext,s){var h=l.path+"/"+l.name;h+=null!=a?"_"+a+".ktx":"."+l.ext,this._nextPhaseUrls.push({original:t,next:h})}}var u=this._load(n,r,e,i);return this.cache.add(t,u),u},n.prototype.getCompressionFormat=function(){return this._compressionFormat},n.prototype.getCompressionFormatAsStr=function(){return null==this._compressionFormat?"":n.IMAGEFORMAT_BY_TEXTURECOMPRESSION[this._compressionFormat]},n.prototype._getLowRes=function(t){return!(1<this._phase)&&2==(2&t.quality)},n.prototype._getCompressionExt=function(t){return null==this._compressionFormat?null:(t.format&this._compressionFormat)==this._compressionFormat?n.IMAGEEXT_BY_TEXTURECOMPRESSION[this._compressionFormat]:null},n.prototype._load=function(t,e,i,n){return e?new c.KTXLoader(this.manager).load(t,i,n):new c.TextureLoader(this.manager).load(t,i,n)},n.prototype._onFirstLoadComplete=function(){if(this.progressiveLoadingEnabled){this._phase++;for(var t=0;t<this._nextPhaseUrls.length;t++)this._upgradeTexture(this._nextPhaseUrls[t]);this._nextPhaseUrls=[]}},n.prototype._upgradeTexture=function(t){var e=this.cache.get(t.original);null!=e?"ktx"==t.next.substring(t.next.length-3)?new c.KTXLoader(this.manager).swap(t.next,e,function(){}):new c.TextureLoader(this.manager).swap(t.next,e,function(){}):c.logger.warn("No mapping found for texture "+t.original)},n.GLEXTENSION_BY_TEXTURECOMPRESSION={2:"WEBGL_compressed_texture_astc",4:"WEBGL_compressed_texture_pvrtc",8:"WEBGL_compressed_texture_s3tc",16:"WEBGL_compressed_texture_etc1"},n.IMAGEEXT_BY_TEXTURECOMPRESSION={2:"ASTC",4:"PVRX",8:"S3TC",16:"ETCX"},n.IMAGEFORMAT_BY_TEXTURECOMPRESSION={2:"ASTC",4:"PVRTC",8:"S3TC",16:"ETC1"},n}(c.TextureLoaderManager);c.ProgressiveTextureLoaderManager=t}(plume||(plume={})),function(i){var t=function(){function t(t,e){this.manager=t,this.cache=e,this.crossOrigin="anonymous",null==t&&(this.manager=THREE.DefaultLoadingManager),null==e&&(this.cache=i.Engine.get().textureCache)}return t.prototype.load=function(t,e,i){var n=new THREE.Texture;return this._load0(t,n,e,i),n},t.prototype.swap=function(t,e,i,n){return this._load0(t,e,i,n),e},t.prototype._load0=function(i,n,r,t){var e=new THREE.ImageLoader(this.manager);return e.setCrossOrigin(this.crossOrigin),e.load(i,function(t){n.image=t;var e=0<i.search(/\.jpe?g$/i)||0===i.search(/^data\:image\/jpeg/);n.format=e?THREE.RGBFormat:THREE.RGBAFormat,n.needsUpdate=!0,void 0!==r&&r(n)},null,t),n},t}();i.TextureLoader=t}(plume||(plume={})),function(t){var e=function(){function n(t){this.canvas=t,this._width=0,this._height=0,this.heightRatio=3.65,this._context2d=t.getContext("2d"),this._width=this.canvas.width,this._height=this.canvas.height,this._texture=new THREE.Texture(t)}return n.fromSize=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,new n(i)},n.prototype._debug=function(){this.canvas.style.zIndex="15",this.canvas.style.position="absolute",document.body.appendChild(this.canvas)},n.prototype.update=function(){this._texture.needsUpdate=!0},Object.defineProperty(n.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"context2d",{get:function(){return this._context2d},enumerable:!0,configurable:!0}),n.prototype.clear=function(){this.context2d.clearRect(0,0,this._width,this._height)},n.prototype.drawText=function(t,e,i,n,r,o,s,a,l){void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=!0);var h=i+" "+n+"px "+e;if(null!=o&&(this._context2d.fillStyle=o,this._context2d.fillRect(0,0,this._width,this._height)),this._context2d.font=h,this._context2d.textBaseline="alphabetic",null==s){var u=this._context2d.measureText(t);s=(this._width-u.width)/2}if(null==a){var c=n/this.heightRatio;a=(this._width-c)/2}this._context2d.font=h,this._context2d.textBaseline="alphabetic",this._context2d.fillStyle=r,this._context2d.fillText(t,s,a),l&&this.update()},n}();t.DynamicTexture=e}(plume||(plume={})),function(t){var e=function(){function t(){}return t.prototype.modify=function(t){for(var e=[],i=0,n=t.faces.length;i<n;i++){var r=e.length,o=t.faces[i],s=o.a,a=o.b,l=o.c,h=t.vertices[s],u=t.vertices[a],c=t.vertices[l];e.push(h.clone()),e.push(u.clone()),e.push(c.clone()),o.a=r,o.b=r+1,o.c=r+2}t.vertices=e},t}();t.ExplodeModifier=e}(plume||(plume={})),function(r){var t=function(){function t(t){if(void 0===t&&(t=!0),this.optShowFps=!0,this.optShowUpdateTime=!1,this.optShowRenderTime=!1,this.optShowCalls=!1,this.optShowTriangles=!1,this.optShowGeometries=!1,this.optShowTextures=!1,this.optShowPhysics=!1,this.optPrintRenderableOnClick=!0,this._customStats=new r.HashMap,this._statsFlush=performance.now(),t){var e=document.createElement("div");e.id="plume-fps",e.style.position="absolute",e.style.color="white",e.style.fontFamily="Consolas, monaco, monospace",e.style.fontSize="12px",e.style.backgroundColor="#242526",e.style.zIndex="11",e.onclick=this._OnClick.bind(this),document.body.appendChild(e),this._statsDiv=e}this._engine=r.Engine.get(),this._game=r.Game.get(),this._game.trackStats=!0,this._game.addUpdatable(this)}return t.prototype.showAll=function(){this.optShowFps=!0,this.optShowUpdateTime=!0,this.optShowRenderTime=!0,this.optShowCalls=!0,this.optShowTriangles=!0,this.optShowGeometries=!0,this.optShowTextures=!0,this.optShowPhysics=!0},t.prototype.update=function(t){var e=performance.now(),i=e-this._statsFlush;if(1e3<=i){var n=this._engine.renderer.info,r="",o=(this._game._renderStat.count/(i/1e3)).toFixed();this._statsFlush=e,r+=o+" fps\n",this.optShowUpdateTime&&(r+="Update: "+(this._game._updateStat.sum/this._game._updateStat.count).toFixed(2)+" ms\n"),this.optShowRenderTime&&(r+="Render: "+(this._game._renderStat.sum/this._game._updateStat.count).toFixed(2)+" ms\n",r+="Render delta: "+(this._game._deltaStat.sum/this._game._deltaStat.count).toFixed(2)+" ms\n"),this._game.simulation&&this._game.simulation.stats&&this.optShowPhysics&&(r+="Physics: "+this._game.simulation.stats.avg+" ms\n"),this._game._updateStat.count=0,this._game._updateStat.sum=0,this._game._renderStat.count=0,this._game._renderStat.sum=0,this._game._deltaStat.count=0,this._game._deltaStat.sum=0,this.optShowCalls&&(r+="Calls: "+n.render.calls+"\n"),this.optShowTriangles&&(r+="Triangles: "+n.render.triangles+"\n"),this.optShowGeometries&&(r+="Geometries: "+n.memory.geometries+"\n"),this.optShowTextures&&(r+="Textures: "+n.memory.textures+"\n"),0<this._customStats.size()&&this._customStats.forEach(function(t,e){var i=e.sum/e.count;r+=t+": "+i.toFixed(2)+"\n",e.count=0,e.sum=0},this);var s=this.onFlushStats();null!=s&&(r+=s),null!=this._statsDiv&&(this._statsDiv.innerText=r)}},t.prototype.destroy=function(){this._game.removeUpdatable(this),null!=this._statsDiv&&this._statsDiv.parentElement.removeChild(this._statsDiv)},t.prototype.onFlushStats=function(){return null},t.prototype.addCustom=function(t){var e={count:0,start:0,sum:0};return this._customStats.put(t,e),e},t.prototype.getCustom=function(t){return this._customStats.get(t)},t.prototype._OnClick=function(){if(this.optPrintRenderableOnClick){var t=this._engine.renderer.renderLists.get(this._engine.scene,this._engine.camera);r.logger.debug("Opaque: "+t.opaque.length+", Transparent: "+t.transparent.length);var e=this._CollectMeshData(t.opaque,!0);(e=this._CollectMeshData(t.transparent,!0,e)).sort(function(t,e){return e.faces-t.faces});r.logger.debug("Triangles:");for(var i=0;i<e.length;i++){var n=e[i];r.logger.debug(n.name+": "+n.faces+" triangles (with "+n.count+" instances)"),n.faces}}},Object.defineProperty(t.prototype,"div",{get:function(){return this._statsDiv},enumerable:!0,configurable:!0}),t.prototype._CollectMeshData=function(t,e,i){void 0===e&&(e=!0),null==i&&(i=[]);for(var n=function(t){for(var e=0;e<i.length;e++)if(i[e].name==t)return i[e];return null},r=0;r<t.length;r++){var o=t[r].object,s=null==o.name?"na":o.name,a=-1;if(o instanceof THREE.Mesh){var l=o.geometry;if(l instanceof THREE.Geometry)a=l.faces.length;else if(l instanceof THREE.BufferGeometry){a=l.toNonIndexed().getAttribute("position").array.length/9}}if(e){var h=n(s);null==h?(h={name:s,faces:a,count:1},i.push(h)):(h.count+=1,h.faces+=a)}else i.push({name:s,faces:a,count:1})}return i},t}();r.FpsHelper=t}(plume||(plume={})),function(n){var t=function(){function o(){}return o.detach=function(t,e,i){null==e&&(e=t.parent),null==i&&(i=n.Engine.get().scene),t.applyMatrix(e.matrixWorld),e.remove(t),i.add(t)},o.attach=function(t,e,i){null==i&&(i=n.Engine.get().scene),t.applyMatrix(this._tmp_mat4.getInverse(e.matrixWorld)),i.remove(t),e.add(t)},o.move=function(t,e){this.detach(t),this.attach(t,e)},o.flatten=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),e&&t.updateMatrixWorld(!0);var n=t;if(this.traverseBottomUp(t,function(t){t.parent!=n&&t!=n&&o.move(t,n)}),i)for(var r=t.children.length-1;0<=r;r--)"Object3D"==t.children[r].type&&t.remove(t.children[r])},o.traverseBottomUp=function(t,e){for(var i=t.children,n=i.length-1;0<=n;n--)this.traverseBottomUp(i[n],e);e(t)},o._tmp_mat4=new THREE.Matrix4,o}();n.SceneUtils=t}(plume||(plume={})),function(t){var e=function(){function t(){this._success=!1,this._failed=!1}return t.prototype.onSuccess0=function(){this._success=!0,null!=this._onSuccess&&this._onSuccess()},t.prototype.onFailed0=function(){this._failed=!0,null!=this._onFailed&&this._onFailed()},t.prototype.onSuccess=function(t){this._onSuccess=t,this._success&&t()},t.prototype.onFailed=function(t){this._onFailed=t,this._failed&&t()},t.prototype.isSuccess=function(){return this._success},t.prototype.isFailed=function(){return this._failed},t.prototype.isTerminated=function(){return 1==this._success||1==this._failed},t}();t.AbstractLoadingResource=e}(plume||(plume={})),function(r){var t=function(n){function t(t){var e=n.call(this)||this;e.file=t;var i=e;return r.LoaderProxy.get().loadXHR(e.file,function(t){i.data=t,i.onSuccess0()},function(t){r.logger.error("Can't load "+i.file+", reason: "+t),i.onFailed0()}),e}return __extends(t,n),t.prototype.getAssetDef=function(){return{type:"file",name:this.file,file:this.file}},t}(r.AbstractLoadingResource);r.FileResource=t}(plume||(plume={})),function(t){var e=function(){function t(){this._data={},this._size=0}return t.prototype.isEmpty=function(){return 0==this._size},t.prototype.size=function(){return this._size},t.prototype.clear=function(){this._data={},this._size=0},t.prototype.containsKey=function(t){return null!=this._data[t]},t.prototype.get=function(t){return this._data[t]},t.prototype.put=function(t,e){var i=this._data[t];return this._data[t]=e,null==i&&this._size++,i},t.prototype.remove=function(t){var e=this._data[t];return null!=e&&(delete this._data[t],this._size--),e},t.prototype.removeValues=function(t){var e=[];for(var i in this._data){var n=this._data[i];null!=n&&n==t&&e.push(i)}for(var r=0;r<e.length;r++)this.remove(e[r])},t.prototype.keys=function(){var t=[];for(var e in this._data)t.push(e);return t},t.prototype.values=function(){var t=[];for(var e in this._data){var i=this._data[e];null!=i&&t.push(i)}return t},t.prototype.forEach=function(t,e){for(var i in this._data){var n=this._data[i];if(null!=n)if(!1===t.call(e,i,n))break}},t.prototype.computeIfAbsent=function(t,e){var i=this.get(t);if(null!=i)return i;var n=e(t);return this.put(t,n),n},t}();t.HashMap=e}(plume||(plume={})),function(i){var o,t;(t=o=i.TextureType||(i.TextureType={}))[t.IMG=0]="IMG",t[t.CANVAS=1]="CANVAS";var e=function(){function a(t,e,i,n,r){this.name=t,this.x=e,this.y=i,this.width=n,this.height=r,this._type=o.IMG,this._loaded=!1}return a.prototype.setTrim=function(t,e,i,n){this._trim={x:t,y:e,width:i,height:n}},a.prototype.getTrim=function(){return this._trim},a.prototype.getFrameTexture=function(t,e,i,n,r){if(r&&a.containsTexture(r))return a.getTexture(r);var o=this._trim;o&&(t+=o.x,e+=o.y);var s=new a(r||"useless",t,e,i,n);return s.setImpl(this._impl),s.setTrim(0,0,i,n),r&&a.addTexture(s),s},Object.defineProperty(a.prototype,"trimmed",{get:function(){return null!=this._trim},set:function(t){throw new Error("trimmed is read-only")},enumerable:!0,configurable:!0}),a.addTexture=function(t){a.textures.put(t.name,t)},a.getTexture=function(t){var e=a.textures.get(t);if(null==e)throw new Error("Texture "+t+" not loaded.");return e},a.containsTexture=function(t){return a.textures.get(t)},a.fromFrame=function(t){return a.getTexture(t)},a.fromImage=function(t){var e=a.containsTexture(t);return null!=e?e:e=new i.PImage(t,t).getTexture()},a.fromFrames=function(t){var e=[];return t.forEach(function(t){e.push(a.fromFrame(t))}),e},a.prototype.setLoaded=function(t){(this._loaded=t)&&null!=this._loadedHadler&&this._loadedHadler.fire(!0)},a.prototype.isLoaded=function(){return this._loaded},a.prototype.setImpl=function(t){this._impl=t},a.prototype.getImpl=function(){return this._impl},a.prototype.addLoadedHandler=function(t){this._loaded?t():(null==this._loadedHadler&&(this._loadedHadler=new i.Handler),this._loadedHadler.once(t))},a.textures=new i.HashMap,a}();i.Texture=e}(plume||(plume={})),function(h){var t=function(s){function t(t,e,i){var n=s.call(this)||this;n._name=t,n._img=e,n._def=i;var r=n,o=new h.WaitQueue(2);return o.onComplete=function(){r._onAllLoaded()},n.chars=[],n.lettersByCode=new Array(65e3),n.textureByCode=new Array(65e3),n._atlas=new h.FileResource(i),n._image=h.Resources.addImage(t,e),n.resource=n._image.resource,n._atlas.onSuccess(function(){o.resolve(0,null)}),n._atlas.onFailed(function(){o.resolve(0,null)}),n._image.onSuccess(function(){o.resolve(1,null)}),n._image.onFailed(function(){o.resolve(1,null)}),n}return __extends(t,s),t.prototype._onAllLoaded=function(){this._image.isTerminated()&&this._atlas.isTerminated()?this._image.isSuccess()&&this._atlas.isSuccess()?(this._createFont(),this.onSuccess0()):this.onFailed0():h.logger.error("Bad font loading. Image and atlas should be success/failed here")},t.prototype._createFont=function(){var t;window.DOMParser?t=(new DOMParser).parseFromString(this._atlas.data,"text/xml"):((t=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(this._atlas.data));var e=t.getElementsByTagName("font")[0],i=e.getElementsByTagName("info")[0],n=e.getElementsByTagName("common")[0];this.size=parseInt(i.getAttribute("size")),this.lineHeight=parseInt(n.getAttribute("lineHeight")),this.baseLine=parseInt(n.getAttribute("baseLine"));for(var r=e.getElementsByTagName("char"),o=0;o<r.length;o++){var s=r[o],a={id:parseInt(s.getAttribute("id")),x:parseInt(s.getAttribute("x")),y:parseInt(s.getAttribute("y")),xoffset:parseInt(s.getAttribute("xoffset")),yoffset:parseInt(s.getAttribute("yoffset")),width:parseInt(s.getAttribute("width")),height:parseInt(s.getAttribute("height")),xadvance:parseInt(s.getAttribute("xadvance"))};this.lettersByCode[a.id]=a;var l=new h.Texture(this._name+"/"+a.id,a.x,a.y,a.width,a.height);l.setImpl(this.resource),this.textureByCode[a.id]=l,this.chars.push(a.id)}},t.prototype.getAssetDef=function(){return{type:"font",name:this._name,file:this._img,atlas:this._def}},t}(h.AbstractLoadingResource);h.HFont=t}(plume||(plume={})),function(s){var t=function(o){function t(t,e){var i=o.call(this)||this;i._name=t,i._src=e,i.created=!1;var n=i,r=s.LoaderProxy.get();return i.resource=new Image,i._texture=new s.Texture(i._name,0,0,0,0),i._texture.setImpl(i.resource),s.Texture.addTexture(i._texture),r.loadImage(i.resource,e),i.resource.onload=function(){n.onSuccess0()},i.resource.onerror=function(){n.onFailed0()},i.resource.complete&&n.onSuccess0(),i}return __extends(t,o),t.prototype.onSuccess0=function(){this._createTexture(),o.prototype.onSuccess0.call(this)},t.prototype._createTexture=function(){this.created||(this._texture.x=0,this._texture.y=0,this._texture.width=this.resource.width,this._texture.height=this.resource.height,this._texture.setLoaded(!0),this.created=!0)},t.prototype.getTexture=function(){return this._texture},t.prototype.getAssetDef=function(){return{type:"img",name:this._name,file:this._src}},t}(s.AbstractLoadingResource);s.PImage=t}(plume||(plume={})),function(s){var t=function(){function e(t,e){void 0===e&&(e=3),this._ressources=t,this._retryAttempt=e,this._state=0,this._failedResources=[],this._successResources=[],this._terminated=!1,this._attempt=0,this._progressHandler=new s.Handler}return e.prototype.load=function(t){this._completeCb=t,this._timer=s.TimeManager.get().createTimer(100,this._checkLoaded,this),this._timer.setRepeat(-1),this._timer.start(),this._load0()},e.prototype.getResourcesLoaded=function(){return this._successResources},e.prototype._checkLoaded=function(){if(1==this._state){for(var t=this,e=!1,i=this._loadingResources.length-1;0<=i;i--){var n=this._loadingResources[i];n.isTerminated()&&(this._loadingResources.splice(i,1),n.isSuccess()?(e=!0,this._successResources.push(n)):(s.logger.error("Failed to load "+n.getAssetDef().file),this._failedResources.push(n.getAssetDef())))}if(e){var r=this._loadingResources.length+this._successResources.length+this._failedResources.length,o=this._successResources.length/r;this._progressHandler.fire(o)}this._loadingResources.length<=0&&(0<this._failedResources.length?(this._state=0,setTimeout(function(){t._retry()},250)):(this._state=2,this._terminate()))}},e.prototype._load0=function(){var o=this;this._attempt++,this._loadingResources=[],this._failedResources=[],this._ressources.forEach(function(t){if("img"==t.type){var e=s.Resources.addImage(t.name,t.file);o._loadingResources.push(e)}else if("font"==t.type){var i=s.Resources.addFont(t.name,t.file,t.atlas);o._loadingResources.push(i)}else if("spritesheet"==t.type){var n=s.Resources.addSpriteSheet(t.name,t.file,t.atlas);o._loadingResources.push(n)}else if("soundsheet"==t.type){var r=s.Resources.addSoundsheet(t.name,t.file);o._loadingResources.push(r)}else if("file"==t.type){r=s.Resources.addFile(t.name,t.file);o._loadingResources.push(r)}}),this._state=1},e.prototype._retry=function(){var e=this;this._attempt>=this._retryAttempt?this._terminate():(this._ressources=[],this._failedResources.forEach(function(t){e._ressources.push(t)}),this._load0())},e.prototype._terminate=function(){this._timer.cancel(),this._terminated=!0,0<this._failedResources.length?this._completeCb(!1):this._completeCb(!0)},e.prototype.getStatus=function(){return{loading:this._loadingResources.length,loaded:this._successResources.length,failed:this._failedResources.length}},e.prototype.getProgress=function(){var t=this._loadingResources.length+this._successResources.length+this._failedResources.length;return this._successResources.length/t},Object.defineProperty(e.prototype,"terminated",{get:function(){return this._terminated},enumerable:!0,configurable:!0}),e.loadFile=function(t,i){var n=new e([{type:"file",name:t,file:t}],5);n.load(function(t){if(t){var e=n.getResourcesLoaded()[0];i(e.data)}else i(null)})},e}();s.Loader2d=t}(plume||(plume={})),function(n){var t=function(){function t(){}return t.get=function(){return null==this._INST&&(this._INST=new t),this._INST},t.set=function(t){this._INST=t},t.prototype.loadXHR=function(t,e,i){(new n.HttpRequest).get(t,e,i)},t.prototype.loadImage=function(t,e){t.src=e},t}();n.LoaderProxy=t}(plume||(plume={})),function(r){var t=function(){function t(){}return t.destroy=function(){return delete t.images,delete t.spritesheets,delete t.fonts,this},t.addImage=function(t,e){var i=new r.PImage(t,e);return this.images[t]=i},t.addFont=function(t,e,i){var n=new r.HFont(t,e,i);return this.fonts[t]=n},t.addLoadedFont=function(t,e){return this.fonts[t]=e},t.addSpriteSheet=function(t,e,i){var n=new r.Spritesheet(t,e,i);return this.spritesheets[t]=n},t.addSoundsheet=function(t,e){return new r.Soundsheet(t,e)},t.addFile=function(t,e){return new r.FileResource(e)},t.images={},t.spritesheets={},t.fonts={},t}();r.Resources=t}(plume||(plume={})),function(e){var t=function(n){function t(t,e){var i=n.call(this,e)||this;return i._name=t,i}return __extends(t,n),t.prototype.onSuccess0=function(){n.prototype.onSuccess0.call(this),e.AudioManager.get().registerSoundsheet(this._name,this.data)},t.prototype.getAssetDef=function(){return{type:"soundsheet",name:this._name,file:this.file}},t}(e.FileResource);e.Soundsheet=t}(plume||(plume={})),function(a){var t=function(s){function t(t,e,i){var n=s.call(this)||this;n._name=t,n._img=e,n._def=i;var r=n,o=new a.WaitQueue(2);return o.onComplete=function(){r._onAllLoaded()},n._atlas=new a.FileResource(i),n._image=a.Resources.addImage(t,e),n._atlas.onSuccess(function(){o.resolve(0,null)}),n._atlas.onFailed(function(){o.resolve(0,null)}),n._image.onSuccess(function(){o.resolve(1,null)}),n._image.onFailed(function(){o.resolve(1,null)}),n}return __extends(t,s),t.prototype._onAllLoaded=function(){this._image.isTerminated()&&this._atlas.isTerminated()?this._image.isSuccess()&&this._atlas.isSuccess()?(this._createSpritesheet(),this.onSuccess0()):this.onFailed0():a.logger.error("Bad spritesheet loading. Image and atlas should be success/failed here")},t.prototype._createSpritesheet=function(){var t=JSON.parse(this._atlas.data);for(var e in t.frames){var i=t.frames[e].frame,n=new a.Texture(e,i.x,i.y,i.w,i.h);if(t.frames[e].trimmed){var r=t.frames[e].sourceSize,o=t.frames[e].spriteSourceSize;n.setTrim(o.x,o.y,r.w,r.h)}n.setImpl(this._image.resource),n.setLoaded(!0),a.Texture.addTexture(n)}},t.prototype.getAssetDef=function(){return{type:"spritesheet",name:this._name,file:this._img,atlas:this._def}},t}(a.AbstractLoadingResource);a.Spritesheet=t}(plume||(plume={})),function(l){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.assetExportName="__gb_assets",t}return __extends(t,e),t.prototype.loadXHR=function(t,e,i){var n=this._getAsset(t);if(null==n)return l.logger.error("Asset not found: "+t),void i("Not found "+t);var r="";if("json"==n.t){if(null!=n.zlib)try{var o=n.data,s=atob(o),a=pako.inflate(s,{raw:!1,to:"string"});n.data=a}catch(t){l.logger.error("failed to decompress json",t)}r=n.data}else r=n.data;e(r)},t.prototype.loadImage=function(t,e){var i=this._getAsset(e);if(null==i)return"data:"!=e.substr(0,5)?void l.logger.error("Image not found: "+e):void(t.src=e);t.src=i.data},t.prototype._getAsset=function(t){return this._ensureInititalized(),this._assetByName.get(t)},t.prototype._ensureInititalized=function(){if(null==this._assetByName){this._assetByName=new l.HashMap;for(var t=window[this.assetExportName],e=0;e<t.length;e++){var i=t[e];this._assetByName.put(i.name,i)}}},t}(l.LoaderProxy);l.InlineLoader=t}(plume||(plume={})),function(e){var t=function(){function t(t){void 0===t&&(t=!0),this.useBox=t,this.radius=1e3,this.widthSegments=1,this.heightSegments=1,this.depthSegments=1,this.topColor=new THREE.Color(30719),this.bottomColor=new THREE.Color(30719),this.offset=0,this.exponent=.6,this.uniforms={},this.uniforms={topColor:{value:this.topColor},bottomColor:{value:this.bottomColor},offset:{value:this.offset},exponent:{value:this.exponent}}}return t.prototype.create=function(){if(this.useBox){var t=2*this.radius;this.geometry=new THREE.BoxBufferGeometry(t,t,t,this.widthSegments,this.heightSegments,this.depthSegments)}else this.geometry=new THREE.SphereBufferGeometry(this.radius,this.widthSegments,this.heightSegments);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.core.shaders.skydome_vertex,fragmentShader:e.core.shaders.skydome_fragment,side:THREE.BackSide,depthWrite:!1}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.name="Skydome",this.mesh.renderOrder=-1},t}();e.Skydome=t}(plume||(plume={})),function(e){var t=function(){function t(){var t=this;this.os=new e.OS,this.fullscreenManager=new e.FullScreenManager,this.visibilityManager=new e.VisibilityManager,this._checkReady=function(){document.body?(t.os.init(),document.removeEventListener("DOMContentLoaded",t._checkReady),window.removeEventListener("load",t._checkReady),t.readyCallback()):window.setTimeout(t._checkReady,20)}}return t.prototype.whenReady=function(t){var e="complete"==document.readyState;this.readyCallback=t,e?(this.os.init(),this.readyCallback()):(document.addEventListener("DOMContentLoaded",this._checkReady),window.addEventListener("load",this._checkReady))},t}();e.DeviceManager=t}(plume||(plume={})),function(e){var t=function(){function t(){var t=this;this._onFullscreenChange=function(){t._isInFullScreen=t._hasFullscreenElement(),null!=t._changeHandler&&t._changeHandler.fire({})},this.fullscreenEnabled=document.fullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled,this._element=document.documentElement,this._isInFullScreen=this._hasFullscreenElement(),document.addEventListener("fullscreenchange",this._onFullscreenChange),document.addEventListener("msfullscreenchange",this._onFullscreenChange),document.addEventListener("mozfullscreenchange",this._onFullscreenChange),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange)}return Object.defineProperty(t.prototype,"isInFullScreen",{get:function(){return this._isInFullScreen},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changeHandler",{get:function(){return null==this._changeHandler&&(this._changeHandler=new e.Handler),this._changeHandler},enumerable:!0,configurable:!0}),t.prototype.requestFullScreen=function(){if(this.fullscreenEnabled)if(document.documentElement.requestFullscreen)document.documentElement.requestFullscreen();else if(document.documentElement.msRequestFullscreen)document.documentElement.msRequestFullscreen();else if(document.documentElement.mozRequestFullScreen)document.documentElement.mozRequestFullScreen();else if(document.documentElement.webkitRequestFullscreen){Element.ALLOW_KEYBOARD_INPUT;document.documentElement.webkitRequestFullscreen()}},t.prototype.exitFullscreen=function(){this.fullscreenEnabled&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())},t.prototype._hasFullscreenElement=function(){return null!=(document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)},t.prototype.toggleFullScreen=function(){this.fullscreenEnabled?this.isInFullScreen?this.exitFullscreen():this.requestFullScreen():e.logger.info("FullScreen is not enabled")},t}();e.FullScreenManager=t}(plume||(plume={})),function(i){var s,t=function(){function t(){this.level=0}return t.prototype.setLevel=function(t){this.level=t},t.prototype.debug=function(t){0<this.level||(console.debug(t),null!=this.listeners&&this.listeners.fire({level:"debug",message:t}))},t.prototype.info=function(t){1<this.level||(console.info(t),null!=this.listeners&&this.listeners.fire({level:"info",message:t}))},t.prototype.warn=function(t){2<this.level||(console.warn(t),null!=this.listeners&&this.listeners.fire({level:"warn",message:t}))},t.prototype.error=function(t,e){3<this.level||(console.error(t,e),null!=this.listeners&&this.listeners.fire({level:"error",message:t,error:e}))},t.prototype.addListener=function(t){null==this.listeners&&(this.listeners=new i.Handler),this.listeners.add(t)},t}();i.Logger=t,i.logger=new t;var a=[];i.enableDomConsole=function(){var t=document.createElement("div");t.id="plume-logger",t.style.background="white",t.style.fontSize="10px",t.style.fontFamily="Consolas, monaco, monospace",t.style.position="absolute",t.style.top="0",t.style.zIndex="11",document.body.appendChild(t);var e=document.createElement("div");t.appendChild(e),a.push(e),s=t,i.logger.addListener(function(t){!function(t,e,i){var n=a[0],r=document.createElement("div");if(r.innerHTML="<b>"+t+"</b>: "+e+(null==i?"":", "+i),s.insertBefore(r,n),a.splice(0,0,r),n=r,8<a.length){var o=a[a.length-1];a.splice(a.length-1,1),s.removeChild(o)}}(t.level,t.message,t.error)})}}(plume||(plume={})),function(t){var e=function(){function t(){this.vita=!1,this.kindle=!1,this.android=!1,this.chromeOS=!1,this.iOS=!1,this.iPhone=!1,this.iPad=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.desktop=!1,this.iOSVersion=0,this.pixelRatio=1}return t.prototype.init=function(){var t=navigator.userAgent;/Playstation Vita/.test(t)?this.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?this.kindle=!0:/Android/.test(t)?this.android=!0:/CrOS/.test(t)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?(this.iOS=!0,navigator.appVersion.match(/OS (\d+)/),this.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(t)?this.linux=!0:/Mac OS/.test(t)?this.macOS=!0:/Windows/.test(t)&&(this.windows=!0),(/Windows Phone/i.test(t)||/IEMobile/i.test(t))&&(this.android=!1,this.iOS=!1,this.macOS=!1,this.windows=!0,this.windowsPhone=!0);var e=/Silk/.test(t);(this.windows||this.macOS||this.linux&&!e||this.chromeOS)&&(this.desktop=!0),(this.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(this.desktop=!1),this.iPhone=-1!==t.toLowerCase().indexOf("iphone"),this.iPad=-1!==t.toLowerCase().indexOf("ipad"),this.pixelRatio=window.devicePixelRatio||1},t}();t.OS=e}(plume||(plume={})),function(i){var t=function(){function t(){this._isUnloading=!1,this._isVisible=!0,this._isExtendedVisible=!0,this._visibilityChangeHandler=new i.Handler,this._extendedVisibilityChangeHandler=new i.Handler,this._beforeUnloadHandler=new i.Handler,this._browserPrefixes=["moz","ms","o","webkit"];var t=this,e=this._getBrowserPrefix();this._hiddenPropertyName=this._getHiddenPropertyName(e),this._visibilityEventName=this._getVisibilityEvent(e),document.addEventListener(this._visibilityEventName,this._handleVisibilityChange.bind(this),!1),document.addEventListener("focus",function(){t._handleExtendedVisibilityChange(!0,"document-focus")},!1),document.addEventListener("blur",function(){t._handleExtendedVisibilityChange(!1,"document-blur")},!1),window.addEventListener("focus",function(){t._handleExtendedVisibilityChange(!0,"window-focus")},!1),window.addEventListener("blur",function(){t._handleExtendedVisibilityChange(!1,"window-blur")},!1),window.addEventListener("beforeunload",this._handleOnBeforeUnload.bind(this),!1)}return t.prototype._getHiddenPropertyName=function(t){return t?t+"Hidden":"hidden"},t.prototype._getVisibilityEvent=function(t){return(t||"")+"visibilitychange"},t.prototype._getBrowserPrefix=function(){for(var t=0;t<this._browserPrefixes.length;t++)if(this._getHiddenPropertyName(this._browserPrefixes[t])in document)return this._browserPrefixes[t];return null},t.prototype._handleVisibilityChange=function(){if(document[this._hiddenPropertyName])return this._isVisible=!1,this._visibilityChangeHandler.fire(!1),void this._onExtendedHidden(this._hiddenPropertyName);this._isVisible=!0,this._visibilityChangeHandler.fire(!0),this._onExtendedVisible(this._hiddenPropertyName)},t.prototype._handleExtendedVisibilityChange=function(t,e){return t?this._onExtendedVisible(e):this._onExtendedHidden(e)},t.prototype._onExtendedVisible=function(t){this._isExtendedVisible||(this._isExtendedVisible=!0,this._extendedVisibilityChangeHandler.fire({isExtended:this._isExtendedVisible,triggerProperty:t}))},t.prototype._onExtendedHidden=function(t){this._isExtendedVisible&&(this._isExtendedVisible=!1,this._extendedVisibilityChangeHandler.fire({isExtended:this._isExtendedVisible,triggerProperty:t}))},t.prototype._handleOnBeforeUnload=function(t){this._isUnloading=!0,this._beforeUnloadHandler.fire(t)},t.prototype.addVisibilityChangeHandler=function(t){this._visibilityChangeHandler.add(t)},t.prototype.removeVisibilityChangeHandler=function(t){this._visibilityChangeHandler.remove(t)},t.prototype.addExtendedVisibilityChangeHandler=function(t){this._extendedVisibilityChangeHandler.add(t)},t.prototype.removeExtendedVisibilityChangeHandler=function(t){this._extendedVisibilityChangeHandler.remove(t)},t.prototype.addBeforeUnloadHandler=function(t){this._beforeUnloadHandler.add(t)},t.prototype.removeBeforeUnloadHandler=function(t){this._beforeUnloadHandler.remove(t)},t.prototype.isVisible=function(){return this._isVisible},t.prototype.isUnloading=function(){return this._isUnloading},Object.defineProperty(t.prototype,"hidden",{get:function(){return!this._isVisible},set:function(t){throw"Read only"},enumerable:!0,configurable:!0}),t}();i.VisibilityManager=t}(plume||(plume={})),function(t){var e;(e=t.Datef||(t.Datef={})).oneday=864e5,e.serverTimeDiff=0,e.now=function(){return Date.now()-e.serverTimeDiff}}(plume||(plume={})),function(t){var e,i,n;e=t.Time||(t.Time={}),i=performance.now(),n=performance.now(),e._refresh=function(t){n=t-i,i=t},e.now=function(){return i},e.ellapsed=function(){return n}}(plume||(plume={})),function(o){var t=function(){function r(){this._timers=[],this._inUpdateLoop=!1,this._timersToAdd=[],this._timersToRemove=[],r._TIME_MANAGER=this}return r.get=function(){return null==r._TIME_MANAGER&&(r._TIME_MANAGER=new r),r._TIME_MANAGER},r.prototype.update=function(t){this._inUpdateLoop=!0,this._now=o.Time.now();for(var e=this,i=this._timers.length-1;0<=i;i--){var n=this._timers[i];n.update(this._now)&&n.hasExpired()&&this._timersToRemove.push(n)}this._inUpdateLoop=!1,0<this._timersToRemove.length&&(this._timersToRemove.forEach(function(t){e.remove(t)}),this._timersToRemove.length=0),0<this._timersToAdd.length&&(this._timersToAdd.forEach(function(t){e._pushTimer(t)}),this._timersToAdd.length=0)},r.prototype._pushTimer=function(t){this._timers.push(t)},r.prototype.remove=function(t){if(this._inUpdateLoop)this._timersToRemove.push(t);else{var e=this._timers.indexOf(t);0<=e&&this._timers.splice(e,1)}},r.prototype.removeAll=function(){for(var t=0;t<this._timers.length;t++)this._timers[t]._expired=!0;this._timers=[]},r.prototype.cancelAll=function(){for(var t=this._timers.length-1;0<=t;t--)this._timers[t].cancel()},r.prototype.createTimer=function(t,e,i,n){var r=new o.Timer(this,t,e,i,n);return this._inUpdateLoop?this._timersToAdd.push(r):this._pushTimer(r),r},r.prototype.createAndStartTimer=function(t,e,i,n){var r=this.createTimer(t,e,i,n);return r.start(),r},r.createAndStartTimer=function(t,e,i,n){return r.get().createAndStartTimer(t,e,i,n)},Object.defineProperty(r.prototype,"activeTimersCount",{get:function(){return this._timers.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"activeTimers",{get:function(){return this._timers.map(function(t){return t.id}).join()},enumerable:!0,configurable:!0}),r}();o.TimeManager=t}(plume||(plume={})),function(e){var t=function(){function t(t,e,i,n,r){this.id="DefaultId",this._repeatCount=1,this._running=!1,this._expired=!1,this._timeManager=t,this._delay=e,this._callback=i,this._thisArg=n,this._argArray=r}return t.prototype.setRepeat=function(t){this._repeatCount=t},t.prototype.update=function(t){return!this._running||this._tick-t<=0&&(null!=this._callback&&this._callback.call(this._thisArg,this._argArray),this._repeatCount--,0==this._repeatCount?(this._running=!1,this._expired=!0):(this._repeatCount<-1&&(this._repeatCount=-1),this._tick=t+this._delay,this._startTime=t,!1))},t.prototype.start=function(){this._running||(this._running=!0,this._tick=e.Time.now()+this._delay,this._startTime=e.Time.now())},t.prototype.cancel=function(){this._running=!1,this._timeManager.remove(this)},t.prototype.hasExpired=function(){return this._expired},t.prototype.getProgress=function(){return this._expired?1:this._running?(e.Time.now()-this._startTime)/this._delay:0},t.prototype.getDuration=function(){return this._delay},t}();e.Timer=t}(plume||(plume={})),function(t){!function(t){function e(t){return t*t}function i(t){return t*t*t}function n(t){return t*t*t*t}t.linear=function(t){return t},t.easeInQuad=e,t.easeInCubic=i,t.easeInQuint=n,t.easeOutQuad=function(t){return 1-e(1-t)},t.easeOutCubic=function(t){return 1-i(1-t)},t.easeOutQuint=function(t){return 1-n(1-t)},t.easeInOutQuad=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2},t.easeInOutCubic=function(t){return t<.5?i(2*t)/2:1-i(2*(1-t))/2},t.easeInOutQuint=function(t){return t<.5?n(2*t)/2:1-n(2*(1-t))/2},t.easeOutElastic=function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1}}(t.easing||(t.easing={}))}(plume||(plume={})),function(t){var e=function(){function t(){}return t.init=function(t){this._seed=t,this._seed<=0&&(this._seed+=2147483646)},t.currentSeed=function(){return this._seed},t.get=function(t){return void 0===t&&(t=!1),t?this._random0():Math.random()},t.inRange=function(t,e,i){return void 0===i&&(i=!1),this.get(i)*(e-t)+t},t.sign=function(t){return void 0===t&&(t=!1),this.get(t)<.5?1:-1},t.intInRange=function(t,e,i){return void 0===i&&(i=!1),Math.floor(this.get(i)*(e-t+1))+t},t._getSeededInt=function(){return this._seed=16807*this._seed%2147483647},t._random0=function(){return(this._getSeededInt()-1)/2147483646},t._seed=Date.now(),t}();t.Random=e}(plume||(plume={})),function(t){var e=function(){function e(){}return e.ellipsis=function(t,e,i){if(null==t)return t;if(t.length<=e)return t;var n=t.substring(0,e);return null!=i&&(n+=i),n},e.capitalize=function(t){return null==t?null:t.length<=1?t.toUpperCase():t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},e.interpolate=function(t,i){return t.replace(/{([^{}]*)}/g,function(t,e){return i[e]})},e.pad=function(t,e){for(var i=t+"";i.length<e;)i="0"+i;return i},e.pads=function(t,e){for(;t.length<e;)t="0"+t;return t},e.pad2=function(t){return e.pad(t,2)},e.randomUUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e}();t.Strings=e}(plume||(plume={})),function(t){var e=function(){function t(){this.state=0,this.startTime=0,this.duration=3e3}return t.prototype.reset=function(t,e,i,n,r){this.duration=i,this.startTime=null==n?performance.now():n,this.startValue=t,this.endValue=e,null!=r?this.currentValue=r:null==this.currentValue&&(this.currentValue=this.startValue)},t.prototype.getInterpolation=function(t){var e=(null==t?performance.now():t)-this.startTime;if(e>=this.duration)return this.endValue;var i=e/this.duration,n=i;return null!=this.easing&&(n=this.easing(i)),n=THREE.Math.clamp(n,0,1),this.currentValue=this.computeCurrentValue(n),this.currentValue},t}(),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.computeCurrentValue=function(t){return THREEEXT.Math.lerp(this.startValue,this.endValue,t)},e}(t.ValueSmoother=e);t.ValueSmootherNumber=i;var n=function(e){function t(){var t=e.call(this)||this;return t.currentValue=new THREE.Vector3,t}return __extends(t,e),t.prototype.computeCurrentValue=function(t){return THREEEXT.Vector3.lerpVectors(this.startValue,this.endValue,t)},t}(e);t.ValueSmootherVector3=n;var r=function(e){function t(){var t=e.call(this)||this;return t.currentValue=new THREE.Quaternion,t}return __extends(t,e),t.prototype.computeCurrentValue=function(t){return THREE.Quaternion.slerp(this.startValue,this.endValue,this.currentValue,t),this.currentValue},t}(e);t.ValueSmootherQuat=r}(plume||(plume={})),function(o){var t=function(){function r(){}return r.shuffle=function(t,e){void 0===e&&(e=!1);var i=0,n=0,r=null;for(i=t.length-1;0<i;i-=1)n=Math.floor(o.Random.get(e)*(i+1)),r=t[i],t[i]=t[n],t[n]=r},r.rotate=function(t,e){for(;e--;){var i=t.shift();t.push(i)}},r.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=[],n=0;n<t.length;n++)for(var r=t[n],o=0;o<r.length;o++)i.push(r[o]);return i},r.addAll=function(t,e){if(null!=e)for(var i=0;i<e.length;i++)t.push(e[i])},r.copy=function(t){return null==t?null:t.slice()},r.one=function(t,e){return void 0===e&&(e=!1),null==t||t.length<1?null:1==t.length?t[0]:t[o.Random.intInRange(0,t.length-1,e)]},r.some=function(t,e,i){if(void 0===i&&(i=!1),null==t||t.length<1)return null;var n=r.copy(t);return r.shuffle(n,i),n.length<=e?n:n.slice(0,e)},r.remove=function(t,e){var i=t.indexOf(e);if(0<=i){var n=t.splice(i,1);if(null!=n&&0<n.length)return!0}return!1},r.contains=function(t,e){return 0<=t.indexOf(e)},r}();o.Collections=t}(plume||(plume={})),function(n){var t;(t=n.http||(n.http={})).loadJs=function(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,t())}:i.onload=function(){t()},i.onerror=function(t){n.logger.error("Failed to load script "+e+"! "+t)},i.src=e,document.getElementsByTagName("head")[0].appendChild(i)},t.loadArrayBuffer=function(t,i,n){var e=new XMLHttpRequest;e.open("GET",t,!0),e.addEventListener("load",function(t){var e=this.response;200===this.status||0===this.status?i(e):n&&n()},!1),e.addEventListener("error",function(t){n&&n()},!1),e.responseType="arraybuffer",e.send(null)}}(plume||(plume={})),function(o){var t=function(){function n(){this._params=n.urlParametersToHashMap(document.location.href)}return n.getInstance=function(){return null==n._INSTANCE&&(n._INSTANCE=new n),n._INSTANCE},n.add=function(t,e){n.getInstance()._params.put(t,e)},n.remove=function(t){return n.getInstance()._params.remove(t)},n.get=function(t,e){var i=n.getInstance()._params.get(t);return null==i||i.length<=0?e:i},n.has=function(t){return n.getInstance()._params.containsKey(t)},n.urlParametersToHashMap=function(t){for(var e=new o.HashMap,i=t.substring(t.indexOf("?")+1).split("&"),n=0;n<i.length;n++)if(i[n]){var r=i[n].split("=");e.put(decodeURIComponent(r[0]),decodeURIComponent(r[1]))}return e},n}();o.StartupParams=t}(plume||(plume={})),function(t){var e=function(){function t(){this._handlers=[],this._onces=[]}return Object.defineProperty(t.prototype,"length",{get:function(){return this._handlers.length+this._onces.length},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){this._handlers.push({listener:t,context:e})},t.prototype.once=function(t,e){this._onces.push({listener:t,context:e})},t.prototype.remove=function(t){for(var e=-1,i=0;i<this._handlers.length;i++)if(this._handlers[i].listener==t){e=i;break}-1<e&&this._handlers.splice(e,1)},t.prototype.clear=function(){this._handlers=[],this._onces=[]},t.prototype.fire=function(e){this._handlers.forEach(function(t){t.listener.apply(t.context,[e])}),this._onces.forEach(function(t){t.listener.apply(t.context,[e])}),this._onces=[]},t}();t.Handler=e;var i=function(){function t(t,e){this.callback=t,this.context=e}return t.prototype.execute=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.callback.apply(this.context,t)},t.removeFromArray=function(t,e){for(var i=-1,n=0;n<e.length;n++)if(e[n].callback==t){i=n;break}return 0<=i&&(e.splice(i,1),!0)},t}();t.ContextualCallback=i}(plume||(plume={})),function(t){var e=function(){function t(t){this.size=t,this._data=[],this._resolved=[];for(var e=0;e<t;e++)this._resolved[e]=!1}return t.prototype.resolve=function(t,e){this._data[t]=e,this._resolved[t]=!0,this._allDone()&&this.onComplete(this._data)},t.prototype._allDone=function(){for(var t=0;t<this._resolved.length;t++)if(!this._resolved[t])return!1;return!0},t}();t.WaitQueue=e}(plume||(plume={})),function(i){var t=function(){function t(t){if(this._id=t,this.available=!1,this.available=this._isAvailable(),this.available){var e=localStorage.getItem(this._id);this.cacheData=i.JSONS.safeJson(e,{})}else this.cacheData={}}return t.prototype._isAvailable=function(){try{return localStorage.setItem("test123456789","test123456789"),localStorage.removeItem("test123456789"),!0}catch(t){return!1}},t.prototype.put=function(t,e){this.cacheData[t]=e,this.available&&localStorage.setItem(this._id,JSON.stringify(this.cacheData))},t.prototype.get=function(t,e){if(this.available){var i=this.cacheData[t];return null==i?e:i}return e},t.prototype.remove=function(t){this.available&&(delete this.cacheData[t],0==Object.keys(this.cacheData).length?(localStorage.setItem(this._id,""),localStorage.removeItem(this._id)):localStorage.setItem(this._id,JSON.stringify(this.cacheData)))},t}();i.LocalStorage=t}(plume||(plume={}));__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t){var e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.impacts=new Array,t}return __extends(t,e),t.prototype.get=function(t,e){var i=this._getkey(t,e);return 0<=this.impacts.indexOf(i)?1:0},t.prototype.set=function(t,e,i){var n=this._getkey(t,e);this.impacts.push(n)},t.prototype.reset=function(){this.impacts=[]},t.prototype.setNumObjects=function(t){},t.prototype._getkey=function(t,e){return t+"-"+e},t}(CANNON.ArrayCollisionMatrix);t.CannonArrayCollisionMatrix=e}(plume||(plume={})),function(s){var t=function(){function t(){}return t.newBodyFromMesh=function(t,e){var i=t.geometry;if(i instanceof THREE.BoxBufferGeometry||i instanceof THREE.BoxGeometry){i.computeBoundingBox();var n=i.boundingBox,r=new THREE.Vector3;return n.getSize(r).multiply(t.scale),this.newBox(r.x,r.y,r.z,e)}if(i instanceof THREE.SphereBufferGeometry||i instanceof THREE.SphereGeometry){i.computeBoundingSphere();var o=i.boundingSphere;return this.newSphere(o.radius*t.scale.x,e)}if(i instanceof THREE.BufferGeometry||i instanceof THREE.Geometry){o=this.newTriMeshShape(i);return this.newRigidBody(o,e)}return s.logger.warn("Unable to build physics body from mesh: "+t),null},t.newBoxShape=function(t,e,i){return new CANNON.Box(new CANNON.Vec3(.5*t,.5*e,.5*i))},t.newBox=function(t,e,i,n){void 0===n&&(n={mass:0});var r=this.newBoxShape(t,e,i);return this.newRigidBody(r,n)},t.newSphere=function(t,e){void 0===e&&(e={mass:0});var i=new CANNON.Sphere(t);return this.newRigidBody(i,e)},t.newCylinder=function(t,e,i,n,r,o){void 0===r&&(r={mass:0}),void 0===o&&(o=!0);var s=new CANNON.Cylinder(t,e,i,n);if(o){var a=new CANNON.Quaternion;a.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2);var l=new CANNON.Vec3(0,0,0);s.transformAllPoints(l,a)}return this.newRigidBody(s,r)},t.newPlane=function(t){var e=new CANNON.Plane,i=this.newRigidBody(e);return null!=t&&i.quaternion.set(t.x,t.y,t.z,t.w),i},t.newTriMeshShape=function(t){if(t instanceof THREE.BufferGeometry){var e=t.getAttribute("position").array,i=t.index.array;return new CANNON.Trimesh(e,i)}e=[];for(var n=0;n<t.vertices.length;n++)e[3*n+0]=t.vertices[n].x,e[3*n+1]=t.vertices[n].y,e[3*n+2]=t.vertices[n].z;var r=[];for(n=0;n<t.faces.length;n++)r.push(t.faces[n].a),r.push(t.faces[n].b),r.push(t.faces[n].c);return new CANNON.Trimesh(e,r)},t.newConvexShape=function(t){if(t instanceof THREE.BufferGeometry){for(var e=t.getAttribute("position").array,i=t.index.array,n=[],r=0;r<e.length;r+=3){var o=new CANNON.Vec3(e[r],e[r+1],e[r+2]);n.push(o)}var s=[];for(r=0;r<i.length;r+=3){var a=[i[r],i[r+1],i[r+2]];s.push(a)}return new CANNON.ConvexPolyhedron(n,s)}for(n=[],r=0;r<t.vertices.length;r++){o=new CANNON.Vec3(t.vertices[r].x,t.vertices[r].y,t.vertices[r].z);n.push(o)}for(s=[],r=0;r<t.faces.length;r++){var l=[t.faces[r].a,t.faces[r].b,t.faces[r].c];s.push(l)}return new CANNON.ConvexPolyhedron(n,s)},t.newConvex=function(t,e){void 0===e&&(e={mass:0});var i=this.newConvexShape(t);return this.newRigidBody(i,e)},t.cloneConvexPolyhedron=function(t,e){for(var i=new Array,n=new Array,r=0;r<t.vertices.length;r++){var o=t.vertices[r].clone();o.x*=e.x,o.y*=e.y,o.z*=e.z,i.push(o)}for(r=0;r<t.faces.length;r++){for(var s=t.faces[r],a=new Array,l=0;l<s.length;l++)a.push(s[l]);n.push(a)}return new CANNON.ConvexPolyhedron(i,n)},t.cloneTrimesh=function(t,e){for(var i=new Array,n=new Array,r=0;r<t.vertices.length;r++){var o=t.vertices[r];i.push(o)}for(r=0;r<t.indices.length;r++){o=t.indices[r];n.push(o)}var s=new CANNON.Trimesh(i,n);return s.setScale(new CANNON.Vec3(e.x,e.y,e.z)),s},t.newTriMesh=function(t,e){void 0===e&&(e={mass:0});var i=this.newTriMeshShape(t);return this.newRigidBody(i,e)},t.newRigidBody=function(t,e){void 0===e&&(e={mass:0});var i=new CANNON.Body({mass:e.mass,type:e.type});return i.addShape(t),i},t}();s.CannonBodyBuilder=t}(plume||(plume={})),function(d){var f=new THREE.Vector3,l=new THREE.Vector3,c=function(){function t(){this.offsets=[],this.shapes=[],this._shapesByScale=new d.HashMap}return t.prototype.getShapes=function(t){var e=f;null==t?e.set(1,1,1):e.copy(t);var i=this.manager.scaleIdProvider(e),n=this._shapesByScale.get(i);if(null!=n)return n;for(var r=1==e.x&&1==e.y&&1==e.z,o=new Array,s=0;s<this.shapes.length;s++){var a=this.shapes[s];if(a instanceof CANNON.Box){var l=(u=a.halfExtents).clone();l.x*=e.x,l.y*=e.y,l.z*=e.z;var h=new CANNON.Box(l);o.push(h)}else if(a instanceof CANNON.Sphere){var u=a.radius,c=new CANNON.Sphere(u*e.x);o.push(c)}else if(a instanceof CANNON.ConvexPolyhedron)if(r)o.push(a);else{var p=d.CannonBodyBuilder.cloneConvexPolyhedron(a,e);o.push(p)}else if(a instanceof CANNON.Trimesh)if(r)o.push(a);else{p=d.CannonBodyBuilder.cloneTrimesh(a,e);o.push(p)}else d.logger.warn("Unsupported CANNON.shape : "+a.type)}return this._shapesByScale.put(i,o),o},t.prototype.addShapesToBody=function(t,e,i){var n=null!=i?i:e.getWorldScale(l),r=this.getShapes(n);if(0!=r.length)for(var o=0;o<r.length;o++){var s=r[o],a=this.offsets[o];t.addShape(s,new CANNON.Vec3(a.x,a.y,a.z))}else d.logger.warn("No shapes found for body "+e.name)},t}();d.CannonCachedShape=c;var t=function(){function t(){this.shapeById=new d.HashMap,this._convexWarnDisplayed=!1;var n=this;this.shapeIdProvider=function(t){return t.geometry.uuid},this.scaleIdProvider=function(t){return t.x.toFixed(3)+"-"+t.y.toFixed(3)+"-"+t.z.toFixed(3)},this.trimeshProvider=function(t,e,i){return i?n.createConvexGeometry(e):e}}return t.prototype.readShapesFromGltf=function(e,t){var i=this;t.updateMatrixWorld(!0),t.traverse(function(t){t instanceof THREE.Mesh&&i.readShapeFromGltf(e,t)})},t.prototype.readShapeFromGltf=function(t,e){var i=this.shapeIdProvider(e),n=this.shapeById.get(i);if(null!=n)return n;var r=t.collidersByNode.get(e.uuid);if(null==r)return null;var o=new c;o.manager=this,o.geometry=e.geometry,o.geometryId=i;for(var s=0;s<r.length;s++){var a=r[s];if("box"==a.type){var l=d.CannonBodyBuilder.newBoxShape(a.size[0],a.size[1],a.size[2]),h=new THREE.Vector3(a.center[0],a.center[1],a.center[2]);o.shapes.push(l),o.offsets.push(h)}else if("sphere"==a.type){l=new CANNON.Sphere(a.radius),h=new THREE.Vector3(a.center[0],a.center[1],a.center[2]);o.shapes.push(l),o.offsets.push(h)}else if("mesh"==a.type){l=void 0;var u=this.trimeshProvider(e,e.geometry,a.convex);l=a.convex?d.CannonBodyBuilder.newConvexShape(u):d.CannonBodyBuilder.newTriMeshShape(u);h=new THREE.Vector3(0,0,0);o.shapes.push(l),o.offsets.push(h)}}return this.shapeById.put(i,o),o},t.prototype.addShapesToBody=function(t,e,i){var n=this.shapeIdProvider(e),r=this.shapeById.get(n);null!=r?r.addShapesToBody(t,e,i):d.logger.warn("No shape found for "+e.name)},t.prototype.createConvexGeometry=function(t){var e=[];if(t instanceof THREE.Geometry)e=t.vertices;else for(var i=t.toNonIndexed().attributes.position,n=0;n<i.count;n++){var r=(new THREE.Vector3).fromBufferAttribute(i,n);e.push(r)}return new THREEEXT.ConvexGeometry(e)},t}();d.CannonCachedShapeManager=t}(plume||(plume={})),function(o){var t=function(r){function t(t){var e=r.call(this)||this;return e.optFixedTimeStep=1/60,e.optMaxSubSteps=10,e.readyHandlers=new o.Handler,e._ready=!1,e._dynamicBodies=[],e._dynamicBodiesData=[],e._bodies=[],e._visuals=[],e._bodyForVisuals=[],e._stats={avg:0,_timeTotal:0,_flush:0,_count:0},e._world=new CANNON.World,e._world.gravity.set(0,-10,0),e._stats._flush=performance.now(),e._stats._timeTotal=0,null!=t&&t(e._world),e}return __extends(t,r),t.prototype.useCustomMatrixCollision=function(){this._world.collisionMatrix=new o.CannonArrayCollisionMatrix,this._world.collisionMatrixPrevious=new o.CannonArrayCollisionMatrix},t.prototype.update=function(t){if(r.prototype.update.call(this,t),this._running){var e=t/1e3,i=performance.now();this._world.step(this.optFixedTimeStep,e,this.optMaxSubSteps),this._syncMesh();var n=performance.now();1e3<=i-this._stats._flush&&(this._stats.avg=Math.round(this._stats._timeTotal/this._stats._count*100)/100,this._stats._flush=i,this._stats._count=0,this._stats._timeTotal=0),this._stats._timeTotal+=n-i,this._stats._count++}},Object.defineProperty(t.prototype,"stats",{get:function(){return this._stats},enumerable:!0,configurable:!0}),t.prototype.setGravity=function(t,e,i){this._world.gravity.set(t,e,i)},t.prototype.onStart=function(){},t.prototype.onStop=function(){},t.prototype.getWorld=function(){return this._world},t.prototype.updatePositionAndRotation=function(t,e,i){null!=e&&t.position.set(e.x,e.y,e.z),null!=i&&t.quaternion.set(i.x,i.y,i.z,i.w)},t.prototype.addRigidBody=function(t,e,i,n,r){null!=e&&this.updatePositionAndRotation(t,e.position,e.quaternion),i&&(this._dynamicBodies.push(t),this._dynamicBodiesData.push({rigidbody:t,mesh:e,syncPosition:!0,syncRotation:!0})),null!=n&&(t.collisionFilterGroup=n),null!=r&&(t.collisionFilterMask=r),this._bodies.push(t),this._world.addBody(t)},t.prototype.removeRigidBody=function(t){var e=this._dynamicBodies.indexOf(t);0<=e&&(this._dynamicBodies.splice(e,1),this._dynamicBodiesData.splice(e,1)),0<=(e=this._bodies.indexOf(t))&&this._bodies.splice(e,1),this._world.removeBody(t)},t.prototype.setDynamicBodySyncProperty=function(t,e,i){var n=this._dynamicBodies.indexOf(t),r=this._dynamicBodiesData[n];r.syncPosition=e,r.syncRotation=i},t.prototype.getRigidBodies=function(){return this._bodies},t.prototype.removeRigidBodies=function(){for(var t=this._bodies.length-1;0<=t;t--){var e=this._bodies[t];this.removeRigidBody(e)}},t.prototype._syncMesh=function(){for(var t=0;t<this._dynamicBodiesData.length;t++){var e=this._dynamicBodiesData[t],i=e.rigidbody,n=e.mesh;if(e.syncPosition){var r=i.position;n.position.set(r.x,r.y,r.z)}if(e.syncRotation){var o=i.quaternion;n.quaternion.set(o.x,o.y,o.z,o.w)}}for(t=0;t<this._visuals.length;t++){var s=this._visuals[t];i=this._bodyForVisuals[t];s.position.set(i.position.x,i.position.y,i.position.z),i.quaternion&&s.quaternion.set(i.quaternion.x,i.quaternion.y,i.quaternion.z,i.quaternion.w)}},t.prototype.destroy=function(){this.removeRigidBodies()},t.prototype.addVisual=function(t,e,i){var n=this.createVisual(t,e);return this._visuals.push(n),this._bodyForVisuals.push(t),i.add(n),n},t.prototype.removeVisual=function(t){var e;if(t instanceof CANNON.Body){var i=this._bodyForVisuals.indexOf(t);if(null==(e=this._visuals[i]))return void o.logger.warn("No visual attached to body.")}else e=t;var n=this._visuals.indexOf(e);0<=n&&(this._visuals.splice(n,1),this._bodyForVisuals.splice(n,1),e.parent.remove(e))},t.prototype.removeVisuals=function(){for(var t=this._visuals.length-1;0<=t;t--){var e=this._visuals[t];this.removeVisual(e)}},t.prototype.createVisual=function(t,e){for(var i=new THREE.Object3D,n=0;n<t.shapes.length;n++){var r=t.shapes[n],o=void 0;switch(r.type){case CANNON.Shape.types.SPHERE:var s=new THREE.SphereGeometry(r.radius,8,8);o=new THREE.Mesh(s,e);break;case CANNON.Shape.types.PLANE:var a=new THREE.PlaneGeometry(10,10,4,4);o=new THREE.Object3D;var l=new THREE.Object3D,h=new THREE.Mesh(a,e);h.scale.set(100,100,100),l.add(h),o.add(l);break;case CANNON.Shape.types.BOX:var u=r,c=new THREE.BoxGeometry(2*u.halfExtents.x,2*u.halfExtents.y,2*u.halfExtents.z);o=new THREE.Mesh(c,e);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:for(var p=new THREE.Geometry,d=r,f=0;f<d.vertices.length;f++){var m=d.vertices[f];p.vertices.push(new THREE.Vector3(m.x,m.y,m.z))}for(f=0;f<d.faces.length;f++)for(var y=d.faces[f],g=y[0],v=1;v<y.length-1;v++){var _=y[v],x=y[v+1];p.faces.push(new THREE.Face3(g,_,x))}p.computeBoundingSphere(),p.computeFaceNormals(),o=new THREE.Mesh(p,e);break;case CANNON.Shape.types.TRIMESH:var S=new THREE.Geometry,w=r,b=new CANNON.Vec3,E=new CANNON.Vec3,T=new CANNON.Vec3;for(f=0;f<w.indices.length/3;f++){w.getTriangleVertices(f,b,E,T),S.vertices.push(new THREE.Vector3(b.x,b.y,b.z),new THREE.Vector3(E.x,E.y,E.z),new THREE.Vector3(T.x,T.y,T.z));v=S.vertices.length-3;S.faces.push(new THREE.Face3(v,v+1,v+2))}S.computeBoundingSphere(),S.computeFaceNormals(),o=new THREE.Mesh(S,e);break;default:throw"Visual type not recognized: "+r.type}var I=t.shapeOffsets[n],C=t.shapeOrientations[n];o.position.set(I.x,I.y,I.z),o.quaternion.set(C.x,C.y,C.z,C.w),i.add(o)}return i},t}(o.SimulationSupport);o.CannonSimulation=t}(plume||(plume={}));__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(i){var t=function(){function e(t){this.options=t,(e._inst=this).expandedBounds=new i.Rectangle(0,0,i.Game.get().width,i.Game.get().height),this.layers=new i.GameContainerGroup,this._initCanvas(),this.scaling=new i.GuiScaling,this.scaling.init(),this._mouseInterpretor=new i.GuiMouseEventInterpretor,i.Game.get().inputManager.mouseEventInterpretors.push(this._mouseInterpretor)}return e.get=function(){return this._inst},e.prototype.update=function(t){this.layers.update(),this.scene&&this.scene.update(t)},e.prototype.render=function(t,e){this.scene&&this.scene.render(t,e),this._beginDraw(),this.layers.root.draw(this._context2D),this._endDraw()},e.prototype.switchScene=function(t,e,i){var n=this;void 0===e&&(e=!0),void 0===i&&(i=!0),this.scene?(this._currentOrPendingScene=t,this.scene.hide(function(){n.layers.scene.removeChild(n.scene.container),n._pushScene(t,i)},e)):(this._currentOrPendingScene=t,this._pushScene(t,i))},e.prototype._pushScene=function(t,e){i.logger.debug("Change scene"),this.scene=t,this.scene&&(this.layers.scene.addChild(this.scene.container),this.scene.show(e))},e.prototype.getCurrentOrPendingScene=function(){return this._currentOrPendingScene},e.prototype._initCanvas=function(){if(null!=this.options.canvasId){var t=this.options.canvasId;if(this.canvas=document.getElementById(t),null==this.canvas)throw new Error("Unable to find canvas: "+t)}else this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",document.body.appendChild(this.canvas);var e=i.Game.get().bounds;this.canvas.width=e.width,this.canvas.height=e.height,this._context2D=this.canvas.getContext("2d"),i.Renderer._applyStyle(this.canvas),this.canvas.style.pointerEvents="none"},e.prototype._beginDraw=function(){this._context2D.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype._endDraw=function(){},Object.defineProperty(e.prototype,"context",{get:function(){return this._context2D},enumerable:!0,configurable:!0}),e}();i.CanvasGui=t}(plume||(plume={})),function(e){var t=function(){function t(){}return t.getRgb=function(t){return[t>>16&255,t>>8&255,255&t]},t.fromRgb=function(t,e,i){return t<<16|e<<8|i},t.fromHSV=function(t,e,i){var n,r,o,s=Math.floor(6*t),a=6*t-s,l=i*(1-e),h=i*(1-a*e),u=i*(1-(1-a)*e);switch(s%6){case 0:n=i,r=u,o=l;break;case 1:n=h,r=i,o=l;break;case 2:n=l,r=i,o=u;break;case 3:n=l,r=h,o=i;break;case 4:n=u,r=l,o=i;break;case 5:n=i,r=l,o=h}return n=Math.round(255*n),r=Math.round(255*r),o=Math.round(255*o),this.fromRgb(n,r,o)},t.toString=function(t,e){return void 0===e&&(e=1),"rgba("+((16711680&t)>>>16)+","+((65280&t)>>>8)+","+(255&t)+","+e+")"},t.toHexString=function(t){return"#"+e.Strings.pads(t.toString(16),6)},t.fromString=function(t){return 7!=t.length?0:parseInt(t.replace("#",""),16)},t}();e.Colors=t}(plume||(plume={})),function(s){var t=function(){function r(){this._clickHandlerCount=0,this._inputManager=s.Game.get().inputManager,this._mouseHandler=s.Game.get().inputManager.mouse,this._desktop=s.Game.get().deviceManager.os.desktop,this.rootContainer=s.CanvasGui.get().layers.root}return r.prototype.onUpdate=function(){this._triggerMouseHit()},r.prototype.onImmediate=function(){if(!(this._clickHandlerCount<=0))for(var t=0;t<this._mouseHandler.pointers.length;t++){var e=this._mouseHandler.pointers[t];e.isActive()&&this._triggerImmediateClick0(e)}},r.prototype._triggerMouseHit=function(){var t=this._inputManager._pointerDirty;if(this._inputManager._pointerDirty=!1,s.DisplayObject.interactiveDirty&&(this._clickHandlerCount=0,this._invalidateInteractive(this.rootContainer),t=!(s.DisplayObject.interactiveDirty=!1)),t)for(var e=0;e<this._mouseHandler.pointers.length;e++){var i=this._mouseHandler.pointers[e];this._triggerMouseHit0(i)}},r.prototype._invalidateInteractive=function(t){t.hasInteractiveChild=!1;for(var e=t.getChildrenCount(),i=0;i<e;i++){var n=t.getChildAt(i);n instanceof s.Container?(this._invalidateInteractive(n),(n.hasInteractiveChild||n.interactive)&&(t.hasInteractiveChild=!0)):n.interactive&&(t.hasInteractiveChild=!0),n.hasClickHandler()&&this._clickHandlerCount++}},r.prototype._triggerMouseHit0=function(t){if(t.mouseChanged()){var e=new Array;if(r._collectInteractiveHit(t.position,this.rootContainer,e),0<e.length){var i=e[e.length-1];t.interactiveElement=i,t.isJustDown?(t._lastDownTarget=i).hasDownHandler()&&i.downHandler.fire(!0):t.isJustUp&&i.hasUpHandler()&&i.upHandler.fire(!0),i!=t._previousHit&&(i.hasOverHandler()&&i.overHandler.fire(!0),null!=t._previousHit&&t._previousHit.hasOutHandler()&&t._previousHit.outHandler.fire()),t._previousHit=i}else(t.interactiveElement=null)!=t._previousHit&&t._previousHit.hasOutHandler()&&t._previousHit.outHandler.fire(),t._previousHit=null;if(this._desktop&&!this._inputManager.noCursor){var n=s.Game.get().engine.canvas;null!=t._previousHit&&t._previousHit.showCursor?n.style.cursor="pointer":n.style.cursor="default"}}},r.prototype._triggerImmediateClick0=function(t){var e=new Array;if(r._collectInteractiveHit(t.position,this.rootContainer,e),0<e.length){var i=e[e.length-1];i.hasClickHandler()&&(t.wasSwipe()||i.clickHandler.fire(!0))}},r._collectInteractiveHit=function(t,e,i){if(e.visible){if(e.interactive)e.hitPoint(t)&&i.push(e);if(e.hasInteractiveChild)for(var n=e.getChildrenCount(),r=0;r<n;r++){var o=e.getChildAt(r);o instanceof s.Container?this._collectInteractiveHit(t,o,i):o.visible&&o.interactive&&o.hitPoint(t)&&i.push(o)}}},r}();s.GuiMouseEventInterpretor=t}(plume||(plume={})),function(u){var t=function(){function t(){this._scaleManager=u.Game.get().scaleManager}return t.prototype.init=function(){this._scaleManager.resizeHandler.add(this._onResize,this),this._onResize()},t.prototype._onResize=function(){var t=this._scaleManager.getCurrentScaling(),e=window.devicePixelRatio||1,i=t.windowWidth,n=t.windowHeight,r=u.CanvasGui.get(),o=r.canvas,s=r.layers.root;o.width=i*e,o.height=n*e,o.style.width=i+"px",o.style.height=n+"px",s.scaleXY=t.scale*e,s.x=t.x*e,s.y=t.y*e;var a=u.Game.get(),l=t.x/t.scale,h=t.y/t.scale;u.CanvasGui.get().expandedBounds=new u.Rectangle(-l,-h,a.width+2*l,a.height+2*h)},t}();u.GuiScaling=t}(plume||(plume={})),function(n){var t=function(){function t(){this.game=n.Game.get(),this.gui=n.CanvasGui.get(),this.container=new n.Container(this.game.bounds.width,this.game.bounds.height),this.container.debugName="Scene"}return t.prototype.addChild=function(t){this.container.addChild(t)},t.prototype.removeChild=function(t){this.container.removeChild(t)},t.prototype.update=function(t){},t.prototype.render=function(t,e){},t.prototype.show=function(t){var e=this;void 0===t&&(t=!0);var i=this;1==t?this.animateIn(function(){e.game.inputManager.enable(),n.DisplayObject.interactiveDirty=!0,i.onShow()}):(this.game.inputManager.enable(),n.DisplayObject.interactiveDirty=!0,this.onShow())},t.prototype.animateIn=function(t){t()},t.prototype.onShow=function(){},t.prototype.hide=function(t,e){void 0===e&&(e=!0),n.Game.get().inputManager.disable(),null!=this._hideHandler&&(this._hideHandler.fire({}),this._hideHandler.clear());var i=this;1==e?this.animateOut(function(){i.onHide(),i.dispose(),t()}):(this.onHide(),this.dispose(),t())},t.prototype.animateOut=function(t){t()},t.prototype.onHide=function(){},t.prototype.dispose=function(){},Object.defineProperty(t.prototype,"hideHandler",{get:function(){return null==this._hideHandler&&(this._hideHandler=new n.Handler),this._hideHandler},enumerable:!0,configurable:!0}),t}();n.GuiScene=t}(plume||(plume={})),function(r){var t=function(){function e(){this._root=!1,this.showCursor=!0,this._visible=!0,this._interactive=!1,this._hasInteractiveChild=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._rotation=0,this._alpha=1,this._scaleX=1,this._scaleY=1,this._pivotX=0,this._pivotY=0,this._flipX=!1,this._flipY=!1,this._tint=16777215,this._transformDirty=!1,this._worldAlpha=1,this._cachedAsBitmap=!1,this._x=0,this._y=0,this._scaleX=1,this._scaleY=1,this._id=e._idCount++,this._debugId="DisplayObject-"+this._id,this._transform=new r.Matrix,this._worldTransform=new r.Matrix,this._hitTransform=new r.Matrix}return e.prototype.addDebugBorder=function(t){void 0===t&&(t="#00FFBB"),this._debugColor=t,this.debug=!0},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=null==t?16777215:t},enumerable:!0,configurable:!0}),e.prototype.draw=function(t){if(this.visible){this.computeWorldTransform();var e=this.getParentAlpha();this._worldAlpha=this._alpha*e,t.globalAlpha=this._worldAlpha,t.save(),this._worldTransform.applyToContext(t),null!=this._mask&&this._mask._applyMask(t),this.cachedAsBitmap?(null==this._cachedTexture&&this.createCachedTexture(),this.drawCachedTexture(t)):this.draw0(t),t.restore()}},e.prototype.computeWorldTransform=function(){this._transformDirty&&(this._transformDirty=!1,this._transform.reset(),0==this._x&&0==this._y||this._transform.translate(this._x,this._y),(0!=this._rotation||1!=this._scaleX||1!=this._scaleY||this._flipX||this._flipY)&&(0==this._pivotX&&0==this._pivotY||this._transform.translate(this._pivotX,this._pivotY),0!=this._rotation&&this._transform.rotate(this._rotation),0==this._pivotX&&0==this._pivotY||this._transform.translate(-this._pivotX,-this._pivotY),1==this._scaleX&&1==this._scaleY||this._transform.scale(this._scaleX,this._scaleY),(this._flipX||this._flipY)&&(this._transform.translate(this._width*(this._flipX?1:0),this._height*(this._flipY?1:0)),this._transform.scale(this._flipX?-1:1,this._flipY?-1:1))));var t=this.getParentWorldTransform(),e=new r.Matrix;e.setTransform(t.a,t.b,t.c,t.d,t.e,t.f),e.transform(this._transform.a,this._transform.b,this._transform.c,this._transform.d,this._transform.e,this._transform.f);var i=this.getParentHitTransform(),n=new r.Matrix;(i&&n.setTransform(i.a,i.b,i.c,i.d,i.e,i.f),this._root||n.transform(this._transform.a,this._transform.b,this._transform.c,this._transform.d,this._transform.e,this._transform.f),this._interactive)&&((!n.isEqual(this._hitTransform)||null==this._worldHitArea)&&this.updateWorldHitArea(n));this._worldTransform=e,this._hitTransform=n},e.prototype.getParentWorldTransform=function(){return null==this._parent?new r.Matrix:this._parent._worldTransform},e.prototype.getParentAlpha=function(){return null==this._parent?1:this._parent._worldAlpha},e.prototype.getParentHitTransform=function(){return this._root?this._hitTransform:this._parent?this._parent._hitTransform:null},e.prototype.updateWorldHitArea=function(t){var e;if(null!=this._hitArea)e=t.applyToArray([this._hitArea.x,this._hitArea.y,this._hitArea.x+this._hitArea.width,this._hitArea.y,this._hitArea.x+this._hitArea.width,this._hitArea.y+this._hitArea.height,this._hitArea.x,this._hitArea.y+this._hitArea.height]);else{if(this._width<=0||this.height<=0)return void r.logger.warn("Cannot compute hit area on no-size object. Check bounds of #"+this.getDebugId()+". Size:"+this._width+"x"+this._height);e=t.applyToArray([0,0,this._width,0,this._width,this._height,0,this._height])}e.push(e[0]),e.push(e[1]),this._worldHitArea=e},e.prototype.draw0=function(t){},e.prototype.createCachedTexture=function(){},e.prototype.drawCachedTexture=function(t){t.drawImage(this._cachedTexture.getImpl(),this._cachedTexture.x,this._cachedTexture.y,this._cachedTexture.width,this._cachedTexture.height,0,0,this._cachedTexture.width,this._cachedTexture.height)},e.prototype.onDetach=function(){null!=this._detachListener&&this._detachListener.fire(!0)},e.prototype.removeSelf=function(){return null!=this._parent&&null!=this._parent.removeChild(this)},e.prototype.getDebugId=function(){return this._debugId},e.prototype.setDebugId=function(t,e){void 0===e&&(e=!1),this._debugId=t,e&&(this._debugId+=this._id)},e.prototype.hitPoint=function(t){return null!=this._worldHitArea&&0<this._worldHitArea.length?r.Collisions.pointInPolygon2(this._worldHitArea,t.x,t.y):!this._transformDirty&&(r.logger.error("Using containsPoint without worldHitArea. Check object bounds of #"+this.getDebugId()+". Size:"+this._width+"x"+this._height+", Hit area: "+this._hitArea),this.containsPoint(t))},e.prototype.containsPoint=function(t){return!1},Object.defineProperty(e.prototype,"interactive",{get:function(){return this._interactive},set:function(t){e.interactiveDirty=!0,this._worldHitArea=null,this._interactive=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitArea",{get:function(){return this._hitArea},set:function(t){this._hitArea=t,this._worldHitArea=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasInteractiveChild",{get:function(){return this._hasInteractiveChild},set:function(t){this._hasInteractiveChild=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"interactiveDirty",{get:function(){return this._interactiveDirty},set:function(t){this._interactiveDirty=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t},enumerable:!0,configurable:!0}),e.prototype.onClick=function(t,e,i){this.interactive=!0,null!=i&&1==i?this.clickHandler.once(t,e):this.clickHandler.add(t,e)},e.prototype.hasDownHandler=function(){return null!=this._downHandler&&0<this._downHandler.length},e.prototype.hasUpHandler=function(){return null!=this._upHandler&&0<this._upHandler.length},e.prototype.hasOverHandler=function(){return null!=this._overHandler&&0<this._overHandler.length},e.prototype.hasOutHandler=function(){return null!=this._outHandler&&0<this._outHandler.length},e.prototype.hasClickHandler=function(){return null!=this._clickHandler&&0<this._clickHandler.length},Object.defineProperty(e.prototype,"downHandler",{get:function(){return null==this._downHandler&&(this._downHandler=new r.Handler),this._downHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upHandler",{get:function(){return null==this._upHandler&&(this._upHandler=new r.Handler),this._upHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overHandler",{get:function(){return null==this._overHandler&&(this._overHandler=new r.Handler),this._overHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outHandler",{get:function(){return null==this._outHandler&&(this._outHandler=new r.Handler),this._outHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clickHandler",{get:function(){return null==this._clickHandler&&(this._clickHandler=new r.Handler),this._clickHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"detachListener",{get:function(){return null==this._detachListener&&(this._detachListener=new r.Handler),this._detachListener},enumerable:!0,configurable:!0}),e.prototype.setPivot=function(t,e){this._pivotX=t,this._pivotY=e,this._transformDirty=!0},e.prototype.setPivotToCenter=function(){if(this._width<=0||this._height<=0)throw new Error("Cannot set pivot to center on display object without size");this._pivotX=this.width/2,this._pivotY=this.height/2,this._transformDirty=!0},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t,1<this._alpha?this._alpha=1:this._alpha<0&&(this.alpha=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleXY",{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this._scaleY=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotX",{get:function(){return this._pivotX},set:function(t){this._pivotX=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotY",{get:function(){return this._pivotY},set:function(t){this._pivotY=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._rotation*r.Mathf.RAD2DEG},set:function(t){this.rotation=t*r.Mathf.DEG2RAD},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width*this._scaleX},set:function(t){0!=this._width&&(this.scaleX=t/this._width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height*this._scaleY},set:function(t){0!=this._height&&(this.scaleY=t/this._height)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(t){throw new Error("parent is readonly")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this._transformDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cachedAsBitmap",{get:function(){return this._cachedAsBitmap},set:function(t){this._cachedAsBitmap=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),e._interactiveDirty=!1,e._idCount=0,e}();r.DisplayObject=t}(plume||(plume={})),function(r){var t=function(n){function e(t){var e=n.call(this)||this;if(e._texture=t,e._debugId="Sprite-"+e._id,e.setSizeFromTexture(),!e.texture.isLoaded()){var i=e;e.texture.addLoadedHandler(function(){i.setSizeFromTexture()})}return e}return __extends(e,n),e.prototype.setSizeFromTexture=function(){if(this.texture.trimmed){var t=this.texture.getTrim();this._width=t.width,this._height=t.height}else this._width=this.texture.width,this._height=this.texture.height},e.fromFrame=function(t){return new e(r.Texture.getTexture(t))},e.fromImage=function(t){return new e(r.Texture.fromImage(t))},e.fromTexture=function(t){return new e(t)},e.prototype.setTexture=function(t){this._texture=t},e.prototype.setFrame=function(t){this._texture=r.Texture.getTexture(t)},e.prototype.addLoadedHandler=function(t){this.texture.addLoadedHandler(t)},Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),e.prototype.draw0=function(t){var e=16777215==this._tint?this._texture:r.Tinter.tint(this._texture,this._tint),i=0,n=0;this.texture.trimmed&&(i=this.texture.getTrim().x,n=this.texture.getTrim().y),t.drawImage(e.getImpl(),e.x,e.y,e.width,e.height,i,n,e.width,e.height)},e}(r.DisplayObject);r.Sprite=t}(plume||(plume={})),function(o){var t=function(r){function i(t,e){var i=r.call(this,t[0])||this;i.fps=1e3/60,i._curIndex=0,i._textures=[],i._playing=!1,i._startTime=0,i._startFrame=0,i._lastIndex=-1,i._from=0,i._to=0,i._repeats=1,i.forward=!0,i.animationSpeed=1,i.paused=!1,i.pausedDuration=0;var n=i;return t.forEach(function(t){n._textures.push(t)}),o.Game.get().addUpdatable(i),i.detachListener.once(i.destroy,i),null!=e&&i.setDebugId(e),i}return __extends(i,r),i.fromFrames=function(t,e){return new i(o.Texture.fromFrames(t),e)},i.fromTextures=function(t,e){return new i(t,e)},i.prototype.destroy=function(){this.stop(),o.Game.get().removeUpdatable(this)},i.prototype.setTextures=function(t){this.setTextures2(o.Texture.fromFrames(t))},i.prototype.setTextures2=function(t){var e=this.isPlaying();1==e&&this.stop(),this._textures=t,this.gotoAndStop(0),1==e&&this.play()},i.prototype.setFrameIndex=function(t){var e=this._textures[t];this.setTexture(e),0==this._playing&&(this._playing=!0)},i.prototype.setActiveFrame=function(t){var e;if(null!=t&&(e=t<0?(t%this._totalFrames+this._totalFrames)%this._totalFrames:t%this._totalFrames)!=this._curIndex){this._curIndex=e;var i=this._from+this._curIndex%this._totalFrames;this.setFrameIndex(i),0<this._lastIndex&&(t=Math.abs(t))>=this._lastIndex&&(this.setFrameIndex(this._to),this._onAnimationEnded())}},i.prototype._onAnimationEnded=function(){this._playing=!1,this.onEnd&&this.onEnd()},i.prototype.gotoAndStop=function(t){this.setFrameIndex(t),this._playing=!1},i.prototype.gotoAndPlay=function(t){this.setFrameIndex(t)},i.prototype.update=function(t){if(this.paused)this.pausedDuration+=t;else if(this._playing){var e=Math.floor((o.Time.now()-this._startTime)/this.fps);e=Math.floor(e*this.animationSpeed);var i=this._startFrame;this.forward?i+=e:i-=e,this.setActiveFrame(i)}},i.prototype.getTotalFrames=function(){return this._totalFrames},i.prototype.getCurrentFrame=function(){return this._curIndex},i.prototype._play0=function(){this._playing=!0,this._startTime=o.Time.now(),this._startFrame=this._curIndex},i.prototype.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._from=t,this._to=0<e?e:this._textures.length-1,this._totalFrames=this._to-this._from+1,this._curIndex=t,this.setFrameIndex(t),this._repeats<0?this._lastIndex=-1:this._lastIndex=this._curIndex+this._totalFrames*this._repeats,this._play0()},i.prototype.repeat=function(t){void 0===t&&(t=0),this._repeats=t},i.prototype.isPlaying=function(){return this._playing},i.prototype.stop=function(){this._playing=!1},i.prototype.pause=function(){this.paused=!0},i.prototype.resume=function(){this._startTime+=this.pausedDuration,this.pausedDuration=0,this.paused=!1},i}(o.Sprite);o.Animation=t}(plume||(plume={})),function(i){var t=function(n){function o(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=n.call(this)||this;return i._children=[],i._debugId="Container-"+i._id,i._width=t,i._height=e,i}return __extends(o,n),o.prototype.addChild=function(t){return this.addChildAt(t,this._children.length)},o.prototype.addChildAt=function(t,e){if(t._parent){if(t._parent==this)return console.error("Child already in H5Container. Use setChildIndex."),t;t._parent.removeChild(t)}return this._children.splice(e,0,t),t._parent=this,t},o.prototype.removeChild=function(t){var e=this._children.indexOf(t);return-1===e?null:this.removeChildAt(e)},o.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e._parent=null,e.onDetach(),this._children.splice(t,1),e},o.prototype.removeChildren=function(t,e){var i=null==t?0:t,n=(null==e?this._children.length:e)-i;if(n<=0)return[];for(var r=this._children.splice(i,n),o=0;o<r.length;o++){var s=r[o];s._parent=null,s.onDetach()}return r},o.prototype.getChildIndex=function(t){return this._children.indexOf(t)},o.prototype.getChildById=function(t){for(var e=0;e<this._children.length;e++){var i=this._children[e];if(i.getDebugId()==t)return i}return null},o.prototype.setChildIndex=function(t,e){var i=this.getChildIndex(t);i!=e?(this._children.splice(i,1),this._children.splice(e,0,t)):console.error("Child "+t.getDebugId()+"already @ that index : "+e)},o.prototype.onDetach=function(){n.prototype.onDetach.call(this);for(var t=this._children.length,e=0;e<t;e++)this._children[e].onDetach()},o.prototype.getChildAt=function(t){return this._children[t]},o.prototype.getChildrenCount=function(){return this._children.length},o.prototype._outputToConsole=function(t,e){void 0===e&&(e=[]);for(var i="",n=0;n<t;n++)i+="  ";for(n=0;n<this._children.length;n++){var r=this._children[n];console.log(i+this._getDebugPropertyString(r,e)),r instanceof o&&r._outputToConsole(t++,e)}},o.prototype._countElements=function(t){if(void 0===t&&(t=!1),t&&!this.visible)return 0;for(var e=1,i=0;i<this._children.length;i++){var n=this._children[i];e+=n instanceof o?n._countElements():1}return e},o.prototype._getDebugPropertyString=function(e,t){var i=e.getDebugId()+" ";return t.forEach(function(t){i+=t+"="+e[t]+" "}),i},o.prototype.draw0=function(t){n.prototype.draw0.call(this,t);for(var e=0;e<this._children.length;e++){this._children[e].draw(t)}},o.prototype.setSize=function(t,e){this._width=t,this._height=e},o.prototype.setSizeFromChildren=function(t){void 0===t&&(t=!1);var e=i.layout.computeBounds(this,t);this.setSize(e.width,e.height)},o}(i.DisplayObject);i.Container=t}(plume||(plume={})),function(t){var e=function(e){function t(){var t=e.call(this)||this;return t._enabled=!0,t.disableAlpha=.5,t.interactive=!0,t.downHandler.add(t.onStateDown,t),t.upHandler.add(t.onStateUp,t),t.overHandler.add(t.onStateOver,t),t.outHandler.add(t.onStateOut,t),t.enable(),t}return __extends(t,e),t.prototype.enable=function(){this._enabled=!0,this.interactive=!0,this.alpha=1},t.prototype.disable=function(){this._enabled=!1,this.interactive=!1,this.alpha=this.disableAlpha},t.prototype.onStateDown=function(){this._down=!0},t.prototype.onStateUp=function(){this._over=!1,this._down=!1},t.prototype.onStateOver=function(){this._over=!0},t.prototype.onStateOut=function(){this._over=!1,this._down=!1},t}(t.Container);t.Button=e}(plume||(plume={})),function(a){var n=function(){function s(t,e,i){this._stateUp=t,this._stateDown=e,this._stateOver=i}return s.fromFrames=function(t,e,i){var n=a.Sprite.fromFrame(t),r=null,o=null;return null!=e&&(r=a.Sprite.fromFrame(e)),null!=i&&(o=a.Sprite.fromFrame(i)),new s(n,r,o)},s.fromTextures=function(t,e,i){var n=a.Sprite.fromTexture(t),r=null,o=null;return null!=e&&(r=a.Sprite.fromTexture(e)),null!=i&&(o=a.Sprite.fromTexture(i)),new s(n,r,o)},s}();a.ImageButtonStyle=n;var t=function(i){function o(t){var e=i.call(this)||this;return e._text=null,e._icon=null,e._style=t,e.addChild(e._style._stateDown),e.addChild(e._style._stateOver),e.addChild(e._style._stateUp),e.setSize(e._style._stateUp.width,e._style._stateUp.height),e}return __extends(o,i),o.fromFramesArray=function(t){var e=t.length;if(e<1||3<e)throw new Error("Invalid states array size");var i=t[0],n=null,r=null;return 1<e&&(n=t[1]),2<e&&(r=t[2]),o.fromFrames(i,n,r)},o.fromFrames=function(t,e,i){return new o(n.fromFrames(t,e,i))},o.fromTextures=function(t,e,i){return new o(n.fromTextures(t,e,i))},o.prototype.setFrames=function(t,e,i){this._style._stateDown&&this._style._stateDown.removeSelf(),this._style._stateOver&&this._style._stateOver.removeSelf(),this._style._stateUp&&this._style._stateUp.removeSelf(),this._style=n.fromFrames(t,e,i),this.addChildAt(this._style._stateUp,0),this._style._stateDown&&this.addChildAt(this._style._stateDown,0),this._style._stateOver&&this.addChildAt(this._style._stateOver,0)},o.prototype.setFramesArray=function(t){var e=t[0],i=null,n=null;1<t.length&&(i=t[1]),2<t.length&&(n=t[2]),this.setFrames(e,i,n)},o.prototype.setContent=function(t){this.addChild(t),a.layout.centerOnX(t,this,!1),a.layout.centerOnY(t,this,!1)},o.prototype.setText=function(t){null!=this._text&&this._text.removeSelf(),this._text=t,this.addChild(t),a.layout.centerOnX(t,this,!1),a.layout.centerOnY(t,this,!1)},o.prototype.setIcon=function(t,e){null!=this._icon&&this._icon.removeSelf(),this._icon=a.Sprite.fromFrame(t),null!=e&&(this._icon.scaleXY=e),a.layout.centerOnX(this._icon,this,!1),a.layout.centerOnY(this._icon,this,!1),this.addChild(this._icon)},o.prototype.setStateTexture=function(){this._style._stateDown&&(this._style._stateDown.visible=!1),this._style._stateOver&&(this._style._stateDown.visible=!1),this._style._stateUp.visible=!1,this._down?this._style._stateDown&&(this._style._stateDown.visible=!0):this._over?this._style._stateOver&&(this._style._stateOver.visible=!0):this._style._stateUp&&(this._style._stateUp.visible=!0)},o.prototype.onStateDown=function(){i.prototype.onStateDown.call(this),this.setStateTexture()},o.prototype.onStateUp=function(){i.prototype.onStateUp.call(this),this.setStateTexture()},o.prototype.onStateOver=function(){i.prototype.onStateOver.call(this),this.setStateTexture()},o.prototype.onStateOut=function(){i.prototype.onStateOut.call(this),this.setStateTexture()},Object.defineProperty(o.prototype,"style",{get:function(){return this._style},enumerable:!0,configurable:!0}),o}(a.Button);a.ImageButton=t}(plume||(plume={})),function(e){var t=function(){function t(){this._childs=new e.HashMap,this._dirty=!1,this._root=new e.Container,this._root._root=!0,this._root.setDebugId("root")}return t.prototype.destroy=function(){this._childs.clear()},t.prototype.update=function(){this._dirty&&(this._sortLayers(),this._dirty=!1)},t.prototype.getChild=function(t){return this._ensureLayer(t).container},t.prototype.addChild=function(t,e){void 0===e&&(e=1);var i=this._ensureLayer(t);return i.zindex=e,i.container},t.prototype.removeChild=function(t){var e=this._childs.remove(t);return null!=e&&this._root.removeChild(e.container),e.container},t.prototype.setChildIndex=function(t,e){this._ensureLayer(t).zindex=e,this._dirty=!0},t.prototype._sortLayers=function(){for(var t=this._childs.values().sort(function(t,e){return t.zindex-e.zindex}),e=0;e<t.length;e++){var i=t[e];this._root.getChildIndex(i.container)!=e&&this._root.setChildIndex(i.container,e)}},t.prototype._ensureLayer=function(t){var e=this._childs.get(t);return null==e&&(e=new i(t),this._root.addChild(e.container),this._childs.put(t,e),this._dirty=!0),e},Object.defineProperty(t.prototype,"root",{get:function(){return this._root},set:function(t){throw new Error("root is read-only")},enumerable:!0,configurable:!0}),t}();e.ContainerGroup=t;var i=function(t){this.container=new e.Container,this.container.setDebugId(t),this.zindex=1,this.name=t}}(plume||(plume={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"background",{get:function(){return null==this._background&&(this._background=this.addChild("background",1)),this._background},set:function(t){throw new Error("background is read-only")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return null==this._scene&&(this._scene=this.addChild("scene",100)),this._scene},set:function(t){throw new Error("scene is read-only")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameplayHUD",{get:function(){return null==this._gameplayHUD&&(this._gameplayHUD=this.addChild("gameplayHUD",150)),this._gameplayHUD},set:function(t){throw new Error("gameplayHUD is read-only")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sceneHUD",{get:function(){return null==this._gameplayHUD&&(this._gameplayHUD=this.addChild("sceneHUD",180)),this._gameplayHUD},set:function(t){throw new Error("sceneHUD is read-only")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"popup",{get:function(){return null==this._popup&&(this._popup=this.addChild("popup",200)),this._popup},set:function(t){throw new Error("popup is read-only")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return null==this._top&&(this._top=this.addChild("top",300)),this._top},set:function(t){throw new Error("top is read-only")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"technical",{get:function(){return null==this._technical&&(this._technical=this.addChild("technical",400)),this._technical},set:function(t){throw new Error("technical is read-only")},enumerable:!0,configurable:!0}),e}(t.ContainerGroup);t.GameContainerGroup=e}(plume||(plume={})),function(u){!function(t){function e(t,e,i){void 0===i&&(i=!0);var n=Math.round((e.width-t.width)/2);t.x=i?e.x+n:n}function i(t,e,i){void 0===i&&(i=!0);var n=Math.round((e.height-t.height)/2);t.y=i?e.y+n:n}function h(t,e){void 0===e&&(e=!1);for(var i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=0;s<t.getChildrenCount();s++){var a=t.getChildAt(s),l=void 0;l=e&&a instanceof u.Container?h(a,!0):a,i=Math.min(i,l.x),n=Math.min(n,l.y),0<l.width&&(o=Math.max(o,l.x+l.width)),0<l.height&&(r=Math.max(r,l.y+l.height))}return{x:i,y:n,width:o-i,height:r-n}}t.centerOnX=e,t.centerOnY=i,t.centerOnXInParent=function(t){e(t,t.parent,!1)},t.centerOnYInParent=function(t){i(t,t.parent,!1)},t.centerOnXYInParent=function(t){e(t,t.parent,!1),i(t,t.parent,!1)},t.computeBounds=h,t.setContainerSize=function(t,e){void 0===e&&(e=!1);var i=h(t,e);t.setSize(i.width,i.height)}}(u.layout||(u.layout={}))}(plume||(plume={})),function(l){var t=function(a){function t(t,e,i,n){var r=a.call(this)||this;r._itemWidth=t,r._itemHeight=e,r._visibleItems=i,r._vertical=n,r._items=[],r.optShowItemOverlay=!0;r._scrollableContainer=new l.ScrollableContainer,r.addChild(r._scrollableContainer);var o=t,s=e;return n?(s=(r._itemSize=e)*i,r._scrollableContainer.scrollEnableOnX=!1):(o=(r._itemSize=t)*i,r._scrollableContainer.scrollEnableOnY=!1),r._scrollableContainer.setContainerSize(o,s),r._scrollableContainer.addScrollHandler(r._onScroll,r),r._scrollableContainer.wheelOnY=r._vertical,r._contentBounds=new l.Rectangle(0,0,o,s),r.setSize(o,s),r._updateVisibleItems(0),r}return __extends(t,a),t.prototype.getContentBounds=function(){return this._contentBounds},t.prototype.addItem=function(t){var e=this._items.length;this._vertical?(t.x=0,t.y=e*this._itemHeight):(t.x=e*this._itemWidth,t.y=0),this._scrollableContainer.addDisplayObject(t),this._items.push(t),this._updateVisibleItems()},t.prototype.clear=function(){this._scrollableContainer.clear(),this._items=[],this._updateVisibleItems(0)},t.prototype.setControlButton=function(t,e){var i=this;this._upOrLeft=t,this._downOrRight=e,this._upOrLeft.onClick(function(){i.moveUpOrLeft()}),this._downOrRight.onClick(function(){i.moveDownOrRight()})},t.prototype.moveUpOrLeft=function(){this._vertical?this.moveUp():this.moveLeft()},t.prototype.moveDownOrRight=function(){this._vertical?this.moveDown():this.moveRight()},t.prototype.moveUp=function(){this._vertical&&this._moveUp0()},t.prototype.moveDown=function(){this._vertical&&this._moveDown0()},t.prototype.moveLeft=function(){this._vertical||this._moveUp0()},t.prototype.moveRight=function(){this._vertical||this._moveDown0()},t.prototype.scrollToItem=function(t){t>this._items.length-this._visibleItems&&(t=this._items.length-this._visibleItems),0<=t&&this._moveTo(t)},t.prototype.getItems=function(){return this._items},t.prototype._onScroll=function(t){this._updateVisibleItems()},t.prototype._moveUp0=function(){var t=this._getMoveByCount();this._moveBy(-t)},t.prototype._moveDown0=function(){var t=this._getMoveByCount();this._moveBy(t)},t.prototype._getMoveByCount=function(){return 3<this._visibleItems?this._visibleItems-2:1},t.prototype._moveBy=function(t){var e=t*this._itemSize;this._vertical?this._scrollableContainer.moveByAbout(null,e):this._scrollableContainer.moveByAbout(e,null),this._updateVisibleItems()},t.prototype._moveTo=function(t){var e=t*this._itemSize;this._vertical?this._scrollableContainer.moveTo(null,e):this._scrollableContainer.moveTo(e,null),this._updateVisibleItems()},t.prototype._updateVisibleItems=function(t){if(void 0===t&&(t=null),null==t){var e=this._scrollableContainer.getContentBound();t=this._vertical?e.y:e.x}null!=this._topItemOverlay&&(this._topItemOverlay.visible=!1),null!=this._bottomItemOverlay&&(this._bottomItemOverlay.visible=!1);for(var i=t+this._visibleItems*this._itemSize,n=0;n<this._items.length;n++){var r=this._items[n],o=this._vertical?r.y:r.x,s=this._vertical?r.y+this._itemSize:r.x+this._itemSize;t<=o&&s<=i?r.visible=!0:i<=o||s<=t?r.visible=!1:(r.visible=!0,o+this._itemSize/2<t?this._addTopItemOverlay(r):s-this._itemSize/2>i&&this._addBottomItemOverlay(r))}},t.prototype._addTopItemOverlay=function(t){this.optShowItemOverlay&&(null==this._topItemOverlay&&(this._topItemOverlay=this._buildItemOverlay(t),this._scrollableContainer.addDisplayObject(this._topItemOverlay)),this._topItemOverlay.visible=!0,this._topItemOverlay.x=t.x,this._topItemOverlay.y=t.y)},t.prototype._addBottomItemOverlay=function(t){this.optShowItemOverlay&&(null==this._bottomItemOverlay&&(this._bottomItemOverlay=this._buildItemOverlay(t),this._scrollableContainer.addDisplayObject(this._bottomItemOverlay)),this._bottomItemOverlay.visible=!0,this._bottomItemOverlay.x=t.x,this._bottomItemOverlay.y=t.y)},t.prototype._buildItemOverlay=function(t){var e=this._itemWidth,i=this._itemWidth;t instanceof l.Container&&(e=Math.min(this._itemWidth,t.width),i=Math.min(this._itemHeight,t.height));var n=new l.Graphics;return n.beginFill(0,.2),n.drawRect(0,0,e,i),n.endFill(),n.showCursor=!1,n},t}(l.Container);l.ScrollableList=t}(plume||(plume={})),function(t){var e=function(){function t(){this._command=[]}return t.prototype.moveTo=function(t,e){this._command.push(-1),this._command.push(t),this._command.push(e)},t.prototype.lineTo=function(t,e){this._command.push(-2),this._command.push(t),this._command.push(e)},t.prototype.rectangle=function(t,e,i,n){this._command.push(-3),this._command.push(t),this._command.push(e),this._command.push(i),this._command.push(n)},t.prototype.arc=function(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=2*Math.PI),this._command.push(-4),this._command.push(t),this._command.push(e),this._command.push(i),this._command.push(n),this._command.push(r)},t.prototype._applyMask=function(t){t.beginPath();for(var e=0;e<this._command.length;e++){var i=this._command[e];-1==i?(t.moveTo(this._command[e+1],this._command[e+2]),e+=2):-2==i?(t.lineTo(this._command[e+1],this._command[e+2]),e+=2):-3==i?(t.rect(this._command[e+1],this._command[e+2],this._command[e+3],this._command[e+4]),e+=4):-4==i&&(t.arc(this._command[e+1],this._command[e+2],this._command[e+3],this._command[e+4],this._command[e+5]),e+=5)}t.clip()},t}();t.Mask=e}(plume||(plume={})),function(i){var t=function(){function t(t,e){void 0===e&&(e=0),this._background=t,this._progress=e,this._lastProgress=-1,this._startTime=0,this._duration=0,this._expired=!1,this._started=!1,this._autoUpdate()}return t.prototype.startTimeLimited=function(t,e){void 0===e&&(e=0),this._progress=e/t,this._duration=t,this._startTime=performance.now()-e,this._started=!0},t.prototype.setProgress=function(t){t<0?t=0:1<t&&(t=1),this._progress=t},t.prototype.update=function(t){if(!this._expired&&this._started&&0!=this._startTime){var e=performance.now();this._progress=(e-this._startTime)/this._duration,this._progress=Math.min(this._progress,1),1==this._progress&&this._onExpired()}},t.prototype.render=function(t){},t.prototype.getProgress=function(){return this._progress},t.prototype._onExpired=function(){this._expired=!0,this._started=!1,null!=this.onProgressExpired&&this.onProgressExpired()},t.prototype._autoUpdate=function(){var t=this,e=i.Game.get();e.addRenderable(this),e.addUpdatable(this),this._background.detachListener.once(function(){e.removeRenderable(t),e.removeUpdatable(t)})},t}();i.AbstractProgressBar=t}(plume||(plume={})),function(l){var t=function(a){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=a.call(this,t,i)||this;return n._way=e,n._bgwidth=0,n._bgheight=0,n._inverted=!1,n._bgwidth=t.width,n._bgheight=t.height,n}return __extends(t,a),t.prototype.updateProgress=function(t){t<0?t=0:1<t&&(t=1),this._progress=t},t.prototype.update=function(t){a.prototype.update.call(this,t)},t.prototype.render=function(t){if(a.prototype.render.call(this,t),this._progress!=this._lastProgress){var e,i,n,r;if(this._background.mask=new l.Mask,0==this._way)i=e=0,n=this._bgwidth*this._progress,r=this._bgheight,this._inverted&&(e=n,n=this._bgwidth-n);else if(1==this._way){var o=this._background.width*this._progress;e=this._bgwidth-o,i=0,n=o,r=this._bgheight,this._inverted&&(n=e,e=0)}else if(2==this._way)i=e=0,n=this._bgwidth,r=this._bgheight*this._progress,this._inverted&&(i=r,r=this._bgheight-r);else if(3==this._way){var s=this._bgheight*this._progress;e=0,i=this._bgheight-s,n=this._bgwidth,r=s,this._inverted&&(r=i,i=0)}this._background.mask.rectangle(e,i,n,r),this._lastProgress=this._progress}},t.prototype.setInverted=function(t){this._inverted=!0},t}(l.AbstractProgressBar);l.ProgressBar=t}(plume||(plume={})),function(i){var t=function(n){function t(t,e){void 0===e&&(e=0);var i=n.call(this,t,e)||this;return i.start=-Math.PI/2,i._inverted=!1,i.radius=t.width/2,i.centerX=i.radius,i.centerY=i.radius,i}return __extends(t,n),t.prototype.setInverted=function(t){this._inverted=t},t.prototype.updateProgress=function(t){t<0?t=0:1<t&&(t=1),this._progress=t},t.prototype.update=function(t){n.prototype.update.call(this,t)},t.prototype.render=function(t){if(n.prototype.render.call(this,t),this._progress!=this._lastProgress){if(this._background.mask=new i.Mask,0<this._progress)if(this._background.visible=!0,this._inverted){e=2*this._progress*Math.PI;this._background.mask.moveTo(this.centerX,this.centerY),this._background.mask.lineTo(this.radius+this.radius*Math.cos(this.start+e),this.radius+this.radius*Math.sin(this.start+e)),this._background.mask.arc(this.centerX,this.centerY,this.radius,this.start+e,3*Math.PI/2),this._background.mask.lineTo(this.centerX,this.centerY)}else{var e=2*this._progress*Math.PI;this._background.mask.moveTo(this.centerX,this.centerY),this._background.mask.lineTo(this.radius,0),this._background.mask.arc(this.centerX,this.centerY,this.radius,this.start,this.start+e),this._background.mask.lineTo(this.centerX,this.centerY)}else this._background.visible=!1;this._lastProgress=this._progress}},t}(i.AbstractProgressBar);i.RoundProgressBar=t}(plume||(plume={})),function(i){var t=function(){function t(t){this._enabled=!0;var e=i.Game.get();e.addUpdatable(this),this._dragListener=t,this._pointer=e.inputManager.mouse.pointer}return t.prototype.enable=function(){this._enabled=!0},t.prototype.disable=function(){this._enabled=!1},t.prototype._onStateDown=function(t){if(null!=this._startDragController&&!this._startDragController(t))return;this._down||(this._previousPosition=new i.Point(t.x,t.y),this._down=!0,this._dragListener.onDragBegin(t))},t.prototype._hasMoved=function(t){if(this._down){var e=1<=Math.abs(t.x-this._previousPosition.x),i=1<=Math.abs(t.y-this._previousPosition.y);if(e||i)return!0}return!1},t.prototype._onStateMove=function(t){this._down&&this._dragListener.onDragMove(t.x-this._previousPosition.x,t.y-this._previousPosition.y,t),this._previousPosition=new i.Point(t.x,t.y)},t.prototype._onStateUp=function(t){this._down&&(this._down=!1,this._dragListener.onDragEnd(t))},t.prototype.update=function(t){this._enabled&&(this._pointer.isJustDown?this._onStateDown(this._pointer.downPosition):this._pointer.isJustUp?this._onStateUp(this._pointer.upPosition):this._pointer.isDown&&this._hasMoved(this._pointer.position)&&this._onStateMove(this._pointer.position))},t.prototype.destroy=function(){i.Game.get().removeUpdatable(this)},t.prototype.setStartDragController=function(t){this._startDragController=t},t}();i.DragManager=t}(plume||(plume={})),function(o){var t=function(n){function t(){var t=n.call(this)||this;t.applyVelocity=!0,t.velocityTheshold=.2,t.dragDurationVelocityTheshold=400,t.wheelOnY=!0,t.scrollEnableOnX=!0,t.scrollEnableOnY=!0,t._innerVelocity=new THREE.Vector2,t._dragStartPosition=new o.Point,t._dragStartTime=0,t._lastInnerPosition=new o.Point,t._scrollHandler=new o.Handler;var e=t,i=o.Game.get().bounds;return t.interactive=!0,t.showCursor=!1,t._game=o.Game.get(),t._game.addUpdatable(t),t._inner=new o.Container,t.addChild(t._inner),t._dragManager=new o.DragManager(t),t._dragManager.setStartDragController(function(t){return e._canStartDrag(t)}),t._game.inputManager.mouse.mouseWheelHandlers.add(t.onMouseWheel,t),t.detachListener.once(function(){e._destroy()}),t.setContainerSize(i.width,i.height),t}return __extends(t,n),t.prototype.setContainerSize=function(t,e){this.setSize(t,e),this._contentBounds=new o.Rectangle(0,0,t,e),this._contentMask=new o.Mask,this._contentMask.rectangle(0,0,t,e),this.mask=this._contentMask},t.prototype.onDragBegin=function(t){this._dragStartPosition=t.copy(),this._dragStartTime=Date.now(),this._innerVelocity.x=0,this._innerVelocity.y=0},t.prototype.onDragMove=function(t,e,i){this.scrollEnableOnX&&(this._inner.x+=t),this.scrollEnableOnY&&(this._inner.y+=e),this._checkBoundLimit()},t.prototype.onDragEnd=function(t){var e=t.x-this._dragStartPosition.x,i=t.y-this._dragStartPosition.y,n=Date.now()-this._dragStartTime;this.scrollEnableOnX||(e=0),this.scrollEnableOnY||(i=0),this.applyVelocity&&n<this.dragDurationVelocityTheshold&&(this._innerVelocity.x=e/n,this._innerVelocity.y=i/n)},t.prototype.onMouseWheel=function(t){var e=o.Game.get().inputManager.mouse.position;if(this._canStartDrag(e)){var i=0,n=0,r=50*-t.delta;this.wheelOnY?n=r:i=r,this._doFakeDrag(i,n,1e3)}},t.prototype.addDisplayObject=function(t,e){var i;return i=null!=e?this._inner.addChildAt(t,e):this._inner.addChild(t),this._computeInnerMinMax(),i},t.prototype.clear=function(){this._inner.removeChildren(),this._computeInnerMinMax()},t.prototype.moveTo=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),null!=t&&(this._inner.x=-t),null!=e&&(this._inner.y=-e),this._checkBoundLimit()},t.prototype.moveBy=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),null!=t&&(this._inner.x-=t),null!=e&&(this._inner.y-=e),this._checkBoundLimit()},t.prototype.moveByAbout=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this._canMove()&&(null==t&&(t=0),null==e&&(e=0),this._inner.x+=t,this._inner.y+=e,this._doFakeDrag(-t,-e,300))},t.prototype.update=function(t){0==this._innerVelocity.x&&0==this._innerVelocity.y||(this._innerVelocity.x*=.95,this._innerVelocity.y*=.95,Math.abs(this._innerVelocity.x)<this.velocityTheshold&&(this._innerVelocity.x=0),Math.abs(this._innerVelocity.y)<this.velocityTheshold&&(this._innerVelocity.y=0),this._inner.x=this._inner.x+t*this._innerVelocity.x,this._inner.y=this._inner.y+t*this._innerVelocity.y,this._checkBoundLimit())},t.prototype.getContentBound=function(){return this._contentBounds.x=-this._inner.x,this._contentBounds.y=-this._inner.y,this._contentBounds},t.prototype._doFakeDrag=function(t,e,i){var n=new o.Point(this._inner.x,this._inner.y),r=n.copy();r.x=r.x+t,r.y=r.y+e,this.onDragBegin(n),this._dragStartTime=Date.now()-i,this.onDragMove(t,e,r),this.onDragEnd(r)},t.prototype._computeInnerMinMax=function(){var t=o.layout.computeBounds(this._inner,!1);this._inner.setSize(t.width,t.height);var e=this._inner.width,i=this._inner.height;this._innerMin=new o.Point(-e+this._contentBounds.width,-i+this._contentBounds.height),this._innerMax=new o.Point(0,0)},t.prototype._canMove=function(){return!(this._inner.width<=this._contentBounds.width&&this._inner.height<=this._contentBounds.height)},t.prototype._canStartDrag=function(t){return!!this._canMove()&&this.hitPoint(t)},t.prototype._checkBoundLimit=function(){this.scrollEnableOnX&&(this._inner.x<this._innerMin.x?this._inner.x=this._innerMin.x:this._inner.x>this._innerMax.x&&(this._inner.x=this._innerMax.x)),this.scrollEnableOnY&&(this._inner.y<this._innerMin.y?this._inner.y=this._innerMin.y:this._inner.y>this._innerMax.y&&(this._inner.y=this._innerMax.y));var t=this._lastInnerPosition.x-this._inner.x,e=this._lastInnerPosition.y-this._inner.y;this._lastInnerPosition.x=this._inner.x,this._lastInnerPosition.y=this._inner.y,0==t&&0==e||this._scrollHandler.fire({offsetX:t,offsetY:e,x:-this._lastInnerPosition.x,y:-this._lastInnerPosition.y})},t.prototype._destroy=function(){this._dragManager.destroy(),this._game.inputManager.mouse.mouseWheelHandlers.remove(this.onMouseWheel),this._game.removeUpdatable(this)},t.prototype.addScrollHandler=function(t,e){this._scrollHandler.add(t,e)},t.prototype.removeScrollHandler=function(t){this._scrollHandler.remove(t)},t}(o.Container);o.ScrollableContainer=t}(plume||(plume={})),function(m){var t=function(){function f(){}return f._isMultiplySupported=function(){if(null===this._multiplyDetected){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=1,t.height=1,e.clearRect(0,0,1,1),e.globalCompositeOperation="source-over",e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply",e.fillStyle="#fff",e.fillRect(0,0,1,1),this._multiplyDetected=0===e.getImageData(0,0,1,1).data[0],this._multiplyDetected||m.logger.warn("Tinter : globalCompositeOperation multiply not supported, fallback to manual multiply")}return this._multiplyDetected},f.tint=function(t,e,i){void 0===i&&(i=!0);var n=e>>16&255,r=e>>8&255,o=255&e;n=Math.min(255,Math.round(n/f.rounding)*f.rounding),r=Math.min(255,Math.round(r/f.rounding)*f.rounding),o=Math.min(255,Math.round(o/f.rounding)*f.rounding);var s=t.name+"-tint-"+n+","+r+","+o;if(i){var a=m.Texture.containsTexture(s);if(null!=a)return a}var l=document.createElement("canvas"),h=l.getContext("2d");if(l.width=t.width,l.height=t.height,h.fillStyle="rgba("+n+","+r+","+o+",1)",h.fillRect(0,0,t.width,t.height),this._isMultiplySupported())h.globalCompositeOperation="multiply",h.drawImage(t.getImpl(),t.x,t.y,t.width,t.height,0,0,t.width,t.height);else{h.drawImage(t.getImpl(),t.x,t.y,t.width,t.height,0,0,t.width,t.height);for(var u=h.getImageData(0,0,l.width,l.height),c=u.data,p=0;p<c.length;p+=4)c[p]=n*c[p]/255,c[p+1]=r*c[p+1]/255,c[p+2]=o*c[p+2]/255;h.putImageData(u,0,0)}h.globalCompositeOperation="destination-atop",h.drawImage(t.getImpl(),t.x,t.y,t.width,t.height,0,0,t.width,t.height);var d=new m.Texture(s,0,0,t.width,t.height);return d.setImpl(l),i&&m.Texture.addTexture(d),d},f.rounding=8,f._multiplyDetected=null,f}();m.Tinter=t}(plume||(plume={})),function(t){var e=function(){function t(){}return t.overlapRectangles=function(t,e){return t.left<e.right&&t.right>e.left&&t.top<e.bottom&&t.bottom>e.top},t.pointInPolygon2=function(t,e,i){var n=t.length,r=0,o=t.length-2,s=!1;for(r=0;r<n;r+=2)(t[r+1]<i&&t[o+1]>=i||t[o+1]<i&&t[r+1]>=i)&&t[r]+(i-t[r+1])/(t[o+1]-t[r+1])*(t[o]-t[r])<e&&(s=!s),o=r;return s},t}();t.Collisions=e}(plume||(plume={})),function(t){var e=function(){function l(t){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this.context=t||null,t&&t.setTransform(1,0,0,1,0,0)}return l.prototype.toString=function(){return"["+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+"]"},l.prototype.flipX=function(){return this.transform(-1,0,0,1,0,0),this},l.prototype.flipY=function(){return this.transform(1,0,0,-1,0,0),this},l.prototype.reset=function(){return this.a=this.d=1,this.b=this.c=this.e=this.f=0,this._setCtx(),this},l.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t);return this.transform(e,i,-i,e,0,0),this},l.prototype.rotateDeg=function(t){return this.rotate(.017453292519943295*t),this},l.prototype.scale=function(t,e){return this.transform(t,0,0,e,0,0),this},l.prototype.scaleX=function(t){return this.transform(t,0,0,1,0,0),this},l.prototype.scaleY=function(t){return this.transform(1,0,0,t,0,0),this},l.prototype.skew=function(t,e){return this.transform(1,e,t,1,0,0),this},l.prototype.skewX=function(t){return this.transform(1,0,t,1,0,0),this},l.prototype.skewY=function(t){return this.transform(1,t,0,1,0,0),this},l.prototype.setTransform=function(t,e,i,n,r,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.e=r,this.f=o,this._setCtx(),this},l.prototype.translate=function(t,e){return this.transform(1,0,0,1,t,e),this},l.prototype.translateX=function(t){return this.transform(1,0,0,1,t,0),this},l.prototype.translateY=function(t){return this.transform(1,0,0,1,0,t),this},l.prototype.transform=function(t,e,i,n,r,o){var s=this.a,a=this.b,l=this.c,h=this.d,u=this.e,c=this.f;return this.a=s*t+l*e,this.b=a*t+h*e,this.c=s*i+l*n,this.d=a*i+h*n,this.e=s*r+l*o+u,this.f=a*r+h*o+c,this._setCtx(),this},l.prototype.getInverse=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.e,o=this.f,s=new l,a=t*n-e*i;return s.a=n/a,s.b=-e/a,s.c=-i/a,s.d=t/a,s.e=(i*o-n*r)/a,s.f=-(t*o-e*r)/a,s},l.prototype.interpolate=function(t,e){var i=new l;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i},l.prototype.applyToPoint=function(t,e){return{x:t*this.a+e*this.c+this.e,y:t*this.b+e*this.d+this.f}},l.prototype.applyToArray=function(t){for(var e,i=0,n=t.length,r=new Array(n);i<n;)e=this.applyToPoint(t[i],t[i+1]),r[i++]=e.x,r[i++]=e.y;return r},l.prototype.applyToContext=function(t){return t.setTransform(this.a,this.b,this.c,this.d,this.e,this.f),this},l.prototype.isIdentity=function(){return this._isEqual(this.a,1)&&this._isEqual(this.b,0)&&this._isEqual(this.c,0)&&this._isEqual(this.d,1)&&this._isEqual(this.e,0)&&this._isEqual(this.f,0)},l.prototype.isEqual=function(t){return this._isEqual(this.a,t.a)&&this._isEqual(this.b,t.b)&&this._isEqual(this.c,t.c)&&this._isEqual(this.d,t.d)&&this._isEqual(this.e,t.e)&&this._isEqual(this.f,t.f)},l.prototype._isEqual=function(t,e){return Math.abs(t-e)<1e-14},l.prototype._setCtx=function(){this.context&&this.context.setTransform(this.a,this.b,this.c,this.d,this.e,this.f)},l}();t.Matrix=e}(plume||(plume={})),function(T){var t=function(s){function t(t,e,i,n){void 0===n&&(n=!1);var r=s.call(this)||this;r._missingChar=!1,r._ratio=1,r._align="left",r._maxWidth=1e4,r._dirty=!0,r._cleanOffset=!1;var o=T.Resources.fonts[e];if(null==o)throw new Error("Font not loaded: "+e);return r._fontName=e,r._font=o,r._text=t,r._size=null==i?o.size:i,r._cleanOffset=n,r._ratio=r._size/o.size,r._debugId="Text-"+r._id,r}return __extends(t,s),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(t){t!=this._text&&(this._text=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._dirty&&this.create(),this._width*this._scaleX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._dirty&&this.create(),this._height*this._scaleY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tint",{set:function(t){this._tint=null==t?16777215:t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cleanOffset",{get:function(){return this._cleanOffset},set:function(t){this._cleanOffset=t,this._dirty=!0},enumerable:!0,configurable:!0}),t.prototype.hasMissingChar=function(){return this._dirty&&this.create(),this._missingChar},t.prototype.draw0=function(t){this._dirty&&(this.create(),this._dirty=!1),s.prototype.draw0.call(this,t)},t.prototype.create=function(){this.removeChildren(),null!=this.text&&""!=this.text||this.setSize(0,0),this._missingChar=!1;var t=0,e=0;if(this._cleanOffset){for(var i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=0;r<this._text.length;r++){if(10!=(x=this._text.charCodeAt(r)))if(32!=x)null!=(S=this._font.lettersByCode[x])&&(S.yoffset<i&&(i=S.yoffset),S.xoffset<n&&(n=S.xoffset))}n<Number.POSITIVE_INFINITY&&(t=n),i<Number.POSITIVE_INFINITY&&(e=i)}var o=[],s=0,a={width:0,letters:[],xposition:[]};o.push(a);var l=-1,h=0;for(r=0;r<this._text.length;r++){if(10!=(x=this._text.charCodeAt(r)))if(null!=(S=this._font.lettersByCode[x])){32==x&&(l=0,s),-1<l&&l++,a.letters.push(S),a.xposition.push(s),s+=this.getLetterWidthToDraw(S,t),a.width=s;var u=S.yoffset-e+S.height;if(h<u&&(h=u),0<this._maxWidth&&s>this._maxWidth&&0<l){var c=a.letters.length-l;a.letters.splice(c,l),a.xposition.splice(c,l);var p=a.xposition[c-1]+this.getLetterWidthToDraw(a.letters[c-1],t);a.width=p,r=r-l+1,a={width:0,letters:[],xposition:[]},o.push(a),s=0,l=-1}}else this._missingChar=!0;else a={width:0,letters:[],xposition:[]},o.push(a),s=0,l=-1}var d=0;for(r=0;r<o.length;r++){var f=o[r];d=Math.max(f.width,d)}var m=Math.ceil(d),y=o.length<=1?this.normalizeSize(h):this.normalizeSize(this._font.lineHeight-e),g=Math.ceil(o.length*y);this.setSize(m,g);var v=0;for(r=0;r<o.length;r++){f=o[r];var _=0;"center"==this._align?_=(d-f.width)/2:"right"==this._align&&(_=d-f.width);for(var x=0;x<f.letters.length;x++){var S=f.letters[x],w=f.xposition[x];if(w+=_,0<S.width&&0<S.height){var b=this._font.textureByCode[S.id];if(16777215!=this._tint)b=T.Tinter.tint(b,this._tint,!0);var E=new T.Sprite(b);E.scaleXY=this._ratio,E.x=w+(S.xoffset-t)*this._ratio,E.y=v+(S.yoffset-e)*this._ratio,this.addChild(E)}}v+=y}},t.prototype.normalizeSize=function(t){return t*this._ratio},t.prototype.getLetterWidthToDraw=function(t,e){return 32==t.id?t.xadvance*this._ratio:(t.xoffset-e+t.width)*this._ratio},t}(T.Container);T.BitmapText=t}(plume||(plume={})),function(r){var t=function(n){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=n.call(this)||this;return i._ops=new Array,i._debugId="Graphics-"+i._id,i._width=t,i._height=e,i}return __extends(t,n),t.prototype.customDraw=function(t){return this._ops.push(t),this},t.prototype.beginFill=function(e,i){return void 0===i&&(i=1),this._ops.push(function(t){t.fillStyle=r.Colors.toString(e,i),t.beginPath()}),this},t.prototype.beginStroke=function(e,i,n){void 0===n&&(n=1);return this._ops.push(function(t){t.lineWidth=e,t.strokeStyle=r.Colors.toString(i,n),t.beginPath()}),this},t.prototype.endStroke=function(){return this._ops.push(function(t){t.stroke()}),this},t.prototype.endFill=function(){return this._ops.push(function(t){t.fill()}),this},t.prototype.moveTo=function(e,i){return this._ops.push(function(t){t.moveTo(e,i)}),this},t.prototype.lineTo=function(e,i){return this._ops.push(function(t){t.lineTo(e,i)}),this},t.prototype.quadraticCurveTo=function(e,i,n,r){return this._ops.push(function(t){t.quadraticCurveTo(e,i,n,r)}),this},t.prototype.bezierCurveTo=function(e,i,n,r,o,s){return this._ops.push(function(t){t.bezierCurveTo(e,i,n,r,o,s)}),this},t.prototype.arcTo=function(e,i,n,r,o){return this._ops.push(function(t){t.arcTo(e,i,n,r,o)}),this},t.prototype.arc=function(e,i,n,r,o,s){return void 0===r&&(r=0),void 0===o&&(o=2*Math.PI),this._ops.push(function(t){t.arc(e,i,n,r,o,s)}),this},t.prototype.drawRect=function(e,i,n,r){return this._ops.push(function(t){t.rect(e,i,n,r)}),this},t.prototype.drawRoundedRect=function(e,i,n,r,o){return this._ops.push(function(t){t.moveTo(e+o,i),t.lineTo(e+n-o,i),t.quadraticCurveTo(e+n,i,e+n,i+o),t.lineTo(e+n,i+r-o),t.quadraticCurveTo(e+n,i+r,e+n-o,i+r),t.lineTo(e+o,i+r),t.quadraticCurveTo(e,i+r,e,i+r-o),t.lineTo(e,i+o),t.quadraticCurveTo(e,i,e+o,i)}),this},t.prototype.drawCircle=function(e,i,n){return this._ops.push(function(t){t.arc(e,i,n,0,2*Math.PI)}),this},t.prototype.clear=function(){return this._ops.length=0,this},t.prototype.createCachedTexture=function(){var t=document.createElement("canvas");t.width=this._width,t.height=this._height,0!=this._width&&0!=this._height||r.logger.warn("Caching graphics without size.");var e=t.getContext("2d");this.draw0(e),this._cachedTexture=new r.Texture("graphics",0,0,this._width,this._height),this._cachedTexture.setImpl(t)},t.prototype.draw0=function(e){this._ops.forEach(function(t){t(e)})},t.prototype.setSize=function(t,e){this._width=t,this._height=e},t}(r.DisplayObject);r.Graphics=t}(plume||(plume={})),function(t){var e=function(){function t(){}return t.prototype.render=function(t){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=t.x+t.width,e.height=t.y+t.height;var n=t._parent;return t._parent=null,t.draw(i),t._parent=n,e.toDataURL("image/png")},t}();t.RenderTexture=e}(plume||(plume={})),function(s){var a,t=function(o){function t(t,e,i,n){void 0===n&&(n=16777215);var r=o.call(this)||this;return r._text=t,r._fontName=e,r._fontSize=i,r._color=n,r._align="left",r._dirty=!0,r._heightRatio=1.4,r._font=i+"px "+e,r._debugId="Text-"+r._id,r._colorString=s.Colors.toHexString(n),r}return __extends(t,o),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(t){t!=this._text&&(this._text=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._dirty&&this._create(),this._width*this._scaleX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._dirty&&this._create(),this._height*this._scaleY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{set:function(t){this.color=null==t?16777215:t,this._colorString=s.Colors.toHexString(t),this._dirty=!0},enumerable:!0,configurable:!0}),t.prototype.draw0=function(t){this._dirty&&(this._create(),this._dirty=!1),null!=this._canvas&&0!=this._height&&0!=this._width&&(o.prototype.draw0.call(this,t),t.drawImage(this._canvas,0,0))},t.prototype._setFontStyle=function(t){t.textBaseline="alphabetic",t.font=this._font,t.fillStyle=this._colorString},t.prototype._create=function(){if(null==this.text||""==this.text)return this._width=0,this._height=0,void(this._canvas=null);if(null!=this._canvas&&(this._canvas=null),this._canvas=document.createElement("canvas"),0<this._text.indexOf("\n"))this._createMultiline();else{var t=this._canvas.getContext("2d");this._setFontStyle(t);var e=t.measureText(this._text).width,i=p(this._fontName,this._fontSize);this._canvas.width=e,this._canvas.height=i*this._heightRatio,this._width=this._canvas.width,this._height=this._canvas.height,this._setFontStyle(t),t.fillText(this._text,0,i)}},t.prototype._createMultiline=function(){var t=this._canvas.getContext("2d"),e=this._text.split("\n"),i=p(this._fontName,this._fontSize),n=i*this._heightRatio,r=0,o=[];this._setFontStyle(t);for(var s=0;s<e.length;s++){var a=e[s],l=t.measureText(a).width;o.push({x:0,y:s*n,width:l}),r=Math.max(r,l)}this._canvas.width=r,this._canvas.height=n*o.length,this._width=this._canvas.width,this._height=this._canvas.height;for(s=0;s<o.length;s++){a=o[s];var h=e[s],u=s*n,c=(l=a.width,0);"center"==this._align?c=(r-l)/2:"right"==this.align&&(c=r-l),this._setFontStyle(t),t.fillText(h,c,u+i)}},t}(s.DisplayObject);function p(t,e){null==a&&(a=new s.HashMap);var i=t+e,n=a.get(i);if(null!=n)return n;var r=document.createElement("div");r.innerHTML="(|MÃ‰qgy",r.style.position="absolute",r.style.top="-9999px",r.style.left="-9999px",r.style.fontFamily=t,r.style.fontWeight="normal",r.style.fontSize=e+"px",document.body.appendChild(r);var o=r.offsetHeight;return a.put(i,o),document.body.removeChild(r),o}s.Text=t}(plume||(plume={})),function(p){var t=function(){function i(){}return i.loadAll=function(t){for(var e=0;e<t.length;e++)i.load(t[e])},i.load=function(t){var e=p.Sprite.fromFrame(t.face+".png"),i=new Array,n=new Array(65e3),r=new Array(65e3),o={size:t.size,lettersByCode:n,lineHeight:t.lineHeight,baseLine:t.baseLine,textureByCode:r,chars:i,resource:e.texture.getImpl()},s=e.texture.x,a=e.texture.y;e.texture.trimmed&&(s-=e.texture.getTrim().x,a-=e.texture.getTrim().y);for(var l=0;l<t.chars.length;l++){var h=t.chars[l],u={id:h.id,x:h.x+s,y:h.y+a,xoffset:h.xoffset,yoffset:h.yoffset,width:h.width,height:h.height,xadvance:h.xadvance},c=new p.Texture(t.face+"/"+u.id,u.x,u.y,u.width,u.height);c.setImpl(e.texture.getImpl()),n[h.id]=u,r[h.id]=c,i.push(h.id)}p.Resources.addLoadedFont(t.face,o)},i}();p.FontLoader=t}(plume||(plume={})),function(o){var t=function(n){function t(t,e){var i=n.call(this)||this;return i.progressListener=new o.Handler,i._timeCounted=0,i.startLoadTime=0,i.optDelayBeforeCompleteFire=0,i.optProgressAlgo=1,i.optEstimateLoadingTime=2e3,i.estimatedProgress=-1,i.lastEstimatedProgress=-1,i.assetList=t,i.callback=e,i}return __extends(t,n),t.prototype.onLoadComplete=function(){var t=this,e=performance.now()-this.startLoadTime;o.logger.debug("Loading time: "+e);for(var i=0;i<this.assetList.length;i++){var n=this.assetList[i];if("spritesheet"==n.type){var r=n.atlas.split("/");if(-1!=r[r.length-1].indexOf(".json"))n.name}}0<this.optDelayBeforeCompleteFire?o.TimeManager.get().createAndStartTimer(this.optDelayBeforeCompleteFire,function(){t.progressListener.fire(100),t.callback()}):(t.progressListener.fire(100),t.callback())},t.prototype.addProgressListener=function(t,e){this.progressListener.add(t,e)},t.prototype.onShow=function(){var e=this;this.startLoadTime=performance.now(),this.loader=new o.Loader2d(this.assetList,t.retryMax),this.loader.load(function(t){t?e.onLoadComplete():o.logger.error("Failed to load all assets :/")}),this._loadingStatus=this.loader.getStatus()},t.prototype.update=function(t){if(n.prototype.update.call(this,t),!(this.startLoadTime<=0)){if(this.lastEstimatedProgress=this.estimatedProgress,this._updateProgress(t),null!=this.optOnProgress&&this.optOnProgress(this.estimatedProgress),null!=this._loadingStatus){var e=this.loader.getStatus();e.loaded!=this._loadingStatus.loaded&&(this._loadingStatus=e)}this.lastEstimatedProgress!=this.estimatedProgress&&this.progressListener.fire(100*this.estimatedProgress)}},t.prototype.render=function(t){},t.prototype._updateProgress=function(t){2==this.optProgressAlgo?this._updateProgress_AssetsSmooth(t):3==this.optProgressAlgo?this._updateProgress_FakeDuration(t):this._updateProgress_Assets(t)},t.prototype._updateProgress_AssetsSmooth=function(t){var e=this._loadingStatus.loading+this._loadingStatus.loaded+this._loadingStatus.failed,i=(this._loadingStatus.loaded+1)/e;i=Math.min(i,1);var n=this._timeCounted/this.optEstimateLoadingTime;n<i&&(this._timeCounted+=t),this.estimatedProgress=Math.min(n,1)},t.prototype._updateProgress_FakeDuration=function(t){var e=(performance.now()-this.startLoadTime)/this.optEstimateLoadingTime;this.estimatedProgress=Math.min(e,1)},t.prototype._updateProgress_Assets=function(t){var e=this._loadingStatus.loading+this._loadingStatus.loaded+this._loadingStatus.failed,i=this._loadingStatus.loaded/e;this.estimatedProgress=Math.min(i,1)},t.retryMax=5,t}(o.GuiScene);o.H5PreLoadingScene=t}(plume||(plume={})),function(o){var t=function(){function t(){}return t.clearYOffset=function(t){var e=o.Resources.fonts[t];if(null==e)throw new Error("Font not loaded: "+t);for(var i=Number.POSITIVE_INFINITY,n=0;n<e.chars.length;n++){(r=e.lettersByCode[e.chars[n]]).height<=0||r.yoffset<i&&(i=r.yoffset)}for(n=0;n<e.chars.length;n++){var r;(r=e.lettersByCode[e.chars[n]]).height<=0||(r.yoffset=r.yoffset-i)}},t}();o.Fonts=t}(plume||(plume={}));__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(r){var t=function(){function t(t,e){this.id="DefaultId",this._repeatCount=1,this._currentStepIndex=-1,this._steps=[],this._state=0,this._savedValues={},this._object=t,this._tweenManager=e}return t.prototype.getObject=function(){return this._object},t.prototype.delay=function(t){var e=new r.DelayTweenStep(t);return this._steps.push(e),this},t.prototype.repeat=function(t){this._repeatCount=t},t.prototype.to=function(t,e,i){void 0===e&&(e=1e3),void 0===i&&(i=r.easing.linear);var n=new r.PropertiesTweenStep(this._object,t,e,i,!1);return this._steps.push(n),this},t.prototype.from=function(t,e,i){void 0===e&&(e=1e3),void 0===i&&(i=r.easing.linear);var n=new r.PropertiesTweenStep(this._object,t,e,i,!0);return this._steps.push(n),this},t.prototype.start=function(){1!=this._state?0!=this._steps.length?(this._state=1,this._nextStep(),this.onStart&&this.onStart()):r.logger.warn("No step defined in Tween"):r.logger.warn("Tween already started")},t.prototype.stop=function(){2!=this._state&&(this._state=2,this.onComplete&&this.onComplete(this),this._tweenManager.remove(this))},t.prototype.update=function(t){1==this._state&&(null!=this._currentStep?(this._currentStep.update(t),this._currentStep.isComplete()&&(this.render(1),this._nextStep())):this.stop())},t.prototype.render=function(t){1==this._state&&null!=this._currentStep&&this._currentStep.render(t)},t.prototype._nextStep=function(){this._currentStepIndex++,this._currentStepIndex<this._steps.length?(this._currentStep=this._steps[this._currentStepIndex],this._currentStep.start()):(this._repeatCount-=1,0==this._repeatCount?this._currentStep=null:(this._currentStepIndex=-1,this._nextStep()))},t}();r.Tween=t}(plume||(plume={})),function(n){var t=function(){function t(){this._tweens=[],(t._instance=this)._game=n.Game.get(),this._game.addUpdatable(this),this._game.addRenderable(this)}return t.get=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.create=function(t,e){var i=new n.Tween(t,this);return null!=e&&(i.id=e),this._tweens.push(i),i},t.prototype.remove=function(t){var e=this._tweens.indexOf(t);-1<e&&(this._tweens.splice(e,1),t.stop())},t.prototype.removeAll=function(){this.cancelAll(),this._tweens=[]},t.prototype.cancelAll=function(){for(var t=0;t<this._tweens.length;t++)this._tweens[t].stop()},t.prototype.update=function(t){for(var e=0;e<this._tweens.length;e++)this._tweens[e].update(t)},t.prototype.render=function(t){for(var e=0;e<this._tweens.length;e++)this._tweens[e].render(t)},Object.defineProperty(t.prototype,"activeTweensCount",{get:function(){return this._tweens.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeTweens",{get:function(){return this._tweens.map(function(t){return t.id}).join()},enumerable:!0,configurable:!0}),t}();n.TweenManager=t}(plume||(plume={})),function(i){var t=function(){function t(t){this.complete=!1,this.elapsedTime=null,this.startTime=null,this.duration=t}return t.prototype.start=function(){this.startTime=i.Time.now(),this.elapsedTime=0,this.complete=!1},t.prototype.update=function(t){var e=i.Time.now();this.elapsedTime=e-this.startTime,this.elapsedTime>=this.duration&&(this.complete=!0)},t.prototype.render=function(t){},t.prototype.isComplete=function(){return this.complete},t}(),e=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t}(i.TweenStep=t);i.DelayTweenStep=e;var n=function(s){function t(t,e,i,n,r){var o=s.call(this,i)||this;return o._startValues={},o._endValues={},o._previousValues={},o._computedValues={},o._properties=e,o._easing=n,o._from=r,o._object=t,o}return __extends(t,s),t.prototype.start=function(){for(var t in s.prototype.start.call(this),this._properties)this._from?(this._startValues[t]=this._properties[t],this._endValues[t]=this._object[t]):(this._startValues[t]=this._object[t],this._endValues[t]=this._properties[t]),this._previousValues[t]=this._startValues[t],this._computedValues[t]=this._startValues[t]},t.prototype.update=function(t){s.prototype.update.call(this,t);var e=Math.min(this.elapsedTime,this.duration)/this.duration,i=this._easing(e);for(var n in this._properties){this._previousValues[n]=this._computedValues[n];var r=this._startValues[n],o=r+(this._endValues[n]-r)*i;this._computedValues[n]=o}},t.prototype.render=function(t){for(var e in s.prototype.render.call(this,t),this._computedValues){var i=this._previousValues[e],n=this._computedValues[e];this._object[e]=i+(n-i)*t}},t}(t);i.PropertiesTweenStep=n}(plume||(plume={})),function(t){var e=function(){function t(t,e){void 0===e&&(e=!0),this.roundValue=e,this._value=e?Math.round(t):t}return t.prototype._notify=function(t){var e=this._value;e!=t&&(e<t?(null!=this.onValueUp&&this.onValueUp(t),null!=this.onValueChange&&this.onValueChange(t)):t<e&&(null!=this.onValueDown&&this.onValueDown(t),null!=this.onValueChange&&this.onValueChange(t)))},Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this.roundValue&&(t=Math.round(t)),this._notify(t),this._value=t},enumerable:!0,configurable:!0}),t}();t.TweenValueListener=e}(plume||(plume={}));__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(l){var c,t;c=l.gltf||(l.gltf={}),t=function(){function t(t,e){this.manager=t,this.textureLoaderManager=e,this.crossOrigin="anonymous",null==t&&(this.manager=THREE.DefaultLoadingManager),this.dracoLoader=null;var i=THREE.DRACOLoader;i&&(i.setDecoderPath(l.Loader3d.dracoLib),this.dracoLoader=new i)}return t.prototype.load=function(e,i,t,n){var r=this,o=void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e);r.manager.itemStart(e);var s=function(t){n?n(t):l.logger.error(t),r.manager.itemEnd(e),r.manager.itemError(e)},a=new THREE.FileLoader(r.manager);a.setResponseType("arraybuffer"),a.load(e,function(t){try{r.parse(t,o,function(t){i(t),r.manager.itemEnd(e)},s)}catch(t){s(t)}},t,s)},t.prototype.setCrossOrigin=function(t){return this.crossOrigin=t,this},t.prototype.setPath=function(t){return this.path=t,this},t.prototype.setDRACOLoader=function(t){return this.dracoLoader=t,this},t.prototype.parse=function(t,e,i,n){var r,o={};if("string"==typeof t)r=t;else if(THREE.LoaderUtils.decodeText(new Uint8Array(t,0,4))===c.BINARY_EXTENSION_HEADER_MAGIC){try{o.KHR_binary_glTF=new c.GLTFBinaryExtension(t)}catch(t){return void(n&&n(t))}r=o.KHR_binary_glTF.content}else r=THREE.LoaderUtils.decodeText(new Uint8Array(t));var s=JSON.parse(r);if(void 0===s.asset||parseInt(s.asset.version[0])<2)n&&n(new Error("Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(s.extensionsUsed)for(var a=0;a<s.extensionsUsed.length;++a){var l=s.extensionsUsed[a],h=s.extensionsRequired||[];switch(l){case"KHR_lights_punctual":o.KHR_lights_punctual=new c.GLTFLightsExtension(s);break;case"KHR_materials_unlit":o.KHR_materials_unlit=new c.GLTFMaterialsUnlitExtension(s);break;case"KHR_materials_pbrSpecularGlossiness":o.KHR_materials_pbrSpecularGlossiness=new c.GLTFMaterialsPbrSpecularGlossinessExtension;break;case"KHR_draco_mesh_compression":o.KHR_draco_mesh_compression=new c.GLTFDracoMeshCompressionExtension(s,this.dracoLoader);break;case"MSFT_texture_dds":o.MSFT_texture_dds=new c.GLTFTextureDDSExtension;break;case"GB_lightmaps":o.GB_lightmaps=new c.GLTFLightMapsExtension(s);break;case"GB_sprites":o.GB_sprites=new c.GLTFSpritesExtension(s);break;case"EXT_texture_transform":o.EXT_texture_transform=new c.GLTFTextureTransformExtension;break;default:0<=h.indexOf(l)&&console.warn('Unknown extension "'+l+'".')}}o.GB_Unity=new c.GLTFUnityExtension,o.GB_Particle=new c.GLTFParticleExtension;var u=new c.GLTFParser(s,o,{path:e||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager,textureLoaderManager:this.textureLoaderManager,factory:this.factory});o.GB_lightmaps&&(o.GB_lightmaps.parser=u),o.GB_sprites&&(o.GB_sprites.parser=u),o.GB_Unity&&(o.GB_Unity.parser=u),o.GB_Particle&&(o.GB_Particle.parser=u),u.parse(function(t){i(t)},n)}},t}(),c.GLTFLoader=t}(plume||(plume={})),function(u){var c,t;c=u.gltf||(u.gltf={}),t=function(){function t(t,e,i){this.json=t,this.extensions=e,this.options=i,this._externalResources=0,this._loadedResources=0,this._errorResources=0,this._buffers=[],this._images=[],this._textures=[],this._accessors=[],this._bufferViews=[],this._materials=[],this._meshes=[],this._cameras=[],this._animations=[],this._animationsRelatives=[],this._nodes=[],this._scenes=[],this._skins=[],this._particles=[],this._collidersByNode=new u.HashMap,this._factory=null==i.factory?{}:i.factory,this._textureLoaderManager=i.textureLoaderManager,this._fileLoader=new THREE.FileLoader(this.options.manager),this._fileLoader.setResponseType("arraybuffer")}return t.prototype.parse=function(t,e){var r=this;this._onCompleteCb=t,this._externalResources++;var n=this.json.buffers;if(null!=n&&0<n.length)for(var i=function(t){var e=n[t];if(e.index=t,e.type&&"arraybuffer"!==e.type)return u.logger.error("GLTFLoader: "+e.type+" buffer type is not supported."),"continue";if(null==e.uri&&0==e.index)return r._buffers[e.index]=o.extensions.KHR_binary_glTF.body,"continue";if(null==e.uri)return u.logger.warn("GLTFLoader: buffer without uri."),"continue";var i=c.resolveURL(e.uri,o.options.path);o._externalResources++,o._fileLoader.load(i,function(t){r._loadedResources++,r._buffers[e.index]=t,r._onCheckDataLoaded()},function(){},function(t){u.logger.error("Failed to load "+e.uri),r._errorResources++,r._onCheckDataLoaded()})},o=this,s=0;s<n.length;s++)i(s);var a=this.json.images;if(null!=a&&0<a.length){var l=function(t){var e=a[t],i=e.extras;if(null!=i&&0==i.load)return"continue";if(e.index=t,e.uri){var n=c.resolveURL(e.uri,h.options.path);h._externalResources++,h._textureLoaderManager.load(n,function(t){r._loadedResources++,r._images[e.index]=t,r._onCheckDataLoaded()},function(t){u.logger.error("Failed to load "+e.uri),r._errorResources++,r._onCheckDataLoaded()})}},h=this;for(s=0;s<a.length;s++)l(s)}null!=this.extensions.KHR_draco_mesh_compression&&(this._externalResources++,this.extensions.KHR_draco_mesh_compression.initialize(function(){r._loadedResources++,r._onCheckDataLoaded()})),this._externalResources--,this._onCheckDataLoaded()},t.prototype._onCheckDataLoaded=function(){this._errorResources+this._loadedResources>=this._externalResources&&this._onExternalDataLoaded()},t.prototype._onExternalDataLoaded=function(){this._markDefs(),new c.GLTFBufferViewImporter(this).import(),new c.GLTFEmbeddedImageImporter(this).import(),new c.GLTFTextureImporter(this).import(),new c.GLTFAccessorImporter(this).import(),new c.GLTFMaterialImporter(this).import(),new c.GLTFMeshImporter(this).import(),new c.GLTFCameraImporter(this).import(),new c.GLTFSkinImporter(this).import(),new c.GLTFNodeImporter(this).import(),new c.GLTFSceneImporter(this).import(),new c.GLTFAnimationImporter(this).import();var t={scene:this._scenes[0],scenes:this._scenes,cameras:this._cameras,animations:this._animations,animationsRelatives:this._animationsRelatives,particles:this._particles,asset:this.json.asset,images:this._images,textures:this._textures,parser:this,collidersByNode:this._collidersByNode,userData:{}};this._onCompleteCb(t)},t.prototype._markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[],n={},r={},o=0,s=e.length;o<s;o++)for(var a=e[o].joints,l=0,h=a.length;l<h;l++)t[a[l]].isBone=!0;for(var u=0,c=t.length;u<c;u++){var p=t[u];void 0!==p.mesh&&(void 0===n[p.mesh]&&(n[p.mesh]=r[p.mesh]=0),n[p.mesh]++,void 0!==p.skin&&(i[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=r},t.prototype.assignTexture=function(t,e,i){var n=t.index,r=this._textures[n];null!=t.extensions&&null!=t.extensions.EXT_texture_transform&&(r=this.extensions.EXT_texture_transform.apply(r,t.extensions.EXT_texture_transform)),e[i]=r},t.prototype.getBufferView=function(t){return this._bufferViews[t]},t}(),c.GLTFParser=t}(plume||(plume={})),function(t){var e;(e=t.gltf||(t.gltf={})).WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},e.WEBGL_TYPE={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture},e.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},e.WEBGL_FILTERS={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},e.WEBGL_WRAPPINGS={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},e.WEBGL_SIDES={1028:THREE.BackSide,1029:THREE.FrontSide},e.WEBGL_DEPTH_FUNCS={512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth},e.WEBGL_BLEND_EQUATIONS={32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation},e.WEBGL_BLEND_FUNCS={0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor},e.WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},e.ATTRIBUTES={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},e.PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},e.INTERPOLATION={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},e.STATES_ENABLES={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"},e.ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},e.MIME_TYPE_FORMATS={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat}}(plume||(plume={})),function(u){!function(l){function r(t,e){return t.indices===e.indices&&function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(t[i]!==e[i])return!1;return!0}(t.attributes,e.attributes)}function y(t){if(t instanceof THREE.InterleavedBufferAttribute){for(var e=t.count,i=t.itemSize,n=t.array.slice(0,e*i),r=0;r<e;++r)n[r]=t.getX(r),2<=i&&(n[r+1]=t.getY(r)),3<=i&&(n[r+2]=t.getZ(r)),4<=i&&(n[r+3]=t.getW(r));return new THREE.BufferAttribute(n,i,t.normalized)}return t.clone()}function h(t,e){void 0!==e.extras&&("object"==typeof e.extras?t.userData=e.extras:u.logger.warn("GLTFLoader: Ignoring primitive type .extras, "+e.extras))}l.resolveURL=function(t,e){return"string"!=typeof t||""===t?"":/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:/^blob:.*$/i.test(t)?t:e+t},l.createDefaultMaterial=function(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})},l.getCachedGeometry=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(r(n.primitive,e))return n}return null},l.addPrimitiveAttributes=function(t,e,i){var n=e.attributes;for(var r in n){var o=l.ATTRIBUTES[r],s=i[n[r]];o&&(o in t.attributes||t.addAttribute(o,s))}if(void 0!==e.indices&&!t.index){var a=i[e.indices];a instanceof THREE.BufferAttribute?t.setIndex(a):u.logger.error("TODO Interleaved buffer ??? ")}void 0!==e.targets&&function(t,e,i){for(var n=!1,r=!1,o=0;o<e.length;o++){var s=e[o];if(void 0!==s.POSITION&&(n=!0),void 0!==s.NORMAL&&(r=!0),n&&r)break}if(n||r){for(var a=[],l=[],o=0;o<e.length;o++){var s=e[o],h="morphTarget"+o;if(n){var u=void 0;if(void 0!==s.POSITION){(u=y(i[s.POSITION])).name=h;for(var c=t.attributes.position,p=0,d=u.count;p<d;p++)u.setXYZ(p,u.getX(p)+c.getX(p),u.getY(p)+c.getY(p),u.getZ(p)+c.getZ(p))}else u=t.attributes.position;a.push(u)}if(r){var f=void 0;if(void 0!==s.NORMAL){(f=y(i[s.NORMAL])).name=h;for(var m=t.attributes.normal,p=0,d=f.count;p<d;p++)f.setXYZ(p,f.getX(p)+m.getX(p),f.getY(p)+m.getY(p),f.getZ(p)+m.getZ(p))}else f=t.attributes.normal;l.push(f)}}n&&(t.morphAttributes.position=a),r&&(t.morphAttributes.normal=l)}}(t,e.targets,i),h(t,e)},l.updateMorphTargets=function(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var i=0;i<e.weights.length;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){var n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length)for(t.morphTargetDictionary={},i=0;i<n.length;i++)t.morphTargetDictionary[n[i]]=i;else u.logger.warn("GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}},l.assignExtrasToUserData=h}(u.gltf||(u.gltf={}))}(plume||(plume={})),function(t){!function(l){l.BINARY_EXTENSION_HEADER_MAGIC="glTF";var h=1313821514,u=5130562,t=function(t){this.name="KHR_binary_glTF",this.content=null,this.body=null;var e=new DataView(t,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==l.BINARY_EXTENSION_HEADER_MAGIC)throw new Error("Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var i=new DataView(t,12),n=0;n<i.byteLength;){var r=i.getUint32(n,!0);n+=4;var o=i.getUint32(n,!0);if(n+=4,o===h){var s=new Uint8Array(t,12+n,r);this.content=THREE.LoaderUtils.decodeText(s)}else if(o===u){var a=12+n;this.body=t.slice(a,a+r)}n+=r}if(null===this.content)throw new Error("JSON content not found.")};l.GLTFBinaryExtension=t}(t.gltf||(t.gltf={}))}(plume||(plume={})),function(t){var f,e;f=t.gltf||(t.gltf={}),e=function(){function t(t,e){if(this.json=t,!(this.dracoLoader=e))throw new Error("No DRACOLoader instance provided.");this.name="KHR_draco_mesh_compression"}return t.prototype.initialize=function(e){var i=this;THREE.DRACOLoader.getDecoderModule().then(function(t){i.dracoDecoder=t.decoder,e()})},t.prototype.decodePrimitive=function(t,e){var i=this.json,n=this.dracoLoader,r=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,s={},a={},l={};for(var h in o)h in f.ATTRIBUTES&&(s[f.ATTRIBUTES[h]]=o[h]);for(var h in t.attributes)if(void 0!==f.ATTRIBUTES[h]&&void 0!==o[h]){var u=i.accessors[t.attributes[h]],c=f.WEBGL_COMPONENT_TYPES[u.componentType];l[f.ATTRIBUTES[h]]=c,a[f.ATTRIBUTES[h]]=!0===u.normalized}var p,d=e.getBufferView(r);return n.decodeDracoFileInternal(d,this.dracoDecoder,function(t){for(var e in t.attributes){var i=t.attributes[e],n=a[e];void 0!==n&&(i.normalized=n)}p=t},s||{},l||{}),p},t}(),f.GLTFDracoMeshCompressionExtension=e}(plume||(plume={})),function(a){var t,e;t=a.gltf||(a.gltf={}),e=function(){function t(t){this._initialized=!1,this._processedGeometries=[],this._processedMaterial=new a.HashMap,this.name="GB_lightmaps",this.lightmaps=[];for(var e=(t.extensions&&t.extensions.GB_lightmaps||{}).lightmaps||[],i=0;i<e.length;i++){var n=e[i];this.lightmaps.push(n)}}return t.prototype._initTextures=function(){if(!this._initialized){this._initialized=!0;for(var t=0;t<this.lightmaps.length;t++){var e=this.lightmaps[t].texture.index;this.parser._textures[e]}}},t.prototype.applyLightmap=function(t,e){if(null!=this._getTexture(e))if(this._initialized||this._initTextures(),t instanceof THREE.Mesh)this._applyLightmapOnMesh(t,e);else if(t instanceof THREE.Group)for(var i=0;i<t.children.length;i++){var n=t.children[i];n instanceof THREE.Mesh?this._applyLightmapOnMesh(n,e):a.logger.warn("Can not apply lightmap on node "+t.type+" ("+t.name+")")}else a.logger.warn("Can not apply lightmap on node "+t.type+" ("+t.name+")")},t.prototype._applyLightmapOnMesh=function(t,e){var i=this._getTexture(e);if(null!=i){var n=t.material;if(n instanceof THREE.MeshStandardMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.MeshPhongMaterial||n instanceof THREE.ShaderMaterial||n instanceof THREE.RawShaderMaterial){var r=this.parser._textures[i],o=n.uuid+"-"+i,s=this._processedMaterial.get(o);null==s?((n=n.clone()).lightMap=r,t.material=n,this._processedMaterial.put(o,s)):t.material=s,this._setUV2(t,e.uvScale,e.uvOffset)}else a.logger.warn("Can not apply lightmap on material "+t.material)}},t.prototype._getTexture=function(t){var e=t.lightmap;return e>=this.lightmaps.length?(a.logger.warn("Trying to get data from unregistered lightmap "+e),null):this.lightmaps[e].texture.index},t.prototype._setUV2=function(t,e,i){var n=t.geometry,r=n.uuid+"#"+e.join(",")+"#"+i.join(",");0<=this._processedGeometries.indexOf(r)||(n=n.clone(),null!=(t.geometry=n).getAttribute("uv2")?this._fixUv2(t,e,i):this._copyUvToUv2(t,e,i))},t.prototype._fixUv2=function(t,e,i){for(var n=t.geometry,r=n.getAttribute("uv"),o=n.getAttribute("uv2"),s=0;s<r.count;s++){var a=o.getX(s)*e[0]+i[0],l=1-((1-o.getY(s))*e[1]+i[1]);o.setXY(s,a,l)}},t.prototype._copyUvToUv2=function(t,e,i){for(var n=t.geometry,r=n.getAttribute("uv"),o=new THREE.BufferAttribute(new Float32Array(2*r.count),2),s=0;s<r.count;s++){var a=r.getX(s)*e[0]+i[0],l=1-((1-r.getY(s))*e[1]+i[1]);o.setXY(s,a,l)}n.addAttribute("uv2",o)},t}(),t.GLTFLightMapsExtension=e}(plume||(plume={})),function(t){var e;e=function(t){this.name="KHR_lights_punctual",this.lights=[];for(var e=(t.extensions&&t.extensions.KHR_lights_punctual||{}).lights||[],i=0;i<e.length;i++){var n=e[i],r=void 0,o=new THREE.Color(16777215);void 0!==n.color&&o.fromArray(n.color);var s=void 0!==n.range?n.range:0;switch(n.type){case"directional":(r=new THREE.DirectionalLight(o)).target.position.set(0,0,1),r.add(r.target);break;case"point":(r=new THREE.PointLight(o)).decay=2,r.distance=s;break;case"spot":(r=new THREE.SpotLight(o)).distance=s,r.decay=2,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,r.angle=n.spot.outerConeAngle,r.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,r.target.position.set(0,0,1),r.add(r.target);break;default:throw new Error('GLTFLoader: Unexpected light type, "'+n.type+'".')}void 0!==n.intensity&&(r.intensity=n.intensity),r.name=n.name||"light_"+i,this.lights.push(r)}},(t.gltf||(t.gltf={})).GLTFLightsExtension=e}(plume||(plume={})),function(t){var e,i;e=t.gltf||(t.gltf={}),i=function(){function t(){this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],this.name="KHR_materials_pbrSpecularGlossiness"}return t.prototype.getMaterialType=function(t){return THREE.ShaderMaterial},t.prototype.extendParams=function(t,e,i){var n=e.extensions[this.name],r=THREE.ShaderLib.standard,o=THREE.UniformsUtils.clone(r.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),c=r.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",u);if(delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new THREE.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},t.vertexShader=r.vertexShader,t.fragmentShader=c,t.uniforms=o,t.defines={STANDARD:""},t.color=new THREE.Color(1,1,1),t.opacity=1,Array.isArray(n.diffuseFactor)){var p=n.diffuseFactor;t.color.fromArray(p),t.opacity=p[3]}if(void 0!==n.diffuseTexture&&i.assignTexture(t,"map",n.diffuseTexture.index),t.emissive=new THREE.Color(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new THREE.Color(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var d=n.specularGlossinessTexture.index;i.assignTexture(t,"glossinessMap",d),i.assignTexture(t,"specularMap",d)}},t.prototype.createMaterial=function(t){var e=new THREE.ShaderMaterial({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return e.isGLTFSpecularGlossinessMaterial=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e.extensions.derivatives=!0,e},t.prototype.cloneMaterial=function(t){var e=t.clone();e.isGLTFSpecularGlossinessMaterial=!0;for(var i=this.specularGlossinessParams,n=0,r=i.length;n<r;n++)e[i[n]]=t[i[n]];return e},t.prototype.refreshUniforms=function(t,e,i,n,r,o){if(!0===r.isGLTFSpecularGlossinessMaterial){var s,a=r.uniforms,l=r.defines;a.opacity.value=r.opacity,a.diffuse.value.copy(r.color),a.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),a.map.value=r.map,a.specularMap.value=r.specularMap,a.alphaMap.value=r.alphaMap,a.lightMap.value=r.lightMap,a.lightMapIntensity.value=r.lightMapIntensity,a.aoMap.value=r.aoMap,a.aoMapIntensity.value=r.aoMapIntensity,r.map?s=r.map:r.specularMap?s=r.specularMap:r.displacementMap?s=r.displacementMap:r.normalMap?s=r.normalMap:r.bumpMap?s=r.bumpMap:r.glossinessMap?s=r.glossinessMap:r.alphaMap?s=r.alphaMap:r.emissiveMap&&(s=r.emissiveMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),a.uvTransform.value.copy(s.matrix)),a.envMap.value=r.envMap,a.envMapIntensity.value=r.envMapIntensity,a.flipEnvMap.value=r.envMap&&r.envMap.isCubeTexture?-1:1,a.refractionRatio.value=r.refractionRatio,a.specular.value.copy(r.specular),a.glossiness.value=r.glossiness,a.glossinessMap.value=r.glossinessMap,a.emissiveMap.value=r.emissiveMap,a.bumpMap.value=r.bumpMap,a.normalMap.value=r.normalMap,a.displacementMap.value=r.displacementMap,a.displacementScale.value=r.displacementScale,a.displacementBias.value=r.displacementBias,null!==a.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===a.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}},t}(),e.GLTFMaterialsPbrSpecularGlossinessExtension=i}(plume||(plume={})),function(t){var e,i;e=t.gltf||(t.gltf={}),i=function(){function t(t){this.json=t,this.name="KHR_materials_unlit"}return t.prototype.getMaterialType=function(t){return THREE.MeshBasicMaterial},t.prototype.extendParams=function(t,e,i){t.color=new THREE.Color(1,1,1),t.opacity=1;var n=e.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var r=n.baseColorFactor;t.color.fromArray(r),t.opacity=r[3]}void 0!==n.baseColorTexture&&i.assignTexture(n.baseColorTexture,t,"map")}},t}(),e.GLTFMaterialsUnlitExtension=i}(plume||(plume={})),function(g){!function(t){var e=function(){function t(){}return t.prototype.addParticleSystem=function(t,e,i){var n,r=new g.Emitter;if(r.name=t.name,e.renderer){if("billboard"==e.renderer.mode?r.renderer.renderMode=g.ParticleRenderMode.Billboard:"horizontalBillboard"==e.renderer.mode?r.renderer.renderMode=g.ParticleRenderMode.HorizontalBillboard:"verticalBillboard"==e.renderer.mode?r.renderer.renderMode=g.ParticleRenderMode.VerticalBillboard:"stretch"==e.renderer.mode?(r.renderer.renderMode=g.ParticleRenderMode.StrechedBillboard,r.renderer.lengthScale=e.renderer.lengthScale,r.renderer.velocityScale=e.renderer.velocityScale):"mesh"==e.renderer.mode?r.renderer.renderMode=g.ParticleRenderMode.Mesh:g.logger.warn("Unsupported renderMode: "+e.renderer.mode),null!=e.renderer.mesh){var o=this.parser._meshes[e.renderer.mesh];r.renderer.mesh=o}if(null!=e.renderer.material){var s=(c=this.parser._materials[e.renderer.material]).map;null!=s&&(r.renderer.texture=s),r.renderer.material=c}}if(e.main&&(r.main.duration=e.main.duration,r.main.looping=e.main.loop,r.main.prewarm=e.main.prewarm,r.main.startDelay=f(e.main.startDelay),r.main.startLifetime=f(e.main.startLifetime),e.main.startSize3D?(r.main.startSizeX=f(e.main.startSizeX),r.main.startSizeY=f(e.main.startSizeY),r.main.startSizeZ=f(e.main.startSizeZ),r.main.startSize3D=!0):r.main.startSize=f(e.main.startSize),r.main.startSpeed=f(e.main.startSpeed),r.main.startRotation=f(e.main.startRotation),r.main.startColor=y(e.main.startColor),r.main.gravityModifier=f(e.main.gravityModifier),r.main.simulationSpace=m(e.main.simulationSpace),r.main.simulationSpeed=e.main.simulationSpeed,r.main.maxParticles=e.main.maxParticles),e.emission&&(r.emission.rateOverTime=f(e.emission.rateOverTime),r.emission.rateOverDistance=f(e.emission.rateOverDistance),null!=e.emission.bursts))for(var a=0;a<e.emission.bursts.length;a++){var l=e.emission.bursts[a],h=new g.Burst(l.time,l.cycles);h.count=f(l.count),h.repeatInterval=l.interval,r.emission.bursts.push(h)}(e.shape&&this._importShape(r.shape,e),e.velocityOverLifetime)&&((u=new g.ParticleVelocityOverLifetimeModule).x=f(e.velocityOverLifetime.x),u.y=f(e.velocityOverLifetime.y),u.z=f(e.velocityOverLifetime.z),u.speedModifier=f(e.velocityOverLifetime.speedModifier),u.space=m(e.velocityOverLifetime.space),r.velocityOverLifetime=u);if(e.limitVelocityOverLifetime){var u=new g.ParticleLimitVelocityOverLifetimeModule;e.limitVelocityOverLifetime.separateAxes?(u.limitX=f(e.limitVelocityOverLifetime.limitX),u.limitY=f(e.limitVelocityOverLifetime.limitY),u.limitZ=f(e.limitVelocityOverLifetime.limitZ),u.space=m(e.limitVelocityOverLifetime.space)):u.limit=f(e.limitVelocityOverLifetime.limit),u.separateAxes=e.limitVelocityOverLifetime.separateAxes,u.dampen=e.limitVelocityOverLifetime.dampen,r.limitVelocityOverLifetime=u}(e.inheritVelocity,e.forceOverLifetime)&&((u=new g.ParticleForceOverLifetimeModule).x=f(e.forceOverLifetime.x),u.y=f(e.forceOverLifetime.y),u.z=f(e.forceOverLifetime.z),u.space=m(e.forceOverLifetime.space),u.randomized=e.forceOverLifetime.randomized,r.forceOverLifetime=u);e.colorOverLifetime&&((u=new g.ParticleColorOverLifetimeModule).color=y(e.colorOverLifetime.color),r.colorOverLifetime=u);if(e.colorBySpeed,e.sizeOverLifetime){u=new g.ParticleSizeOverLifetimeModule;e.sizeOverLifetime.separateAxes?(u.separateAxes=!0,u.x=f(e.sizeOverLifetime.x),u.y=f(e.sizeOverLifetime.y),u.z=f(e.sizeOverLifetime.z)):(u.separateAxes=!1,u.size=f(e.sizeOverLifetime.size)),r.sizeOverLifetime=u}if(e.sizeBySpeed,e.rotationOverLifetime){u=new g.ParticleRotationOverLifetimeModule;e.rotationOverLifetime.separateAxes?(u.separateAxes=!0,u.x=f(e.rotationOverLifetime.x),u.y=f(e.rotationOverLifetime.y),u.z=f(e.rotationOverLifetime.z)):(u.separateAxes=!1,u.angularVelocity=f(e.rotationOverLifetime.angularVelocity)),r.rotationOverLifetime=u}if(e.rotationBySpeed){u=new g.ParticleRotationBySpeedModule;e.rotationBySpeed.separateAxes?(u.separateAxes=!0,u.x=f(e.rotationBySpeed.x),u.y=f(e.rotationBySpeed.y),u.z=f(e.rotationBySpeed.z)):u.angularVelocity=f(e.rotationBySpeed.angularVelocity),null!=e.rotationBySpeed.range&&(u.range[0]=e.rotationBySpeed.range[0],u.range[1]=e.rotationBySpeed.range[1]),r.rotationBySpeed=u}if(e.externalForces,e.collision,e.trigger,e.subEmitters,e.textureSheetAnimation){u=new g.ParticleTextureAnimationModule;"sprites"==e.textureSheetAnimation.mode?g.logger.warn("textureSheetAnimation: sprites not implemented"):(u.numTilesX=e.textureSheetAnimation.numTilesX,u.numTilesY=e.textureSheetAnimation.numTilesY,"singleRow"==e.textureSheetAnimation.animation?(u.animation=g.ParticleTextureAnimationAnimationMode.SingleRow,u.randomRow=e.textureSheetAnimation.randomRow,u.rowIndex=e.textureSheetAnimation.rowIndex):u.animation=g.ParticleTextureAnimationAnimationMode.WholeSheet),u.frameOverTime=f(e.textureSheetAnimation.frameOverTime),u.startFrame=f(e.textureSheetAnimation.startFrame),u.cycleCount=e.textureSheetAnimation.cycleCount,r.textureAnimation=u}if(e.lights,e.trails){u=new g.ParticleTrailsModule;if("ribbon"==e.trails.mode?(u.mode=1,u.ribbonCount=e.trails.ribbonCount):(u.mode=0,u.ratio=e.trails.ratio,u.lifetime=f(e.trails.lifetime),u.minVertexDistance=e.trails.minVertexDistance,u.worldSpace=e.trails.worldSpace,u.dieWithParticles=e.trails.dieWithParticles,u.sizeAffectsLifetime=e.trails.sizeAffectsLifetime),u.textureMode="tile"==(n=e.trails.textureMode)?1:"distribute"==n?2:"repeat"==n?3:0,u.sizeAffectsWidth=e.trails.sizeAffectsWidth,u.inheritParticleColor=e.trails.inheritParticleColor,u.colorOverLifetime=y(e.trails.colorOverLifetime),u.widthOverTrail=f(e.trails.widthOverTrail),u.colorOverTrail=y(e.trails.colorOverTrail),null!=e.trails.material){var c=this.parser._materials[e.trails.material];r.renderer.trailTexture=c.map}r.trails=u}if(null!=i){var p=i.split(",");for(a=0;a<p.length;a++){var d=p[a];"AdditiveBlending"==d?r.renderer.blending=THREE.AdditiveBlending:"NoBlending"==d?r.renderer.blending=THREE.NoBlending:"SubtractiveBlending"==d?r.renderer.blending=THREE.SubtractiveBlending:"MultiplyBlending"==d&&(r.renderer.blending=THREE.MultiplyBlending)}r.renderer.trailBlending=r.renderer.blending}this.parser._particles.push(r),t.add(r)},t.prototype._importShape=function(t,e){var i=e.shape,n=!1,r=!1,o=!1,s=g.ephemeralPool.v3();if("sphere"==i.shapeType)t.shapeType=g.ParticleShapeType.Sphere,n=!0;else if("hemisphere"==i.shapeType)t.shapeType=g.ParticleShapeType.Hemisphere,n=!0;else if("cone"==i.shapeType)t.shapeType=g.ParticleShapeType.Cone,t.emitFrom=g.ParticleEmitFrom.Base,t.angle=i.angle*g.Mathf.DEG2RAD,r=n=!0;else if("conevolume"==i.shapeType)t.shapeType=g.ParticleShapeType.Cone,t.emitFrom=g.ParticleEmitFrom.Volume,t.angle=i.angle*g.Mathf.DEG2RAD,t.length=i.length,r=n=!0;else if("box"==i.shapeType)t.shapeType=g.ParticleShapeType.Box,t.emitFrom=g.ParticleEmitFrom.Volume;else if("boxedge"==i.shapeType)t.shapeType=g.ParticleShapeType.Box,t.emitFrom=g.ParticleEmitFrom.Edge,o=!0;else if("boxshell"==i.shapeType)t.shapeType=g.ParticleShapeType.Box,t.emitFrom=g.ParticleEmitFrom.Shell,o=!0;else if("circle"==i.shapeType)t.shapeType=g.ParticleShapeType.Circle,r=n=!0;else{if("edge"!=i.shapeType)return void g.logger.warn("Unsuported emitter shape");t.shapeType=g.ParticleShapeType.Edge,t.radius=i.radius,t.radiusSpread=i.radiusSpread,"random"==i.radiusMode?t.radiusMode=g.ParticleArcMode.Random:("loop"==i.radiusMode?t.radiusMode=g.ParticleArcMode.Loop:t.radiusMode=g.ParticleArcMode.PingPong,t.radiusSpeed=f(i.radiusSpeed))}n&&(t.radius=i.radius,t.radiusThickness=i.radiusThickness),r&&(t.arc=i.arc*g.Mathf.DEG2RAD,t.arcSpread=i.arcSpread,"random"==i.arcMode?t.arcMode=g.ParticleArcMode.Random:("loop"==i.arcMode?t.arcMode=g.ParticleArcMode.Loop:t.arcMode=g.ParticleArcMode.PingPong,t.arcSpeed=f(i.arcSpeed))),o&&t.boxThickness.copy(a(i.boxThickness,s)),t.position.copy(a(i.position,s)),t.rotation.copy(a(i.rotation,s)),t.rotation.multiplyScalar(g.Mathf.DEG2RAD),t.scale.copy(a(i.scale,s)),t.alignToDirection=i.alignToDirection,t.randomDirectionAmount=i.randomDirectionAmount,t.sphericalDirectionAmount=i.sphericalDirectionAmount,t.randomPositionAmount=i.randomPositionAmount},t}();function f(t){var e;return"constant"==t.mode?e=g.MinMaxCurve.constant(t.constant):"twoConstants"==t.mode?e=g.MinMaxCurve.randomBetweenTwoConstant(t.constantMin,t.constantMax):"curve"==t.mode?e=g.MinMaxCurve.curve(i(t.curve),null==t.multiplier?1:t.multiplier):"twoCurves"==t.mode&&(e=g.MinMaxCurve.randomBetweenTwoCurve(i(t.curveMin),i(t.curveMax),null==t.multiplier?1:t.multiplier)),null!=t.multiplier&&(e.multiplier=t.multiplier),e}function i(t){var e=new g.AnimationCurve;e.preWrapMode=o(t.preWrapMode),e.postWrapMode=o(t.postWrapMode),t.keys.length;for(var i=0;i<t.keys.length;i++){var n=t.keys[i],r=new g.Keyframe;r.time=n[0],r.value=n[1],r.inTangent=n[2],r.outTangent=n[3],e.addKey(r)}return e}function o(t){return"clamp"==t?4:"pingpong"==t?2:"once"==t?0:"loop"==t?1:3}function m(t){return"local"==t?g.ParticleSimulationSpace.Local:g.ParticleSimulationSpace.World}function y(t){var e;return"color"==t.mode?e=g.GradientRange.color(r(t.color)):"twoColors"==t.mode?e=g.GradientRange.randomBetweenTwoColor(r(t.colorMin),r(t.colorMax)):"randomColor"==t.mode?e=g.GradientRange.randomColor(n(t.gradient)):"gradient"==t.mode?e=g.GradientRange.gradient(n(t.gradient)):"twoGradients"==t.mode&&(e=g.GradientRange.randomBetweenTwoGradient(n(t.gradientMin),n(t.gradientMax))),e}function n(t){for(var e=new g.Gradient,i=new Array,n=new Array,r=0;r<t.alphaKeys.length;r++){var o=t.alphaKeys[r];n.push(new g.GradientAlphaKey(o[1],o[0]))}for(r=0;r<t.colorKeys.length;r++){o=t.colorKeys[r];i.push(new g.GradientColorKey(new THREE.Color(o[1],o[2],o[3]),o[0]))}return e.setKeys(i,n),e}function r(t,e){return null==e&&(e=new THREE.Vector4),e.set(t[0],t[1],t[2],t[3]),e}function a(t,e){return null==e&&(e=new THREE.Vector3),e.set(t[0],t[1],t[2]),e}t.GLTFParticleExtension=e}(g.gltf||(g.gltf={}))}(plume||(plume={})),function(t){var e,i;e=t.gltf||(t.gltf={}),i=function(){function t(t){this.sprites=[],this.name="GB_sprites",this.spritesDef=[];for(var e=(t.extensions&&t.extensions.GB_sprites||{}).sprites||[],i=0;i<e.length;i++){var n=e[i];this.spritesDef.push(n)}}return t.prototype.getSprite=function(t){var e=this.sprites[t];if(null!=e){var i=e.clone();return i.material=e.material.clone(),i}var n=this.spritesDef[t],r=this.parser._textures[n.texture],o=new THREE.MeshBasicMaterial({map:r,transparent:!0});if((e=new THREE.Mesh(new THREE.PlaneBufferGeometry,o)).rotateZ(Math.PI),this.sprites[t]=e,null!=r.image&&null!=n.pixelsPerUnit){var s=r.image.width,a=r.image.height/s;e.scale.set(1,a,1);var l=n.pixelsPerUnit/s;e.scale.multiplyScalar(1/l)}return e},t}(),e.GLTFSpritesExtension=i}(plume||(plume={})),function(t){var e;e=function(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name="MSFT_texture_dds",this.ddsLoader=new THREE.DDSLoader},(t.gltf||(t.gltf={})).GLTFTextureDDSExtension=e}(plume||(plume={})),function(t){var e,i;e=t.gltf||(t.gltf={}),i=function(){function t(){this.name="EXT_texture_transform"}return t.prototype.apply=function(t,e){return t=t.clone(),null!=e.scale&&t.repeat.set(e.scale[0],e.scale[1]),null!=e.offset&&t.offset.set(e.offset[0],e.offset[1]),t.wrapS=t.wrapT=THREE.RepeatWrapping,t.needsUpdate=!0,t},t}(),e.GLTFTextureTransformExtension=i}(plume||(plume={})),function(t){var e,i;e=t.gltf||(t.gltf={}),i=function(){function t(){}return t.prototype.applyToNode=function(t,e){if(null!=e.static&&1==e.static&&(t.matrixAutoUpdate=!1,t.updateMatrix()),null!=e.activeSelf&&0==e.activeSelf&&(t.visible=!1),null!=e.sprite){var i=this.parser.extensions.GB_sprites.getSprite(e.sprite.id),n=i.material;null!=e.sprite.color&&(n.color=(new THREE.Color).setRGB(e.sprite.color[0],e.sprite.color[1],e.sprite.color[2])),n.side=THREE.DoubleSide,t.add(i)}null!=e.colliders&&0<e.colliders.length&&this.parser._collidersByNode.put(t.uuid,e.colliders)},t}(),e.GLTFUnityExtension=i}(plume||(plume={})),function(t){var e;e=function(t){this.parser=t},(t.gltf||(t.gltf={})).GLTFImporter=e}(plume||(plume={})),function(c){var p,t;p=c.gltf||(c.gltf={}),t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.accessors||this.parser.json.accessors.length<=0))for(var t=0;t<this.parser.json.accessors.length;t++){var e=this.parser.json.accessors[t];this._loadAccessor(e,t)}},e.prototype._loadAccessor=function(t,e){if(void 0!==t.bufferView){var i,n,r=this.parser._bufferViews[t.bufferView],o=this.parser.json.bufferViews[t.bufferView],s=p.WEBGL_TYPE_SIZES[t.type],a=p.WEBGL_COMPONENT_TYPES[t.componentType],l=a.BYTES_PER_ELEMENT*s,h=t.byteOffset||0,u=!0===t.normalized;if(null!=o.byteStride&&o.byteStride!=l)return c.logger.warn("Accessor with 'byteStride' (need to be implemented)"),void(this.parser._accessors[e]=null);i=null===r?new a(t.count*s):new a(r,h,t.count*s),n=new THREE.BufferAttribute(i,s,u),this.parser._accessors[e]=n}else this.parser._accessors[e]=null},e}(p.GLTFImporter),p.GLTFAccessorImporter=t}(plume||(plume={})),function(x){!function(v){var t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.animations||this.parser.json.animations.length<=0))for(var t=0;t<this.parser.json.animations.length;t++){var e=this.parser.json.animations[t],i=this._loadAnimation(e,t);if(null==e.extras||null==e.extras.root&&null==e.extras.othersRoot)this.parser._animations.push(i);else{var n=null==e.extras.root?this.parser._scenes[0]:this.parser._nodes[e.extras.root],r=v.GLTFAnimationsHelper.convertToRelative(n,i);if(this.parser._animationsRelatives.push({root:n,clip:r}),null!=e.extras.othersRoot)for(var o=0;o<e.extras.othersRoot.length;o++){var s=e.extras.othersRoot[o],a=this.parser._nodes[s];this.parser._animationsRelatives.push({root:a,clip:r})}}}},e.prototype._loadAnimation=function(m,t){for(var y=[],e=function(t){var e=m.channels[t],i=m.samplers[e.sampler];if(null==i)return x.logger.warn("No sampler "+e.sampler+" in "+JSON.stringify(m)),"continue";var n=e.target,r=void 0!==m.parameters?m.parameters[i.input]:i.input,o=void 0!==m.parameters?m.parameters[i.output]:i.output,s=g.parser._accessors[r],a=g.parser._accessors[o],l=g.parser._nodes[n.node];if(null==l)return x.logger.warn("Node "+n.node+" used in "+m.name+" does not exists."),"continue";l.updateMatrix(),l.matrixAutoUpdate=!0;var h=void 0;switch(v.PATH_PROPERTIES[n.path]){case v.PATH_PROPERTIES.weights:h=THREE.NumberKeyframeTrack;break;case v.PATH_PROPERTIES.rotation:h=THREE.QuaternionKeyframeTrack;break;case v.PATH_PROPERTIES.translation:case v.PATH_PROPERTIES.scale:default:h=THREE.VectorKeyframeTrack}var u=l.name?l.name:l.uuid,c=void 0!==i.interpolation?v.INTERPOLATION[i.interpolation]:THREE.InterpolateLinear,p=[];v.PATH_PROPERTIES[n.path]===v.PATH_PROPERTIES.weights?l.traverse(function(t){!0===t.isMesh&&t.morphTargetInfluences&&p.push(t.name?t.name:t.uuid)}):p.push(u);for(var d=0;d<p.length;d++){var f=new h(p[d]+"."+v.PATH_PROPERTIES[n.path],THREE.AnimationUtils.arraySlice(s.array,0,void 0),THREE.AnimationUtils.arraySlice(a.array,0,void 0),c);"CUBICSPLINE"===i.interpolation&&(f.createInterpolant=function(t){return new _(this.times,this.values,this.getValueSize()/3,t)}),y.push(f)}},g=this,i=0;i<m.channels.length;i++)e(i);var n=void 0!==m.name?m.name:"animation_"+t;return new THREE.AnimationClip(n,-1,y)},e}(v.GLTFImporter);v.GLTFAnimationImporter=t;var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n*3+n,o=0;o!==n;o++)e[o]=i[r+o];return e},e.prototype.beforeStart_=function(t){this.copySampleValue_(t)},e.prototype.afterEnd_=function(t){this.copySampleValue_(t)},e.prototype.interpolate_=function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,l=3*s,h=n-e,u=(i-e)/h,c=u*u,p=c*u,d=t*l,f=d-l,m=2*p-3*c+1,y=p-2*c+u,g=-2*p+3*c,v=p-c,_=0;_!==s;_++){var x=o[f+_+s],S=o[f+_+a]*h,w=o[d+_+s],b=o[d+_]*h;r[_]=m*x+y*S+g*w+v*b}return r},e}(THREE.Interpolant)}(x.gltf||(x.gltf={}))}(plume||(plume={})),function(t){var e,i;e=t.gltf||(t.gltf={}),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.bufferViews||this.parser.json.bufferViews.length<=0))for(var t=0;t<this.parser.json.bufferViews.length;t++){var e=this.parser.json.bufferViews[t],i=this.parser._buffers[e.buffer],n=e.byteLength||0,r=e.byteOffset||0,o=i.slice(r,r+n);this.parser._bufferViews[t]=o}},e}(e.GLTFImporter),e.GLTFBufferViewImporter=i}(plume||(plume={})),function(s){var a,t;a=s.gltf||(s.gltf={}),t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.cameras||this.parser.json.cameras.length<=0))for(var t=0;t<this.parser.json.cameras.length;t++){var e=this.parser.json.cameras[t];this._loadCamera(e,t)}},e.prototype._loadCamera=function(t,e){var i;if("perspective"===t.type){var n=t.perspective,r=new THREE.PerspectiveCamera(THREE.Math.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6);i=r;var o=s.Game.get().scaleManager.getCurrentScaling();r.aspect=o.windowWidth/o.windowHeight,r.updateProjectionMatrix()}else if("orthographic"===t.type){n=t.orthographic;i=new THREE.OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)}void 0!==t.name&&(i.name=t.name),a.assignExtrasToUserData(i,t),this.parser._cameras[e]=i},e}(a.GLTFImporter),a.GLTFCameraImporter=t}(plume||(plume={})),function(s){var t,e;t=s.gltf||(s.gltf={}),e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.images||this.parser.json.images.length<=0))for(var t=0;t<this.parser.json.images.length;t++){var e=this.parser.json.images[t];null!=e.bufferView&&this._loadImage(e,t)}},e.prototype._loadImage=function(e,t){var i=this.parser._bufferViews[e.bufferView],n=new Blob([i],{type:e.mimeType}),r=URL.createObjectURL(n),o=this.parser._textureLoaderManager.load(r,function(t){URL.revokeObjectURL(r)},function(t){s.logger.error("Failed to load texture from bufferView "+e.bufferView)});this.parser._images[t]=o},e}(t.GLTFImporter),t.GLTFEmbeddedImageImporter=e}(plume||(plume={})),function(t){var c,e;c=t.gltf||(t.gltf={}),e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.materials||this.parser.json.materials.length<=0))for(var t=0;t<this.parser.json.materials.length;t++){var e=this.parser.json.materials[t];this._loadMaterial(e,t)}},e.prototype._loadMaterial=function(t,e){var i,n={},r=t.extensions||{};if(r.KHR_materials_pbrSpecularGlossiness){var o=this.parser.extensions.KHR_materials_pbrSpecularGlossiness;i=o.getMaterialType(t),o.extendParams(n,t,this.parser)}else if(r.KHR_materials_unlit){var s=this.parser.extensions.KHR_materials_unlit;i=s.getMaterialType(t),s.extendParams(n,t,this.parser)}else{i=THREE.MeshStandardMaterial;var a=t.pbrMetallicRoughness||{};if(n.color=new THREE.Color(1,1,1),n.opacity=1,Array.isArray(a.baseColorFactor)){var l=a.baseColorFactor;n.color.fromArray(l),n.opacity=l[3]}if(void 0!==a.baseColorTexture&&this.parser.assignTexture(a.baseColorTexture,n,"map"),n.metalness=void 0!==a.metallicFactor?a.metallicFactor:1,n.roughness=void 0!==a.roughnessFactor?a.roughnessFactor:1,void 0!==a.metallicRoughnessTexture){a.metallicRoughnessTexture.index;this.parser.assignTexture(a.metallicRoughnessTexture,n,"metalnessMap"),this.parser.assignTexture(a.metallicRoughnessTexture,n,"roughnessMap")}}!0===t.doubleSided&&(n.side=THREE.DoubleSide);var h,u=t.alphaMode||c.ALPHA_MODES.OPAQUE;u===c.ALPHA_MODES.BLEND?n.transparent=!0:(n.transparent=!1,u===c.ALPHA_MODES.MASK&&(n.alphaTest=void 0!==t.alphaCutoff?t.alphaCutoff:.5)),void 0!==t.normalTexture&&i!==THREE.MeshBasicMaterial&&(this.parser.assignTexture(t.normalTexture,n,"normalMap"),n.normalScale=new THREE.Vector2(1,1),void 0!==t.normalTexture.scale&&n.normalScale.set(t.normalTexture.scale,t.normalTexture.scale)),void 0!==t.occlusionTexture&&i!==THREE.MeshBasicMaterial&&(this.parser.assignTexture(t.occlusionTexture,n,"aoMap"),void 0!==t.occlusionTexture.strength&&(n.aoMapIntensity=t.occlusionTexture.strength)),void 0!==t.emissiveFactor&&i!==THREE.MeshBasicMaterial&&(n.emissive=(new THREE.Color).fromArray(t.emissiveFactor)),void 0!==t.emissiveTexture&&i!==THREE.MeshBasicMaterial&&this.parser.assignTexture(t.emissiveTexture,n,"emissiveMap"),h="KHR_materials_pbrSpecularGlossiness"==r?this.parser.extensions.KHR_materials_pbrSpecularGlossiness.createMaterial(n):null!=this.parser._factory.materialFactory?this.parser._factory.materialFactory(i,n):new i(n),void 0!==t.name&&(h.name=t.name),h.normalScale&&(h.normalScale.y=-h.normalScale.y),h.map&&(h.map.encoding=THREE.sRGBEncoding),h.emissiveMap&&(h.emissiveMap.encoding=THREE.sRGBEncoding),h.specularMap&&(h.specularMap.encoding=THREE.sRGBEncoding),c.assignExtrasToUserData(h,t),null!=this.parser._factory.materialProcessor&&(h=this.parser._factory.materialProcessor(h)),this.parser._materials[e]=h},e}(c.GLTFImporter),c.GLTFMaterialImporter=e}(plume||(plume={})),function(i){var C,t;C=i.gltf||(i.gltf={}),t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._primitiveCache=[],t._cache=new i.HashMap,t}return __extends(t,e),t.prototype.import=function(){if(!(null==this.parser.json.meshes||this.parser.json.meshes.length<=0))for(var t=0;t<this.parser.json.meshes.length;t++){var e=this.parser.json.meshes[t];this._loadMesh(e,t)}},t.prototype._loadMesh=function(t,e){for(var i=t.primitives,n=[],r=0;r<i.length;r++)n[r]=void 0===i[r].material?C.createDefaultMaterial():this.parser._materials[i[r].material];var o=this._loadGeometries(i,t),s=1==o.length&&0<o[0].groups.length,a=[];for(r=0;r<o.length;r++){var l=o[r],h=i[r],u=void 0,c=s?n:n[r];if(h.mode===C.WEBGL_CONSTANTS.TRIANGLES||h.mode===C.WEBGL_CONSTANTS.TRIANGLE_STRIP||h.mode===C.WEBGL_CONSTANTS.TRIANGLE_FAN||void 0===h.mode)u=!0===t.isSkinnedMesh?new THREE.SkinnedMesh(l,c):new THREE.Mesh(l,c),h.mode===C.WEBGL_CONSTANTS.TRIANGLE_STRIP?u.drawMode=THREE.TriangleStripDrawMode:h.mode===C.WEBGL_CONSTANTS.TRIANGLE_FAN&&(u.drawMode=THREE.TriangleFanDrawMode);else if(h.mode===C.WEBGL_CONSTANTS.LINES)u=new THREE.LineSegments(l,c);else if(h.mode===C.WEBGL_CONSTANTS.LINE_STRIP)u=new THREE.Line(l,c);else if(h.mode===C.WEBGL_CONSTANTS.LINE_LOOP)u=new THREE.LineLoop(l,c);else{if(h.mode!==C.WEBGL_CONSTANTS.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new THREE.Points(l,c)}0<Object.keys(u.geometry.morphAttributes).length&&C.updateMorphTargets(u,t),u.name=t.name||"mesh_"+e,1<o.length&&(u.name+="_"+r),C.assignExtrasToUserData(u,t),a.push(u);for(var p=s?u.material:[u.material],d=void 0!==l.attributes.color,f=void 0===l.attributes.normal,m=!0===u.isSkinnedMesh,y=0<Object.keys(l.morphAttributes).length,g=y&&void 0!==l.morphAttributes.normal,v=0,_=p.length;v<_;v++){var x=p[v];if(u instanceof THREE.Points){var S="PointsMaterial:"+x.uuid,w=this._cache.get(S);w||(w=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(w,x),w.color.copy(x.color),w.map=x.map,w.lights=!1,this._cache.put(S,w)),x=w}else if(u instanceof THREE.Line){S="LineBasicMaterial:"+x.uuid;var b=this._cache.get(S);b||(b=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(b,x),b.color.copy(x.color),b.lights=!1,this._cache.put(S,b)),x=b}if(d||f||m||y){S="ClonedMaterial:"+x.uuid+":";x.isGLTFSpecularGlossinessMaterial&&(S+="specular-glossiness:"),m&&(S+="skinning:"),d&&(S+="vertex-colors:"),f&&(S+="flat-shading:"),y&&(S+="morph-targets:"),g&&(S+="morph-normals:");var E=this._cache.get(S);E||(E=x.isGLTFSpecularGlossinessMaterial?this.parser.extensions.KHR_materials_pbrSpecularGlossiness.cloneMaterial(x):x.clone(),m&&(E.skinning=!0),d&&(E.vertexColors=THREE.VertexColors),f&&(E.flatShading=!0),y&&(E.morphTargets=!0),g&&(E.morphNormals=!0),this._cache.put(S,E)),x=E}(p[v]=x).aoMap&&void 0===l.attributes.uv2&&void 0!==l.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),l.addAttribute("uv2",new THREE.BufferAttribute(l.attributes.uv.array,2))),x.isGLTFSpecularGlossinessMaterial&&(u.onBeforeRender=this.parser.extensions.KHR_materials_pbrSpecularGlossiness.refreshUniforms)}u.material=s?p:p[0]}if(1===a.length)this.parser._meshes[e]=a[0];else{for(var T=new THREE.Group,I=(r=0,a.length);r<I;r++)T.add(a[r]);this.parser._meshes[e]=T}},t.prototype._loadGeometries=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=t[n],o=C.getCachedGeometry(this._primitiveCache,r);if(null!=o)i.push(o.geometry);else if(r.extensions&&r.extensions.KHR_draco_mesh_compression){var s=this.parser.extensions.KHR_draco_mesh_compression.decodePrimitive(r,this.parser);C.addPrimitiveAttributes(s,r,this.parser._accessors),null!=this.parser._factory.geometryProcessor&&(s=this.parser._factory.geometryProcessor(s,e)),this._primitiveCache.push({primitive:r,geometry:s}),i.push(s)}else{s=new THREE.BufferGeometry;C.addPrimitiveAttributes(s,r,this.parser._accessors),null!=this.parser._factory.geometryProcessor&&(s=this.parser._factory.geometryProcessor(s,e)),this._primitiveCache.push({primitive:r,geometry:s}),i.push(s)}}return i},t}(C.GLTFImporter),C.GLTFMeshImporter=t}(plume||(plume={})),function(c){var p,t;p=c.gltf||(c.gltf={}),t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.nodes||this.parser.json.nodes.length<=0))for(var t=0;t<this.parser.json.nodes.length;t++){var e=this.parser.json.nodes[t];this._loadNode(e,t)}},e.prototype._loadNode=function(t,e){var i,n=this.parser.json.meshReferences,r=this.parser.json.meshUses;if(!0===t.isBone)i=new THREE.Bone;else if(void 0!==t.mesh){var o=this.parser._meshes[t.mesh];if(1<n[t.mesh]){var s=r[t.mesh]++;(i=o.clone()).name+="_instance_"+s,i.onBeforeRender=o.onBeforeRender;for(var a=0,l=i.children.length;a<l;a++)i.children[a].name+="_instance_"+s,i.children[a].onBeforeRender=o.children[a].onBeforeRender}else i=o}else if(void 0!==t.camera)i=this.parser._cameras[t.camera];else if(t.extensions){if(null!=t.extensions.KHR_lights_punctual)if(null!=t.extensions.KHR_lights_punctual.light)i=this.parser.extensions.KHR_lights_punctual.lights[t.extensions.KHR_lights_punctual.light]}else i=new THREE.Object3D;if(null==i&&(c.logger.warn("construct default object3d"),i=new THREE.Object3D),void 0!==t.name&&(i.name=THREE.PropertyBinding.sanitizeNodeName(t.name)),null!=t.extensions&&null!=t.extensions.GB_lightmaps&&this.parser.extensions.GB_lightmaps.applyLightmap(i,t.extensions.GB_lightmaps),p.assignExtrasToUserData(i,t),void 0!==t.matrix){var h=new THREE.Matrix4;h.fromArray(t.matrix),i.applyMatrix(h)}else void 0!==t.translation&&i.position.fromArray(t.translation),void 0!==t.rotation&&i.quaternion.fromArray(t.rotation),void 0!==t.scale&&i.scale.fromArray(t.scale);if(null!=t.extras&&t.extras.gbunity&&this.parser.extensions.GB_Unity.applyToNode(i,t.extras.gbunity),null!=t.extras&&t.extras.particles)for(a=0;a<t.extras.particles.length;a++){var u=null;null!=t.extras.particletags&&t.extras.particletags.length-1>=a&&(u=t.extras.particletags[a]),this.parser.extensions.GB_Particle.addParticleSystem(i,t.extras.particles[a],u)}this.parser._nodes[e]=i},e}(p.GLTFImporter),p.GLTFNodeImporter=t}(plume||(plume={})),function(y){var s,t;s=y.gltf||(y.gltf={}),t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(null!=this.parser.json.scenes)for(var t=0;t<this.parser.json.scenes.length;t++)this._loadScene(this.parser.json.scenes[t],t)},e.prototype._loadScene=function(t,e){var i=new THREE.Scene;void 0!==t.name&&(i.name=t.name),s.assignExtrasToUserData(i,t);for(var n=t.nodes||[],r=0,o=n.length;r<o;r++)this._buildNodeHierachy(n[r],i);this.parser._scenes[e]=i},e.prototype._buildNodeHierachy=function(t,e){var i=this.parser._nodes[t],n=this.parser.json.nodes[t];if(void 0!==n.skin)for(var r=!0===i.isGroup?i.children:[i],o=0;o<r.length;o++){for(var s=r[o],a=this.parser._skins[n.skin],l=[],h=[],u=0;u<a.joints.length;u++){var c=a.joints[u],p=this.parser._nodes[c];if(p){l.push(p);var d=new THREE.Matrix4;void 0!==a.inverseBindMatrices&&d.fromArray(a.inverseBindMatrices.array,16*u),h.push(d)}else y.logger.warn("Joint "+c+" could not be found.")}1==s.isSkinnedMesh&&s.bind(new THREE.Skeleton(l,h),s.matrixWorld)}if(e.add(i),n.children){var f=n.children;for(o=0;o<f.length;o++){var m=f[o];this._buildNodeHierachy(m,i)}}},e}(s.GLTFImporter),s.GLTFSceneImporter=t}(plume||(plume={})),function(t){var e,i;e=t.gltf||(t.gltf={}),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.skins||this.parser.json.skins.length<=0))for(var t=0;t<this.parser.json.skins.length;t++){var e=this.parser.json.skins[t];this._loadSkin(e,t)}},e.prototype._loadSkin=function(t,e){var i={joints:t.joints,inverseBindMatrices:null};null!=t.inverseBindMatrices&&(i.inverseBindMatrices=this.parser._accessors[t.inverseBindMatrices]),this.parser._skins[e]=i},e}(e.GLTFImporter),e.GLTFSkinImporter=i}(plume||(plume={})),function(t){var o,e;o=t.gltf||(t.gltf={}),e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.import=function(){if(!(null==this.parser.json.textures||this.parser.json.textures.length<=0))for(var t=0;t<this.parser.json.textures.length;t++){var e=this.parser.json.textures[t];this._loadTexture(e,t)}},e.prototype._loadTexture=function(t,e){var i=this.parser.json.images[t.source],n=this.parser._images[t.source];n.flipY=!1,void 0!==t.name&&(n.name=t.name),i.mimeType in o.MIME_TYPE_FORMATS&&(n.format=o.MIME_TYPE_FORMATS[i.mimeType]);var r=(this.parser.json.samplers||{})[t.sampler]||{};n.magFilter=o.WEBGL_FILTERS[r.magFilter]||THREE.LinearFilter,n.minFilter=o.WEBGL_FILTERS[r.minFilter]||THREE.LinearMipMapLinearFilter,n.wrapS=o.WEBGL_WRAPPINGS[r.wrapS]||THREE.RepeatWrapping,n.wrapT=o.WEBGL_WRAPPINGS[r.wrapT]||THREE.RepeatWrapping,this.parser._textures[e]=n},e}(o.GLTFImporter),o.GLTFTextureImporter=e}(plume||(plume={})),function(t){var e,i;e=t.gltf||(t.gltf={}),i=function(){function t(){}return t.convertToRelative=function(t,e){return e},t}(),e.GLTFAnimationsHelper=i}(plume||(plume={}));__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(a){var l=new THREE.Quaternion,t=function(i){function n(){var t=i.call(this)||this;return t._isPlaying=!1,t._isPaused=!1,t._isStopped=!0,t._isEmitting=!1,t._time=0,t._tmpVec3_0=new THREE.Vector3,t.renderer=new a.ParticleSystemRenderer,t.main=new a.ParticleMainModule,t.shape=new a.ParticleShapeModule,t.emission=new a.ParticleEmissionModule,t.visible=!1,t}return __extends(n,i),n.prototype.initialize=function(){var t=this;this._particles=new a.RecyclePool(function(){return new a.Particle(t)},this.main.maxParticles),null==this.shape&&(this.shape=new a.ParticleShapeModule),null==this.emission&&(this.emission=new a.ParticleEmissionModule),this.main.initialize(this),this.renderer.initialize(this),this.shape.initialize(this),this.emission.initialize(this),null!=this.colorOverLifetime&&this.colorOverLifetime.initialize(this),null!=this.forceOverLifetime&&this.forceOverLifetime.initialize(this),null!=this.limitVelocityOverLifetime&&this.limitVelocityOverLifetime.initialize(this),null!=this.rotationOverLifetime&&this.rotationOverLifetime.initialize(this),null!=this.rotationBySpeed&&this.rotationBySpeed.initialize(this),null!=this.sizeOverLifetime&&this.sizeOverLifetime.initialize(this),null!=this.textureAnimation&&this.textureAnimation.initialize(this),null!=this.velocityOverLifetime&&this.velocityOverLifetime.initialize(this),null!=this.trails&&this.trails.initialize(this),a.Game.get().addUpdatable(this)},n.prototype.destroy=function(){a.Game.get().removeUpdatable(this),this.renderer.destroy()},n.prototype.play=function(){this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this.visible=!0,this._time=0,this._isPlaying=!0,this.emission.play(),this.main.prewarm&&this._prewarmSystem()},n.prototype.pause=function(){this._isStopped?a.logger.warn("Particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0,this.visible=!1)},n.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this.clear(),this.visible=!1,this._time=0,this._isStopped=!0,this.emission.stop()},n.prototype.clear=function(){this._particles.reset(),this.renderer.model.clear()},n.prototype.emit=function(t){for(var e=0;e<t;e++){if(this._particles.length>=this.main.maxParticles)return;var i=this._particles.add();i.reset();var n=Math.random();switch(this.shape.emit(i),i.velocity.multiplyScalar(this.main.startSpeed.evaluate(this._time/this.main.duration,n)),this.main.simulationSpace){case a.ParticleSimulationSpace.Local:break;case a.ParticleSimulationSpace.World:var r=this.getWorldQuaternion(l);i.position.applyMatrix4(this.matrixWorld),i.velocity.applyQuaternion(r)}var o=this.main.startRotation.evaluate(this._time/this.main.duration,n);if(i.rotation.set(o,o,o),this.main.startSize3D)i.startSize.set(this.main.startSizeX.evaluate(this._time/this.main.duration,n),this.main.startSizeY.evaluate(this._time/this.main.duration,n),this.main.startSizeZ.evaluate(this._time/this.main.duration,n));else{var s=this.main.startSize.evaluate(this._time/this.main.duration,n);i.startSize.set(s,s,s)}i.size.copy(i.startSize),i.startColor.copy(this.main.startColor.evaluate(this._time/this.main.duration,n)),i.color.copy(i.startColor),i.startLifetime=this.main.startLifetime.evaluate(this._time/this.main.duration,n),i.remainingLifetime=i.startLifetime,i.randomSeed=n,null!=this.trails&&this.trails.emit(i,this._time/this.main.duration,n)}},n.prototype._updateParticles=function(t){null!=this.velocityOverLifetime&&this.velocityOverLifetime.update(this.main.simulationSpace,this.matrixWorld),null!=this.forceOverLifetime&&this.forceOverLifetime.update(this.main.simulationSpace,this.matrixWorld),null!=this.trails&&this.trails.update(this.main.simulationSpace,this.matrixWorld);for(var e=0;e<this._particles.length;++e){var i=this._particles.data[e];if(i.remainingLifetime-=t,i.animatedVelocity.set(0,0,0),i.remainingLifetime<0)i.garbage(),this._particles.remove(e),--e;else{i.velocity.y-=9.8*this.main.gravityModifier.evaluate(1-i.remainingLifetime/i.startLifetime,i.randomSeed)*t,null!=this.sizeOverLifetime&&this.sizeOverLifetime.animate(i),this.colorOverLifetime&&this.colorOverLifetime.animate(i),null!=this.forceOverLifetime&&this.forceOverLifetime.animate(i,t),null!=this.velocityOverLifetime?this.velocityOverLifetime.animate(i):i.ultimateVelocity.copy(i.velocity),null!=this.limitVelocityOverLifetime&&this.limitVelocityOverLifetime.animate(i),null!=this.rotationOverLifetime&&this.rotationOverLifetime.animate(i,t),null!=this.textureAnimation&&this.textureAnimation.animate(i),null!=this.rotationBySpeed&&this.rotationBySpeed.animate(i,t);var n=this._tmpVec3_0.copy(i.ultimateVelocity).multiplyScalar(t);i.position.add(n),null!=this.trails&&this.trails.animate(i,t)}}},n.prototype._prewarmSystem=function(){this.main.startDelay.mode=0,this.main.startDelay.constant=0;for(var t=this.main.duration/1,e=0;e<t;++e)this._time+=1,this._emit(1),this._updateParticles(1)},n.prototype._emit=function(t){var e=this.main.startDelay.evaluate(0,Math.random());if(this._time>e){this._isStopped||(this._isEmitting=!0),this._time>this.main.duration+e&&(this.main.looping||(this._isEmitting=!1,this._isStopped=!0,this.onStopped()));var i=this.emission.emitOverTime(t,this.isEmitting);0<i&&this.emit(i);var n=this.emission.emitOverDistance(t,this.isEmitting);0<n&&this.emit(n);for(var r=0;r<this.emission.bursts.length;++r)this.emission.bursts[r].update(this,t)}},n.prototype.update=function(t){var e=t/1e3*this.main.simulationSpeed;this._isPlaying&&(this._time+=e,this._emit(e),this._updateParticles(e),this.renderer.updateRenderData())},n.prototype.onStopped=function(){null!=this._stopHandler&&this._stopHandler.fire(!0),this.stop()},n.prototype.getParticles=function(){return this._particles},n.prototype.getParticleCount=function(){return this._particles.length},Object.defineProperty(n.prototype,"stopHandler",{get:function(){return null==this._stopHandler&&(this._stopHandler=new a.Handler),this._stopHandler},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPaused",{get:function(){return this._isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isStopped",{get:function(){return this._isStopped},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEmitting",{get:function(){return this._isEmitting},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.renderer&&(this.renderer=t.renderer.clone()),null!=t.main&&(this.main=t.main.clone()),null!=t.shape&&(this.shape=t.shape.clone()),null!=t.emission&&(this.emission=t.emission.clone()),null!=t.colorOverLifetime&&(this.colorOverLifetime=t.colorOverLifetime.clone()),null!=t.forceOverLifetime&&(this.forceOverLifetime=t.forceOverLifetime.clone()),null!=t.limitVelocityOverLifetime&&(this.limitVelocityOverLifetime=t.limitVelocityOverLifetime.clone()),null!=t.rotationOverLifetime&&(this.rotationOverLifetime=t.rotationOverLifetime.clone()),null!=t.rotationBySpeed&&(this.rotationBySpeed=t.rotationBySpeed.clone()),null!=t.sizeOverLifetime&&(this.sizeOverLifetime=t.sizeOverLifetime.clone()),null!=t.textureAnimation&&(this.textureAnimation=t.textureAnimation.clone()),null!=t.velocityOverLifetime&&(this.velocityOverLifetime=t.velocityOverLifetime.clone()),null!=t.trails&&(this.trails=t.trails.clone()),this},n}(THREE.Object3D);a.Emitter=t}(plume||(plume={})),function(i){var t=function(){function t(t){this.root=t,this.all=[];var e=this;t.traverse(function(t){t instanceof i.Emitter&&e.all.push(t)})}return t.prototype.initialize=function(){this.all.forEach(function(t){t.initialize()})},t.prototype.play=function(){this.all.forEach(function(t){t.play()})},t.prototype.stop=function(){this.all.forEach(function(t){t.stop()})},t.prototype.destroy=function(){this.all.forEach(function(t){t.destroy()})},t}();i.EmitterGroup=t}(plume||(plume={})),function(t){var e=function(){function t(t){this.particleSystem=t,this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,this.rotation=new THREE.Euler,this.size=new THREE.Vector3,this.color=new THREE.Vector4,this.startColor=new THREE.Vector4,this.startSize=new THREE.Vector3,this.startLifetime=0,this.remainingLifetime=0,this.animatedVelocity=new THREE.Vector3,this.ultimateVelocity=new THREE.Vector3,this.startFrameIndex=-1,this.startRowIndex=-1,this.frameIndex=0,this.randomSeed=0,this.hasTrail=!1,this.trail=null}return t.prototype.garbage=function(){null!=this.trail&&this.trail.garbage()},t.prototype.reset=function(){this.startFrameIndex=-1,this.startRowIndex=-1,this.frameIndex=0,this.hasTrail=!1,this.trail=null},t}();t.Particle=e}(plume||(plume={})),function(t){var i=function(){function t(){}return t.pop=function(){return 0==this._stack.length?new e:this._stack.pop()},t.release=function(t){this._stack.push(t)},t._stack=new Array,t}(),e=function(){function t(){this.position=new THREE.Vector3,this.directionToNext=new THREE.Vector3,this.remainingLifetime=0,this.size=new THREE.Vector3,this.color=new THREE.Vector4}return t.prototype.reset=function(){this.position.set(0,0,0),this.size.set(1,1,1),this.color.set(1,1,1,1)},t}();t.ParticleTrailVertex=e;var n=function(){function t(t){this.particleSystem=t,this.startLifetime=0,this.remainingLifetime=0,this.vertexLifetime=0,this.trail=[],this.lastVertexAddedPosition=new THREE.Vector3,this.queuePosition=new THREE.Vector3,this.fullyVisible=!0}return t.prototype.getLastElement=function(){return this.trail.length<=0?null:this.trail[this.trail.length-1]},t.prototype.addElement=function(){var t=i.pop();return t.reset(),this.trail.push(t),t},t.prototype.remove=function(t){var e=this.trail[t];return i.release(e),this.trail.splice(t,1),e},t.prototype.garbage=function(){for(var t=0;t<this.trail.length;t++)i.release(this.trail[t])},t.prototype.reset=function(){},t}();t.ParticleTrail=n}(plume||(plume={})),function(t){var e,i,n,r,o,s,a;(e=t.ParticleRenderMode||(t.ParticleRenderMode={}))[e.Billboard=0]="Billboard",e[e.StrechedBillboard=1]="StrechedBillboard",e[e.HorizontalBillboard=2]="HorizontalBillboard",e[e.VerticalBillboard=3]="VerticalBillboard",e[e.Mesh=4]="Mesh",(i=t.ParticleSimulationSpace||(t.ParticleSimulationSpace={}))[i.Local=0]="Local",i[i.World=1]="World",(n=t.ParticleTextureAnimationGridMode||(t.ParticleTextureAnimationGridMode={}))[n.Grid=0]="Grid",n[n.Sprites=1]="Sprites",(r=t.ParticleTextureAnimationAnimationMode||(t.ParticleTextureAnimationAnimationMode={}))[r.WholeSheet=0]="WholeSheet",r[r.SingleRow=1]="SingleRow",(o=t.ParticleShapeType||(t.ParticleShapeType={}))[o.Box=0]="Box",o[o.Cone=1]="Cone",o[o.Sphere=2]="Sphere",o[o.Hemisphere=3]="Hemisphere",o[o.Circle=4]="Circle",o[o.Edge=5]="Edge",(s=t.ParticleEmitFrom||(t.ParticleEmitFrom={}))[s.Base=0]="Base",s[s.Edge=1]="Edge",s[s.Shell=2]="Shell",s[s.Volume=3]="Volume",(a=t.ParticleArcMode||(t.ParticleArcMode={}))[a.Random=0]="Random",a[a.Loop=1]="Loop",a[a.PingPong=2]="PingPong"}(plume||(plume={})),function(o){var t=function(){function t(){}return t.calculateTransform=function(t,e,i,n){if(e===t)return n.set(0,0,0,1),!1;if(t==o.ParticleSimulationSpace.World)n.setFromRotationMatrix(i);else{var r=o.ephemeralPool.m4().getInverse(i);n.setFromRotationMatrix(r)}return!0},t.fixedAngleUnitVector2=function(t,e){t.set(Math.cos(e),Math.sin(e),0)},t.randomUnitVector2=function(t){var e=o.Random.inRange(0,2*Math.PI),i=Math.cos(e),n=Math.sin(e);t.set(i,n)},t.randomUnitVector=function(t){t.set(o.Random.inRange(-1,1),o.Random.inRange(-1,1),o.Random.inRange(-1,1)).normalize()},t.randomPointInUnitSphere=function(t){this.randomUnitVector(t),t.multiplyScalar(Math.random())},t.randomPointBetweenSphere=function(t,e,i){this.randomUnitVector(t),t.multiplyScalar(e+(i-e)*Math.random())},t.randomPointInUnitCircle=function(t){this.randomUnitVector2(t),t.multiplyScalar(Math.random())},t.randomPointBetweenCircle=function(t,e,i){this.randomUnitVector2(t),t.multiplyScalar(e+(i-e)*Math.random())},t.randomPointBetweenCircleAtFixedAngle=function(t,e,i,n){this.fixedAngleUnitVector2(t,n),t.multiplyScalar(e+(i-e)*Math.random())},t.randomPointInCube=function(t,e){t.set(o.Random.inRange(-e.x,e.x),o.Random.inRange(-e.y,e.y),o.Random.inRange(-e.z,e.z))},t.PARTICLE_EMIT_Z_AXIS=new THREE.Vector3(0,0,1),t}();o.ParticleUtils=t}(plume||(plume={})),function(s){var t=function(){function i(t,e){this.cycleCount=1,this.repeatInterval=1,this._time=0,this._curTime=0,this._remainingCount=1,this.cycleCount=e,this._remainingCount=e,this._time=t,this._curTime=t}return i.prototype.update=function(t,e){if(t.main.looping&&0==this._remainingCount&&(this._remainingCount=this.cycleCount,this._curTime=this._time),0<this._remainingCount){var i=Math.random(),n=this._curTime/t.main.duration,r=s.Mathf.repeat(t.time-t.main.startDelay.evaluate(n,i),t.main.duration),o=r-e;o=0<o?o:0,this._curTime>=o&&this._curTime<r&&(t.emit(this.count.evaluate(n,i)),this._curTime+=this.repeatInterval,--this._remainingCount)}},Object.defineProperty(i.prototype,"time",{set:function(t){this._time=t,this._curTime=t},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this._remainingCount=this.cycleCount,this._curTime=this._time},i.prototype.clone=function(t){var e=new i(this._time,this.cycleCount);return e.copy(this,t),e},i.prototype.copy=function(t,e){return null!=t.count&&(this.count=t.count),null!=t.cycleCount&&(this.cycleCount=t.cycleCount),null!=t.repeatInterval&&(this.repeatInterval=t.repeatInterval),this},i}();s.Burst=t}(plume||(plume={})),function(t){var e,i;e=t.particle||(t.particle={}),(i=e.shaders||(e.shaders={})).billboard_fragment="precision highp float;\n#if USE_MAIN_TEX\nuniform sampler2D mainTexture;\n#endif\nvarying vec2 vUv;\nvarying vec4 vColor;\nvoid main () {\n#if USE_MAIN_TEX\nvec4 texColor = texture2D(mainTexture, vUv);\n#else\nvec4 texColor = vec4(1.0, 1.0, 1.0, 1.0);\n#endif\ngl_FragColor = vColor * texColor;\n}",i.billboard_vertex="precision highp float;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec2 uv;\nattribute vec3 instancePosition;\nattribute vec3 instanceScale;\nattribute vec4 instanceRotation;\nattribute vec4 instanceColor;\nuniform vec4 billboardRotation;\n#if USE_SPRITESHEET\nuniform vec2 frameTile; // x,y tiles\nattribute float instanceFrameIndex; // index\n#endif\n#if USE_STRETCHED_BILLBOARD\nuniform float velocityScale;\nuniform float lengthScale;\nattribute vec3 instanceVelocity;\n#endif\nvarying vec2 vUv;\nvarying vec4 vColor;\nvec3 applyTRS( vec3 position, vec3 translation, vec4 quaternion, vec3 scale ) {\nposition += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );\nreturn position + translation;\n}\nvec3 rotate( vec3 position, vec4 quaternion) {\nposition += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );\nreturn position;\n}\nvoid main () {\nvec4 transformed = vec4(rotate(position.xyz * instanceScale, billboardRotation), 1.0);\ntransformed = vec4( applyTRS(transformed.xyz, instancePosition, instanceRotation, instanceScale), 1.0);\n#if USE_STRETCHED_BILLBOARD\nvec4 velocity4 = vec4(instanceVelocity.xyz, 0);\n#endif\n#if USE_WORLD_SPACE\n#else\ntransformed = modelMatrix * transformed;\n#if USE_STRETCHED_BILLBOARD\nvelocity4 = modelMatrix * velocity4;\n#endif\n#endif\ntransformed = projectionMatrix * viewMatrix  * transformed;\n#if USE_SPRITESHEET\nvec2 flipUv = vec2(uv.x, 1.0 - uv.y);\nvec2 aniUV = vec2(mod(instanceFrameIndex, frameTile.x), floor(instanceFrameIndex / frameTile.x));\naniUV = (aniUV.xy + flipUv.xy) / vec2(frameTile.x, frameTile.y);\naniUV.y = 1.0 - aniUV.y;\nvUv = aniUV;\n#else\nvUv = uv.xy;\n#endif\nvColor = instanceColor;\ngl_Position = transformed;\n}",i.mesh_fragment="precision highp float;\n#if USE_MAIN_TEX\nuniform sampler2D mainTexture;\n#endif\nvarying vec2 vUv;\nvarying vec4 vColor;\nvoid main () {\n#if USE_MAIN_TEX\nvec4 texColor = texture2D(mainTexture, vUv);\n#else\nvec4 texColor = vec4(1.0, 1.0, 1.0, 1.0);\n#endif\ngl_FragColor = vColor * texColor;\n}",i.mesh_vertex="precision highp float;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec2 uv;\nattribute vec3 instancePosition;\nattribute vec3 instanceScale;\nattribute vec4 instanceRotation;\nattribute vec4 instanceColor;\nvarying vec2 vUv;\nvarying vec4 vColor;\nvec3 applyTRS( vec3 position, vec3 translation, vec4 quaternion, vec3 scale ) {\nposition *= scale;\nposition += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );\nreturn position + translation;\n}\nvoid main () {\nvUv = uv;\nvColor = instanceColor;\nvec3 transformed = applyTRS(position.xyz, instancePosition, instanceRotation, instanceScale);\n#if USE_WORLD_SPACE\ngl_Position = projectionMatrix * viewMatrix * vec4(transformed, 1.0);\n#else\ngl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(transformed, 1.0);\n#endif\n}",i.trail_fragment="precision highp float;\n#if USE_MAIN_TEX\nuniform sampler2D mainTexture;\n#endif\nvarying vec2 vUv;\nvarying vec4 vColor;\nvoid main () {\n#if USE_MAIN_TEX\nvec4 texColor = texture2D(mainTexture, vUv);\n#else\nvec4 texColor = vec4(1.0, 1.0, 1.0, 1.0);\n#endif\ngl_FragColor = vColor * texColor;\n}",i.trail_vertex="precision highp float;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec2 uv;\nattribute vec4 color;\nuniform vec4 billboardRotation;\nvarying vec2 vUv;\nvarying vec4 vColor;\nvec3 applyTRS( vec3 position, vec3 translation, vec4 quaternion, vec3 scale ) {\nposition += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );\nreturn position + translation;\n}\nvec3 rotate( vec3 position, vec4 quaternion) {\nposition += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );\nreturn position;\n}\nvoid main () {\nvec4 transformed = vec4(position.xyz, 1.0);\n#if USE_WORLD_SPACE\n#else\ntransformed = modelMatrix * transformed;\n#endif\ntransformed = projectionMatrix * viewMatrix  * transformed;\nvUv = uv.xy;\nvColor = color;\ngl_Position = transformed;\n}"}(plume||(plume={})),function(t){var e=function(){function i(){}return i.prototype.initialize=function(t){this.particleSystem=t},i.prototype.clone=function(t){var e=new i;return e.copy(this,t),e},i.prototype.copy=function(t,e){return this},i}();t.ParticleModule=e}(plume||(plume={})),function(t){var e=function(i){function n(){return null!==i&&i.apply(this,arguments)||this}return __extends(n,i),n.prototype.animate=function(t){if(t.remainingLifetime<.2)t.remainingLifetime,t.startLifetime,t.randomSeed;var e=this.color.evaluate(1-t.remainingLifetime/t.startLifetime,t.randomSeed);if(.7<e.x)e.x;t.color.copy(t.startColor),t.color.x*=e.x,t.color.y*=e.y,t.color.z*=e.z,t.color.w*=e.w},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.color&&(this.color=t.color),this},n}(t.ParticleModule);t.ParticleColorOverLifetimeModule=e}(plume||(plume={})),function(e){var t=function(n){function i(){var t=n.call(this)||this;return t.bursts=[],t._emitRateTimeCounter=0,t._emitRateDistanceCounter=0,t._oldWPos=new THREE.Vector3,t._curWPos=new THREE.Vector3,t.rateOverTime=e.MinMaxCurve.constant(10),t.rateOverDistance=e.MinMaxCurve.constant(0),t}return __extends(i,n),i.prototype.initialize=function(t){n.prototype.initialize.call(this,t),t.getWorldPosition(this._curWPos),this._oldWPos.copy(this._curWPos)},i.prototype.play=function(){this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0},i.prototype.stop=function(){this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this.bursts.forEach(function(t){t.reset()})},i.prototype.emitOverTime=function(t,e){if(this._emitRateTimeCounter+=this.rateOverTime.evaluate(this.particleSystem.time/this.particleSystem.main.duration,1)*t,1<this._emitRateTimeCounter&&e){var i=Math.floor(this._emitRateTimeCounter);return this._emitRateTimeCounter-=i,i}return 0},i.prototype.emitOverDistance=function(t,e){this.particleSystem.getWorldPosition(this._curWPos);var i=this._curWPos.distanceTo(this._oldWPos);if(this._oldWPos.copy(this._curWPos),this._emitRateDistanceCounter+=i*this.rateOverDistance.evaluate(this.particleSystem.time/this.particleSystem.main.duration,1),1<this._emitRateDistanceCounter&&e){var n=Math.floor(this._emitRateDistanceCounter);return this._emitRateDistanceCounter-=n,n}return 0},i.prototype.clone=function(t){var e=new i;return e.copy(this,t),e},i.prototype.copy=function(t,e){n.prototype.copy.call(this,t,e),null!=t.rateOverTime&&(this.rateOverTime=t.rateOverTime),null!=t.rateOverDistance&&(this.rateOverDistance=t.rateOverDistance);for(var i=0;i<t.bursts.length;i++)this.bursts.push(t.bursts[i].clone());return this},i}(e.ParticleModule);e.ParticleEmissionModule=t}(plume||(plume={})),function(r){var t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.space=r.ParticleSimulationSpace.Local,t.randomized=!1,t._rotation=new THREE.Quaternion,t._needTransform=!1,t}return __extends(n,i),n.prototype.update=function(t,e){this._needTransform=r.ParticleUtils.calculateTransform(t,this.space,e,this._rotation)},n.prototype.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,n=r.ephemeralPool.v3();n.x=this.x.evaluate(i,t.randomSeed),n.y=this.y.evaluate(i,t.randomSeed),n.z=this.z.evaluate(i,t.randomSeed),this._needTransform&&n.applyQuaternion(this._rotation),n.multiplyScalar(e),t.velocity.add(n)},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.z&&(this.z=t.z),null!=t.space&&(this.space=t.space),null!=t.randomized&&(this.randomized=t.randomized),this},n}(r.ParticleModule);r.ParticleForceOverLifetimeModule=t}(plume||(plume={})),function(o){var t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.separateAxes=!1,t.dampen=0,t.space=o.ParticleSimulationSpace.Local,t}return __extends(n,i),n.prototype.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=o.ephemeralPool.v3(0,0,0);if(this.separateAxes)i.x=r(t.ultimateVelocity.x,this.limitX.evaluate(e,t.randomSeed),this.dampen),i.y=r(t.ultimateVelocity.y,this.limitY.evaluate(e,t.randomSeed),this.dampen),i.z=r(t.ultimateVelocity.z,this.limitZ.evaluate(e,t.randomSeed),this.dampen);else{i.copy(t.ultimateVelocity).normalize();var n=r(t.ultimateVelocity.length(),this.limit.evaluate(e,t.randomSeed),this.dampen);i.multiplyScalar(n)}t.ultimateVelocity.copy(i)},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.limitX&&(this.limitX=t.limitX),null!=t.limitY&&(this.limitY=t.limitY),null!=t.limitZ&&(this.limitZ=t.limitZ),null!=t.separateAxes&&(this.separateAxes=t.separateAxes),null!=t.limit&&(this.limit=t.limit),null!=t.dampen&&(this.dampen=t.dampen),null!=t.space&&(this.space=t.space),this},n}(o.ParticleModule);function r(t,e,i){var n=Math.sign(t),r=Math.abs(t);return e<r&&(r=o.Mathf.lerp(r,e,i)),r*n}o.ParticleLimitVelocityOverLifetimeModule=t}(plume||(plume={})),function(e){var t=function(i){function n(){var t=i.call(this)||this;return t.maxParticles=1,t.simulationSpeed=1,t.duration=5,t.looping=!0,t.prewarm=!1,t.startSize3D=!1,t.startSpeed=e.MinMaxCurve.constant(1),t.startDelay=e.MinMaxCurve.constant(0),t.startLifetime=e.MinMaxCurve.constant(5),t.startColor=e.GradientRange.color(new THREE.Vector4(1,1,1,1)),t.startSize=e.MinMaxCurve.constant(1),t.startRotation=e.MinMaxCurve.constant(0),t.gravityModifier=e.MinMaxCurve.constant(0),t.simulationSpace=e.ParticleSimulationSpace.Local,t}return __extends(n,i),n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),this.maxParticles=t.maxParticles,this.simulationSpeed=t.simulationSpeed,this.duration=t.duration,this.looping=t.looping,null!=t.startDelay&&(this.startDelay=t.startDelay),null!=t.startLifetime&&(this.startLifetime=t.startLifetime),null!=t.startSpeed&&(this.startSpeed=t.startSpeed),null!=t.startColor&&(this.startColor=t.startColor),this.prewarm=t.prewarm,null!=t.startRotation&&(this.startRotation=t.startRotation),null!=t.gravityModifier&&(this.gravityModifier=t.gravityModifier),this.simulationSpace=t.simulationSpace,this.startSize3D=t.startSize3D,null!=t.startSize&&(this.startSize=t.startSize),null!=t.startSizeX&&(this.startSizeX=t.startSizeX),null!=t.startSizeY&&(this.startSizeY=t.startSizeY),null!=t.startSizeZ&&(this.startSizeZ=t.startSizeZ),this},n}(e.ParticleModule);e.ParticleMainModule=t}(plume||(plume={})),function(r){var t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.separateAxes=!1,t.range=[0,1],t}return __extends(n,i),n.prototype.animate=function(t,e){this.separateAxes?(t.rotation.x-=this._evaluateOnAxe(t,t.ultimateVelocity.x,this.x)*e,t.rotation.y-=this._evaluateOnAxe(t,t.ultimateVelocity.y,this.y)*e,t.rotation.z-=this._evaluateOnAxe(t,t.ultimateVelocity.z,this.z)*e):(t.rotation.x-=this._evaluateOnAxe(t,t.ultimateVelocity.x,this.angularVelocity)*e,t.rotation.y-=this._evaluateOnAxe(t,t.ultimateVelocity.y,this.angularVelocity)*e,t.rotation.z-=this._evaluateOnAxe(t,t.ultimateVelocity.z,this.angularVelocity)*e)},n.prototype._evaluateOnAxe=function(t,e,i){var n=r.Mathf.map(e,this.range[0],this.range[1],0,1);return i.evaluate(n,t.randomSeed)},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.angularVelocity&&(this.angularVelocity=t.angularVelocity),null!=t.separateAxes&&(this.separateAxes=t.separateAxes),null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.z&&(this.z=t.z),null!=t.range&&(this.range=t.range),this},n}(r.ParticleModule);r.ParticleRotationBySpeedModule=t}(plume||(plume={})),function(o){var t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.separateAxes=!1,t}return __extends(n,i),n.prototype.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,n=o.ephemeralPool.v3(0,0,0);if(this.separateAxes)n.set(this.x.evaluate(i,t.randomSeed),this.y.evaluate(i,t.randomSeed),this.z.evaluate(i,t.randomSeed));else{var r=this.angularVelocity.evaluate(i,t.randomSeed);n.set(r,r,r)}t.rotation.x-=n.x,t.rotation.y-=n.y,t.rotation.z-=n.z},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.angularVelocity&&(this.angularVelocity=t.angularVelocity),null!=t.separateAxes&&(this.separateAxes=t.separateAxes),null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.z&&(this.z=t.z),this},n}(o.ParticleModule);o.ParticleRotationOverLifetimeModule=t}(plume||(plume={})),function(c){var p=new THREE.Vector3(.5,.5,.5),d=new Array,f=new THREE.Vector3,t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.shapeType=c.ParticleShapeType.Box,t.emitFrom=c.ParticleEmitFrom.Volume,t.position=new THREE.Vector3,t.rotation=new THREE.Vector3,t.scale=new THREE.Vector3(1,1,1),t.alignToDirection=!1,t.randomDirectionAmount=0,t.sphericalDirectionAmount=0,t.randomPositionAmount=0,t.radius=0,t.radiusThickness=1,t.arc=0,t.arcMode=c.ParticleArcMode.Random,t.arcSpread=0,t.radiusMode=c.ParticleArcMode.Random,t.radiusSpread=0,t.angle=0,t.length=0,t.boxThickness=new THREE.Vector3,t._lastTime=0,t._totalAngle=0,t._quat=new THREE.Quaternion,t._mat=new THREE.Matrix4,t}return __extends(n,i),n.prototype.initialize=function(t){i.prototype.initialize.call(this,t),this._lastTime=t.time,this._totalAngle=0,this._quat.setFromEuler(new THREE.Euler(this.rotation.x,this.rotation.y,this.rotation.z)),this._mat.compose(this.position,this._quat,this.scale)},n.prototype.emit=function(t){if(null==this.shapeType)return t.position.set(0,0,0),void t.velocity.copy(c.ParticleUtils.PARTICLE_EMIT_Z_AXIS);switch(this.shapeType){case c.ParticleShapeType.Box:!function(t,e,i,n){switch(t){case c.ParticleEmitFrom.Volume:c.ParticleUtils.randomPointInCube(i,p);break;case c.ParticleEmitFrom.Shell:(d=[]).push(c.Random.inRange(-.5,.5)),d.push(c.Random.inRange(-.5,.5)),d.push(.5*c.Random.sign()),c.Collections.shuffle(d),m(d,e),i.set(d[0],d[1],d[2]);break;case c.ParticleEmitFrom.Edge:d.splice(0,d.length),d.push(c.Random.inRange(-.5,.5)),d.push(.5*c.Random.sign()),d.push(.5*c.Random.sign()),c.Collections.shuffle(d),m(d,e),i.set(d[0],d[1],d[2]);break;default:c.logger.warn(t+" is not supported for box emitter.")}n.copy(c.ParticleUtils.PARTICLE_EMIT_Z_AXIS)}(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case c.ParticleShapeType.Circle:r=this.radius,o=this.radiusThickness,s=this.generateArcAngle(t),a=t.position,l=t.velocity,c.ParticleUtils.randomPointBetweenCircleAtFixedAngle(a,r*(1-o),r,s),l.copy(a),l.normalize();break;case c.ParticleShapeType.Cone:!function(t,e,i,n,r,o,s,a){switch(t){case c.ParticleEmitFrom.Base:c.ParticleUtils.randomPointBetweenCircleAtFixedAngle(s,e*(1-i),e,n),a.x=s.x*Math.sin(r),a.y=s.y*Math.sin(r),a.z=Math.cos(r)*e,s.z=0;break;case c.ParticleEmitFrom.Shell:c.ParticleUtils.fixedAngleUnitVector2(s,n),a.x=s.x*Math.sin(r),a.y=s.y*Math.sin(r),a.z=Math.cos(r),s.multiplyScalar(e),s.z=0;break;case c.ParticleEmitFrom.Volume:c.ParticleUtils.randomPointBetweenCircleAtFixedAngle(s,e*(1-i),e,n),a.x=s.x*Math.sin(r),a.y=s.y*Math.sin(r),a.z=Math.cos(r)*e,a.normalize(),s.z=0,f.copy(a).multiplyScalar(o*Math.random()/-a.z),s.add(f);break;default:console.warn(t+" is not supported for cone emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,this.generateArcAngle(t),this.angle,this.length,t.position,t.velocity);break;case c.ParticleShapeType.Sphere:!function(t,e,i,n,r){switch(t){case c.ParticleEmitFrom.Volume:c.ParticleUtils.randomPointBetweenSphere(n,e*(1-i),e),r.copy(n).normalize();break;case c.ParticleEmitFrom.Shell:c.ParticleUtils.randomUnitVector(n),n.multiplyScalar(e),r.copy(n);break;default:c.logger.warn(t+" is not supported for sphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case c.ParticleShapeType.Hemisphere:!function(t,e,i,n,r){switch(t){case c.ParticleEmitFrom.Volume:c.ParticleUtils.randomPointBetweenSphere(n,e*(1-i),e),0<n.z&&(n.z*=-1),r.copy(n).normalize();break;case c.ParticleEmitFrom.Shell:c.ParticleUtils.randomUnitVector(n),n.multiplyScalar(e),n.z<0&&(n.z*=-1),r.copy(n);break;default:c.logger.warn(t+" is not supported for hemisphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case c.ParticleShapeType.Edge:e=this.generateRadius(t),i=t.position,n=t.velocity,i.set(c.Random.sign()*e,0,0),n.set(0,1,0);break;default:console.warn(this.shapeType+" shapeType is not supported by ShapeModule.")}var e,i,n,r,o,s,a,l;if(0<this.randomPositionAmount&&(t.position.x+=c.Random.inRange(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=c.Random.inRange(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=c.Random.inRange(-this.randomPositionAmount,this.randomPositionAmount)),t.velocity.applyQuaternion(this._quat),t.position.applyMatrix4(this._mat),0<this.sphericalDirectionAmount){var h=c.ephemeralPool.v3().copy(t.position);h.normalize(),t.velocity.lerp(h,this.sphericalDirectionAmount)}if(0<this.randomDirectionAmount){var u=c.ephemeralPool.v3().set(c.Random.inRange(-1,1),c.Random.inRange(-1,1),c.Random.inRange(-1,1));u.normalize(),t.velocity.lerp(u,this.randomDirectionAmount)}this._lastTime=this.particleSystem.time},n.prototype.generateArcAngle=function(t){if(this.arcMode===c.ParticleArcMode.Random)return c.Random.inRange(0,this.arc);var e=this._totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem.time,t.randomSeed)*(this.particleSystem.time-this._lastTime);switch(this._totalAngle=e,0!==this.arcSpread&&(e=Math.floor(e/(this.arc*this.arcSpread))*this.arc*this.arcSpread),this.arcMode){case c.ParticleArcMode.Loop:return c.Mathf.repeat(e,this.arc);case c.ParticleArcMode.PingPong:return c.Mathf.pingPong(e,this.arc)}},n.prototype.generateRadius=function(t){if(this.radiusMode===c.ParticleArcMode.Random)return c.Random.inRange(0,this.radius);var e=this._totalAngle+this.radiusSpeed.evaluate(this.particleSystem.time,t.randomSeed)*(this.particleSystem.time-this._lastTime);switch(this._totalAngle=e,0!==this.radiusSpread&&(e=Math.floor(e/(this.radius*this.radiusSpread))*this.radius*this.radiusSpread),this.radiusMode){case c.ParticleArcMode.Loop:return c.Mathf.repeat(e,this.radius);case c.ParticleArcMode.PingPong:return c.Mathf.pingPong(e,this.radius)}},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.shapeType&&(this.shapeType=t.shapeType),null!=t.emitFrom&&(this.emitFrom=t.emitFrom),null!=t.position&&(this.position=t.position.clone()),null!=t.rotation&&(this.rotation=t.rotation.clone()),null!=t.scale&&(this.scale=t.scale.clone()),null!=t.alignToDirection&&(this.alignToDirection=t.alignToDirection),null!=t.randomDirectionAmount&&(this.randomDirectionAmount=t.randomDirectionAmount),null!=t.sphericalDirectionAmount&&(this.sphericalDirectionAmount=t.sphericalDirectionAmount),null!=t.randomPositionAmount&&(this.randomPositionAmount=t.randomPositionAmount),null!=t.radius&&(this.radius=t.radius),null!=t.radiusThickness&&(this.radiusThickness=t.radiusThickness),null!=t.arc&&(this.arc=t.arc),null!=t.arcMode&&(this.arcMode=t.arcMode),null!=t.arcSpread&&(this.arcSpread=t.arcSpread),null!=t.arcSpeed&&(this.arcSpeed=t.arcSpeed),null!=t.radiusMode&&(this.radiusMode=t.radiusMode),null!=t.radiusSpread&&(this.radiusSpread=t.radiusSpread),null!=t.radiusSpeed&&(this.radiusSpeed=t.radiusSpeed),null!=t.angle&&(this.angle=t.angle),null!=t.length&&(this.length=t.length),null!=t.boxThickness&&(this.boxThickness=t.boxThickness.clone()),this},n}(c.ParticleModule);function m(t,e){0<e.x&&(t[0]+=.5*c.Random.inRange(-e.x,e.x),t[0]=c.Mathf.clamp(t[0],-.5,.5)),0<e.y&&(t[1]+=.5*c.Random.inRange(-e.y,e.y),t[1]=c.Mathf.clamp(t[1],-.5,.5)),0<e.z&&(t[2]+=.5*c.Random.inRange(-e.z,e.z),t[2]=c.Mathf.clamp(t[2],-.5,.5))}c.ParticleShapeModule=t}(plume||(plume={})),function(r){var t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.separateAxes=!1,t}return __extends(n,i),n.prototype.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=r.ephemeralPool.v3(1,1,1);if(this.separateAxes)i.set(this.x.evaluate(e,t.randomSeed),this.y.evaluate(e,t.randomSeed),this.z.evaluate(e,t.randomSeed));else{var n=this.size.evaluate(e,t.randomSeed);i.set(n,n,n)}t.size.copy(t.startSize),t.size.multiply(i)},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.size&&(this.size=t.size),null!=t.separateAxes&&(this.separateAxes=t.separateAxes),null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.z&&(this.z=t.z),this},n}(r.ParticleModule);r.ParticleSizeOverLifetimeModule=t}(plume||(plume={})),function(a){var t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.numTilesX=0,t.numTilesY=0,t.cycleCount=0,t.randomRow=!1,t.rowIndex=0,t}return __extends(n,i),n.prototype.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime;-1==t.startFrameIndex&&(t.startFrameIndex=this.startFrame.evaluate(e,t.randomSeed)/(this.numTilesX*this.numTilesY));var i=t.startFrameIndex;if(this.animation==a.ParticleTextureAnimationAnimationMode.WholeSheet)t.frameIndex=a.Mathf.repeat(this.cycleCount*(this.frameOverTime.evaluate(e,t.randomSeed)+i),1);else if(this.animation==a.ParticleTextureAnimationAnimationMode.SingleRow){var n=1/this.numTilesY,r=a.Mathf.repeat(this.cycleCount*(this.frameOverTime.evaluate(e,t.randomSeed)+i),1);if(this.randomRow){-1==t.startRowIndex&&(t.startRowIndex=Math.floor(Math.random()*this.numTilesY));var o=(s=t.startRowIndex*n)+n;t.frameIndex=a.Mathf.lerp(s,o,r)}else{var s;o=(s=this.rowIndex*n)+n;t.frameIndex=a.Mathf.lerp(s,o,r)}}t.frameIndex=Math.floor(t.frameIndex*this.numTilesX*this.numTilesY)},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.mode&&(this.mode=t.mode),null!=t.numTilesX&&(this.numTilesX=t.numTilesX),null!=t.numTilesY&&(this.numTilesY=t.numTilesY),null!=t.animation&&(this.animation=t.animation),null!=t.frameOverTime&&(this.frameOverTime=t.frameOverTime),null!=t.startFrame&&(this.startFrame=t.startFrame),null!=t.cycleCount&&(this.cycleCount=t.cycleCount),null!=t.randomRow&&(this.randomRow=t.randomRow),null!=t.rowIndex&&(this.rowIndex=t.rowIndex),this},n}(a.ParticleModule);a.ParticleTextureAnimationModule=t}(plume||(plume={})),function(r){var t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.ratio=1,t.minVertexDistance=1,t.worldSpace=!1,t.dieWithParticles=!1,t.sizeAffectsLifetime=!1,t.ribbonCount=1,t.sizeAffectsWidth=!1,t.inheritParticleColor=!1,t._particleCount=0,t._nextEmit=0,t._minVertexDistanceSq=1,t._v1=new THREE.Vector3,t}return __extends(n,i),n.prototype.initialize=function(t){i.prototype.initialize.call(this,t),this._minVertexDistanceSq=this.minVertexDistance*this.minVertexDistance},n.prototype.emit=function(t,e,i){this._particleCount>=this._nextEmit&&(this._nextEmit+=1/this.ratio,t.hasTrail=!0,t.trail=new r.ParticleTrail(this.particleSystem),t.trail.startLifetime=t.startLifetime,t.trail.remainingLifetime=this.lifetime.evaluate(e,i)*t.remainingLifetime,t.trail.vertexLifetime=this.lifetime.evaluate(e,i)*t.remainingLifetime,t.trail.queuePosition.copy(t.position),this._addVertex(t)),this._particleCount++},n.prototype.update=function(t,e){},n.prototype.animate=function(t,e){if(null!=t.trail){var i=!1;if(t.position.distanceToSquared(t.trail.lastVertexAddedPosition)>=this._minVertexDistanceSq)i=!0,this._addVertex(t);else if(1==t.trail.trail.length||2==t.trail.trail.length){t.trail.trail[t.trail.trail.length-1].position.equals(t.position)||(i=!0,this._addVertex(t))}for(var n=!1,r=t.trail.trail.length-1;0<=r;r--){var o=t.trail.trail[r];o.remainingLifetime<=0&&(i?t.trail.remove(r):n?t.trail.remove(r):(n=!0,t.trail.fullyVisible=!1,t.trail.queuePosition.copy(o.position))),o.remainingLifetime-=e}var s=t.trail.trail,a=s.length,l=0;for(r=a-1;0<=r;r--){var h=s[r],u=l/a,c=1-h.remainingLifetime/t.trail.vertexLifetime,p=this.widthOverTrail.evaluate(u,t.randomSeed);h.size.set(p,p,p),this.sizeAffectsWidth&&h.size.multiply(t.size),h.color.set(1,1,1,1),this.inheritParticleColor&&this._multiplyColor(h.color,t.color);var d=this.colorOverLifetime.evaluate(c,t.randomSeed);this._multiplyColor(h.color,d);var f=this.colorOverTrail.evaluate(u,t.randomSeed);this._multiplyColor(h.color,f),l++}}},n.prototype._multiplyColor=function(t,e){t.x=t.x*e.x,t.y=t.y*e.y,t.z=t.z*e.z,t.w=t.w*e.w},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.ratio&&(this.ratio=t.ratio),null!=t.lifetime&&(this.lifetime=t.lifetime),null!=t.minVertexDistance&&(this.minVertexDistance=t.minVertexDistance),null!=t.worldSpace&&(this.worldSpace=t.worldSpace),null!=t.dieWithParticles&&(this.dieWithParticles=t.dieWithParticles),null!=t.sizeAffectsLifetime&&(this.sizeAffectsLifetime=t.sizeAffectsLifetime),null!=t.ribbonCount&&(this.ribbonCount=t.ribbonCount),null!=t.mode&&(this.mode=t.mode),null!=t.textureMode&&(this.textureMode=t.textureMode),null!=t.sizeAffectsWidth&&(this.sizeAffectsWidth=t.sizeAffectsWidth),null!=t.inheritParticleColor&&(this.inheritParticleColor=t.inheritParticleColor),null!=t.colorOverLifetime&&(this.colorOverLifetime=t.colorOverLifetime),null!=t.widthOverTrail&&(this.widthOverTrail=t.widthOverTrail),null!=t.colorOverTrail&&(this.colorOverTrail=t.colorOverTrail),this},n.prototype._addVertex=function(t){var e=t.trail,i=(e.getLastElement(),e.addElement());i.position.copy(t.position),i.remainingLifetime=t.trail.vertexLifetime,t.trail.lastVertexAddedPosition.copy(t.position)},n}(r.ParticleModule);r.ParticleTrailsModule=t}(plume||(plume={})),function(r){var t=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.space=r.ParticleSimulationSpace.Local,t._rotation=new THREE.Quaternion,t._needTransform=!1,t}return __extends(n,i),n.prototype.update=function(t,e){this._needTransform=r.ParticleUtils.calculateTransform(t,this.space,e,this._rotation)},n.prototype.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=r.ephemeralPool.v3();i.x=this.x.evaluate(e,t.randomSeed),i.y=this.y.evaluate(e,t.randomSeed),i.z=this.z.evaluate(e,t.randomSeed),this._needTransform&&i.applyQuaternion(this._rotation),t.animatedVelocity.add(i),t.ultimateVelocity.copy(t.velocity).add(t.animatedVelocity),t.ultimateVelocity.multiplyScalar(this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,t.randomSeed))},n.prototype.clone=function(t){var e=new n;return e.copy(this,t),e},n.prototype.copy=function(t,e){return i.prototype.copy.call(this,t,e),null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.z&&(this.z=t.z),null!=t.speedModifier&&(this.speedModifier=t.speedModifier),null!=t.space&&(this.space=t.space),this},n}(r.ParticleModule);r.ParticleVelocityOverLifetimeModule=t}(plume||(plume={})),function(s){var t=function(o){function t(t){var e=o.call(this)||this,i=(e.renderer=t).particleSystem,n=i.main.maxParticles;t.renderMode==s.ParticleRenderMode.Mesh?e.geometry=(new THREE.InstancedBufferGeometry).copy(t.mesh.geometry):(e.geometry=(new THREE.InstancedBufferGeometry).copy(new THREE.PlaneBufferGeometry(1,1)),null!=e.renderer.texture&&(e.renderer.texture.flipY=!0));var r=n;return e._positionAtt=new THREE.InstancedBufferAttribute(new Float32Array(3*r),3,!1,1),e._scaleAtt=new THREE.InstancedBufferAttribute(new Float32Array(3*r),3,!1,1),e._rotationAtt=new THREE.InstancedBufferAttribute(new Float32Array(4*r),4,!1,1),e._colorAtt=new THREE.InstancedBufferAttribute(new Float32Array(4*r),4,!1,1),e.geometry.addAttribute("instancePosition",e._positionAtt),e.geometry.addAttribute("instanceScale",e._scaleAtt),e.geometry.addAttribute("instanceRotation",e._rotationAtt),e.geometry.addAttribute("instanceColor",e._colorAtt),null!=i.textureAnimation&&(e._frameIndexAtt=new THREE.InstancedBufferAttribute(new Float32Array(1*r),1,!1,1),e.geometry.addAttribute("instanceFrameIndex",e._frameIndexAtt)),i.renderer.renderMode==s.ParticleRenderMode.StrechedBillboard&&(e._velocityAtt=new THREE.InstancedBufferAttribute(new Float32Array(3*r),3,!1,1),e.geometry.addAttribute("instanceVelocity",e._velocityAtt)),t.renderMode==s.ParticleRenderMode.Mesh?e.createMeshMaterial():e.createBillboardMaterial(),e}return __extends(t,o),t.prototype.getVertexFlag=function(){return{position:!0,rotation:!0,scale:!0,color:!0,animation:null!=this._frameIndexAtt,velocity:null!=this._velocityAtt}},t.prototype.createBillboardMaterial=function(){var t=this.renderer.particleSystem,e={USE_WORLD_SPACE:0,USE_SPRITESHEET:0,USE_MAIN_TEX:0,USE_BILLBOARD:0,USE_HORIZONTAL_BILLBOARD:0,USE_VERTICAL_BILLBOARD:0,USE_STRETCHED_BILLBOARD:0},i={};i.billboardRotation={value:this.renderer.billboardRotation},this.renderer.renderMode==s.ParticleRenderMode.Billboard?e.USE_BILLBOARD=1:this.renderer.renderMode==s.ParticleRenderMode.HorizontalBillboard?e.USE_HORIZONTAL_BILLBOARD=1:this.renderer.renderMode==s.ParticleRenderMode.VerticalBillboard?e.USE_VERTICAL_BILLBOARD=1:this.renderer.renderMode==s.ParticleRenderMode.StrechedBillboard&&(e.USE_STRETCHED_BILLBOARD=1,i.velocityScale={value:this.renderer.velocityScale},i.lengthScale={value:this.renderer.lengthScale}),null!=this.renderer.texture&&(e.USE_MAIN_TEX=1,i.mainTexture={value:this.renderer.texture}),t.main.simulationSpace==s.ParticleSimulationSpace.World&&(e.USE_WORLD_SPACE=1);var n=this.renderer.particleSystem.textureAnimation;null!=n&&(e.USE_SPRITESHEET=1,i.frameTile={value:new THREE.Vector2(n.numTilesX,n.numTilesY)}),this.material=new THREE.RawShaderMaterial({transparent:!0,depthWrite:!1,uniforms:i,side:THREE.DoubleSide,blending:this.renderer.blending,vertexShader:s.particle.shaders.billboard_vertex,fragmentShader:s.particle.shaders.billboard_fragment,defines:e})},t.prototype.createMeshMaterial=function(){var t=this.renderer.particleSystem,e={USE_WORLD_SPACE:0,USE_MAIN_TEX:0},i={};null!=this.renderer.texture&&(e.USE_MAIN_TEX=1,i.mainTexture={value:this.renderer.texture}),t.main.simulationSpace==s.ParticleSimulationSpace.World&&(e.USE_WORLD_SPACE=1),this.material=new THREE.RawShaderMaterial({transparent:!0,depthWrite:!1,uniforms:i,side:THREE.DoubleSide,blending:this.renderer.blending,vertexShader:s.particle.shaders.mesh_vertex,fragmentShader:s.particle.shaders.mesh_fragment,defines:e})},t.prototype.setVertexData=function(t,e,i){i.position&&this._positionAtt.setXYZ(t,e.position.x,e.position.y,e.position.z),i.rotation&&this._rotationAtt.setXYZW(t,e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),i.scale&&this._scaleAtt.setXYZ(t,e.scale.x,e.scale.y,e.scale.z),i.color&&this._colorAtt.setXYZW(t,e.color.x,e.color.y,e.color.z,e.color.w),i.animation&&this._frameIndexAtt.setX(t,e.frameIndex),i.velocity&&this._velocityAtt.setXYZ(t,e.velocity.x,e.velocity.y,e.velocity.z)},t.prototype.render=function(t,e){this.geometry.maxInstancedCount=e,t.position&&(this._positionAtt.count=e,this._positionAtt.updateRange.offset=0,this._positionAtt.updateRange.count=-1,this._positionAtt.needsUpdate=!0),t.rotation&&(this._rotationAtt.count=e,this._rotationAtt.updateRange.offset=0,this._rotationAtt.updateRange.count=-1,this._rotationAtt.needsUpdate=!0),t.scale&&(this._scaleAtt.count=e,this._scaleAtt.updateRange.offset=0,this._scaleAtt.updateRange.count=-1,this._scaleAtt.needsUpdate=!0),t.color&&(this._colorAtt.count=e,this._colorAtt.updateRange.offset=0,this._colorAtt.updateRange.count=-1,this._colorAtt.needsUpdate=!0),t.animation&&(this._frameIndexAtt.count=e,this._frameIndexAtt.updateRange.offset=0,this._frameIndexAtt.updateRange.count=-1,this._frameIndexAtt.needsUpdate=!0),t.velocity&&(this._velocityAtt.count=e,this._velocityAtt.updateRange.offset=0,this._velocityAtt.updateRange.count=-1,this._velocityAtt.needsUpdate=!0)},t.prototype.clear=function(){this.geometry.maxInstancedCount=0,null!=this._positionAtt&&(this._positionAtt.count=0,this._positionAtt.needsUpdate=!0),null!=this._scaleAtt&&(this._scaleAtt.count=0,this._scaleAtt.needsUpdate=!0),null!=this._rotationAtt&&(this._rotationAtt.count=0,this._rotationAtt.needsUpdate=!0),null!=this._colorAtt&&(this._colorAtt.count=0,this._colorAtt.needsUpdate=!0),null!=this._frameIndexAtt&&(this._frameIndexAtt.count=0,this._frameIndexAtt.needsUpdate=!0),null!=this._velocityAtt&&(this._velocityAtt.count=0,this._velocityAtt.needsUpdate=!0)},t}(THREE.Mesh);s.ParticleContainer=t}(plume||(plume={})),function(b){var t=function(){function i(){this.renderMode=b.ParticleRenderMode.Billboard,this.blending=THREE.NormalBlending,this.trailBlending=THREE.NormalBlending,this.lengthScale=0,this.velocityScale=0,this.billboardRotation=new THREE.Quaternion,this._vertexDataTmp={position:new THREE.Vector3,rotation:new THREE.Quaternion,scale:new THREE.Vector3,color:new THREE.Vector4,frameIndex:0,velocity:new THREE.Vector3}}return i.prototype.initialize=function(t){this.particleSystem=t,this.model=new b.ParticleContainer(this),this.particleSystem.add(this.model),this._modelVertexDataFlag=this.model.getVertexFlag(),null!=this.particleSystem.trails&&(this.trail=new b.ParticleTrailContainer(this),this.particleSystem.add(this.trail),this._trailVertexDataFlag=this.trail.getVertexFlag()),this.renderMode==b.ParticleRenderMode.HorizontalBillboard&&(this._rotationToUp=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2))},i.prototype.destroy=function(){null!=this.model&&(this.model.geometry.dispose(),this.model.material.dispose(),null!=this.texture&&this.texture.dispose(),null!=this.trail&&(this.trail.geometry.dispose(),this.trail.material.dispose(),null!=this.trailTexture&&this.trailTexture.dispose()))},i.prototype.updateRenderData=function(){var t=this.particleSystem.getParticles();if(this.renderMode==b.ParticleRenderMode.Mesh);else if(this.renderMode==b.ParticleRenderMode.Billboard){var e=this._computeBillboardRotation(!1);this.billboardRotation.copy(e)}else if(this.renderMode==b.ParticleRenderMode.HorizontalBillboard){e=b.ephemeralPool.q();b.Transforms.setWorldQuaternion(this.model,this._rotationToUp,e),this.billboardRotation.copy(e)}else if(this.renderMode==b.ParticleRenderMode.VerticalBillboard){e=this._computeBillboardRotation(!0);this.billboardRotation.copy(e)}else{e=this._computeBillboardRotation(!1);this.billboardRotation.copy(e)}for(var i=0;i<t.length;i++){var n=t.data[i];this._modelVertexDataFlag.position&&this._vertexDataTmp.position.copy(n.position),this._modelVertexDataFlag.scale&&this._vertexDataTmp.scale.copy(n.size),this._modelVertexDataFlag.rotation&&(this.renderMode==b.ParticleRenderMode.Billboard&&(n.rotation.x=0,n.rotation.y=0),this._vertexDataTmp.rotation.setFromEuler(n.rotation)),this._modelVertexDataFlag.color&&this._vertexDataTmp.color.copy(n.color),this._modelVertexDataFlag.animation&&(this._vertexDataTmp.frameIndex=n.frameIndex),this._modelVertexDataFlag.velocity&&this._vertexDataTmp.velocity.copy(n.ultimateVelocity),this.model.setVertexData(i,this._vertexDataTmp,this._modelVertexDataFlag)}if(this.model.render(this._modelVertexDataFlag,t.length),null!=this.trail){this.trail.prepareDraw();var r=b.ephemeralPool.v3(),o=b.ephemeralPool.v3(),s=b.Game.get().engine.camera.getWorldPosition(b.ephemeralPool.v3());b.Transforms.setWorldPosition(this.trail,s,r);var a=b.ephemeralPool.v3(),l=0,h=0,u=0;for(i=0;i<t.length;i++){if(null!=(n=t.data[i]).trail){var c=n.trail.trail;if(!(c.length<=2)){var p=c[c.length-1],d=n.position.distanceTo(p.position);if(!n.trail.fullyVisible){var f=b.Mathf.clamp(this.particleSystem.trails.minVertexDistance-d,.001,this.particleSystem.trails.minVertexDistance),m=c[0],y=c[1],g=b.ephemeralPool.v3().copy(m.position).sub(y.position).normalize().multiplyScalar(f);m.position.copy(y.position).add(g)}u=l+3;for(var v=c.length-1;0<=v;v--){var _=c[v],x=v==c.length-1?n.position:_.position,S=0==v?n.trail.queuePosition:c[v-1].position;if(_.size.z=0,_.directionToNext.copy(S).sub(_.position),a.copy(r).sub(_.position),o.crossVectors(_.directionToNext,a).normalize(),o.multiplyScalar(.5).multiplyScalar(_.size.x),this._vertexDataTmp.position.copy(x),this._vertexDataTmp.position.add(o),this._vertexDataTmp.color.copy(_.color),this.trail.setVertexData(l,this._vertexDataTmp,this._trailVertexDataFlag),l++,this._vertexDataTmp.position.copy(x),this._vertexDataTmp.position.sub(o),this._vertexDataTmp.color.copy(_.color),this.trail.setVertexData(l,this._vertexDataTmp,this._trailVertexDataFlag),u<=++l){var w=l-3-1;this.trail.setIndices(h,w+0,w+2,w+1),this.trail.setIndices(h+3,w+2,w+3,w+1),h+=6}}}}}this.trail.render(this._trailVertexDataFlag,l)}},i.prototype._computeBillboardRotation=function(t){var e=b.ephemeralPool.q(),i=b.Game.get().engine.camera,n=i.getWorldQuaternion(b.ephemeralPool.q()),r=this.model.getWorldPosition(b.ephemeralPool.v3()),o=i.getWorldPosition(b.ephemeralPool.v3()),s=b.ephemeralPool.v3(0,1,0);s.applyQuaternion(n),t&&(r.y=o.y);var a=(new THREE.Matrix4).lookAt(o,r,s),l=(new THREE.Quaternion).setFromRotationMatrix(a);return b.Transforms.setWorldQuaternion(this.model,l,e),e},i.prototype.clone=function(t){var e=new i;return e.copy(this,t),e},i.prototype.copy=function(t,e){return null!=t.renderMode&&(this.renderMode=t.renderMode),null!=t.blending&&(this.blending=t.blending),null!=t.texture&&(this.texture=t.texture),null!=t.trailBlending&&(this.trailBlending=t.trailBlending),null!=t.trailTexture&&(this.trailTexture=t.trailTexture),null!=t.material&&(this.material=t.material),null!=t.mesh&&(this.mesh=t.mesh),null!=t.lengthScale&&(this.lengthScale=t.lengthScale),null!=t.velocityScale&&(this.velocityScale=t.velocityScale),this},i}();b.ParticleSystemRenderer=t}(plume||(plume={})),function(n){var t=function(r){function t(t){var e=r.call(this)||this,i=(e.renderer=t).particleSystem.main.maxParticles;e.geometry=new THREE.BufferGeometry,null!=e.renderer.trailTexture&&(e.renderer.trailTexture.flipY=!0);var n=100*i;return e._indicesArray=new Uint16Array(n),e._indicesAtt=new THREE.BufferAttribute(e._indicesArray,1,!1).setDynamic(!0),e._positionAtt=new THREE.BufferAttribute(new Float32Array(3*n),3,!1).setDynamic(!0),e._colorAtt=new THREE.BufferAttribute(new Float32Array(4*n),4,!1).setDynamic(!0),e.geometry.setIndex(e._indicesAtt),e.geometry.addAttribute("position",e._positionAtt),e.geometry.addAttribute("color",e._colorAtt),e.createMaterial(),e}return __extends(t,r),t.prototype.getVertexFlag=function(){return{position:!0,rotation:!1,scale:!1,color:!1,animation:!1,velocity:!1}},t.prototype.createMaterial=function(){var t=this.renderer.particleSystem,e={USE_WORLD_SPACE:0,USE_MAIN_TEX:0},i={};i.billboardRotation={value:this.renderer.billboardRotation},null!=this.renderer.trailTexture&&(e.USE_MAIN_TEX=1,i.mainTexture={value:this.renderer.trailTexture}),t.main.simulationSpace==n.ParticleSimulationSpace.World&&(e.USE_WORLD_SPACE=1),this.material=new THREE.RawShaderMaterial({transparent:!0,depthWrite:!1,uniforms:i,side:THREE.DoubleSide,blending:this.renderer.trailBlending,vertexShader:n.particle.shaders.trail_vertex,fragmentShader:n.particle.shaders.trail_fragment,defines:e})},t.prototype.prepareDraw=function(){this._indicesArray.fill(0)},t.prototype.setVertexData=function(t,e,i){this._positionAtt.setXYZ(t,e.position.x,e.position.y,e.position.z),this._colorAtt.setXYZW(t,e.color.x,e.color.y,e.color.z,e.color.w)},t.prototype.setIndices=function(t,e,i,n){this._indicesAtt.setXYZ(t,e,i,n)},t.prototype.render=function(t,e){this._positionAtt.count=e,this._positionAtt.updateRange.offset=0,this._positionAtt.updateRange.count=-1,this._positionAtt.needsUpdate=!0,this._colorAtt.count=e,this._colorAtt.updateRange.offset=0,this._colorAtt.updateRange.count=-1,this._colorAtt.needsUpdate=!0;var i=3*(e-2);this._indicesAtt.count=i,this._indicesAtt.updateRange.offset=0,this._indicesAtt.updateRange.count=-1,this._indicesAtt.needsUpdate=!0},t.prototype.clear=function(){null!=this._positionAtt&&(this._positionAtt.count=0,this._positionAtt.updateRange.offset=0,this._positionAtt.updateRange.count=-1,this._positionAtt.needsUpdate=!0),null!=this._colorAtt&&(this._colorAtt.count=0,this._colorAtt.updateRange.offset=0,this._colorAtt.updateRange.count=-1,this._colorAtt.needsUpdate=!0),this._indicesAtt.count=0,this._indicesAtt.updateRange.offset=0,this._indicesAtt.updateRange.count=-1,this._indicesAtt.needsUpdate=!0},t}(THREE.Mesh);n.ParticleTrailContainer=t}(plume||(plume={}));var gs;__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(n){var t=function(i){function t(t){var e=i.call(this)||this;return e.type="TrailMaterial",e.uniforms.minID={value:null},e.uniforms.maxID={value:null},e.uniforms.tailSharp={value:null},e.uniforms.headColor={value:new THREE.Vector4},e.uniforms.tailColor={value:new THREE.Vector4},e.vertexShader=n.trail.shaders.base_vertex,e.fragmentShader=n.trail.shaders.base_fragment,e.transparent=!0,e.alphaTest=.5,e.blending=THREE.CustomBlending,e.blendSrc=THREE.SrcAlphaFactor,e.blendDst=THREE.OneMinusSrcAlphaFactor,e.blendEquation=THREE.AddEquation,e.depthTest=!0,e.depthWrite=!1,e.side=THREE.DoubleSide,e.setValues(t),e}return __extends(t,i),Object.defineProperty(t.prototype,"minID",{get:function(){return this.uniforms.minID.value},set:function(t){this.uniforms.minID.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxID",{get:function(){return this.uniforms.maxID.value},set:function(t){this.uniforms.maxID.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tailSharp",{get:function(){return this.uniforms.tailSharp.value},set:function(t){this.uniforms.tailSharp.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headColor",{get:function(){return this.uniforms.headColor.value},set:function(t){this.uniforms.headColor.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tailColor",{get:function(){return this.uniforms.tailColor.value},set:function(t){this.uniforms.tailColor.value=t},enumerable:!0,configurable:!0}),t}(THREE.RawShaderMaterial);n.TrailMaterial=t}(plume||(plume={})),function(e){var t=function(){function c(t){this._active=!1,this._geometry=null,this._mesh=null,this._nodeCenters=null,this._currentNodeCenter=null,this._nodeIDs=null,this._currentLength=0,this._currentEnd=0,this._currentNodeID=0,this.autoUpdate=!0,this._tempPosition=new THREE.Vector3,this._tempMatrix4=new THREE.Matrix4,this._scene=null!=t?t:e.Game.get().engine.scene,this.material=c._getOrCreateSharedMaterial().clone()}return c._getOrCreateSharedMaterial=function(){return null!=this._sharedMaterial||(this._sharedMaterial=new e.TrailMaterial),this._sharedMaterial},c.prototype.initialize=function(t,e,i,n){var r=this;this.deactivate(),this._destroyMesh(),this.material.minID=0,this.material.maxID=0,this.material.tailSharp=e?1:0,this._length=0<t?t+1:0,this._targetObject=n,this._nodeIDs=[],this._nodeCenters=[];for(var o=0;o<this._length;o++)this._nodeIDs[o]=-1,this._nodeCenters[o]=new THREE.Vector3;this._initializeLocalHeadGeometry(i),this._initializeGeometry(),this._initializeMesh(),this._reset(),n.addEventListener("removed",function(t){r.deactivate()})},c.prototype.deactivate=function(){this._active&&(this._targetObject.remove(this._mesh),this._active=!1),this.autoUpdate&&e.Game.get().removeUpdatable(this)},c.prototype.activate=function(){this._active||(this._targetObject.add(this._mesh),this._active=!0),this.autoUpdate&&e.Game.get().addUpdatable(this)},c.prototype.update=function(){this._active&&this._advance()},c.prototype._initializeLocalHeadGeometry=function(t){var e=t/2;this._localHeadGeometry=[],this._localHeadGeometry.push(new THREE.Vector3(-e,0,0)),this._localHeadGeometry.push(new THREE.Vector3(e,0,0)),this._verticesPerNode=2,this._facesPerNode=2*(this._verticesPerNode-1),this._faceIndicesPerNode=3*this._facesPerNode},c.prototype._initializeGeometry=function(){this._vertexCount=this._length*this._verticesPerNode,this._faceCount=this._length*this._facesPerNode;var t=new THREE.BufferGeometry,e=new Float32Array(this._vertexCount),i=new Float32Array(this._vertexCount*this._verticesPerNode),n=new Float32Array(this._vertexCount*c._PositionComponentCount),r=new Float32Array(this._vertexCount*c._PositionComponentCount),o=new Uint32Array(this._faceCount*c._IndicesPerFace),s=new THREE.BufferAttribute(e,1);s.setDynamic(!0),t.addAttribute("nodeID",s);var a=new THREE.BufferAttribute(i,1);a.setDynamic(!0),t.addAttribute("nodeVertexID",a);var l=new THREE.BufferAttribute(r,c._PositionComponentCount);l.setDynamic(!0),t.addAttribute("nodeCenter",l);var h=new THREE.BufferAttribute(n,c._PositionComponentCount);h.setDynamic(!0),t.addAttribute("position",h);var u=new THREE.BufferAttribute(o,1);u.setDynamic(!0),t.setIndex(u),this._geometry=t},c.prototype._initializeMesh=function(){this._mesh=new THREE.Mesh(this._geometry,this.material),this._mesh.name="Trail_"+this._targetObject.name},c.prototype._reset=function(){this._currentLength=0,this._currentEnd=-1,this._currentNodeCenter=null,this._currentNodeID=0,this._zeroIndices(),this._zeroVertices(),this._formInitialFaces(),this._geometry.setDrawRange(0,0)},c.prototype._zeroIndices=function(){for(var t=this._geometry.getIndex(),e=0;e<this._faceCount;e++)t.setXYZ(e,0,0,0);t.needsUpdate=!0,t.updateRange.count=-1},c.prototype._zeroVertices=function(){for(var t=this._geometry.getAttribute("position"),e=0;e<this._vertexCount;e++)t.setXYZ(e,0,0,0);t.needsUpdate=!0,t.updateRange.count=-1},c.prototype._formInitialFaces=function(){for(var t=this._geometry.getIndex(),e=0;e<this._length-2;e++)this._connectNodes(e,e+1);t.needsUpdate=!0,t.updateRange.count=-1},c.prototype._destroyMesh=function(){this._mesh&&(this._scene.remove(this._mesh),this._mesh=null)},c.prototype._updateUniforms=function(){this._currentLength<this._length?this.material.uniforms.minID.value=0:this.material.uniforms.minID.value=this._currentNodeID-this._length,this.material.uniforms.maxID.value=this._currentNodeID},c.prototype._advance=function(){this._tempMatrix4.copy(this._targetObject.matrixWorld),this._advanceWithTransform(this._tempMatrix4),this._updateUniforms()},c.prototype._advanceWithTransform=function(t){this._advanceGeometry(t)},c.prototype._advanceGeometry=function(t){var e=this._currentEnd+1>=this._length?0:this._currentEnd+1;if(this._updateNodePositionsFromTransformMatrix(e,t),1<=this._currentLength&&(this._connectNodes(this._currentEnd,e),this._currentLength>=this._length)){var i=this._currentEnd+1>=this._length?0:this._currentEnd+1;this._disconnectNodes(i)}this._currentLength<this._length&&this._currentLength++,this._currentEnd++,this._currentEnd>=this._length&&(this._currentEnd=0),1<=this._currentLength&&(this._currentLength<this._length?this._geometry.setDrawRange(0,(this._currentLength-1)*this._faceIndicesPerNode):this._geometry.setDrawRange(0,this._currentLength*this._faceIndicesPerNode)),this._updateNodeID(this._currentEnd,this._currentNodeID),this._currentNodeID++},c.prototype._updateNodeID=function(t,e){this._nodeIDs[t]=e;for(var i=this._geometry.getAttribute("nodeID"),n=this._geometry.getAttribute("nodeVertexID"),r=0;r<this._verticesPerNode;r++){var o=t*this._verticesPerNode+r;i.setX(o,e),n.setX(o,r)}i.needsUpdate=!0,n.needsUpdate=!0,i.updateRange.offset=t*this._verticesPerNode,i.updateRange.count=this._verticesPerNode,n.updateRange.offset=t*this._verticesPerNode,n.updateRange.count=this._verticesPerNode},c.prototype._updateNodeCenter=function(t,e){this._currentNodeCenter=this._nodeCenters[t],this._currentNodeCenter.copy(e);for(var i=this._geometry.getAttribute("nodeCenter"),n=0;n<this._verticesPerNode;n++){var r=t*this._verticesPerNode+n;i.setXYZ(r,e.x,e.y,e.z)}i.needsUpdate=!0,i.updateRange.offset=t*this._verticesPerNode*c._PositionComponentCount,i.updateRange.count=this._verticesPerNode*c._PositionComponentCount},c.prototype._updateNodePositionsFromTransformMatrix=function(t,e){this._tempPosition.set(0,0,0),this._tempPosition.applyMatrix4(e),this._updateNodeCenter(t,this._tempPosition);for(var i=this._geometry.getAttribute("position"),n=this._tempPosition,r=0;r<this._localHeadGeometry.length;r++){n.copy(this._localHeadGeometry[r]),n.applyMatrix4(e);var o=this._verticesPerNode*t+r;i.setXYZ(o,n.x,n.y,n.z)}i.needsUpdate=!0,i.updateRange.offset=t*this._verticesPerNode*c._PositionComponentCount,i.updateRange.count=this._verticesPerNode*c._PositionComponentCount},c.prototype._connectNodes=function(t,e){for(var i=this._geometry.getIndex(),n=0;n<this._localHeadGeometry.length-1;n++){var r=this._verticesPerNode*t+n,o=this._verticesPerNode*e+n,s=(t*this._facesPerNode+n*c._FacesPerQuad)*c._IndicesPerFace;i.setXYZ(s,r,o,r+1),i.setXYZ(s+3,o,o+1,r+1)}i.needsUpdate=!0,i.updateRange.count=-1},c.prototype._disconnectNodes=function(t){for(var e=this._geometry.getIndex(),i=0;i<this._localHeadGeometry.length-1;i++){var n=(t*this._facesPerNode+i*c._FacesPerQuad)*c._IndicesPerFace;e.setXYZ(n,0,0,0),e.setXYZ(n+3,0,0,0)}e.needsUpdate=!0,e.updateRange.count=-1},c._PositionComponentCount=3,c._IndicesPerFace=3,c._FacesPerQuad=2,c}();e.TrailRenderer=t}(plume||(plume={})),function(f){var m=new THREE.Vector3,i=function(){function t(){}return t.pop=function(){return 0==this._stack.length?new e:this._stack.pop()},t.release=function(t){this._stack.push(t)},t._stack=new Array,t}(),t=function(){function t(t){this.length=10,this.minVertexDistance=.2,this.autoUpdate=!0,this._randomSeed=f.Random.get(),this._active=!1,this._minVertexDistanceSq=1,this._tmpPosition=new THREE.Vector3,this._tmpColor=new THREE.Vector4,this.scene=null!=t?t:f.Engine.get().scene}return t.prototype.initialize=function(){var e=this;null!=this.mesh&&(this.mesh.destroy(),this.scene.remove(this.mesh)),this._minVertexDistanceSq=this.minVertexDistance*this.minVertexDistance,this._trailData=new r,this.mesh=new n(this),this.scene.add(this.mesh),this.target.addEventListener("removed",function(t){e.deactivate()})},t.prototype.destroy=function(){null!=this.mesh&&(this.mesh.destroy(),this.scene.remove(this.mesh))},t.prototype.activate=function(){this._active||(this._active=!0,this.scene.add(this.mesh),this.autoUpdate&&f.Game.get().addUpdatable(this))},t.prototype.deactivate=function(){this._active&&(this._active=!1,this.scene.remove(this.mesh),this.autoUpdate&&f.Game.get().removeUpdatable(this))},t.prototype.setColor=function(t,e,i,n){this.colorOverTrail=f.GradientRange.gradient((new f.Gradient).setKeys([new f.GradientColorKey(t,0),new f.GradientColorKey(i,1)],[new f.GradientAlphaKey(e,0),new f.GradientAlphaKey(n,1)]))},t.prototype.setWidth=function(t,e){var i=new f.AnimationCurve([(new f.Keyframe).setTime(0).setValue(t),(new f.Keyframe).setTime(1).setValue(e)]);this.widthOverTrail=f.MinMaxCurve.curve(i)},t.prototype.update=function(){if(this._active){var t=this.target.getWorldPosition(m);0==this._trailData.vertex.length&&(this._trailData.queuePosition.copy(t),this._addVertex(t));for(var e=0,i=-1,n=this._trailData.vertex.length-2;0<=n;n--){var r=this._trailData.vertex[n+1],o=this._trailData.vertex[n];if((e+=r.position.distanceTo(o.position))>this.length){i=n;break}}if(0<=i){for(n=i;0<=n;n--)this._trailData.remove(n);var s=this._trailData.vertex[0];this._trailData.queuePosition.copy(s.position)}if(t.distanceToSquared(this._trailData.lastVertexAddedPosition)>=this._minVertexDistanceSq)this._addVertex(t);else if(1==this._trailData.vertex.length||2==this._trailData.vertex.length){this._trailData.vertex[this._trailData.vertex.length-1].position.equals(t)||this._addVertex(t)}var a=this._trailData.vertex,l=a.length,h=0;for(n=l-1;0<=n;n--){var u=a[n],c=h/l,p=this.widthOverTrail.evaluate(c,this._randomSeed);u.size.set(p,p,p),isNaN(p),u.color.set(1,1,1,1);var d=this.colorOverTrail.evaluate(c,this._randomSeed);u.color.x=u.color.x*d.x,u.color.y=u.color.y*d.y,u.color.z=u.color.z*d.z,u.color.w=u.color.w*d.w,h++}this._render(t)}},t.prototype._addVertex=function(t){this._trailData.addElement().position.copy(t),this._trailData.lastVertexAddedPosition.copy(t)},t.prototype._render=function(t){if(!(this._trailData.vertex.length<=2)){this.mesh.prepareDraw();var e=f.ephemeralPool.v3(),i=f.ephemeralPool.v3(),n=f.Game.get().engine.camera.getWorldPosition(f.ephemeralPool.v3());f.Transforms.setWorldPosition(this.mesh,n,e);var r,o=f.ephemeralPool.v3(),s=0,a=0,l=this._trailData.vertex;r=s+3;for(var h=l.length-1;0<=h;h--){var u=l[h],c=h==l.length-1?t:u.position,p=0==h?this._trailData.queuePosition:l[h-1].position;if(u.size.z=0,u.directionToNext.copy(p).sub(u.position),o.copy(e).sub(u.position),i.crossVectors(u.directionToNext,o).normalize(),i.multiplyScalar(.5).multiplyScalar(u.size.x),this._tmpPosition.copy(c),this._tmpPosition.add(i),this._tmpColor.copy(u.color),this.mesh.setPositionAt(s,this._tmpPosition),this.mesh.setColorAt(s,this._tmpColor),s++,this._tmpPosition.copy(c),this._tmpPosition.sub(i),this._tmpColor.copy(u.color),this.mesh.setPositionAt(s,this._tmpPosition),this.mesh.setColorAt(s,this._tmpColor),r<=++s){var d=s-3-1;this.mesh.setIndices(a,d+0,d+2,d+1),this.mesh.setIndices(a+3,d+2,d+3,d+1),a+=6}}this.mesh.render(s)}},t}();f.TrailRenderer2=t;var n=function(i){function t(t){var e=i.call(this)||this;return e.renderer=t,e._lastIndicesCount=0,e._rebuild(),e}return __extends(t,i),t.prototype._rebuild=function(){var t=this.renderer.length/this.renderer.minVertexDistance*2;this.geometry=new THREE.BufferGeometry,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this._indicesArray=new Uint16Array(3*(t-2)),this._indicesAtt=new THREE.BufferAttribute(this._indicesArray,1,!1).setDynamic(!0),this._positionAtt=new THREE.BufferAttribute(new Float32Array(3*t),3,!1).setDynamic(!0),this._colorAtt=new THREE.BufferAttribute(new Float32Array(4*t),4,!1).setDynamic(!0),this.geometry.setIndex(this._indicesAtt),this.geometry.addAttribute("position",this._positionAtt),this.geometry.addAttribute("color",this._colorAtt);this.material=new THREE.RawShaderMaterial({transparent:!0,depthWrite:!1,uniforms:{},side:THREE.DoubleSide,blending:THREE.NormalBlending,vertexShader:f.trail.shaders.trail2_vertex,fragmentShader:f.trail.shaders.trail2_fragment,defines:{}})},t.prototype.prepareDraw=function(){},t.prototype.setPositionAt=function(t,e){this._positionAtt.setXYZ(t,e.x,e.y,e.z)},t.prototype.setColorAt=function(t,e){this._colorAtt.setXYZW(t,e.x,e.y,e.z,e.w)},t.prototype.setIndices=function(t,e,i,n){this._indicesAtt.setXYZ(t,e,i,n)},t.prototype.render=function(t){var e=3*(t-2);e<this._lastIndicesCount&&this._indicesArray.fill(0,e);var i=this.geometry;this._positionAtt.count=t,this._positionAtt.updateRange.offset=0,this._positionAtt.updateRange.count=-1,this._positionAtt.needsUpdate=!0,this._colorAtt.count=t,this._colorAtt.updateRange.offset=0,this._colorAtt.updateRange.count=-1,this._colorAtt.needsUpdate=!0,this._indicesAtt.count=e,this._indicesAtt.updateRange.offset=0,this._indicesAtt.updateRange.count=-1,this._indicesAtt.needsUpdate=!0,this._lastIndicesCount=e,i.computeBoundingSphere()},t.prototype.clear=function(){null!=this._positionAtt&&(this._positionAtt.count=0,this._positionAtt.updateRange.offset=0,this._positionAtt.updateRange.count=-1,this._positionAtt.needsUpdate=!0),null!=this._colorAtt&&(this._colorAtt.count=0,this._colorAtt.updateRange.offset=0,this._colorAtt.updateRange.count=-1,this._colorAtt.needsUpdate=!0),this._indicesAtt.count=0,this._indicesAtt.updateRange.offset=0,this._indicesAtt.updateRange.count=-1,this._indicesAtt.needsUpdate=!0},t.prototype.destroy=function(){this.clear()},t}(THREE.Mesh);f.TrailRenderer2Mesh=n;var e=function(){function t(){this.position=new THREE.Vector3,this.directionToNext=new THREE.Vector3,this.size=new THREE.Vector3,this.color=new THREE.Vector4}return t.prototype.reset=function(){this.position.set(0,0,0),this.size.set(1,1,1),this.color.set(1,1,1,1)},t}();f.TrailRenderer2Vertex=e;var r=function(){function t(){this.vertex=[],this.lastVertexAddedPosition=new THREE.Vector3,this.queuePosition=new THREE.Vector3}return t.prototype.getLastElement=function(){return this.vertex.length<=0?null:this.vertex[this.vertex.length-1]},t.prototype.addElement=function(){var t=i.pop();return t.reset(),this.vertex.push(t),t},t.prototype.remove=function(t){var e=this.vertex[t];return i.release(e),this.vertex.splice(t,1),e},t.prototype.garbage=function(){for(var t=0;t<this.vertex.length;t++)i.release(this.vertex[t])},t.prototype.reset=function(){},t}();f.Trail2Data=r}(plume||(plume={})),function(t){var e,i;e=t.trail||(t.trail={}),(i=e.shaders||(e.shaders={})).base_fragment="precision highp float;\nvarying vec4 vColor;\nvoid main() {\ngl_FragColor = vColor;\n}",i.base_vertex="precision highp float;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 uv;\nattribute float nodeID;\nattribute float nodeVertexID;\nattribute vec3 nodeCenter;\nuniform float minID;\nuniform float maxID;\nuniform vec4 headColor;\nuniform vec4 tailColor;\nuniform float tailSharp;\nvarying vec4 vColor;\nvoid main() {\nfloat fraction = ( maxID - nodeID ) / ( maxID - minID );\nvColor = ( 1.0 - fraction ) * headColor + fraction * tailColor;\nvec4 realPosition;\nif(tailSharp == 1.0) {\nrealPosition = vec4( ( 1.0 - fraction ) * position.xyz + fraction * nodeCenter.xyz, 1.0 );\n} else {\nrealPosition = vec4( position.xyz, 1.0 );\n}\ngl_Position = projectionMatrix * viewMatrix * realPosition;\n}",i.trail2_fragment="precision highp float;\nvarying vec4 vColor;\nvoid main () {\ngl_FragColor = vColor;\n}",i.trail2_vertex="precision highp float;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec4 color;\nvarying vec4 vColor;\nvoid main() {\nvec4 transformed = vec4(position.xyz, 1.0);\ntransformed = modelMatrix * transformed;\ntransformed = projectionMatrix * viewMatrix  * transformed;\nvColor = color;\ngl_Position = transformed;\n}"}(plume||(plume={})),function(){function t(t){THREE.Geometry.call(this),this.fromBufferGeometry(new e(t)),this.mergeVertices()}function e(t){THREE.BufferGeometry.call(this);var e=[],i=[];void 0===THREE.QuickHull&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on THREE.QuickHull");for(var n=(new THREE.QuickHull).setFromPoints(t).faces,r=0;r<n.length;r++){var o=n[r],s=o.edge;do{var a=s.head().point;e.push(a.x,a.y,a.z),i.push(o.normal.x,o.normal.y,o.normal.z),s=s.next}while(s!==o.edge)}this.addAttribute("position",new THREE.Float32BufferAttribute(e,3)),this.addAttribute("normal",new THREE.Float32BufferAttribute(i,3))}(t.prototype=Object.create(THREE.Geometry.prototype)).constructor=t,(e.prototype=Object.create(THREE.BufferGeometry.prototype)).constructor=e,THREE.ConvexGeometry=t,THREE.ConvexBufferGeometry=e}(),function(){var g,v,_,n;function t(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new e,this.unassigned=new e,this.vertices=[]}function x(){this.normal=new THREE.Vector3,this.midpoint=new THREE.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function a(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}function r(t){this.point=t,this.prev=null,this.next=null,this.face=null}function e(){this.head=null,this.tail=null}Object.assign(t.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("THREE.QuickHull: Points parameter is not an array."),t.length<4&&console.error("THREE.QuickHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.vertices.push(new r(t[e]));return this.compute(),this},setFromObject:function(t){var a=[];return t.updateMatrixWorld(!0),t.traverse(function(t){var e,i,n,r=t.geometry;if(void 0!==r)if(r.isGeometry){var o=r.vertices;for(e=0,i=o.length;e<i;e++)(n=o[e].clone()).applyMatrix4(t.matrixWorld),a.push(n)}else if(r.isBufferGeometry){var s=r.attributes.position;if(void 0!==s)for(e=0,i=s.count;e<i;e++)(n=new THREE.Vector3).fromBufferAttribute(s,e).applyMatrix4(t.matrixWorld),a.push(n)}}),this.setFromPoints(a)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return null===(t.face=e).outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,i=t.outside;null!==i.next&&i.next.face===t;)i=i.next;return this.assigned.removeSubList(e,i),e.prev=i.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var i=this.removeAllVerticesFromFace(t);if(void 0!==i)if(void 0===e)this.unassigned.appendChain(i);else{var n=i;do{var r=n.next;e.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,e):this.unassigned.append(n),n=r}while(null!==n)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var i=e.next,n=this.tolerance,r=null,o=0;o<t.length;o++){var s=t[o];if(0===s.mark){var a=s.distanceToPoint(e.point);if(n<a&&(n=a,r=s),n>1e3*this.tolerance)break}}null!==r&&this.addVertexToFace(e,r),e=i}while(null!==e)}return this},computeExtremes:function(){var t,e,i,n=new THREE.Vector3,r=new THREE.Vector3,o=[],s=[];for(t=0;t<3;t++)o[t]=s[t]=this.vertices[0];for(n.copy(this.vertices[0].point),r.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var a=this.vertices[t],l=a.point;for(i=0;i<3;i++)l.getComponent(i)<n.getComponent(i)&&(n.setComponent(i,l.getComponent(i)),o[i]=a);for(i=0;i<3;i++)l.getComponent(i)>r.getComponent(i)&&(r.setComponent(i,l.getComponent(i)),s[i]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(r.x))+Math.max(Math.abs(n.y),Math.abs(r.y))+Math.max(Math.abs(n.z),Math.abs(r.z))),{min:o,max:s}},computeInitialHull:function(){void 0===g&&(g=new THREE.Line3,v=new THREE.Plane,_=new THREE.Vector3);var t,e,i,n,r,o,s,a,l,h=this.vertices,u=this.computeExtremes(),c=u.min,p=u.max,d=0,f=0;for(o=0;o<3;o++)d<(l=p[o].point.getComponent(o)-c[o].point.getComponent(o))&&(d=l,f=o);for(e=c[f],i=p[f],d=0,g.set(e.point,i.point),o=0,s=this.vertices.length;o<s;o++)(t=h[o])!==e&&t!==i&&(g.closestPointToPoint(t.point,!0,_),d<(l=_.distanceToSquared(t.point))&&(d=l,n=t));for(d=-1,v.setFromCoplanarPoints(e.point,i.point,n.point),o=0,s=this.vertices.length;o<s;o++)(t=h[o])!==e&&t!==i&&t!==n&&d<(l=Math.abs(v.distanceToPoint(t.point)))&&(d=l,r=t);var m=[];if(v.distanceToPoint(r.point)<0)for(m.push(x.create(e,i,n),x.create(r,i,e),x.create(r,n,i),x.create(r,e,n)),o=0;o<3;o++)a=(o+1)%3,m[o+1].getEdge(2).setTwin(m[0].getEdge(a)),m[o+1].getEdge(1).setTwin(m[a+1].getEdge(0));else for(m.push(x.create(e,n,i),x.create(r,e,i),x.create(r,i,n),x.create(r,n,e)),o=0;o<3;o++)a=(o+1)%3,m[o+1].getEdge(2).setTwin(m[0].getEdge((3-o)%3)),m[o+1].getEdge(0).setTwin(m[a+1].getEdge(1));for(o=0;o<4;o++)this.faces.push(m[o]);for(o=0,s=h.length;o<s;o++)if((t=h[o])!==e&&t!==i&&t!==n&&t!==r){d=this.tolerance;var y=null;for(a=0;a<4;a++)d<(l=this.faces[a].distanceToPoint(t.point))&&(d=l,y=this.faces[a]);null!==y&&this.addVertexToFace(t,y)}return this},reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var i=this.faces[e];0===i.mark&&t.push(i)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,i=this.assigned.first().face,n=i.outside;do{var r=i.distanceToPoint(n.point);e<r&&(e=r,t=n),n=n.next}while(null!==n&&n.face===i);return t}},computeHorizon:function(t,e,i,n){var r;this.deleteFaceVertices(i),i.mark=1,r=null===e?e=i.getEdge(0):e.next;do{var o=r.twin,s=o.face;0===s.mark&&(s.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,o,s,n):n.push(r)),r=r.next}while(r!==e);return this},addAdjoiningFace:function(t,e){var i=x.create(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setTwin(e.twin),i.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var i=null,n=null,r=0;r<e.length;r++){var o=e[r],s=this.addAdjoiningFace(t,o);null===i?i=s:s.next.setTwin(n),this.newFaces.push(s.face),n=s}return i.next.setTwin(n),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(x,{create:function(t,e,i){var n=new x,r=new a(t,n),o=new a(e,n),s=new a(i,n);return r.next=s.prev=o,o.next=r.prev=s,s.next=o.prev=r,n.edge=r,n.compute()}}),Object.assign(x.prototype,{getEdge:function(t){for(var e=this.edge;0<t;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e},compute:function(){void 0===n&&(n=new THREE.Triangle);var t=this.edge.tail(),e=this.edge.head(),i=this.edge.next.head();return n.set(t.point,e.point,i.point),n.getNormal(this.normal),n.getMidpoint(this.midpoint),this.area=n.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(t){return this.normal.dot(t)-this.constant}}),Object.assign(a.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1},lengthSquared:function(){var t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1},setTwin:function(t){return(this.twin=t).twin=this}}),Object.assign(e.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),THREE.QuickHull=t}(),function(t){var o=(p=t||{}).__deffered||[];function h(t){return null==t?null:t.length<=1?t.toUpperCase():t.charAt(0).toUpperCase()+t.slice(1)}p.__deffered=o;var e=function(){};e.prototype.loadNConstant=function(t,e,i){var n=function(){};(p[t]=n).domainID=i.domainID,n.serializerID=e.serializerID,e.name=t,n.values=function(){return n._values},n.prototype.getValue=function(){return this._value},n.prototype.name=function(){return this._name},n.prototype.ordinal=function(){return this._value},n.prototype.init=function(t,e){return null==n._values&&(n._values=new Array),this._value=e,this._name=t,n._values.push(this),this},n.fromValue=function(t){for(var e=0;e<n._values.length;e++){var i=n._values[e];if(i.getValue()==t)return i}return null},n.valueOf=function(t){for(var e=0;e<n._values.length;e++){var i=n._values[e];if(t==i.name())return i}return null},n.prototype.getDomainID=function(){return n.domainID},n.prototype.getSerializerID=function(){return n.serializerID},n.prototype.toString=function(){return t+"."+this._name},n.prototype.clone=function(){return this};for(var r=0;r<e.values.length;r++){var o=e.values[r];n[o.text]=(new n).init(o.text,o.value)}},e.prototype.addField=function(t,e,i,n){i.name=e;var r=n.hierarchyDepth+i.propertyId;i.serializerID=r;var o,s=h(e),a="get";"Boolean"==(o=i).type&&1==o.primitive&&(a="is"),i.getter=a+s,i.setter="set"+s,t.prototype[a+s]=function(){return this["_"+e]},t.prototype["set"+s]=function(t){this["_"+e]=t,this["_"+e+"Set"]=!0},t.prototype["is"+e+"Set"]=function(){return this["_"+e+"Set"]},t.prototype["unSet"+e]=function(t){this["_"+e+"Set"]=!1}},e.prototype.loadNObject=function(n,r,t){var e={};p._serializer[n]=e,r.name=n;var i=function(){};if(p[n]=i,null!=r.extendss){var o=p[r.extendss.name];(i.prototype=new o).constructor=o}for(var s in i.prototype.init=function(){return this},i.domainID=t.domainID,i.serializerID=r.serializerID,i.prototype.getDomainID=function(){return i.domainID},i.prototype.getSerializerID=function(){return i.serializerID},r.fields){var a=r.fields[s];this.addField(i,s,a,r),e[a.serializerID]=a}for(var l=r.extendss;null!=l;){var h=p._specs[l.domainID];if(null==h)throw"Domain "+l.domainID+" not loaded";var u=h.nobjects[l.name];if(null==u)throw"NObject "+l.name+" not loaded";for(var s in u.fields){var c=u.fields[s];e[(r.fields[s]=c).serializerID]=c}l=l.extendss}i.prototype.toString=function(){var t="";for(var e in t+="["+n+" --\x3e ",r.fields){var i=this[r.fields[e].getter]();p.Utils.isNull(i)||(t+=e+"="+i+"| ")}return t+="]"},i.prototype.clone=function(){var t=new i;for(var e in this){"function"!=typeof this[e]&&(t[e]=this[e])}return t}},e.prototype.createSerializerFactory=function(t){var u=[];for(var e in t.nconstants){var i=t.nconstants[e];u[i.serializerID]=i}for(var e in t.nobjects){var n=t.nobjects[e];u[n.serializerID]=n}var r=function(){this.dynamicFieldResolver=(new p.DefaultDynamicFieldResolver).init()};(p["String"+t.domainName+"SerializerFactory"]=r).prototype.init=function(){return this},r.prototype.setDynamicFieldSerializerResolver=function(t){this.dynamicFieldResolver=t},r.prototype.writeField0=function(t,e,i,n){if(n.list){if(n.primitive){var r="write"+n.type+"ListProperty";return p.StringOutputStream[r](e,n.serializerID,i)}if(null==e)return!1;i.putShort(n.serializerID),i.put(p.SerializationTypes.LIST);var o=i.position();i.skip(4);var s=e.length;i.putShort(s);for(var a=0;a<s;a++){var l=e[a];null==l?i.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeObject(t,l,i)}return i.putIntAt(o,i.position()-o),!0}if(n.primitive){r="write"+n.type+"Property";return p.StringOutputStream[r](e,n.serializerID,i)}return n.reference?p.StringOutputStream.writeObjectProperty(t,e,n.serializerID,i):n.structure&&"nmap"==n.type?p.StringOutputStream.writeNMapProperty(t,e,n.serializerID,i,this.dynamicFieldResolver):(console&&console.error("Field not supported!!"),!1)},r.prototype.write=function(t,e,i){var n=e.getSerializerID(),r=u[n];if(null==r)throw Error("No serializer found for "+e);if(null!=r.values)p.StringOutputStream.writeInteger(e.getValue(),i);else{var o=i.position();i.skip(2);var s=0;for(var a in r.fields){var l=r.fields[a];if(1==e["is"+a+"Set"]()){var h=e[l.getter]();this.writeField0(t,h,i,l)&&s++}}i.putShortAt(o,s)}},r.prototype.readField0=function(t,e,i,n){if(n.list){if(n.primitive){var r="read"+n.type+"List";return p.StringInputStream[r](i)}var o=new Array;if(i.get()!=p.SerializationTypes.NULL_TYPE){i.getInt();for(var s=i.getShort(),a=0;a<s;a++)o.push(p.StringInputStream.readObject(t,i))}return o}if(n.primitive){r="read"+n.type;return p.StringInputStream[r](i)}return n.reference?p.StringInputStream.readObject(t,i):n.structure&&"nmap"==n.type?p.StringInputStream.readNMap(t,i,this.dynamicFieldResolver):void 0},r.prototype.readSerializable=function(t,e,i){var n=u[i];if(null==n)throw Error("No serializer found for "+i);if(null!=n.values){var r=p.StringInputStream.readInteger(e);return p[n.name].fromValue(r)}r=new p[n.name];for(var o=p._serializer[n.name],s=p.StringInputStream.getShort(e),a=0;a<s;a++){var l=o[p.StringInputStream.getShort(e)];if(null!=l){var h=this.readField0(t,r,e,l);r[l.setter](h)}else p.StringInputStream.skipProperty(e)}return r}},e.prototype.createDispatcher=function(o){var s=function(){};function t(t,e){var i=e?t:h(t)+"Response",n=i+"Handler",r=o.nobjects[i];s.prototype["add"+n]=function(t){this.listenersBySerializerId[r.serializerID].push(t)},s.prototype["remove"+n]=function(t){var e=this.listenersBySerializerId[r.serializerID].indexOf(t);0<=e&&this.listenersBySerializerId[r.serializerID].splice(e,1)}}if((p[o.domainName+"Dispatcher"]=s).prototype.init=function(){return this.clear(),this},s.prototype.fireMessage=function(t){var e=t.getSerializerID(),i=this.listenersBySerializerId[e];if(null!=i){for(var n=0;n<this.globalListeners.length;n++){(0,this.globalListeners[n])(t)}for(n=0;n<i.length;n++){(0,i[n])(t)}}},s.prototype.clear=function(){if(this.globalListeners=new Array,this.listenersBySerializerId={},null!=o.methods)for(var t in o.methods){var e=h(t)+"Response",i=o.nobjects[e];this.listenersBySerializerId[i.serializerID]=new Array}if(null!=o.notifications)for(var n=0;n<o.notifications.length;n++){var r=o.notifications[n];i=o.nobjects[r];this.listenersBySerializerId[i.serializerID]=new Array}},s.prototype.addHipGsMessageListener=function(t){this.globalListeners.push(t)},s.prototype.removeHipGsMessageListener=function(t){var e=this.globalListeners.indexOf(t);0<=e&&this.globalListeners.splice(e,1)},null!=o.methods)for(var e in o.methods)t(e,!1);if(null!=o.notifications)for(var i=0;i<o.notifications.length;i++){t(o.notifications[i],!0)}},e.prototype.createAPI=function(t){null!=p.AbstractNuggetaApi&&this.createAPI0(t,!1),null!=p.AbstractDisconnectedApi&&this.createAPI0(t,!0)},e.prototype.createAPI0=function(n,t){if(0!=n.domainID){var l=function(){};for(var e in t?((p[n.domainName+"DisconnectedApi"]=l).prototype=new p.AbstractDisconnectedApi,(l.prototype.constructor=l).prototype.init=function(){return this.dispatcher=(new p[n.domainName+"Dispatcher"]).init(),this.domain=(new p[n.domainName+"Domain"]).init(),p.AbstractDisconnectedApi.prototype.init.call(this),this},2):((p[n.domainName+"Api"]=l).prototype=new p.AbstractNuggetaApi,(l.prototype.constructor=l).prototype.init=function(){return this.dispatcher=(new p[n.domainName+"Dispatcher"]).init(),this.domain=(new p[n.domainName+"Domain"]).init(),p.AbstractNuggetaApi.prototype.init.call(this),this},1),l.prototype.getDomain=function(){return this.domain},l.prototype.getDispatcher=function(){return this.dispatcher},n.methods)r(e);if(null!=n.methods)for(var e in n.methods){o(h(e)+"ResponseHandler")}if(null!=n.notifications)for(var i=0;i<n.notifications.length;i++){o(n.notifications[i]+"Handler")}l.prototype.callHandler=function(t,e){e(t)}}function r(t){for(var r=n.methods[t],o=h(t)+"Request",s=r.parameters.length,a=new Array,e=0;e<s;e++){var i=r.parameters[e];a.push("set"+h(i))}l.prototype[t]=function(){if(arguments.length!=s)throw"Invalid api call. Received "+arguments.length+" arguments, expected "+r.parameters;for(var t=new p[o],e=0;e<s;e++){var i=a[e],n=arguments[e];t[i](n)}return this.send(t)},l.prototype[t+"Request"]=function(){if(arguments.length!=s+1)throw"Invalid api call. Received "+arguments.length+" arguments, expected "+r.parameters+" and response handler.";for(var t=new p[o],e=0;e<s;e++){var i=a[e],n=arguments[e];t[i](n)}return this.request(t,arguments[arguments.length-1])}}function o(e){l.prototype["add"+e]=function(t){this.dispatcher["add"+e](t)},l.prototype["remove"+e]=function(t){this.dispatcher["remove"+e](t)}}},e.prototype.createDomain=function(t){var e=function(){};p[t.domainName+"Domain"]=e;var i="String"+t.domainName+"SerializerFactory";(e.prototype=new p.NDomain).constructor=p[t.domainName+"Domain"],e.prototype.init=function(){return p.NDomain.prototype.init.call(this),this.setDomainId(t.domainID),this.setStringSerializerFactory(new p[i]),this}},e.prototype.load=function(t){for(var e in console&&console.log("Loading "+t.domainID),p._specs=p._specs||{},p._specs[t.domainID]=t,p._serializer=p._serializer||{},t.nconstants){var i=t.nconstants[e];this.loadNConstant(e,i,t)}for(var e in t.nobjects){var n=t.nobjects[e];this.loadNObject(e,n,t)}this.createSerializerFactory(t),this.createDispatcher(t),this.createAPI(t);var r=this;void 0===p.NDomain?(console&&console.log("Deffer domain creation"),o.push(function(){console&&console.log("Executing deffered domain creation"),r.createDomain(t)})):this.createDomain(t)},e.loadDeffered=function(){for(var t=p.__deffered,e=0;e<t.length;e++)t[e]();t=[]},p.nruntime=e,console&&console.log("nruntime ready");(new(p=t||{}).nruntime).load({domainID:0,domainName:"NuggetaCore",nconstants:{DnsStatus:{serializerID:0,values:[{value:0,text:"SUCCESS"},{value:1,text:"WARNED"},{value:2,text:"REFUSED"},{value:3,text:"FAILED"},{value:4,text:"FAILED_TRY_LATER"}]},ErrorCode:{serializerID:1,values:[{value:0,text:"INVALID_MESSAGE"},{value:1,text:"INTERNAL_ERROR"}]},NMonitorType:{serializerID:2,values:[{value:0,text:"AVERAGE"},{value:1,text:"COUNT"}]}},nobjects:{Storable:{hierarchyDepth:0,serializerID:3e3,fields:{StoreId:{propertyId:0,primitive:!0,type:"String"},DF:{propertyId:1,structure:!0,type:"nmap"}}},Message:{hierarchyDepth:1e3,serializerID:3001,extendss:{domainID:"0",name:"Storable"},fields:{SenderId:{propertyId:0,primitive:!0,type:"String"},MessageId:{propertyId:1,primitive:!0,type:"String"},RequestId:{propertyId:2,primitive:!0,type:"String"}}},HeartBeatRequest:{hierarchyDepth:2e3,serializerID:3002,extendss:{domainID:"0",name:"Message"},fields:{Counter:{propertyId:0,primitive:!0,type:"Integer"}}},HeartBeatResponse:{hierarchyDepth:2e3,serializerID:3003,extendss:{domainID:"0",name:"Message"},fields:{Counter:{propertyId:0,primitive:!0,type:"Integer"}}},DnsRequest:{hierarchyDepth:2e3,serializerID:3004,extendss:{domainID:"0",name:"Message"},fields:{GameId:{propertyId:0,primitive:!0,type:"String"},GameVersion:{propertyId:1,primitive:!0,type:"Integer"},GameDeployedVersion:{propertyId:2,primitive:!0,type:"Integer"},Platform:{propertyId:3,primitive:!0,type:"String"}}},DnsResponse:{hierarchyDepth:2e3,serializerID:3005,extendss:{domainID:"0",name:"Message"},fields:{IpAddress:{propertyId:0,primitive:!0,type:"String"},TcpPort:{propertyId:1,primitive:!0,type:"Integer"},DnsStatus:{propertyId:2,reference:!0,type:"DnsStatus",domainId:"0"},StartDetails:{propertyId:3,reference:!0,type:"StartDetails",domainId:"0"}}},StartDetails:{hierarchyDepth:0,serializerID:3006,fields:{UseDefaultImpl:{propertyId:0,primitive:!0,type:"Boolean"},CurrentVersion:{propertyId:1,primitive:!0,type:"Integer"},NextVersion:{propertyId:2,primitive:!0,type:"Integer"},Title:{propertyId:3,primitive:!0,type:"String"},Text:{propertyId:4,primitive:!0,type:"String"},Url:{propertyId:5,primitive:!0,type:"String"}}},StopPlugConnectionRequest:{hierarchyDepth:2e3,serializerID:3007,extendss:{domainID:"0",name:"Message"},fields:{}},StopPlugConnectionResponse:{hierarchyDepth:2e3,serializerID:3008,extendss:{domainID:"0",name:"Message"},fields:{}},NuggetaExceptionMessage:{hierarchyDepth:2e3,serializerID:3009,extendss:{domainID:"0",name:"Message"},fields:{ErrorCode:{propertyId:0,reference:!0,type:"ErrorCode",domainId:"0"},Reason:{propertyId:1,primitive:!0,type:"String"}}},NuggetaQuery:{hierarchyDepth:0,serializerID:3010,fields:{domain:{propertyId:0,primitive:!0,type:"String"},start:{propertyId:1,primitive:!0,type:"Integer"},limit:{propertyId:2,primitive:!0,type:"Integer"},query:{propertyId:3,primitive:!0,type:"String"}}},NRawMessage:{hierarchyDepth:2e3,serializerID:3011,extendss:{domainID:"0",name:"Message"},fields:{content:{propertyId:0,primitive:!0,type:"String"}}},NStringPair:{hierarchyDepth:0,serializerID:3012,fields:{Key:{propertyId:0,primitive:!0,type:"String"},Value:{propertyId:1,primitive:!0,type:"String"}}},NMessagesList:{hierarchyDepth:2e3,serializerID:3013,extendss:{domainID:"0",name:"Message"},fields:{storables:{propertyId:0,list:!0,type:"Storable",domainID:"0",reference:!0}}},NMonitor:{hierarchyDepth:1e3,serializerID:3014,extendss:{domainID:"0",name:"Storable"},fields:{Type:{propertyId:0,reference:!0,type:"NMonitorType",domainId:"0"},Name:{propertyId:1,primitive:!0,type:"String"},Description:{propertyId:2,primitive:!0,type:"String"},Enabled:{propertyId:3,primitive:!0,type:"Boolean"}}}},notifications:["NRawMessage"]}),(p=t||{}).StringUtil=function(){},p.StringUtil.prototype.init=function(){return this},p.StringUtil.pad=function(t,e){for(var i=t.length;i<e;i++)t="0"+t;return t},p.ConnectionFail=function(){},p.ConnectionFail.prototype=new p.Message,p.ConnectionFail.prototype.constructor=p.ConnectionFail,p.ConnectionFail.prototype.init=function(){return this},p.ConnectionFail.prototype.getSerializerID=function(){return 0},p.ConnectionFail.prototype.getDomainID=function(){return 0},p.ConnectionFail.prototype.clone=function(){return null},p.StringStream=function(){},p.StringStream.prototype.init=function(t){return this._position=0,this.str=t,this},p.StringStream.prototype.getStringWithSize=function(t){var e=this.str.substring(this._position,this._position+t);return this._position=this._position+t,e},p.StringStream.prototype.append=function(t){this.str.appendString(t),this._position=this.str.length1()},p.StringStream.prototype.toString=function(){return this.str.toString()},p.StringStream.prototype.position=function(){return this._position},p.StringStream.prototype.limit=function(){return this.str.length1()},p.StringStream.prototype.skip=function(t){},p.StringStream.prototype.setPosition=function(t){this._position=t},p.StringStream.prototype.ignore=function(){var t=parseFloat(this.getStringWithSize(1)),e=parseFloat(this.getStringWithSize(t));this._position=this._position+e},p.StringStream.prototype.ignoreLength=function(t){this._position=this._position+t},p.StringStream.prototype.putShortAt=function(t,e){this.writeStringAt(t,""+e)},p.StringStream.prototype.writeStringAt=function(t,e){var i=(new p.StrBuilder).init("");i.appendString(this.str.substring(0,t));var n=""+e.length,r=n.length;i.appendString(""+r),i.appendString(n),i.appendString(e),i.appendString(this.str.substring(t,this.str.length1())),this.str=i,this._position=i.length1()},p.StringStream.prototype.writeString=function(t){this.writeLength(t.length),this.append(t)},p.StringStream.prototype.getShort=function(){return parseFloat(this.readString())},p.StringStream.prototype.getDouble=function(){return parseFloat(this.readString())},p.StringStream.prototype.getInt=function(){return parseFloat(this.readString())},p.StringStream.prototype.getLong=function(){return parseFloat(this.readString())},p.StringStream.prototype.getString=function(){return this.readString()},p.StringStream.prototype.get=function(){return parseFloat(this.readString())},p.StringStream.prototype.getFloat=function(){return parseFloat(this.readString())},p.StringStream.prototype.putShort=function(t){this.writeString(""+t)},p.StringStream.prototype.putString=function(t){this.writeString(t)},p.StringStream.prototype.put=function(t){this.writeString(""+t)},p.StringStream.prototype.putIntAt=function(t,e){this.writeStringAt(t,""+e)},p.StringStream.prototype.putDouble=function(t){this.writeString(""+t)},p.StringStream.prototype.putInt=function(t){this.writeString(""+t)},p.StringStream.prototype.putLong=function(t){this.writeString(""+t)},p.StringStream.prototype.putFloat=function(t){this.writeString(""+t)},p.StringStream.prototype.writeLength=function(t){var e=""+t,i=e.length;this.str.appendString(""+i),this.str.appendString(e)},p.StringStream.prototype.pad=function(t,e){for(var i=t.length;i<e;i++)t="0"+t;return t},p.StringStream.prototype.readString=function(){var t=parseFloat(this.getStringWithSize(1)),e=parseFloat(this.getStringWithSize(t));return this.getStringWithSize(e)},p.StringStream.prototype.getKeyShort=function(t){return 0},p.StringStream.prototype.getKeyDouble=function(t){return 0},p.StringStream.prototype.getKeyInt=function(t){return 0},p.StringStream.prototype.getKeyLong=function(t){return 0},p.StringStream.prototype.getKeyFloat=function(t){return 0},p.StringStream.prototype.getKeyString=function(t){return null},p.StringStream.prototype.putKeyShort=function(t,e){},p.StringStream.prototype.putKeyString=function(t,e){},p.StringStream.prototype.putKeyDouble=function(t,e){},p.StringStream.prototype.putKeyInt=function(t,e){},p.StringStream.prototype.putKeyLong=function(t,e){},p.StringStream.prototype.putKeyFloat=function(t,e){},p.SerializerFactoryType=function(){},p.SerializerFactoryType.prototype.init=function(){return this},p.SerializerFactoryType.BINARY=0,p.SerializerFactoryType.STRING=1,p.SerializerFactoryType.JSON=2,p.StringInputStream=function(){},p.StringInputStream.prototype.init=function(){return this},p.StringInputStream.readObject=function(t,e){var i=null;try{if(e.get()==p.SerializationTypes.NULL_TYPE)return null;e.getInt();var n=e.getInt(),r=t.getDomain(n);if(null==r)throw new Error("No domain available for domain id "+n,null);var o=r.getStringSerializerFactory();if(null==o)throw new Error("No string factory found in domain "+n,null);var s=e.getShort();i=o.readSerializable(t,e,s)}catch(t){throw new Error("Can't read Object",t)}return i},p.StringInputStream.readObjectList=function(t,e){var i=new Array;if(e.get()==p.SerializationTypes.NULL_TYPE)return i;e.getInt();for(var n=e.getShort(),r=0;r<n;r++){var o=p.StringInputStream.readObject(t,e);null!=o&&i.push(o)}return i},p.StringInputStream.readIntegerList=function(t){if(t.get()==p.SerializationTypes.NULL_TYPE)return null;t.getInt();for(var e=t.getShort(),i=new Array,n=0;n<e;n++){t.get()==p.SerializationTypes.NULL_TYPE?i.push(p.Utils.NULL_INTEGER):i.push(t.getInt())}return i},p.StringInputStream.readShortList=function(t){if(t.get()==p.SerializationTypes.NULL_TYPE)return null;t.getInt();for(var e=t.getShort(),i=new Array,n=0;n<e;n++){t.get()==p.SerializationTypes.NULL_TYPE?i.push(p.Utils.NULL_SHORT):i.push(t.getShort())}return i},p.StringInputStream.readLongList=function(t){if(t.get()==p.SerializationTypes.NULL_TYPE)return null;t.getInt();for(var e=t.getShort(),i=new Array,n=0;n<e;n++){t.get()==p.SerializationTypes.NULL_TYPE?i.push(p.Utils.NULL_LONG):i.push(t.getLong())}return i},p.StringInputStream.readFloatList=function(t){if(t.get()==p.SerializationTypes.NULL_TYPE)return null;t.getInt();for(var e=t.getShort(),i=new Array,n=0;n<e;n++){t.get()==p.SerializationTypes.NULL_TYPE?i.push(p.Utils.NULL_FLOAT):i.push(t.getFloat())}return i},p.StringInputStream.readDoubleList=function(t){if(t.get()==p.SerializationTypes.NULL_TYPE)return null;t.getInt();for(var e=t.getShort(),i=new Array,n=0;n<e;n++){t.get()==p.SerializationTypes.NULL_TYPE?i.push(p.Utils.NULL_DOUBLE):i.push(t.getDouble())}return i},p.StringInputStream.readStringList=function(t){if(t.get()==p.SerializationTypes.NULL_TYPE)return null;t.getInt();for(var e=t.getShort(),i=new Array,n=0;n<e;n++)i.push(p.StringInputStream.readString(t));return i},p.StringInputStream.readBooleanList=function(t){if(t.get()==p.SerializationTypes.NULL_TYPE)return null;t.getInt();for(var e=t.getShort(),i=new Array,n=0;n<e;n++){t.get()==p.SerializationTypes.NULL_TYPE?i.push(p.Utils.NULL_BOOLEAN):i.push(1==t.get())}return i},p.StringInputStream.readNMap=function(t,e,i){if(e.get()==p.SerializationTypes.NULL_TYPE)return null;e.getInt();for(var n=e.getShort(),r=(new p.NMap).init(),o=0;o<n;o++){var s=p.StringInputStream.readString(e),a=null,l=e.position(),h=e.get();if(e.setPosition(l),h==p.SerializationTypes.NULL_TYPE)e.get();else if(h==p.SerializationTypes.OBJECT)a=p.StringInputStream.readObject(t,e);else if(h==p.SerializationTypes.STRING)a=p.StringInputStream.readString(e);else if(h==p.SerializationTypes.SHORT)a=p.StringInputStream.readShort(e);else if(h==p.SerializationTypes.INTEGER)a=p.StringInputStream.readInteger(e);else if(h==p.SerializationTypes.LONG)a=p.StringInputStream.readLong(e);else if(h==p.SerializationTypes.FLOAT)a=p.StringInputStream.readFloat(e);else if(h==p.SerializationTypes.DOUBLE)a=p.StringInputStream.readDouble(e);else if(h==p.SerializationTypes.BOOLEAN)a=p.StringInputStream.readBoolean(e);else if(h==p.SerializationTypes.NMAP)a=p.StringInputStream.readNMap(t,e,i);else if(h==p.SerializationTypes.LIST){l=e.position(),h=e.get();var u=e.getInt();if(0<e.getShort()){var c=e.get();e.setPosition(l),c==p.SerializationTypes.OBJECT?a=p.StringInputStream.readObjectList(t,e):c==p.SerializationTypes.STRING?a=p.StringInputStream.readStringList(e):c==p.SerializationTypes.SHORT?a=p.StringInputStream.readShortList(e):c==p.SerializationTypes.INTEGER?a=p.StringInputStream.readIntegerList(e):c==p.SerializationTypes.LONG?a=p.StringInputStream.readLongList(e):c==p.SerializationTypes.FLOAT?a=p.StringInputStream.readFloatList(e):c==p.SerializationTypes.DOUBLE?a=p.StringInputStream.readDoubleList(e):c==p.SerializationTypes.BOOLEAN?a=p.StringInputStream.readBooleanList(e):e.setPosition(l+u)}}r.put(s,a)}return r},p.StringInputStream.readString=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?null:t.getString()},p.StringInputStream.readDate=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?p.Utils.NULL_DATE:new Date(t.getLong())},p.StringInputStream.readDouble=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?p.Utils.NULL_DOUBLE:t.getDouble()},p.StringInputStream.readInteger=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?p.Utils.NULL_INTEGER:t.getInt()},p.StringInputStream.readLong=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?p.Utils.NULL_LONG:t.getLong()},p.StringInputStream.readByte=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?p.Utils.NULL_BYTE:t.get()},p.StringInputStream.readShort=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?p.Utils.NULL_SHORT:t.getShort()},p.StringInputStream.readFloat=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?p.Utils.NULL_FLOAT:t.getFloat()},p.StringInputStream.readBoolean=function(t){return t.get()==p.SerializationTypes.NULL_TYPE?p.Utils.NULL_BOOLEAN:1==t.get()},p.StringInputStream.getInteger=function(t){return t.getInt()},p.StringInputStream.getLong=function(t){return t.getLong()},p.StringInputStream.getShort=function(t){return t.getShort()},p.StringInputStream.skipProperty=function(t){var e=t.get();if(e!=p.SerializationTypes.NULL_TYPE)if(e!=p.SerializationTypes.OBJECT&&e!=p.SerializationTypes.NMAP)t.ignore();else{var i=t.getInt();t.ignoreLength(i)}},p.NDomainList=function(){},p.NDomainList.prototype.init=function(){return this.nDomains=new Array,this},p.NDomainList.prototype.addDomain=function(t){this.nDomains.push(t)},p.NDomainList.prototype.getDomain=function(t){for(var e=0;e<this.nDomains.length;e++){var i=this.nDomains[e];if(i.getDomainId()==t)return i}return null},p.NDomainList.prototype.getDomains=function(){return this.nDomains},p.NDomainList.prototype.setDomainList=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.nDomains.push(i)}},p.NDomainList.prototype.setDynamicFieldSerializerResolver=function(t){for(var e=0;e<this.nDomains.length;e++){this.nDomains[e].setDynamicFieldSerializerResolver(t)}},p.NDomain=function(){},p.NDomain.prototype.init=function(){return this},p.NDomain.prototype.getDomainId=function(){return this.domainId},p.NDomain.prototype.setDomainId=function(t){this.domainId=t},p.NDomain.prototype.getBinarySerializerFactory=function(){return this.binarySerializerFactory},p.NDomain.prototype.setBinarySerializerFactory=function(t){this.binarySerializerFactory=t},p.NDomain.prototype.getStringSerializerFactory=function(){return this.stringSerializerFactory},p.NDomain.prototype.setStringSerializerFactory=function(t){this.stringSerializerFactory=t},p.NDomain.prototype.getJsonSerializerFactory=function(){return this.jsonSerializerFactory},p.NDomain.prototype.setJsonSerializerFactory=function(t){this.jsonSerializerFactory=t},p.NDomain.prototype.setDynamicFieldSerializerResolver=function(t){null!=this.binarySerializerFactory&&this.binarySerializerFactory.setDynamicFieldSerializerResolver(t),null!=this.stringSerializerFactory&&this.stringSerializerFactory.setDynamicFieldSerializerResolver(t),null!=this.jsonSerializerFactory&&this.jsonSerializerFactory.setDynamicFieldSerializerResolver(t)},p.DomainMessageListener=function(){},p.DomainMessageListener.prototype.init=function(t,e){return this.domainId=t,this.messageListener=e,this},p.DomainMessageListener.prototype.getDomainId=function(){return this.domainId},p.DomainMessageListener.prototype.getMessageListener=function(){return this.messageListener},p.NuggetaException=function(){},p.NuggetaException.prototype=new Error,p.NuggetaException.prototype.constructor=p.NuggetaException,p.NuggetaException.prototype.init=function(t,e){return RuntimeException.prototype.init.call(this,t.getReason(),e),this.nuggetaExceptionMessage=t,this},p.NuggetaException.prototype.getNuggetaException=function(){return this.nuggetaExceptionMessage},p.StringOutputStream=function(){},p.StringOutputStream.prototype.init=function(){return this},p.StringOutputStream.writeObject=function(t,e,i){var n=e,r=n.getDomainID(),o=t.getDomain(r);if(null==o)throw new Error("No domain available for domain id "+r,null);var s=o.getStringSerializerFactory();if(null==s)throw new Error("No binary factory found in domain "+r,null);if(null==e)return!1;i.put(p.SerializationTypes.OBJECT);var a=i.position();i.skip(4);var l=i.position();i.putInt(r);var h=n.getSerializerID();return i.putShort(h),s.write(t,n,i),i.putIntAt(a,i.position()-l),!0},p.StringOutputStream.writeObjectProperty=function(t,e,i,n){return null!=e&&(n.putShort(i),p.StringOutputStream.writeObject(t,e,n),!0)},p.StringOutputStream.writeObjectListProperty=function(t,e,i,n){return null!=e&&(n.putShort(i),p.StringOutputStream.writeObjectList(t,e,n),!0)},p.StringOutputStream.writeObjectList=function(t,e,i){if(null==e)return!1;i.put(p.SerializationTypes.LIST);var n=i.position();i.skip(4);var r=e.length;i.putShort(r);for(var o=0;o<r;o++){var s=e[o];null==s?i.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeObject(t,s,i)}return i.putIntAt(n,i.position()-n),!0},p.StringOutputStream.writeIntegerListProperty=function(t,e,i){return null!=t&&(i.putShort(e),p.StringOutputStream.writeIntegerList(t,i),!0)},p.StringOutputStream.writeIntegerList=function(t,e){if(null==t)return!1;e.put(p.SerializationTypes.LIST);var i=e.position();e.skip(4);var n=t.length;e.putShort(n);for(var r=0;r<n;r++){var o=t[r];p.Utils.isNullInteger(o)?e.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeInteger(o,e)}return e.putIntAt(i,e.position()-i),!0},p.StringOutputStream.writeShortListProperty=function(t,e,i){return null!=t&&(i.putShort(e),p.StringOutputStream.writeShortList(t,i),!0)},p.StringOutputStream.writeShortList=function(t,e){if(null==t)return!1;e.put(p.SerializationTypes.LIST);var i=e.position();e.skip(4);var n=t.length;e.putShort(n);for(var r=0;r<n;r++){var o=t[r];p.Utils.isNullShort(o)?e.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeShort(o,e)}return e.putIntAt(i,e.position()-i),!0},p.StringOutputStream.writeLongListProperty=function(t,e,i){return null!=t&&(i.putShort(e),p.StringOutputStream.writeLongList(t,i),!0)},p.StringOutputStream.writeLongList=function(t,e){if(null==t)return!1;e.put(p.SerializationTypes.LIST);var i=e.position();e.skip(4);var n=t.length;e.putShort(n);for(var r=0;r<n;r++){var o=t[r];p.Utils.isNullLong(o)?e.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeLong(o,e)}return e.putIntAt(i,e.position()-i),!0},p.StringOutputStream.writeFloatListProperty=function(t,e,i){return null!=t&&(i.putShort(e),p.StringOutputStream.writeFloatList(t,i),!0)},p.StringOutputStream.writeFloatList=function(t,e){if(null==t)return!1;e.put(p.SerializationTypes.LIST);var i=e.position();e.skip(4);var n=t.length;e.putShort(n);for(var r=0;r<n;r++){var o=t[r];p.Utils.isNullFloat(o)?e.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeFloat(o,e)}return e.putIntAt(i,e.position()-i),!0},p.StringOutputStream.writeDoubleListProperty=function(t,e,i){return null!=t&&(i.putShort(e),p.StringOutputStream.writeDoubleList(t,i),!0)},p.StringOutputStream.writeDoubleList=function(t,e){if(null==t)return!1;e.put(p.SerializationTypes.LIST);var i=e.position();e.skip(4);var n=t.length;e.putShort(n);for(var r=0;r<n;r++){var o=t[r];p.Utils.isNullDouble(o)?e.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeDouble(o,e)}return e.putIntAt(i,e.position()-i),!0},p.StringOutputStream.writeBooleanListProperty=function(t,e,i){return null!=t&&(i.putShort(e),p.StringOutputStream.writeBooleanList(t,i),!0)},p.StringOutputStream.writeBooleanList=function(t,e){if(null==t)return!1;e.put(p.SerializationTypes.LIST);var i=e.position();e.skip(4);var n=t.length;e.putShort(n);for(var r=0;r<n;r++){var o=t[r];p.Utils.isNullBoolean(o)?e.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeBoolean(o,e)}return e.putIntAt(i,e.position()-i),!0},p.StringOutputStream.writeStringListProperty=function(t,e,i){return null!=t&&(i.putShort(e),p.StringOutputStream.writeStringList(t,i),!0)},p.StringOutputStream.writeStringList=function(t,e){if(null==t)return!1;e.put(p.SerializationTypes.LIST);var i=e.position();e.skip(4);var n=t.length;e.putShort(n);for(var r=0;r<n;r++){var o=t[r];null==o?e.put(p.SerializationTypes.NULL_TYPE):p.StringOutputStream.writeString(o,e)}return e.putIntAt(i,e.position()-i),!0},p.StringOutputStream.writeStringProperty=function(t,e,i){return!p.Utils.isNull(t)&&(i.putShort(e),p.StringOutputStream.writeString(t,i),!0)},p.StringOutputStream.writeString=function(t,e){return!p.Utils.isNull(t)&&(e.put(p.SerializationTypes.STRING),e.putString(t),!0)},p.StringOutputStream.writeDoubleProperty=function(t,e,i){return!p.Utils.isNullDouble(t)&&(i.putShort(e),p.StringOutputStream.writeDouble(t,i),!0)},p.StringOutputStream.writeDouble=function(t,e){return!p.Utils.isNullDouble(t)&&(e.put(p.SerializationTypes.DOUBLE),e.putDouble(t),!0)},p.StringOutputStream.writeIntegerProperty=function(t,e,i){return!p.Utils.isNullInteger(t)&&(i.putShort(e),p.StringOutputStream.writeInteger(t,i),!0)},p.StringOutputStream.writeInteger=function(t,e){return!p.Utils.isNullInteger(t)&&(e.put(p.SerializationTypes.INTEGER),e.putInt(t),!0)},p.StringOutputStream.writeDateProperty=function(t,e,i){return!p.Utils.isNullDate(t)&&(p.StringOutputStream.writeLongProperty(t.getTime(),e,i),!0)},p.StringOutputStream.writeLongProperty=function(t,e,i){return!p.Utils.isNullLong(t)&&(i.putShort(e),p.StringOutputStream.writeLong(t,i),!0)},p.StringOutputStream.writeLong=function(t,e){return!p.Utils.isNullLong(t)&&(e.put(p.SerializationTypes.LONG),e.putLong(t),!0)},p.StringOutputStream.writeByte=function(t,e){return!p.Utils.isNullByte(t)&&(e.put(p.SerializationTypes.BYTE),e.put(t),!0)},p.StringOutputStream.writeShortProperty=function(t,e,i){return!p.Utils.isNullShort(t)&&(i.putShort(e),p.StringOutputStream.writeShort(t,i),!0)},p.StringOutputStream.writeShort=function(t,e){return!p.Utils.isNullShort(t)&&(e.put(p.SerializationTypes.SHORT),e.putShort(t),!0)},p.StringOutputStream.writeFloatProperty=function(t,e,i){return!p.Utils.isNullFloat(t)&&(i.putShort(e),p.StringOutputStream.writeFloat(t,i),!0)},p.StringOutputStream.writeFloat=function(t,e){return!p.Utils.isNullFloat(t)&&(e.put(p.SerializationTypes.FLOAT),e.putFloat(t),!0)},p.StringOutputStream.writeBooleanProperty=function(t,e,i){return!p.Utils.isNullBoolean(t)&&(i.putShort(e),p.StringOutputStream.writeBoolean(t,i),!0)},p.StringOutputStream.writeBoolean=function(t,e){return!p.Utils.isNullBoolean(t)&&(e.put(p.SerializationTypes.BOOLEAN),1==t?e.put(1):0==t&&e.put(0),!0)},p.StringOutputStream.writeNMapProperty=function(t,e,i,n,r){return!p.Utils.isNull(e)&&(n.putShort(i),p.StringOutputStream.writeNMap(t,e,n,r),!0)},p.StringOutputStream.writeNMap=function(t,e,i,n){if(p.Utils.isNull(e))return!1;i.put(p.SerializationTypes.NMAP);var r=i.position();i.skip(4),i.skip(2);for(var o=0,s=e.keys();s.hasNext();){var a=s.next(),l=e.get(a);if(null!=l){p.StringOutputStream.writeString(a,i);var h=n.getSerializationType(a,l);if(h==p.SerializationTypes.NULL_TYPE)i.put(p.SerializationTypes.NULL_TYPE);else if(h==p.SerializationTypes.OBJECT)p.StringOutputStream.writeObject(t,l,i);else if(h==p.SerializationTypes.STRING)p.StringOutputStream.writeString(l,i);else if(h==p.SerializationTypes.SHORT)p.StringOutputStream.writeShort(l,i);else if(h==p.SerializationTypes.INTEGER)p.StringOutputStream.writeInteger(l,i);else if(h==p.SerializationTypes.LONG)p.StringOutputStream.writeLong(l,i);else if(h==p.SerializationTypes.FLOAT)p.StringOutputStream.writeFloat(l,i);else if(h==p.SerializationTypes.DOUBLE)p.StringOutputStream.writeDouble(l,i);else if(h==p.SerializationTypes.BOOLEAN)p.StringOutputStream.writeBoolean(l,i);else if(h==p.SerializationTypes.NMAP)p.StringOutputStream.writeNMap(t,l,i,n);else if(h==p.SerializationTypes.LIST){var u=n.getListSerializationType(a,l);if(u==p.SerializationTypes.OBJECT){var c=l;p.StringOutputStream.writeObjectList(t,c,i)}else u==p.SerializationTypes.STRING?p.StringOutputStream.writeStringList(l,i):u==p.SerializationTypes.SHORT?p.StringOutputStream.writeShortList(l,i):u==p.SerializationTypes.INTEGER?p.StringOutputStream.writeIntegerList(l,i):u==p.SerializationTypes.LONG?p.StringOutputStream.writeLongList(l,i):u==p.SerializationTypes.FLOAT?p.StringOutputStream.writeFloatList(l,i):u==p.SerializationTypes.DOUBLE?p.StringOutputStream.writeDoubleList(l,i):u==p.SerializationTypes.BOOLEAN?p.StringOutputStream.writeBooleanList(l,i):u==p.SerializationTypes.NULL_TYPE&&i.put(p.SerializationTypes.NULL_TYPE)}o++}}return i.putShortAt(r,o),i.putIntAt(r,i.position()-r),!0},p.ConnectionStop=function(){},p.ConnectionStop.prototype=new p.Message,p.ConnectionStop.prototype.constructor=p.ConnectionStop,p.ConnectionStop.prototype.init=function(){return this},p.ConnectionStop.prototype.getSerializerID=function(){return 0},p.ConnectionStop.prototype.clone=function(){return(new p.ConnectionStop).init()},p.ConnectionStop.prototype.toString=function(){return""},p.ConnectionStop.prototype.equals=function(t){return!1},p.ConnectionStop.prototype.getDomainID=function(){return 0},p.ConnectionLost=function(){},p.ConnectionLost.prototype=new p.Message,p.ConnectionLost.prototype.constructor=p.ConnectionLost,p.ConnectionLost.prototype.init=function(){return this},p.ConnectionLost.prototype.getSerializerID=function(){return 0},p.ConnectionLost.prototype.clone=function(){return(new p.ConnectionLost).init()},p.ConnectionLost.prototype.toString=function(){return""},p.ConnectionLost.prototype.equals=function(t){return!1},p.ConnectionLost.prototype.getDomainID=function(){return 0},p.NError=function(){},p.NError.prototype.getMessage=function(){return this.errorMessage},p.NError.prototype.getCause=function(){return this.cause},p.NError.prototype.init=function(t,e){return this.errorMessage=t,this.cause=e,this},p.NError.prototype.toString=function(){var t="Error Message : "+this.errorMessage;return null!=this.cause&&(t+=" cause : "+this.cause.toString()),t},p.InvalidVersion=function(){},p.InvalidVersion.prototype=new p.Message,p.InvalidVersion.prototype.constructor=p.InvalidVersion,p.InvalidVersion.prototype.init=function(){return this},p.InvalidVersion.prototype.getSerializerID=function(){return 0},p.InvalidVersion.prototype.clone=function(){var t=(new p.InvalidVersion).init();return null!=this._MessageId&&t.setMessageId(this._MessageId),null!=this._RequestId&&t.setRequestId(this._RequestId),t},p.InvalidVersion.prototype.toString=function(){var t="";return t+="[InvalidVersion --\x3e ",null!=this._MessageId&&(t+="_MessageId="+this._MessageId+"| "),null!=this._RequestId&&(t+="_RequestId="+this._RequestId+"| "),t+="]"},p.InvalidVersion.prototype.equals=function(t){return!1},p.InvalidVersion.prototype.getDomainID=function(){return 0},p.ConnectionReady=function(){},p.ConnectionReady.prototype=new p.Message,p.ConnectionReady.prototype.constructor=p.ConnectionReady,p.ConnectionReady.prototype.init=function(){return this},p.ConnectionReady.prototype.getSerializerID=function(){return 0},p.ConnectionReady.prototype.clone=function(){return(new p.ConnectionReady).init()},p.ConnectionReady.prototype.toString=function(){return""},p.ConnectionReady.prototype.equals=function(t){return!1},p.ConnectionReady.prototype.getDomainID=function(){return 0},p.SerializationTypes=function(){},p.SerializationTypes.prototype.init=function(){return this},p.SerializationTypes.NULL_TYPE=0,p.SerializationTypes.OBJECT=1,p.SerializationTypes.LIST=2,p.SerializationTypes.BYTE=10,p.SerializationTypes.INTEGER=11,p.SerializationTypes.SHORT=12,p.SerializationTypes.LONG=13,p.SerializationTypes.FLOAT=14,p.SerializationTypes.DOUBLE=15,p.SerializationTypes.STRING=16,p.SerializationTypes.CHAR=17,p.SerializationTypes.BOOLEAN=18,p.SerializationTypes.NMAP=19,p.CompositeNDomainList=function(){},p.CompositeNDomainList.prototype=new p.NDomainList,p.CompositeNDomainList.prototype.constructor=p.CompositeNDomainList,p.CompositeNDomainList.prototype.init=function(){return this},p.CompositeNDomainList.prototype.setDomainLists=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.setDomainList(i.getDomains())}};var i=p.MemoryManagement=function(){};i.prototype.init=function(){return this},i.free=function(){},i.dupString=function(t){return t},i._clone=function(t){return t},(p.ByteBuffer=function(){}).prototype.init=function(){return this};var n=p.ByteUtil=function(){};n.prototype.init=function(){return this},n.getBytes=function(t){t=t.replace(/\r\n/g,"\n");for(var e=[],i=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);e[i++]=r<128?r:(e[i++]=r<2048?r>>6|192:(e[i++]=r>>12|224,r>>6&63|128),63&r|128)}return e},n.getString=function(t){for(var e=[],i=0,n=0;i<t.length;){var r=t[i++];if(r<128)e[n++]=String.fromCharCode(r);else if(191<r&&r<224){var o=t[i++];e[n++]=String.fromCharCode((31&r)<<6|63&o)}else{o=t[i++];var s=t[i++];e[n++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&s)}}return e.join("")};var r=p.DefaultDynamicFieldResolver=function(){};r.prototype.init=function(){return this},r.prototype.getSerializationType=function(t,e){return null==e?p.SerializationTypes.NULL_TYPE:e instanceof p.Storable?p.SerializationTypes.OBJECT:e instanceof p.NMap?p.SerializationTypes.NMAP:"string"==typeof e?p.SerializationTypes.STRING:"boolean"==typeof e?p.SerializationTypes.BOOLEAN:"number"==typeof e?e%1==0?2147483647<e?p.SerializationTypes.LONG:p.SerializationTypes.INTEGER:p.SerializationTypes.DOUBLE:Array.isArray(e)?e.length<=0?p.SerializationTypes.NULL_TYPE:p.SerializationTypes.LIST:p.SerializationTypes.NULL_TYPE},r.prototype.getListSerializationType=function(t,e){var i=e[0];return this.getSerializationType(t,i)};var s=p.NamedDynamicFieldResolver=function(){this.typeByName=[],this.listTypeByName=[]};s.prototype=new p.DefaultDynamicFieldResolver,s.constructor=p.NamedDynamicFieldResolver,s.prototype.init=function(){return this},s.prototype.registerField=function(t,e){this.typeByName[t]=e},s.prototype.registerListField=function(t,e){this.typeByName[t]=p.SerializationTypes.LIST,this.listTypeByName[t]=e},s.prototype.getSerializationType=function(t,e){var i=this.typeByName[t];return null!=i?i:p.DefaultDynamicFieldResolver.prototype.getSerializationType.call(this,t,e)},s.prototype.getListSerializationType=function(t,e){var i=this.listTypeByName[t];return null!=i?i:p.DefaultDynamicFieldResolver.prototype.getListSerializationType.call(this,t,e)};var a=p.StrBuilder=function(){};a.prototype.init=function(t){return this.builder=new String(t),this._position=0,this},a.prototype.substring=function(t,e){return this.builder.substring(t,e)},a.prototype.appendString=function(t){this.builder+=t},a.prototype.length1=function(){return this.builder.length},a.prototype.replace=function(t,e,i){this.builder=this.builder.substring(0,t)+i+this.builder.substring(e)},a.prototype.insert=function(t,e){this.builder=this.builder.substring(0,t)+e+this.builder.substring(t)},a.prototype.toString=function(){return this.builder};var l=p.NMap=function(){this.inner=[]};l.prototype.init=function(){return this},l.prototype.put=function(t,e){this.inner[t]=e},l.prototype.get=function(t){return this.inner[t]},l.prototype.keys=function(){var e=Object.keys(this.inner),i=0;return{hasNext:function(){return i<e.length},next:function(){var t=e[i];return i++,t}}},l.prototype.clear=function(){this.inner=[]},l.prototype.size=function(){return Object.keys(this.inner).length},l.prototype.clone=function(){return this},l.prototype.toString=function(){for(var t="[",e=this.keys();e.hasNext();){var i=e.next();t+=i+"="+this.get(i)+", "}return t+="]"};var p,u=p.Utils=function(){};u.prototype.init=function(){return this},u.NULL_INTEGER=null,u.NULL_SHORT=null,u.NULL_LONG=null,u.NULL_FLOAT=null,u.NULL_DOUBLE=null,u.NULL_BOOLEAN=null,u.NULL_BYTE=null,u.NULL_DATE=null,u.isNull=function(t){return null==t},u.isNullInteger=function(t){return null==t},u.isNullShort=function(t){return null==t},u.isNullLong=function(t){return null==t},u.isNullLong=function(t){return null==t},u.isNullDouble=function(t){return null==t},u.isNullFloat=function(t){return null==t},u.isNullBoolean=function(t){return null==t},u.isNullByte=function(t){return null==t},u.isNullDate=function(t){return null==t},p.nruntime.loadDeffered(),(p=t||{}).AbstractDisconnectedApi=function(){},p.AbstractDisconnectedApi.prototype.init=function(){return this},p.AbstractDisconnectedApi.prototype.fill=function(t){},p.AbstractDisconnectedApi.prototype.setDisconnectedPlug=function(t){(this.basicNuggetaPlug=t).addDomain(this.domain)},p.AbstractDisconnectedApi.prototype.request=function(t,e,i){this.fill(t),this.basicNuggetaPlug.request(t,e,i)},p.AbstractDisconnectedApi.prototype.send=function(t){this.fill(t),this.basicNuggetaPlug.sendMessage(t)},p.DisconnectedPlug=function(){this.domains=(new p.NDomainList).init(),this.endpoint="",this.requestId=0},p.DisconnectedPlug.prototype.init=function(){return this},p.DisconnectedPlug.prototype.encode=function(t){var e=(new p.StrBuilder).init(""),i=(new p.StringStream).init(e);return p.StringOutputStream.writeObject(this.domains,t,i),i.toString()},p.DisconnectedPlug.prototype.decode=function(t){var e=(new p.StrBuilder).init(t),i=(new p.StringStream).init(e);return p.StringInputStream.readObject(this.domains,i)},p.DisconnectedPlug.prototype.addDomain=function(t){return this.domains.addDomain(t),this},p.DisconnectedPlug.prototype.setEndpoint=function(t){return this.endpoint="//"+t+"/api",this},p.DisconnectedPlug.prototype.sendMessage=function(t){var e=this.encode(t);this.post(e,function(t){})},p.DisconnectedPlug.prototype.request=function(t,i,n){var r=this,e=this.encode(t);this.post(e,function(t){var e=r.decode(t);e instanceof p.NuggetaExceptionMessage?n?n(e):console.error("serror: "+e):i(e)},function(t){if(n){var e=(new p.NuggetaExceptionMessage).init();e.setReason(t),n(e)}else console.error(t)})},p.DisconnectedPlug.prototype.post=function(t,e,i){var n=new XMLHttpRequest;n.open("POST",this.endpoint),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?(e(n.responseText),n.onreadystatechange=null):i("Invalid status: "+n.status+", text: "+n.responseText)),n.readyState<=0&&(i("Invalid ready state: "+n.readyState),n.onreadystatechange=null)},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(t)},(p=t||{}).FoldingNetworkConnection=function(){},p.FoldingNetworkConnection.prototype.init=function(t){return this.connections=new Array,this.connection=null,this.connectionReadyListenerCollection=(new p.ConnectionReadyListenerCollection).init(),this.connectionLostListenerCollection=(new p.ConnectionLostListenerCollection).init(),this.connectionFailListenerCollection=(new p.ConnectionFailListenerCollection).init(),this.connectionInvalidVersionListenerCollection=(new p.ConnectionInvalidVersionDetectedListenerCollection).init(),this.log=p.NLoggerFactory.getLogger("FoldingNetworkConnection"),this.messageListener=t,this},p.FoldingNetworkConnection.prototype.start=function(){this.tryNextConnection()},p.FoldingNetworkConnection.prototype.tryNextConnection=function(){var t=this;0!=this.connections.length?(null!=this.connection&&(this.connection.removeConnectionReadyListener(this.connectionReadyListener),this.connection.removeConnectionFailListener(this.connectionFailListener),this.connection.removeConnectionLostListener(this.connectionLostListener),this.connection.removeConnectionInvalidVersionDetectedListener(this.connectionInvalidVersionDetectedListener),p.MemoryManagement.free(this.connectionReadyListener),p.MemoryManagement.free(this.connectionFailListener),p.MemoryManagement.free(this.connectionLostListener),p.MemoryManagement.free(this.connectionInvalidVersionDetectedListener)),this.connection=this.connections[0],this.connections.splice(0,1),this.connectionReadyListener=function(){t.connection.removeConnectionReadyListener(t.connectionReadyListener),t.connectionReadyListenerCollection.fireConnectionReady()},t.connection.addConnectionReadyListener(t.connectionReadyListener),t.connectionLostListener=function(){t.connection.removeConnectionLostListener(t.connectionLostListener),t.connectionLostListenerCollection.fireConnectionLost()},t.connection.addConnectionLostListener(t.connectionLostListener),t.connectionFailListener=function(){t.connection.removeConnectionFailListener(t.connectionFailListener),t.tryNextConnection()},t.connection.addConnectionFailListener(t.connectionFailListener),t.connectionInvalidVersionDetectedListener=function(){t.connection.removeConnectionInvalidVersionDetectedListener(t.connectionInvalidVersionDetectedListener),t.connectionInvalidVersionListenerCollection.fireInvalidVersionDetected()},t.connection.addConnectionInvalidVersionDetectedListener(t.connectionInvalidVersionDetectedListener),t.connection.start()):t.connectionFailListenerCollection.fireConnectionFail()},p.FoldingNetworkConnection.prototype.stop=function(){null!=this.connection&&this.connection.stop()},p.FoldingNetworkConnection.prototype.sendMessage=function(t){this.connection.sendMessage(t)},p.FoldingNetworkConnection.prototype.addConnection=function(t){this.connections.push(t)},p.FoldingNetworkConnection.prototype.addConnectionReadyListener=function(t){this.connectionReadyListenerCollection.add(t)},p.FoldingNetworkConnection.prototype.addConnectionLostListener=function(t){this.connectionLostListenerCollection.add(t)},p.FoldingNetworkConnection.prototype.addConnectionFailListener=function(t){this.connectionFailListenerCollection.add(t)},p.FoldingNetworkConnection.prototype.addConnectionInvalidVersionDetectedListener=function(t){this.connectionInvalidVersionListenerCollection.add(t)},p.FoldingNetworkConnection.prototype.removeConnectionInvalidVersionDetectedListener=function(t){this.connectionInvalidVersionListenerCollection.remove(t)},p.FoldingNetworkConnection.prototype.removeConnectionReadyListener=function(t){this.connectionReadyListenerCollection.remove(t)},p.FoldingNetworkConnection.prototype.removeConnectionLostListener=function(t){this.connectionLostListenerCollection.remove(t)},p.FoldingNetworkConnection.prototype.removeConnectionFailListener=function(t){this.connectionFailListenerCollection.remove(t)},p.FoldingNetworkConnection.prototype.sendStopMessage=function(t,e){this.connection.sendStopMessage(t,e)},p.FoldingNetworkConnection.prototype.onHeartBeat=function(){this.connection.onHeartBeat()},p.ConnectionLostListenerCollection=function(){},p.ConnectionLostListenerCollection.prototype.init=function(){return this.connectionLostListeners=new Array,this},p.ConnectionLostListenerCollection.prototype.fireConnectionLost=function(){for(var t=this.connectionLostListeners.length,e=0;e<t;e++){(0,this.connectionLostListeners[e])()}},p.ConnectionLostListenerCollection.prototype.getListeners=function(){return this.connectionLostListeners},p.ConnectionLostListenerCollection.prototype.add=function(t){this.connectionLostListeners.push(t)},p.ConnectionLostListenerCollection.prototype.remove=function(t){if(0<this.connectionLostListeners.length){var e=this.connectionLostListeners.indexOf(t);0<=e&&this.connectionLostListeners.splice(this.connectionLostListeners.indexOf(e),1)}},p.AbstractConnectionManager=function(){},p.AbstractConnectionManager.prototype.init=function(t){return this.connectionReadyListenerCollection=(new p.ConnectionReadyListenerCollection).init(),this.connectionLostListenerCollection=(new p.ConnectionLostListenerCollection).init(),this.connectionFailListenerCollection=(new p.ConnectionFailListenerCollection).init(),this.connectionInvalidVersionListenerCollection=(new p.ConnectionInvalidVersionDetectedListenerCollection).init(),this.name="",this.forceStop=!1,this.name=t,this},p.AbstractConnectionManager.prototype.start=function(t){this.connection=t,this.forceStop=!1},p.AbstractConnectionManager.prototype.sendMessage=function(t){null!=this.connection?this.connection.sendMessage(t):this.log.error("**************************** No connection available to sendMessage , did you wait for StartResponse before sending any message ? ")},p.AbstractConnectionManager.prototype.addConnectionReady=function(t){this.connectionReadyListenerCollection.add(t)},p.AbstractConnectionManager.prototype.removeConnectionReadyListener=function(t){this.connectionReadyListenerCollection.remove(t)},p.AbstractConnectionManager.prototype.addConnectionLost=function(t){this.connectionLostListenerCollection.add(t)},p.AbstractConnectionManager.prototype.removeConnectionLostListener=function(t){this.connectionLostListenerCollection.remove(t)},p.AbstractConnectionManager.prototype.addConnectionFail=function(t){this.connectionFailListenerCollection.add(t)},p.AbstractConnectionManager.prototype.removeConnectionFailListener=function(t){this.connectionFailListenerCollection.remove(t)},p.AbstractConnectionManager.prototype.addConnectionInvalidVersionDetected=function(t){this.connectionInvalidVersionListenerCollection.add(t)},p.AbstractConnectionManager.prototype.removeConnectionInvalidVersionDetected=function(t){this.connectionInvalidVersionListenerCollection.remove(t)},p.AbstractConnectionManager.prototype.stop=function(){this.forceStop=!0,null!=this.connection&&(this.connection.stop(),this.connection=null)},p.AbstractConnectionManager.prototype.isForceStopped=function(){return this.forceStop},p.AbstractConnectionManager.prototype.getConnection=function(){return this.connection},p.AbstractConnectionManager.prototype.sendStopMessage=function(){null!=this.connection&&this.connection.sendStopMessage((new p.StopPlugConnectionRequest).init(),(new p.StopPlugConnectionResponse).init())},p.ConnectionManager=function(){},p.ConnectionManager.prototype=new p.AbstractConnectionManager,p.ConnectionManager.prototype.constructor=p.ConnectionManager,p.ConnectionManager.prototype.init=function(t){return this.started=!1,p.AbstractConnectionManager.prototype.init.call(this,t),this.log=p.NLoggerFactory.getLogger("ConnectionManager"),this},p.ConnectionManager.prototype.start=function(t){p.AbstractConnectionManager.prototype.start.call(this,t),this.installConnectionListeners(this.connection),this.connection.start()},p.ConnectionManager.prototype.installConnectionListeners=function(t){var e=this;t.addConnectionReadyListener(function(){e.started=!0,e.connectionReadyListenerCollection.fireConnectionReady()}),t.addConnectionLostListener(function(){e.started=!1,e.connectionLostListenerCollection.fireConnectionLost()}),t.addConnectionFailListener(function(){e.started=!1,e.connectionFailListenerCollection.fireConnectionFail()}),t.addConnectionInvalidVersionDetectedListener(function(){e.connectionInvalidVersionListenerCollection.fireInvalidVersionDetected()})},p.ConnectionManager.prototype.stop=function(){p.AbstractConnectionManager.prototype.stop.call(this),this.started=!1},p.ConnectionManager.prototype.isStarted=function(){return this.started},p.ConnectionManager.prototype.onHeartBeat=function(){null!=this.connection&&this.connection.onHeartBeat()},p.AbstractNetworkConnection=function(){},p.AbstractNetworkConnection.prototype.init=function(t,e,i){var n=this;return this.connectionReadyListenerCollection=(new p.ConnectionReadyListenerCollection).init(),this.connectionFailListenerCollection=(new p.ConnectionFailListenerCollection).init(),this.connectionLostListenerCollection=(new p.ConnectionLostListenerCollection).init(),this.connectionInvalidVersionDetectedListenerCollection=(new p.ConnectionInvalidVersionDetectedListenerCollection).init(),this.connectionState=p.ConnectionState.INITIAL,this.domainList=e,this.messageListener=i,this.name=t,this.connectionLostHandler=function(){n.connectionState==p.ConnectionState.STARTED&&n.connectionLostListenerCollection.fireConnectionLost(),n.connectionState==p.ConnectionState.STOPPING&&n.tryStop()},n.connectionSendFailHandler=function(){n.connectionState==p.ConnectionState.STARTED&&n.connectionLostListenerCollection.fireConnectionLost(),n.connectionState==p.ConnectionState.STOPPING&&n.tryStop()},this},p.AbstractNetworkConnection.prototype.tryStop=function(){},p.AbstractNetworkConnection.prototype.addConnectionReadyListener=function(t){this.connectionReadyListenerCollection.add(t)},p.AbstractNetworkConnection.prototype.removeConnectionReadyListener=function(t){this.connectionReadyListenerCollection.remove(t)},p.AbstractNetworkConnection.prototype.addConnectionLostListener=function(t){this.connectionLostListenerCollection.add(t)},p.AbstractNetworkConnection.prototype.removeConnectionLostListener=function(t){this.connectionLostListenerCollection.remove(t)},p.AbstractNetworkConnection.prototype.addConnectionFailListener=function(t){this.connectionFailListenerCollection.add(t)},p.AbstractNetworkConnection.prototype.removeConnectionFailListener=function(t){this.connectionFailListenerCollection.remove(t)},p.AbstractNetworkConnection.prototype.addConnectionInvalidVersionDetectedListener=function(t){this.connectionInvalidVersionDetectedListenerCollection.add(t)},p.AbstractNetworkConnection.prototype.removeConnectionInvalidVersionDetectedListener=function(t){this.connectionInvalidVersionDetectedListenerCollection.remove(t)},p.AbstractNetworkConnection.prototype.start=function(){},p.AbstractNetworkConnection.prototype.stop=function(){},p.AbstractNetworkConnection.prototype.sendMessage=function(t){},p.AbstractNetworkConnection.prototype.sendStopMessage=function(t,e){},p.AbstractNetworkConnection.prototype.onHeartBeat=function(){},p.HttpConnection=function(){},p.HttpConnection.prototype=new p.AbstractNetworkConnection,p.HttpConnection.prototype.constructor=p.HttpConnection,p.HttpConnection.prototype.init=function(t,e,i,n,r,o,s){null==p.HttpConnection.PROTOCOL&&(p.HttpConnection.PROTOCOL="x");return this.log=p.NLoggerFactory.getLogger("HttpConnection"),p.AbstractNetworkConnection.prototype.init.call(this,t,e,i),this.log=p.NLoggerFactory.getLogger("HttpConnection"),p.NHttpRequestImpl.isSecured()?this.url="https://"+n+":"+o+s:this.url="http://"+n+":"+r+s,this},p.HttpConnection.prototype.start=function(){var e=this;if(this.connectionState==p.ConnectionState.INITIAL){this.connectionState=p.ConnectionState.STARTING,this.network=(new p.Network).init(this.domainList,this.messageListener,this.connectionInvalidVersionDetectedListenerCollection,this.connectionLostListenerCollection);var t=(new p.NHttpRequestImpl).init(),i=p.NSystem.currentTimeMillis();t.setWithCredentials(!0),t.get(e.name,e.url+"?init=init&p="+p.HttpConnection.PROTOCOL+"&id="+i,function(t){e.connectionState==p.ConnectionState.STARTING?(e.sessionId=t,e.connectionState=p.ConnectionState.STARTED,e.connectionReadyListenerCollection.fireConnectionReady(),e.poll()):e.log.error("invalid connection status")},function(){e.connectionState==p.ConnectionState.STARTING?e.connectionFailListenerCollection.fireConnectionFail():e.log.error("invalid connection status")})}},p.HttpConnection.prototype.poll=function(){var i=this;if(this.connectionState==p.ConnectionState.STARTED){var t=(new p.NHttpRequestImpl).init(),e=p.NSystem.currentTimeMillis();t.get(i.name,i.url+"?session_id="+i.sessionId+"&id="+e+"&p="+p.HttpConnection.PROTOCOL+"&send=p",function(t){try{if(i.connectionState!=p.ConnectionState.STARTED)return;var e=t;if(null!=e&&0<e.length&&"INVALID_SESSION_ID"==e)return void i.connectionLostListenerCollection.fireConnectionLost();i.network.onStrData(e),i.poll()}catch(t){i.dead||(i.dead=!0,i.log.debugCause("can't poll: ",t),i.connectionLostListenerCollection.fireConnectionLost())}},function(){i.connectionState==p.ConnectionState.STARTED&&i.connectionLostListenerCollection.fireConnectionLost()})}},p.HttpConnection.prototype.stop=function(){this.connectionState!=p.ConnectionState.STARTED?(this.connectionState=p.ConnectionState.STOPPED,this.tryStop()):this.connectionState!=p.ConnectionState.STARTING?(this.connectionState=p.ConnectionState.STOPPED,this.tryStop()):this.log.error("invalid status "+this.connectionState)},p.HttpConnection.prototype.tryStop=function(){},p.HttpConnection.prototype.sendMessage=function(t){this.connectionState==p.ConnectionState.STARTED&&this._sendMessage(t)},p.HttpConnection.prototype.sendStopMessage=function(t,e){this.connectionState=p.ConnectionState.STOPPING,this._sendMessage(t);try{this.messageListener(e)}catch(t){this.log.errorCause("Error occured while processing message : ",t)}},p.HttpConnection.prototype._sendMessage=function(t){var e=this,i=(new p.NHttpRequestImpl).init(),n=e.network.prepareStrPacket(t),r=p.NSystem.currentTimeMillis();i.post(e.name,e.url+"?session_id="+e.sessionId+"&id="+r+"&p="+p.HttpConnection.PROTOCOL+"&send=send",n,function(t){},function(){e.connectionState==p.ConnectionState.STARTED&&e.connectionLostListenerCollection.fireConnectionLost()})},p.BasicNuggetaPlug=function(){},p.BasicNuggetaPlug.prototype.init=function(){null==p.BasicNuggetaPlug.logger&&(p.BasicNuggetaPlug.logger=p.NLoggerFactory.getLogger("BasicNuggetaPlug"));return this.connectionManager=(new p.ConnectionManager).init("basic-plug"),this.messagesListeners=new Array,this.domainMessageListeners=new Array,this.messageCounter=0,this.lastHeartBeatTime=0,this.connectionFactory=(new p.ConnectionFactoryImpl).init(p.NConnectionConf.getLayers()),this},p.BasicNuggetaPlug.prototype.start=function(){var o=this;if(this.isStarted())p.BasicNuggetaPlug.logger.error("Error Cannot start ! Plug already started");else{this.lastHeartBeatTime=p.NSystem.currentTimeMillis();o.connectionManager.start(o.connectionFactory.newConnection("basic-plug",function(t){if(o.connectionManager.onHeartBeat(),o.lastHeartBeatTime=p.NSystem.currentTimeMillis(),t instanceof p.HeartBeatRequest){var e=(new p.HeartBeatResponse).init();return o.connectionManager.sendMessage(e),p.MemoryManagement.free(t),void p.MemoryManagement.free(e)}var i=t.getDomainID()+"",n=o.getDomainMessageListener(i);p.MemoryManagement.free(i),null!=n&&n(p.MemoryManagement._clone(t));for(var r=0;r<o.messagesListeners.length;r++)(0,o.messagesListeners[r])(p.MemoryManagement._clone(t));p.MemoryManagement.free(t)},o.url))}},p.BasicNuggetaPlug.prototype.getDomainMessageListener=function(t){for(var e=0;e<this.domainMessageListeners.length;e++){var i=this.domainMessageListeners[e];if(t==i.getDomainId()+"")return i.getMessageListener()}return null},p.BasicNuggetaPlug.prototype.sendMessage=function(t){var e=this.nextMessageId();return t.setMessageId(e),this.connectionManager.sendMessage(t),e},p.BasicNuggetaPlug.prototype.addMessageListener=function(t){this.messagesListeners.push(t)},p.BasicNuggetaPlug.prototype.removeMessageListener=function(t){this.messagesListeners.splice(this.messagesListeners.indexOf(t),1)},p.BasicNuggetaPlug.prototype.addDomainMessageListener=function(t){this.domainMessageListeners.push(t)},p.BasicNuggetaPlug.prototype.removeDomainMessageListener=function(t){this.domainMessageListeners.splice(this.domainMessageListeners.indexOf(t),1)},p.BasicNuggetaPlug.prototype.addDomain=function(t){this.connectionFactory.addDomain(t)},p.BasicNuggetaPlug.prototype.stop=function(){this.connectionManager.stop()},p.BasicNuggetaPlug.prototype.nextMessageId=function(){if(null==this.prefixMessageId)return""+this.messageCounter++;var t=this.prefixMessageId+"_",e=t+this.messageCounter++;return p.MemoryManagement.free(t),e},p.BasicNuggetaPlug.prototype.setConnectionReadyListener=function(t){this.connectionManager.addConnectionReady(t)},p.BasicNuggetaPlug.prototype.setConnectionLostListener=function(t){this.connectionManager.addConnectionLost(t)},p.BasicNuggetaPlug.prototype.setConnectionFailListener=function(t){this.connectionManager.addConnectionFail(t)},p.BasicNuggetaPlug.prototype.setConnectionInvalidVersionDetectedListener=function(t){this.connectionManager.addConnectionInvalidVersionDetected(t)},p.BasicNuggetaPlug.prototype.sendStopMessage=function(){this.connectionManager.sendStopMessage()},p.BasicNuggetaPlug.prototype.setPrefixMessageId=function(t){this.prefixMessageId=t},p.BasicNuggetaPlug.prototype.getUrl=function(){return this.url},p.BasicNuggetaPlug.prototype.setUrl=function(t){this.url=t},p.BasicNuggetaPlug.prototype.isStarted=function(){return this.connectionManager.isStarted()},p.BasicNuggetaPlug.prototype.isConnectionUp=function(){var t=p.NSystem.currentTimeMillis(),e=3*p.BasicNuggetaPlug.HEATBEAT_TIMEOUT;return!(this.lastHeartBeatTime+e<=t)},p.BasicNuggetaPlug.HEATBEAT_TIMEOUT=8e3,p.ConnectionListenerCollection=function(){},p.ConnectionListenerCollection.prototype.init=function(){return this.listeners=new Array,this},p.ConnectionListenerCollection.prototype.fireConnectionReady=function(){for(var t=this.listeners.length,e=0;e<t;e++){(0,this.listeners[e])(null)}},p.ConnectionListenerCollection.prototype.fireConnectionFail=function(){for(var t=this.listeners.length,e=0;e<t;e++){(0,this.listeners[e])(null)}},p.ConnectionListenerCollection.prototype.fireConnectionLost=function(){for(var t=this.listeners.length,e=0;e<t;e++){(0,this.listeners[e])(null)}},p.ConnectionListenerCollection.prototype.fireInvalidVersionDetected=function(){for(var t=this.listeners.length,e=0;e<t;e++){(0,this.listeners[e])(null)}},p.ConnectionListenerCollection.prototype.add=function(t){this.listeners.push(t)},p.ConnectionListenerCollection.prototype.remove=function(t){if(0<this.listeners.length){var e=this.listeners.indexOf(t);0<=e&&this.listeners.splice(this.listeners.indexOf(e),1)}},p.ConnectionListenerCollection.prototype.getListeners=function(){return this.listeners},p.Pump=function(){},p.Pump.prototype.init=function(t){return this.activePumpableMessages=new Array,this.times=new Array,this.timeOut=t,this},p.Pump.prototype.pump=function(){var t=new Array;this.checkCache(p.NSystem.currentTimeMillis());for(var e=0;e<this.activePumpableMessages.length;e++){var i=this.activePumpableMessages[e];t.push(i)}return this.activePumpableMessages.splice(0,this.activePumpableMessages.length),this.times.splice(0,this.times.length),t},p.Pump.prototype.add=function(t){var e=p.NSystem.currentTimeMillis();this.checkCache(e),this.activePumpableMessages.push(t),this.times.push(e)},p.Pump.prototype.checkCache=function(t){},p.ConnectionReadyListenerCollection=function(){},p.ConnectionReadyListenerCollection.prototype.init=function(){return this.connectionReadyListeners=new Array,this},p.ConnectionReadyListenerCollection.prototype.fireConnectionReady=function(){for(var t=this.connectionReadyListeners.length,e=0;e<t;e++){(0,this.connectionReadyListeners[e])()}},p.ConnectionReadyListenerCollection.prototype.getListeners=function(){return this.connectionReadyListeners},p.ConnectionReadyListenerCollection.prototype.add=function(t){this.connectionReadyListeners.push(t)},p.ConnectionReadyListenerCollection.prototype.remove=function(t){if(0<this.connectionReadyListeners.length){var e=this.connectionReadyListeners.indexOf(t);0<=e&&this.connectionReadyListeners.splice(this.connectionReadyListeners.indexOf(e),1)}},p.ConnectionInvalidVersionDetectedListenerCollection=function(){},p.ConnectionInvalidVersionDetectedListenerCollection.prototype.init=function(){return this.connectionInvalidVersionDetectedListeners=new Array,this},p.ConnectionInvalidVersionDetectedListenerCollection.prototype.fireInvalidVersionDetected=function(){for(var t=this.connectionInvalidVersionDetectedListeners.length,e=0;e<t;e++){(0,this.connectionInvalidVersionDetectedListeners[e])()}},p.ConnectionInvalidVersionDetectedListenerCollection.prototype.getListeners=function(){return this.connectionInvalidVersionDetectedListeners},p.ConnectionInvalidVersionDetectedListenerCollection.prototype.add=function(t){this.connectionInvalidVersionDetectedListeners.push(t)},p.ConnectionInvalidVersionDetectedListenerCollection.prototype.remove=function(t){if(0<this.connectionInvalidVersionDetectedListeners.length){var e=this.connectionInvalidVersionDetectedListeners.indexOf(t);0<=e&&this.connectionInvalidVersionDetectedListeners.splice(this.connectionInvalidVersionDetectedListeners.indexOf(e),1)}},p.WebSocketConnection=function(){},p.WebSocketConnection.prototype=new p.AbstractNetworkConnection,p.WebSocketConnection.prototype.constructor=p.WebSocketConnection,p.WebSocketConnection.prototype.init=function(t,e,i,n,r,o,s){return this.log=p.NLoggerFactory.getLogger("WebSocketConnection"),p.AbstractNetworkConnection.prototype.init.call(this,t,e,i),p.NWebSocketImpl.isSecured()?this.wsUrl="wss://"+n+":"+o+s:this.wsUrl="ws://"+n+":"+r+s,this},p.WebSocketConnection.prototype.start=function(){var e=this;if(this.connectionState==p.ConnectionState.INITIAL){this.connectionState=p.ConnectionState.STARTING;try{this.network=(new p.Network).init(this.domainList,this.messageListener,this.connectionInvalidVersionDetectedListenerCollection,this.connectionLostListenerCollection),this.connectionReceivedHandler=function(t){e.connectionState!=p.ConnectionState.STARTING&&e.connectionState!=p.ConnectionState.STARTED||e.network.onStrData(t)};e.webSocket=(new p.NWebSocketImpl).init(),e.webSocket.openConnection(e.name,e.wsUrl,function(){e.connectionState=p.ConnectionState.STARTED,e.connectionReadyListenerCollection.fireConnectionReady()},e.connectionLostHandler,function(){e.connectionState==p.ConnectionState.STARTING?e.connectionFailListenerCollection.fireConnectionFail():e.log.error("invalid connection status")},e.connectionReceivedHandler)}catch(t){e.log.errorCause("Can't connect to server  url: "+e.wsUrl,t),e.connectionFailListenerCollection.fireConnectionFail()}}},p.WebSocketConnection.prototype.sendMessage=function(t){this.connectionState==p.ConnectionState.STARTED?this._sendMessage(t):this.log.error("Connection not started "+t)},p.WebSocketConnection.prototype._sendMessage=function(t){var e=this.network.prepareStrPacket(t);this.webSocket.sendString(e,null,this.connectionSendFailHandler)},p.WebSocketConnection.prototype.sendStopMessage=function(t,e){var i=this;this._response=e,this.connectionState=p.ConnectionState.STOPPING,this._sendMessage(t),this.webSocket.drain(function(){try{i.messageListener(i._response)}catch(t){i.log.errorCause("Error occured while processing message : ",t)}})},p.WebSocketConnection.prototype.stop=function(){this.tryStop()},p.WebSocketConnection.prototype.tryStop=function(){try{this.webSocket.close()}catch(t){}},p.NArrays=function(){},p.NArrays.prototype.init=function(){return this},p.AbstractNuggetaApi=function(){},p.AbstractNuggetaApi.prototype.init=function(){var e=this;return this.callbacks=new Array,this.requestCounter=0,this._pump=(new p.Pump).init(1e4),this.messageListener=function(t){t.getDomainID()==e.getDomain().getDomainId()?e.pumpEnabled?e._pump.add(t):e.fireMessage(t):p.MemoryManagement.free(t)},this},p.AbstractNuggetaApi.prototype.getDomain=function(){return null},p.AbstractNuggetaApi.prototype.getDispatcher=function(){return null},p.AbstractNuggetaApi.prototype.request=function(t,e){return this.stackCallback(t,e),this.fill(t),this.basicNuggetaPlug.sendMessage(t)},p.AbstractNuggetaApi.prototype.send=function(t){return this.fill(t),this.basicNuggetaPlug.sendMessage(t)},p.AbstractNuggetaApi.prototype.fill=function(t){},p.AbstractNuggetaApi.prototype.stackCallback=function(t,e){var i=this.nextRequestId();return t.setRequestId(i),this.callbacks[i]=e,t},p.AbstractNuggetaApi.prototype.executeCallback=function(t){var e=t.getRequestId();if(null!=e){var i=this.callbacks[e];null!=i&&(delete this.callbacks[e],this.callHandler(t,i))}return t},p.AbstractNuggetaApi.prototype.callHandler=function(t,e){},p.AbstractNuggetaApi.prototype.nextRequestId=function(){return""+this.requestCounter++},p.AbstractNuggetaApi.prototype.setBasicNuggetaPlug=function(t){this.basicNuggetaPlug=t},p.AbstractNuggetaApi.prototype.getDomainMessageListener=function(){if(null==this.domainMessageListener){var t=this.getDomain().getDomainId()+"";this.domainMessageListener=(new p.DomainMessageListener).init(t,this.messageListener)}return this.domainMessageListener},p.AbstractNuggetaApi.prototype.enablePump=function(t){this.pumpEnabled=t},p.AbstractNuggetaApi.prototype.pump=function(){for(var t=this.pumpAndGet(),e=0;e<t.length;e++){var i=t[e];p.MemoryManagement.free(i)}p.MemoryManagement.free(t)},p.AbstractNuggetaApi.prototype.pumpAndGet=function(){for(var t=this._pump.pump(),e=0;e<t.length;e++){var i=t[e],n=p.MemoryManagement._clone(i);this.fireMessage(n)}return t},p.AbstractNuggetaApi.prototype.fireMessage=function(t){null!=t.getRequestId()?this.executeCallback(t):this.getDispatcher().fireMessage(t)},p.ConnectionState=function(){},p.ConnectionState.prototype.init=function(){return this},p.ConnectionState.INITIAL=0,p.ConnectionState.STARTING=1,p.ConnectionState.STARTED=2,p.ConnectionState.STOPPING=3,p.ConnectionState.STOPPED=4,p.Byte2DArray=function(){},p.Byte2DArray.prototype.init=function(){return this},p.ConnectionFailListenerCollection=function(){},p.ConnectionFailListenerCollection.prototype.init=function(){return this.connectionFailListeners=new Array,this},p.ConnectionFailListenerCollection.prototype.fireConnectionFail=function(){for(var t=this.connectionFailListeners.length,e=0;e<t;e++){(0,this.connectionFailListeners[e])()}},p.ConnectionFailListenerCollection.prototype.getListeners=function(){return this.connectionFailListeners},p.ConnectionFailListenerCollection.prototype.add=function(t){this.connectionFailListeners.push(t)},p.ConnectionFailListenerCollection.prototype.remove=function(t){if(0<this.connectionFailListeners.length){var e=this.connectionFailListeners.indexOf(t);0<=e&&this.connectionFailListeners.splice(this.connectionFailListeners.indexOf(e),1)}},p.AES=function(){},p.AES.prototype.init=function(){return this},p.NSystem=function(){},p.NSystem.prototype.init=function(){return this},p.NSystem.currentTimeMillis=function(){return 0},p.NLoggerFactory=function(){},p.NLoggerFactory.prototype.init=function(){return this},p.NLoggerFactory.getLogger=function(t){return(new p.NLoggerImpl).init(t)},p.SocketConnection=function(){},p.SocketConnection.prototype=new p.AbstractNetworkConnection,p.SocketConnection.prototype.constructor=p.SocketConnection,p.SocketConnection.prototype.init=function(t,e,i,n,r){return this.log=p.NLoggerFactory.getLogger("SocketConnection"),p.AbstractNetworkConnection.prototype.init.call(this,t,e,i),this.server=n,this.port=r,this},p.SocketConnection.prototype.start=function(){var e=this;if(this.connectionState==p.ConnectionState.INITIAL){this.connectionState=p.ConnectionState.STARTING;try{this.network=(new p.Network).init(this.domainList,this.messageListener,this.connectionInvalidVersionDetectedListenerCollection,this.connectionLostListenerCollection),this.connectionReceivedHandler=function(t){e.connectionState!=p.ConnectionState.STARTING&&e.connectionState!=p.ConnectionState.STARTED||(null!=e.wsUrl?e.network.onStrData(t):e.network.onSingleData(t))};e.socket=(new p.NSocketImpl).init(),e.socket.openConnection(e.name,e.server,e.port,function(){e.connectionState=p.ConnectionState.STARTED,e.connectionReadyListenerCollection.fireConnectionReady()},e.connectionLostHandler,function(){e.connectionState==p.ConnectionState.STARTING?e.connectionFailListenerCollection.fireConnectionFail():e.log.error("invalid connection status")},e.connectionReceivedHandler)}catch(t){e.log.errorCause("Can't connect to server  url "+e.server+":"+e.port,t),e.connectionFailListenerCollection.fireConnectionFail()}}},p.SocketConnection.prototype.sendMessage=function(t){this.connectionState==p.ConnectionState.STARTED?this._sendMessage(t):this.log.error("Connection not started "+t)},p.SocketConnection.prototype._sendMessage=function(t){if(null!=this.wsUrl){var e=this.network.prepareStrPacket(t);this.socket.sendString(e,null,this.connectionSendFailHandler)}else{var i=this.network.prepareBinPacket(t);this.socket.sendBytes(i.getByteBuffer(),null,this.connectionSendFailHandler),p.MemoryManagement.free(i)}},p.SocketConnection.prototype.sendStopMessage=function(t,e){var i=this;this._response=e,this.connectionState!=p.ConnectionState.STARTED&&(this.log.error("Connection not started "+t),i.messageListener(this._response)),this.connectionState=p.ConnectionState.STOPPING,this._sendMessage(t),this.socket.drain(function(){try{i.messageListener(i._response)}catch(t){i.log.errorCause("Error occured while processing message : ",t)}})},p.SocketConnection.prototype.stop=function(){this.tryStop()},p.SocketConnection.prototype.tryStop=function(){try{this.socket.close()}catch(t){}},p.SocketConnection.prototype.onHeartBeat=function(){this.socket.onHeartBeat()},p.Network=function(){},p.Network.prototype.init=function(t,e,i,n){return this.log=p.NLoggerFactory.getLogger("Network"),this._in=new Array,this._length=-1,this.HEADER_LENGTH=10,this.domainList=t,this.messageListener=e,this.connectionInvalidVersionDetectedListenerCollection=i,this.connectionLostListenerCollection=n,this},p.Network.prototype.prepareBinPacket=function(t){var e=p.ByteBuffer.allocate(),i=(new p.BinaryStream).init(e);i.skip(4),p.BinaryOutputStream.writeObject(this.domainList,t,i);var n=i.position()-4;return i.putIntAt(0,n),e.flip(),i},p.Network.prototype.prepareStrPacket=function(t){var e=(new p.StringStream).init((new p.StrBuilder).init(""));p.StringOutputStream.writeObject(this.domainList,t,e);var i=e.toString(),n=i.length;return p.Network.pad(n+"",this.HEADER_LENGTH)+i},p.Network.prototype.onData=function(t){for(var e=0;e<t.length;e++)this.onSingleData(t[e])},p.Network.prototype.onSingleData=function(t){if(this._in.push(t),-1==this._length){if(4==this._in.length){for(var e=p.ByteBuffer.allocate(),i=0;i<4;i++)e.put(this._in[i]);e.flip(),this._in.splice(0,this._in.length),this._length=e.getInt(),p.MemoryManagement.free(e)}}else if(this._in.length==this._length){var n=p.ByteBuffer.allocate();for(i=0;i<this._length;i++)n.put(this._in[i]);n.flip();var r=null;try{var o=(new p.BinaryStream).init(n);r=p.BinaryInputStream.readObject(this.domainList,o),p.MemoryManagement.free(o),this._in.splice(0,this._in.length),this._length=-1;try{this.messageListener(r)}catch(t){this.log.errorCause("Error occured while processing message : "+r,t)}}catch(t){this.log.errorCause("Can't read command ",t),this.connectionInvalidVersionDetectedListenerCollection.fireInvalidVersionDetected()}}},p.Network.pad=function(t,e){for(var i=t.length;i<e;i++)t="0"+t;return t},p.Network.prototype.onStrData=function(t){for(var e=null;0<t.length;){var i=t.substring(0,this.HEADER_LENGTH),n=parseFloat(i);t=t.substring(this.HEADER_LENGTH),e=(new p.StringStream).init((new p.StrBuilder).init(t.substring(0,n)));var r=null;try{r=p.StringInputStream.readObject(this.domainList,e),t=t.substring(n);try{this.messageListener(r)}catch(t){this.log.errorCause("Error occured while processing message : "+r,t)}}catch(t){return this.log.errorCause("Can't read command ",t),void this.connectionInvalidVersionDetectedListenerCollection.fireInvalidVersionDetected()}}},p.ConnectionFactoryImpl=function(){},p.ConnectionFactoryImpl.prototype.init=function(t){return this.logger=p.NLoggerFactory.getLogger("ConnectionFactoryImpl"),this.domainList=(new p.NDomainList).init(),this.layers=t,this},p.ConnectionFactoryImpl.prototype.newConnection=function(t,e,i){var n=i.split(":"),r=n[0],o=parseFloat(n[1]),s=o+1,a=s+1,l=(new p.FoldingNetworkConnection).init(e);if(null!=this.layers)for(var h=this.layers.split("/"),u=0;u<h.length;u++){var c=h[u];"sock"==c?l.addConnection((new p.SocketConnection).init(t,this.domainList,e,r,o)):"wsock"==c?p.NWebSocketImpl.isSupported()&&l.addConnection((new p.WebSocketConnection).init(t,this.domainList,e,r,s,a,"/nuggeta/")):"http"==c?l.addConnection((new p.HttpConnection).init(t,this.domainList,e,r,s,a,"/httpstream/")):"greenlight"==c?l.addConnection((new p.HttpConnection).init(t,this.domainList,e,r,80,443,"/"+s+"/httpstream/")):this.logger.error("Unsupported network "+c)}else this.logger.error("No Layer defined ! using fallback http");return l},p.ConnectionFactoryImpl.prototype.addDomain=function(t){this.domainList.addDomain(t)};var c=p.NSystem=function(){};c.prototype.init=function(){return this},c.currentTimeMillis=function(){return(new Date).getTime()};var d=p.NStorage=function(){};d.prototype.init=function(){this.lsSupport=!1;try{localStorage&&(localStorage.setItem("testKey","1"),localStorage.removeItem("testKey"),this.lsSupport=!0)}catch(t){}return this},d.getItem=function(t){return this.lsSupport?localStorage[t]:this.readCookie(t)},d.setItem=function(t,e){this.lsSupport?localStorage[t]=e:this.createCookie(t,e,30)},d.createCookie=function(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var r="; expires="+n.toGMTString();document.cookie=t+"="+e+r+"; path=/"},d.readCookie=function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0,r=i.length;n<r;n++){for(var o=i[n];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(e))return o.substring(e.length,o.length)}return null};var f=p.NAlert=function(){};f.prototype.init=function(){return this},f.prototype.show=function(t){console.log(t)};var m=p.NLoggerImpl=function(){};m.prototype.init=function(){return this},m.prototype.errorCause=function(t,e){var i=e.stack||e.stacktrace||e;console.log("[ERROR] "+t+", "+i)},m.prototype.error=function(t){console.log("[ERROR] "+t)},m.prototype.info=function(t){console.log("[INFO] "+t)},m.prototype.infoCause=function(t,e){var i=e.stack||e.stacktrace||e;console.log("[INFO] "+t+", "+i)},m.prototype.debug=function(t){console.log("[DEBUG] "+t)},m.prototype.debugCause=function(t,e){var i=e.stack||e.stacktrace||e;console.log("[DEBUG] "+t+", "+i)},m.prototype.warn=function(t){console.log("[WARM] "+t)},m.prototype.warnCause=function(t,e){var i=e.stack||e.stacktrace||e;console.log("[WARM] "+t+", "+i)},m.prototype.isDebug=function(){return m.DEBUG},m.DEBUG=!1;var y=p.NConnectionConf=function(){};p.NConnectionConf.layers="wsock/http",y.prototype.init=function(){return this},y.getLayers=function(){return p.NConnectionConf.layers},y.setLayers=function(t){p.NConnectionConf.layers=t};var g=p.NHttpRequestImpl=function(){};p.NHttpRequestImpl.secured="https:"==document.location.protocol,g.prototype.init=function(){return this.withCredentials=!1,this},g.isSecured=function(){return p.NHttpRequestImpl.secured},g.setSecured=function(t){p.NHttpRequestImpl.secured=t},g.prototype.setWithCredentials=function(t){this.withCredentials=t},g.prototype.get=function(t,e,i,n){var r=this;this.id=t,this.initHTTPRequest(n),this.xhr_object&&(r.xhr_object.open("GET",e,!0),r.xhr_object.onreadystatechange=function(){4==r.xhr_object.readyState&&(200==r.xhr_object.status?i(r.xhr_object.responseText):n()),r.xhr_object.readyState<=0&&n()},this.xhr_object.send(null))},g.prototype.post=function(t,e,i,n,r){var o=this;this.id=t,this.initHTTPRequest(r),this.xhr_object&&(o.xhr_object.open("POST",e,!0),o.xhr_object.onreadystatechange=function(){4==o.xhr_object.readyState&&(200==o.xhr_object.status?n(o.xhr_object.responseText):r()),o.xhr_object.readyState<=0&&r()},this.xhr_object.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr_object.send(i))},g.prototype.initHTTPRequest=function(t){if(window.XMLHttpRequest)this.xhr_object=new XMLHttpRequest,this.withCredentials&&(this.xhr_object.withCredentials=!0);else{if(!window.ActiveXObject)return void t();this.xhr_object=new ActiveXObject("Microsoft.XMLHTTP")}};var v=p.NUrlEncoder=function(){};v.prototype.init=function(){return this},v.encode=function(t,e){return encodeURIComponent(t)},v.decode=function(t,e){return decodeURIComponent(t)};var _=p.NWebSocketImpl=function(){};p.NWebSocketImpl.secured="https:"==document.location.protocol,_.isSecured=function(){return p.NWebSocketImpl.secured},_.setSecured=function(t){p.NWebSocketImpl.secured=t},p.NWebSocketImpl.connectTimeoutInMillis=5e3,p.NWebSocketImpl.count=0,_.getConnectTimeoutInMillis=function(){return p.NWebSocketImpl.connectTimeoutInMillis},_.setConnectTimeoutInMillis=function(t){p.NWebSocketImpl.connectTimeoutInMillis=t},_.isSupported=function(){return"WebSocket"in window},_.prototype.init=function(){return this},_.prototype.openConnection=function(t,e,i,n,r,o){var s=this;this.wsId=p.NWebSocketImpl.count++,this.connectionOpenedHandler=i,this.connectionLostHandler=n,this.connectionFailHandler=r,this.connectionReceivedHandler=o,this.log=p.NLoggerFactory.getLogger("WebSocket["+t+"]"),s.log.debug("opening ws "+this.wsId+" : "+e);try{this.started=!1,this.closed=!1,this.wasClean=!1,this.receiveResponse=!1,this.connection=new WebSocket(e,"plug"),this.connection.onopen=function(){s.log.debug("onopen"),1!=s.closed?(s.started=!0,s.receiveResponse=!0,s.wasClean=!1,i()):s.log.debug("ws closed, will not open it. state: "+s.getDebugState())},this.connection.onerror=function(t){1!=s.closed&&(s.receiveResponse=!0,s.started?(s.started=!1,n()):r())},this.connection.onmessage=function(t){t.data&&o(t.data)},this.connection.onclose=function(t){s.log.debug("ws onclose, state: "+s.getDebugState()),s.receiveResponse=!0,1!=s.closed&&(1!=s.wasClean?1!=t.wasClean&&(s.started?(s.started=!1,n()):r()):s.wasClean=!1)},setTimeout(function(){s.receiveResponse||(s.log.error("ws connection timeout. state: "+s.getDebugState()),s.close(),r())},_.connectTimeoutInMillis)}catch(t){s.receiveResponse?s.log.errorCause("fatal error in ws connection, state: "+s.getDebugState(),t):(s.log.errorCause("failed to open ws connection, state: "+s.getDebugState(),t),s.closed=!0,r())}return this},_.prototype.getDebugState=function(){return"ws="+this.wsId+", readyState="+(null==this.connection?"null":this.connection.readyState)+", started="+this.started+", receiveResponse="+this.receiveResponse+", closed="+this.closed+", wasClean="+this.wasClean},_.prototype.close=function(){this.closed=!0,this.wasClean=!0;try{this.connection.close()}catch(t){this.log.errorCause("Fail to close ws, state: "+this.getDebugState(),t)}},_.prototype.sendString=function(t){var e=this;try{e.connection.readyState==WebSocket.OPEN?e.connection.send(t):(e.log.error("error sending on closed websocket. state="+e.getDebugState()+", data="+t),e.connectionLostHandler())}catch(t){e.log.error("sendMessage error "+t.message),e.connectionLostHandler()}},_.prototype.drain=function(t){t()};var x=p.Net=function(){},S=null;x.prototype.init=function(){return this},x.openURL=function(t){var e=200,i=200;screen&&(e=screen.width/2-600,i=screen.height/2-400);var n=window.open(t,"_blank","height=400,width=600,left="+e+",top="+i);null==n||void 0===n?alert("Turn off your pop-up blocker!\n\nWe try to open the following url:\n"+t):n.focus()},x.openWebView=function(t){var e=parseInt(document.width)/2-250,i=parseInt(screen.height)/2-300;null==(S=window.open(t,"_blank","left="+e+",top="+i+"scrollbars=no,toolbar=no,menubar=no,location=no,height=300,width=500"))||void 0===S?alert("Turn off your pop-up blocker!\n\nWe try to open the following url:\n"+t):S.focus()},x.closeWebView=function(){null!=S&&S.close()};var w=p.Platform=function(){};w.prototype.init=function(){return this},w.get=function(){return"HTML5:"+navigator.userAgent},w.isHTMLPlatform=function(){return!1};var b=p.SecurityUtils=function(){};b.prototype.init=function(){return this},b.SHA1=function(t){return""}}(gs=window.gs||{}),window.gs=gs,(new((gs=window.gs||{})||{}).nruntime).load({domainID:400,domainName:"ShipGs",nconstants:{AuthenticateStatus:{serializerID:10002,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"},{value:2,text:"UNSUPPORTED_GAME_VERSION"}]},SaveAchievementStatus:{serializerID:10005,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},SaveIAPStatus:{serializerID:10008,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},GetPlayerByIdStatus:{serializerID:10011,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},GetPlayerByThirdPartyIdStatus:{serializerID:10014,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},FindScoresStatus:{serializerID:10017,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},GetBestScoresStatus:{serializerID:10020,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},SubmitScoreStatus:{serializerID:10023,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},GetAchievementsStatus:{serializerID:10026,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},SaveNotificationStatus:{serializerID:10029,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},FindNotificationsStatus:{serializerID:10032,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},TrackPlayerStatus:{serializerID:10035,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},CreatePlayerStatus:{serializerID:10038,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"FAILED"}]},SetFriendsStatus:{serializerID:10041,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetFriendsStatus:{serializerID:10044,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetStateStatus:{serializerID:10047,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},SubmitAdvProgressStatus:{serializerID:10062,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetAdvProgressStatus:{serializerID:10065,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetAdvFriendsProgressStatus:{serializerID:10068,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetAdvScoresStatus:{serializerID:10071,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetAdvFriendsScoresStatus:{serializerID:10074,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},SaveAdvProgressStatus:{serializerID:10077,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},FindStorablesStatus:{serializerID:10092,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"},{value:1,text:"INVALID_QUERY"}]},SaveStorableStatus:{serializerID:10095,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},SaveStorableDiffStatus:{serializerID:10098,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},RemoveStorableStatus:{serializerID:10101,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},SaveStorablesStatus:{serializerID:10104,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},FindAndModifyStorablesStatus:{serializerID:10107,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetDuelChampionshipStatus:{serializerID:10122,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},SubmitDuelChampionshipScoreStatus:{serializerID:10125,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetBestServersStatus:{serializerID:10152,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},CreateRoomStatus:{serializerID:10155,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},SubscribeStatus:{serializerID:10158,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},PublishStatus:{serializerID:10161,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},UnsubscribeStatus:{serializerID:10164,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},PullStatus:{serializerID:10167,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]},GetPublicRoomStatus:{serializerID:10170,values:[{value:-2,text:"INVALID_PARAMETERS"},{value:-1,text:"INTERNAL_ERROR"},{value:0,text:"SUCCESS"}]}},nobjects:{SStorable:{hierarchyDepth:1e3,serializerID:100,extendss:{domainID:"0",name:"Storable"},fields:{CreationDate:{propertyId:0,primitive:!0,type:"Long"},UpdateDate:{propertyId:1,primitive:!0,type:"Long"}}},SRequest:{hierarchyDepth:2e3,serializerID:101,extendss:{domainID:"0",name:"Message"},fields:{GameId:{propertyId:0,primitive:!0,type:"String"},GameVersion:{propertyId:1,primitive:!0,type:"Long"},PlayerId:{propertyId:2,primitive:!0,type:"String"},ShipVersion:{propertyId:3,primitive:!0,type:"Long"}}},SResponse:{hierarchyDepth:2e3,serializerID:102,extendss:{domainID:"0",name:"Message"},fields:{PendingMessages:{propertyId:0,list:!0,type:"Message",domainID:"0",reference:!0}}},SPlayer:{hierarchyDepth:2e3,serializerID:103,extendss:{domainID:"400",name:"SStorable"},fields:{Id:{propertyId:0,primitive:!0,type:"String"},PublisherId:{propertyId:1,primitive:!0,type:"String"},ThirdPartyId:{propertyId:2,primitive:!0,type:"String"},AccessToken:{propertyId:3,primitive:!0,type:"String"},Anonymous:{propertyId:4,primitive:!0,type:"Boolean"},Source:{propertyId:5,primitive:!0,type:"String"},Name:{propertyId:6,primitive:!0,type:"String"},Avatar:{propertyId:7,primitive:!0,type:"String"},Lang:{propertyId:8,primitive:!0,type:"String"},Email:{propertyId:9,primitive:!0,type:"String"},Country:{propertyId:10,primitive:!0,type:"String"},Birthday:{propertyId:11,primitive:!0,type:"Long"},Age:{propertyId:12,primitive:!0,type:"Integer"},Gender:{propertyId:13,primitive:!0,type:"String"},CustomData:{propertyId:14,primitive:!0,type:"String"},LastConnection:{propertyId:15,primitive:!0,type:"Long"},LastGift:{propertyId:16,primitive:!0,type:"Long"},ConsecutiveDays:{propertyId:17,primitive:!0,type:"Integer"},TotalDays:{propertyId:18,primitive:!0,type:"Integer"},Sounds:{propertyId:19,primitive:!0,type:"Long"},Tutorial:{propertyId:20,primitive:!0,type:"Long"},LastShare:{propertyId:21,primitive:!0,type:"Long"},LastInvite:{propertyId:22,primitive:!0,type:"Long"},LastDiscount:{propertyId:23,primitive:!0,type:"Long"},Wallet:{propertyId:24,primitive:!0,type:"Integer"},FortuneWheels:{propertyId:25,primitive:!0,type:"Integer"},Lifes:{propertyId:26,primitive:!0,type:"Integer"},LifeLastRecharge:{propertyId:27,primitive:!0,type:"Long"},VersionCreation:{propertyId:30,primitive:!0,type:"Long"},VersionLast:{propertyId:31,primitive:!0,type:"Long"}}},SPlayerAchievement:{hierarchyDepth:2e3,serializerID:104,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:0,primitive:!0,type:"String"},AchievementId:{propertyId:1,primitive:!0,type:"String"},Progress:{propertyId:2,primitive:!0,type:"Integer"},Achieved:{propertyId:3,primitive:!0,type:"Boolean"},Collected:{propertyId:4,primitive:!0,type:"Boolean"}}},SScore:{hierarchyDepth:2e3,serializerID:105,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:0,primitive:!0,type:"String"},PlayerName:{propertyId:1,primitive:!0,type:"String"},PlayerAvatar:{propertyId:2,primitive:!0,type:"String"},Value:{propertyId:3,primitive:!0,type:"Double"}}},SIAPTransaction:{hierarchyDepth:2e3,serializerID:106,extendss:{domainID:"400",name:"SStorable"},fields:{Id:{propertyId:0,primitive:!0,type:"String"},PlayerId:{propertyId:1,primitive:!0,type:"String"},PublisherId:{propertyId:2,primitive:!0,type:"String"},Source:{propertyId:3,primitive:!0,type:"String"},Status:{propertyId:4,primitive:!0,type:"Integer"},ItemId:{propertyId:5,primitive:!0,type:"String"},ItemType:{propertyId:6,primitive:!0,type:"String"},Price:{propertyId:7,primitive:!0,type:"Double"},Quantity:{propertyId:8,primitive:!0,type:"Integer"},TransactionInfo:{propertyId:9,primitive:!0,type:"String"},ExternalTransactionId:{propertyId:10,primitive:!0,type:"String"},ExternalCustomData:{propertyId:11,primitive:!0,type:"String"},ExternalItemId:{propertyId:12,primitive:!0,type:"String"},DiscountId:{propertyId:13,primitive:!0,type:"String"},InventoryQuantity:{propertyId:14,primitive:!0,type:"Integer"},CustomData:{propertyId:15,primitive:!0,type:"String"}}},SNotification:{hierarchyDepth:2e3,serializerID:107,extendss:{domainID:"400",name:"SStorable"},fields:{Id:{propertyId:0,primitive:!0,type:"String"},Kind:{propertyId:1,primitive:!0,type:"Integer"},TargetPlayerId:{propertyId:2,primitive:!0,type:"String"},TargetPublisherId:{propertyId:3,primitive:!0,type:"String"},TargetThirdPartyId:{propertyId:4,primitive:!0,type:"String"},SourcePlayerId:{propertyId:5,primitive:!0,type:"String"},SourcePlayerName:{propertyId:6,primitive:!0,type:"String"},SourcePlayerAvatar:{propertyId:7,primitive:!0,type:"String"},Text:{propertyId:8,primitive:!0,type:"String"},Image:{propertyId:9,primitive:!0,type:"String"},Tracked:{propertyId:10,primitive:!0,type:"Boolean"},Readed:{propertyId:11,primitive:!0,type:"Boolean"},RefId:{propertyId:12,primitive:!0,type:"String"},ScheduledDate:{propertyId:13,primitive:!0,type:"Long"},SendStatus:{propertyId:14,primitive:!0,type:"Integer"},SendDate:{propertyId:15,primitive:!0,type:"Long"},SendStatusText:{propertyId:16,primitive:!0,type:"String"},ExpirationDate:{propertyId:17,primitive:!0,type:"Long"},CustomData:{propertyId:18,primitive:!0,type:"String"}}},SPlayerActivityLog:{hierarchyDepth:2e3,serializerID:108,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:0,primitive:!0,type:"String"},ThirdPartyId:{propertyId:1,primitive:!0,type:"String"},PublisherId:{propertyId:2,primitive:!0,type:"String"},Category:{propertyId:3,primitive:!0,type:"String"},Action:{propertyId:4,primitive:!0,type:"String"},Label:{propertyId:5,primitive:!0,type:"String"},Value:{propertyId:6,primitive:!0,type:"Double"},ClientId:{propertyId:7,primitive:!0,type:"String"},Source:{propertyId:8,primitive:!0,type:"String"},Version:{propertyId:9,primitive:!0,type:"Long"},Verbosity:{propertyId:10,primitive:!0,type:"Integer"}}},SPlayerOffer:{hierarchyDepth:2e3,serializerID:109,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:0,primitive:!0,type:"String"},OfferId:{propertyId:1,primitive:!0,type:"String"},Status:{propertyId:3,primitive:!0,type:"Integer"},ExpirationDate:{propertyId:4,primitive:!0,type:"Long"},ItemId:{propertyId:5,primitive:!0,type:"String"},ItemQuantity:{propertyId:6,primitive:!0,type:"Integer"}}},SDiscount:{hierarchyDepth:2e3,serializerID:110,extendss:{domainID:"400",name:"SStorable"},fields:{Id:{propertyId:0,primitive:!0,type:"String"},StartDate:{propertyId:1,primitive:!0,type:"Long"},EndDate:{propertyId:2,primitive:!0,type:"Long"},ItemId:{propertyId:3,primitive:!0,type:"String"},Discount:{propertyId:4,primitive:!0,type:"Integer"},Promotion:{propertyId:5,primitive:!0,type:"String"}}},SCommunityMessage:{hierarchyDepth:2e3,serializerID:111,extendss:{domainID:"400",name:"SStorable"},fields:{Id:{propertyId:0,primitive:!0,type:"String"},PublisherId:{propertyId:1,primitive:!0,type:"String"},Lang:{propertyId:2,primitive:!0,type:"String"},Title:{propertyId:3,primitive:!0,type:"String"},Message:{propertyId:4,primitive:!0,type:"String"},ButtonTitle:{propertyId:5,primitive:!0,type:"String"},ExternalLink:{propertyId:6,primitive:!0,type:"String"},Image:{propertyId:7,primitive:!0,type:"String"},StartDate:{propertyId:8,primitive:!0,type:"Long"},EndDate:{propertyId:9,primitive:!0,type:"Long"}}},SAdvScore:{hierarchyDepth:2e3,serializerID:112,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:1,primitive:!0,type:"String"},PlayerName:{propertyId:2,primitive:!0,type:"String"},PlayerAvatar:{propertyId:3,primitive:!0,type:"String"},Level:{propertyId:4,primitive:!0,type:"Integer"},Score:{propertyId:5,primitive:!0,type:"Double"},Stars:{propertyId:6,primitive:!0,type:"Integer"},TimeEllapsed:{propertyId:7,primitive:!0,type:"Long"},CompleteCount:{propertyId:8,primitive:!0,type:"Integer"},FailureCount:{propertyId:9,primitive:!0,type:"Integer"},CustomData:{propertyId:10,primitive:!0,type:"String"}}},SAdvProgress:{hierarchyDepth:2e3,serializerID:113,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:1,primitive:!0,type:"String"},PlayerName:{propertyId:2,primitive:!0,type:"String"},PlayerAvatar:{propertyId:3,primitive:!0,type:"String"},Level:{propertyId:4,primitive:!0,type:"Integer"},Score:{propertyId:5,primitive:!0,type:"Integer"},Stars:{propertyId:6,primitive:!0,type:"Integer"},Mode:{propertyId:11,primitive:!0,type:"String"},CustomData:{propertyId:12,primitive:!0,type:"String"}}},SFriendList:{hierarchyDepth:2e3,serializerID:114,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:0,primitive:!0,type:"String"},FriendIds:{propertyId:1,list:!0,type:"String",primitive:!0}}},SDuelChampionship:{hierarchyDepth:2e3,serializerID:115,extendss:{domainID:"400",name:"SStorable"},fields:{Start:{propertyId:1,primitive:!0,type:"Long"},End:{propertyId:2,primitive:!0,type:"Long"},Open:{propertyId:3,primitive:!0,type:"Boolean"},Player1:{propertyId:4,primitive:!0,type:"String"},Player2:{propertyId:5,primitive:!0,type:"String"},P1Best:{propertyId:6,primitive:!0,type:"Double"},P2Best:{propertyId:7,primitive:!0,type:"Double"},CustomData:{propertyId:8,primitive:!0,type:"String"}}},SPlayerDuelStats:{hierarchyDepth:2e3,serializerID:116,extendss:{domainID:"400",name:"SStorable"},fields:{Id:{propertyId:0,primitive:!0,type:"String"},Player1:{propertyId:1,primitive:!0,type:"String"},Player2:{propertyId:2,primitive:!0,type:"String"},P1Victories:{propertyId:3,primitive:!0,type:"Integer"},P2Victories:{propertyId:4,primitive:!0,type:"Integer"},CustomData:{propertyId:5,primitive:!0,type:"String"}}},SPlayerProperty:{hierarchyDepth:2e3,serializerID:117,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:0,primitive:!0,type:"String"},Key:{propertyId:1,primitive:!0,type:"String"},Value:{propertyId:3,primitive:!0,type:"Double"}}},SMessage:{hierarchyDepth:2e3,serializerID:120,extendss:{domainID:"0",name:"Message"},fields:{}},STextMessage:{hierarchyDepth:3e3,serializerID:121,extendss:{domainID:"400",name:"SMessage"},fields:{From:{propertyId:0,primitive:!0,type:"String"},Text:{propertyId:1,primitive:!0,type:"String"},Kind:{propertyId:2,primitive:!0,type:"Integer"},Topic:{propertyId:3,primitive:!0,type:"String"},TopicMessageId:{propertyId:4,primitive:!0,type:"Long"}}},SRoomParameters:{hierarchyDepth:2e3,serializerID:122,extendss:{domainID:"400",name:"SStorable"},fields:{HasMaster:{propertyId:0,primitive:!0,type:"Boolean"},Expiration:{propertyId:1,primitive:!0,type:"Long"},RoomId:{propertyId:2,primitive:!0,type:"String"},Public:{propertyId:3,primitive:!0,type:"Boolean"},Custom:{propertyId:4,primitive:!0,type:"String"}}},SPublishParameters:{hierarchyDepth:2e3,serializerID:123,extendss:{domainID:"400",name:"SStorable"},fields:{PersistState:{propertyId:0,primitive:!0,type:"Boolean"}}},SPullParameters:{hierarchyDepth:2e3,serializerID:124,extendss:{domainID:"400",name:"SStorable"},fields:{State:{propertyId:0,primitive:!0,type:"Boolean"}}},SRoomState:{hierarchyDepth:2e3,serializerID:125,extendss:{domainID:"400",name:"SStorable"},fields:{Players:{propertyId:0,list:!0,type:"SPlayerRoomState",domainID:"400",reference:!0},MasterId:{propertyId:1,primitive:!0,type:"String"}}},SPlayerRoomState:{hierarchyDepth:2e3,serializerID:126,extendss:{domainID:"400",name:"SStorable"},fields:{PlayerId:{propertyId:0,primitive:!0,type:"String"},Text:{propertyId:1,primitive:!0,type:"String"}}},AuthenticateRequest:{hierarchyDepth:3e3,serializerID:1e4,extendss:{domainID:"400",name:"SRequest"},fields:{context:{propertyId:0,structure:!0,type:"nmap"}}},AuthenticateResponse:{hierarchyDepth:3e3,serializerID:10001,extendss:{domainID:"400",name:"SResponse"},fields:{AuthenticateStatus:{propertyId:-1,reference:!0,type:"AuthenticateStatus",domainId:"400"},player:{propertyId:0,reference:!0,type:"SPlayer",domainId:"400"},serverTime:{propertyId:1,primitive:!0,type:"Long"}}},SaveAchievementRequest:{hierarchyDepth:3e3,serializerID:10003,extendss:{domainID:"400",name:"SRequest"},fields:{achievement:{propertyId:0,reference:!0,type:"SPlayerAchievement",domainId:"400"}}},SaveAchievementResponse:{hierarchyDepth:3e3,serializerID:10004,extendss:{domainID:"400",name:"SResponse"},fields:{SaveAchievementStatus:{propertyId:-1,reference:!0,type:"SaveAchievementStatus",domainId:"400"},achievement:{propertyId:0,reference:!0,type:"SPlayerAchievement",domainId:"400"}}},SaveIAPRequest:{hierarchyDepth:3e3,serializerID:10006,extendss:{domainID:"400",name:"SRequest"},fields:{iap:{propertyId:0,reference:!0,type:"SIAPTransaction",domainId:"400"}}},SaveIAPResponse:{hierarchyDepth:3e3,serializerID:10007,extendss:{domainID:"400",name:"SResponse"},fields:{SaveIAPStatus:{propertyId:-1,reference:!0,type:"SaveIAPStatus",domainId:"400"},iap:{propertyId:0,reference:!0,type:"SIAPTransaction",domainId:"400"},message:{propertyId:1,primitive:!0,type:"String"}}},GetPlayerByIdRequest:{hierarchyDepth:3e3,serializerID:10009,extendss:{domainID:"400",name:"SRequest"},fields:{searchedPlayerId:{propertyId:0,primitive:!0,type:"String"}}},GetPlayerByIdResponse:{hierarchyDepth:3e3,serializerID:10010,extendss:{domainID:"400",name:"SResponse"},fields:{GetPlayerByIdStatus:{propertyId:-1,reference:!0,type:"GetPlayerByIdStatus",domainId:"400"},player:{propertyId:1,reference:!0,type:"SPlayer",domainId:"400"}}},GetPlayerByThirdPartyIdRequest:{hierarchyDepth:3e3,serializerID:10012,extendss:{domainID:"400",name:"SRequest"},fields:{publisherId:{propertyId:0,primitive:!0,type:"String"},thirdPartyId:{propertyId:1,primitive:!0,type:"String"}}},GetPlayerByThirdPartyIdResponse:{hierarchyDepth:3e3,serializerID:10013,extendss:{domainID:"400",name:"SResponse"},fields:{GetPlayerByThirdPartyIdStatus:{propertyId:-1,reference:!0,type:"GetPlayerByThirdPartyIdStatus",domainId:"400"},player:{propertyId:1,reference:!0,type:"SPlayer",domainId:"400"}}},FindScoresRequest:{hierarchyDepth:3e3,serializerID:10015,extendss:{domainID:"400",name:"SRequest"},fields:{leaderboardId:{propertyId:0,primitive:!0,type:"String"},query:{propertyId:1,reference:!0,type:"NuggetaQuery",domainId:"0"}}},FindScoresResponse:{hierarchyDepth:3e3,serializerID:10016,extendss:{domainID:"400",name:"SResponse"},fields:{FindScoresStatus:{propertyId:-1,reference:!0,type:"FindScoresStatus",domainId:"400"},scores:{propertyId:2,list:!0,type:"SScore",domainID:"400",reference:!0}}},GetBestScoresRequest:{hierarchyDepth:3e3,serializerID:10018,extendss:{domainID:"400",name:"SRequest"},fields:{leaderboardId:{propertyId:0,primitive:!0,type:"String"},start:{propertyId:1,primitive:!0,type:"Integer"},limit:{propertyId:2,primitive:!0,type:"Integer"},includeRank:{propertyId:3,primitive:!0,type:"Boolean"},limitToFriends:{propertyId:4,primitive:!0,type:"Boolean"}}},GetBestScoresResponse:{hierarchyDepth:3e3,serializerID:10019,extendss:{domainID:"400",name:"SResponse"},fields:{GetBestScoresStatus:{propertyId:-1,reference:!0,type:"GetBestScoresStatus",domainId:"400"},scores:{propertyId:0,list:!0,type:"SScore",domainID:"400",reference:!0},myBest:{propertyId:1,reference:!0,type:"SScore",domainId:"400"},myRank:{propertyId:2,primitive:!0,type:"Integer"}}},SubmitScoreRequest:{hierarchyDepth:3e3,serializerID:10021,extendss:{domainID:"400",name:"SRequest"},fields:{leaderboardId:{propertyId:0,primitive:!0,type:"String"},score:{propertyId:1,reference:!0,type:"SScore",domainId:"400"}}},SubmitScoreResponse:{hierarchyDepth:3e3,serializerID:10022,extendss:{domainID:"400",name:"SResponse"},fields:{SubmitScoreStatus:{propertyId:-1,reference:!0,type:"SubmitScoreStatus",domainId:"400"},previousScore:{propertyId:0,reference:!0,type:"SScore",domainId:"400"}}},GetAchievementsRequest:{hierarchyDepth:3e3,serializerID:10024,extendss:{domainID:"400",name:"SRequest"},fields:{}},GetAchievementsResponse:{hierarchyDepth:3e3,serializerID:10025,extendss:{domainID:"400",name:"SResponse"},fields:{GetAchievementsStatus:{propertyId:-1,reference:!0,type:"GetAchievementsStatus",domainId:"400"},achievements:{propertyId:0,list:!0,type:"SPlayerAchievement",domainID:"400",reference:!0}}},SaveNotificationRequest:{hierarchyDepth:3e3,serializerID:10027,extendss:{domainID:"400",name:"SRequest"},fields:{notification:{propertyId:0,reference:!0,type:"SNotification",domainId:"400"}}},SaveNotificationResponse:{hierarchyDepth:3e3,serializerID:10028,extendss:{domainID:"400",name:"SResponse"},fields:{SaveNotificationStatus:{propertyId:-1,reference:!0,type:"SaveNotificationStatus",domainId:"400"},notification:{propertyId:0,reference:!0,type:"SNotification",domainId:"400"}}},FindNotificationsRequest:{hierarchyDepth:3e3,serializerID:10030,extendss:{domainID:"400",name:"SRequest"},fields:{query:{propertyId:0,reference:!0,type:"NuggetaQuery",domainId:"0"}}},FindNotificationsResponse:{hierarchyDepth:3e3,serializerID:10031,extendss:{domainID:"400",name:"SResponse"},fields:{FindNotificationsStatus:{propertyId:-1,reference:!0,type:"FindNotificationsStatus",domainId:"400"},notifications:{propertyId:0,list:!0,type:"SNotification",domainID:"400",reference:!0}}},TrackPlayerRequest:{hierarchyDepth:3e3,serializerID:10033,extendss:{domainID:"400",name:"SRequest"},fields:{Activity:{propertyId:0,reference:!0,type:"SPlayerActivityLog",domainId:"400"}}},TrackPlayerResponse:{hierarchyDepth:3e3,serializerID:10034,extendss:{domainID:"400",name:"SResponse"},fields:{TrackPlayerStatus:{propertyId:-1,reference:!0,type:"TrackPlayerStatus",domainId:"400"}}},CreatePlayerRequest:{hierarchyDepth:3e3,serializerID:10036,extendss:{domainID:"400",name:"SRequest"},fields:{context:{propertyId:1,structure:!0,type:"nmap"}}},CreatePlayerResponse:{hierarchyDepth:3e3,serializerID:10037,extendss:{domainID:"400",name:"SResponse"},fields:{CreatePlayerStatus:{propertyId:-1,reference:!0,type:"CreatePlayerStatus",domainId:"400"},player:{propertyId:1,reference:!0,type:"SPlayer",domainId:"400"}}},SetFriendsRequest:{hierarchyDepth:3e3,serializerID:10039,extendss:{domainID:"400",name:"SRequest"},fields:{friends:{propertyId:2,list:!0,type:"SPlayer",domainID:"400",reference:!0}}},SetFriendsResponse:{hierarchyDepth:3e3,serializerID:10040,extendss:{domainID:"400",name:"SResponse"},fields:{SetFriendsStatus:{propertyId:-1,reference:!0,type:"SetFriendsStatus",domainId:"400"}}},GetFriendsRequest:{hierarchyDepth:3e3,serializerID:10042,extendss:{domainID:"400",name:"SRequest"},fields:{searchedPlayerId:{propertyId:0,primitive:!0,type:"String"},start:{propertyId:1,primitive:!0,type:"Integer"},limit:{propertyId:2,primitive:!0,type:"Integer"}}},GetFriendsResponse:{hierarchyDepth:3e3,serializerID:10043,extendss:{domainID:"400",name:"SResponse"},fields:{GetFriendsStatus:{propertyId:-1,reference:!0,type:"GetFriendsStatus",domainId:"400"},friends:{propertyId:0,list:!0,type:"SPlayer",domainID:"400",reference:!0}}},GetStateRequest:{hierarchyDepth:3e3,serializerID:10045,extendss:{domainID:"400",name:"SRequest"},fields:{context:{propertyId:0,structure:!0,type:"nmap"},filter:{propertyId:1,primitive:!0,type:"Long"}}},GetStateResponse:{hierarchyDepth:3e3,serializerID:10046,extendss:{domainID:"400",name:"SResponse"},fields:{GetStateStatus:{propertyId:-1,reference:!0,type:"GetStateStatus",domainId:"400"},Storables:{propertyId:0,list:!0,type:"Storable",domainID:"0",reference:!0}}},SubmitAdvProgressRequest:{hierarchyDepth:3e3,serializerID:10060,extendss:{domainID:"400",name:"SRequest"},fields:{level:{propertyId:2,primitive:!0,type:"Integer"},score:{propertyId:3,primitive:!0,type:"Double"},stars:{propertyId:4,primitive:!0,type:"Integer"},timeEllapsed:{propertyId:5,primitive:!0,type:"Long"},completed:{propertyId:6,primitive:!0,type:"Boolean"},mode:{propertyId:7,primitive:!0,type:"String"},scoreCustomData:{propertyId:8,reference:!0,type:"SAdvScore",domainId:"400"},progressCustomData:{propertyId:9,reference:!0,type:"SAdvProgress",domainId:"400"}}},SubmitAdvProgressResponse:{hierarchyDepth:3e3,serializerID:10061,extendss:{domainID:"400",name:"SResponse"},fields:{SubmitAdvProgressStatus:{propertyId:-1,reference:!0,type:"SubmitAdvProgressStatus",domainId:"400"},myScore:{propertyId:1,reference:!0,type:"SAdvScore",domainId:"400"},bestScores:{propertyId:2,list:!0,type:"SAdvScore",domainID:"400",reference:!0},newProgress:{propertyId:3,reference:!0,type:"SAdvProgress",domainId:"400"}}},GetAdvProgressRequest:{hierarchyDepth:3e3,serializerID:10063,extendss:{domainID:"400",name:"SRequest"},fields:{mode:{propertyId:2,primitive:!0,type:"String"}}},GetAdvProgressResponse:{hierarchyDepth:3e3,serializerID:10064,extendss:{domainID:"400",name:"SResponse"},fields:{GetAdvProgressStatus:{propertyId:-1,reference:!0,type:"GetAdvProgressStatus",domainId:"400"},progress:{propertyId:1,reference:!0,type:"SAdvProgress",domainId:"400"},scores:{propertyId:2,list:!0,type:"SAdvScore",domainID:"400",reference:!0}}},GetAdvFriendsProgressRequest:{hierarchyDepth:3e3,serializerID:10066,extendss:{domainID:"400",name:"SRequest"},fields:{levelMin:{propertyId:2,primitive:!0,type:"Integer"},levelMax:{propertyId:3,primitive:!0,type:"Integer"},mode:{propertyId:4,primitive:!0,type:"String"}}},GetAdvFriendsProgressResponse:{hierarchyDepth:3e3,serializerID:10067,extendss:{domainID:"400",name:"SResponse"},fields:{GetAdvFriendsProgressStatus:{propertyId:-1,reference:!0,type:"GetAdvFriendsProgressStatus",domainId:"400"},friendsProgress:{propertyId:1,list:!0,type:"SAdvProgress",domainID:"400",reference:!0}}},GetAdvScoresRequest:{hierarchyDepth:3e3,serializerID:10069,extendss:{domainID:"400",name:"SRequest"},fields:{levelMin:{propertyId:2,primitive:!0,type:"Integer"},levelMax:{propertyId:3,primitive:!0,type:"Integer"},mode:{propertyId:4,primitive:!0,type:"String"}}},GetAdvScoresResponse:{hierarchyDepth:3e3,serializerID:10070,extendss:{domainID:"400",name:"SResponse"},fields:{GetAdvScoresStatus:{propertyId:-1,reference:!0,type:"GetAdvScoresStatus",domainId:"400"},scores:{propertyId:1,list:!0,type:"SAdvScore",domainID:"400",reference:!0}}},GetAdvFriendsScoresRequest:{hierarchyDepth:3e3,serializerID:10072,extendss:{domainID:"400",name:"SRequest"},fields:{level:{propertyId:2,primitive:!0,type:"Integer"},mode:{propertyId:3,primitive:!0,type:"String"}}},GetAdvFriendsScoresResponse:{hierarchyDepth:3e3,serializerID:10073,extendss:{domainID:"400",name:"SResponse"},fields:{GetAdvFriendsScoresStatus:{propertyId:-1,reference:!0,type:"GetAdvFriendsScoresStatus",domainId:"400"},scores:{propertyId:1,list:!0,type:"SAdvScore",domainID:"400",reference:!0}}},SaveAdvProgressRequest:{hierarchyDepth:3e3,serializerID:10075,extendss:{domainID:"400",name:"SRequest"},fields:{mode:{propertyId:2,primitive:!0,type:"String"},progress:{propertyId:3,reference:!0,type:"SAdvProgress",domainId:"400"}}},SaveAdvProgressResponse:{hierarchyDepth:3e3,serializerID:10076,extendss:{domainID:"400",name:"SResponse"},fields:{SaveAdvProgressStatus:{propertyId:-1,reference:!0,type:"SaveAdvProgressStatus",domainId:"400"},progress:{propertyId:1,reference:!0,type:"SAdvProgress",domainId:"400"}}},FindStorablesRequest:{hierarchyDepth:3e3,serializerID:10090,extendss:{domainID:"400",name:"SRequest"},fields:{namespace:{propertyId:0,primitive:!0,type:"String"},query:{propertyId:1,reference:!0,type:"NuggetaQuery",domainId:"0"}}},FindStorablesResponse:{hierarchyDepth:3e3,serializerID:10091,extendss:{domainID:"400",name:"SResponse"},fields:{FindStorablesStatus:{propertyId:-1,reference:!0,type:"FindStorablesStatus",domainId:"400"},storables:{propertyId:0,list:!0,type:"Storable",domainID:"0",reference:!0}}},SaveStorableRequest:{hierarchyDepth:3e3,serializerID:10093,extendss:{domainID:"400",name:"SRequest"},fields:{namespace:{propertyId:0,primitive:!0,type:"String"},storable:{propertyId:1,reference:!0,type:"Storable",domainId:"0"}}},SaveStorableResponse:{hierarchyDepth:3e3,serializerID:10094,extendss:{domainID:"400",name:"SResponse"},fields:{SaveStorableStatus:{propertyId:-1,reference:!0,type:"SaveStorableStatus",domainId:"400"},storable:{propertyId:0,reference:!0,type:"Storable",domainId:"0"}}},SaveStorableDiffRequest:{hierarchyDepth:3e3,serializerID:10096,extendss:{domainID:"400",name:"SRequest"},fields:{namespace:{propertyId:0,primitive:!0,type:"String"},storable:{propertyId:1,reference:!0,type:"Storable",domainId:"0"}}},SaveStorableDiffResponse:{hierarchyDepth:3e3,serializerID:10097,extendss:{domainID:"400",name:"SResponse"},fields:{SaveStorableDiffStatus:{propertyId:-1,reference:!0,type:"SaveStorableDiffStatus",domainId:"400"},storable:{propertyId:0,reference:!0,type:"Storable",domainId:"0"}}},RemoveStorableRequest:{hierarchyDepth:3e3,serializerID:10099,extendss:{domainID:"400",name:"SRequest"},fields:{namespace:{propertyId:0,primitive:!0,type:"String"},storableId:{propertyId:1,primitive:!0,type:"String"}}},RemoveStorableResponse:{hierarchyDepth:3e3,serializerID:10100,extendss:{domainID:"400",name:"SResponse"},fields:{RemoveStorableStatus:{propertyId:-1,reference:!0,type:"RemoveStorableStatus",domainId:"400"}}},SaveStorablesRequest:{hierarchyDepth:3e3,serializerID:10102,extendss:{domainID:"400",name:"SRequest"},fields:{namespace:{propertyId:0,primitive:!0,type:"String"},storables:{propertyId:1,list:!0,type:"Storable",domainID:"0",reference:!0}}},SaveStorablesResponse:{hierarchyDepth:3e3,serializerID:10103,extendss:{domainID:"400",name:"SResponse"},fields:{SaveStorablesStatus:{propertyId:-1,reference:!0,type:"SaveStorablesStatus",domainId:"400"},storables:{propertyId:0,list:!0,type:"Storable",domainID:"0",reference:!0}}},FindAndModifyStorablesRequest:{hierarchyDepth:3e3,serializerID:10105,extendss:{domainID:"400",name:"SRequest"},fields:{namespace:{propertyId:0,primitive:!0,type:"String"},filter:{propertyId:1,reference:!0,type:"NuggetaQuery",domainId:"0"},update:{propertyId:2,reference:!0,type:"Storable",domainId:"0"},upsert:{propertyId:3,primitive:!0,type:"Boolean"}}},FindAndModifyStorablesResponse:{hierarchyDepth:3e3,serializerID:10106,extendss:{domainID:"400",name:"SResponse"},fields:{FindAndModifyStorablesStatus:{propertyId:-1,reference:!0,type:"FindAndModifyStorablesStatus",domainId:"400"},storables:{propertyId:0,list:!0,type:"Storable",domainID:"0",reference:!0}}},GetDuelChampionshipRequest:{hierarchyDepth:3e3,serializerID:10120,extendss:{domainID:"400",name:"SRequest"},fields:{player1:{propertyId:1,primitive:!0,type:"String"},player2:{propertyId:2,primitive:!0,type:"String"}}},GetDuelChampionshipResponse:{hierarchyDepth:3e3,serializerID:10121,extendss:{domainID:"400",name:"SResponse"},fields:{GetDuelChampionshipStatus:{propertyId:-1,reference:!0,type:"GetDuelChampionshipStatus",domainId:"400"},current:{propertyId:1,reference:!0,type:"SDuelChampionship",domainId:"400"},stats:{propertyId:2,reference:!0,type:"SPlayerDuelStats",domainId:"400"}}},SubmitDuelChampionshipScoreRequest:{hierarchyDepth:3e3,serializerID:10123,extendss:{domainID:"400",name:"SRequest"},fields:{championshipId:{propertyId:1,primitive:!0,type:"String"},score:{propertyId:2,primitive:!0,type:"Double"}}},SubmitDuelChampionshipScoreResponse:{hierarchyDepth:3e3,serializerID:10124,extendss:{domainID:"400",name:"SResponse"},fields:{SubmitDuelChampionshipScoreStatus:{propertyId:-1,reference:!0,type:"SubmitDuelChampionshipScoreStatus",domainId:"400"},current:{propertyId:1,reference:!0,type:"SDuelChampionship",domainId:"400"},stats:{propertyId:2,reference:!0,type:"SPlayerDuelStats",domainId:"400"}}},GetBestServersRequest:{hierarchyDepth:3e3,serializerID:10150,extendss:{domainID:"400",name:"SRequest"},fields:{}},GetBestServersResponse:{hierarchyDepth:3e3,serializerID:10151,extendss:{domainID:"400",name:"SResponse"},fields:{GetBestServersStatus:{propertyId:-1,reference:!0,type:"GetBestServersStatus",domainId:"400"},servers:{propertyId:1,list:!0,type:"String",primitive:!0}}},CreateRoomRequest:{hierarchyDepth:3e3,serializerID:10153,extendss:{domainID:"400",name:"SRequest"},fields:{parameters:{propertyId:0,reference:!0,type:"SRoomParameters",domainId:"400"}}},CreateRoomResponse:{hierarchyDepth:3e3,serializerID:10154,extendss:{domainID:"400",name:"SResponse"},fields:{CreateRoomStatus:{propertyId:-1,reference:!0,type:"CreateRoomStatus",domainId:"400"},roomId:{propertyId:0,primitive:!0,type:"String"}}},SubscribeRequest:{hierarchyDepth:3e3,serializerID:10156,extendss:{domainID:"400",name:"SRequest"},fields:{topic:{propertyId:0,primitive:!0,type:"String"},parameters:{propertyId:1,reference:!0,type:"SRoomParameters",domainId:"400"}}},SubscribeResponse:{hierarchyDepth:3e3,serializerID:10157,extendss:{domainID:"400",name:"SResponse"},fields:{SubscribeStatus:{propertyId:-1,reference:!0,type:"SubscribeStatus",domainId:"400"},members:{propertyId:0,list:!0,type:"String",primitive:!0},totalMembers:{propertyId:1,primitive:!0,type:"Integer"}}},PublishRequest:{hierarchyDepth:3e3,serializerID:10159,extendss:{domainID:"400",name:"SRequest"},fields:{topic:{propertyId:0,primitive:!0,type:"String"},message:{propertyId:1,reference:!0,type:"STextMessage",domainId:"400"},parameters:{propertyId:2,reference:!0,type:"SPublishParameters",domainId:"400"}}},PublishResponse:{hierarchyDepth:3e3,serializerID:10160,extendss:{domainID:"400",name:"SResponse"},fields:{PublishStatus:{propertyId:-1,reference:!0,type:"PublishStatus",domainId:"400"}}},UnsubscribeRequest:{hierarchyDepth:3e3,serializerID:10162,extendss:{domainID:"400",name:"SRequest"},fields:{topic:{propertyId:0,primitive:!0,type:"String"}}},UnsubscribeResponse:{hierarchyDepth:3e3,serializerID:10163,extendss:{domainID:"400",name:"SResponse"},fields:{UnsubscribeStatus:{propertyId:-1,reference:!0,type:"UnsubscribeStatus",domainId:"400"}}},PullRequest:{hierarchyDepth:3e3,serializerID:10165,extendss:{domainID:"400",name:"SRequest"},fields:{topic:{propertyId:0,primitive:!0,type:"String"},parameters:{propertyId:1,reference:!0,type:"SPullParameters",domainId:"400"}}},PullResponse:{hierarchyDepth:3e3,serializerID:10166,extendss:{domainID:"400",name:"SResponse"},fields:{PullStatus:{propertyId:-1,reference:!0,type:"PullStatus",domainId:"400"},state:{propertyId:0,reference:!0,type:"SRoomState",domainId:"400"}}},GetPublicRoomRequest:{hierarchyDepth:3e3,serializerID:10168,extendss:{domainID:"400",name:"SRequest"},fields:{parameters:{propertyId:0,reference:!0,type:"SStorable",domainId:"400"}}},GetPublicRoomResponse:{hierarchyDepth:3e3,serializerID:10169,extendss:{domainID:"400",name:"SResponse"},fields:{GetPublicRoomStatus:{propertyId:-1,reference:!0,type:"GetPublicRoomStatus",domainId:"400"},topics:{propertyId:0,list:!0,type:"String",primitive:!0},membersCount:{propertyId:1,list:!0,type:"Integer",primitive:!0}}}},methods:{authenticate:{parameters:["context"]},saveAchievement:{parameters:["achievement"]},saveIAP:{parameters:["iap"]},getPlayerById:{parameters:["searchedPlayerId"]},getPlayerByThirdPartyId:{parameters:["publisherId","thirdPartyId"]},findScores:{parameters:["leaderboardId","query"]},getBestScores:{parameters:["leaderboardId","start","limit","includeRank","limitToFriends"]},submitScore:{parameters:["leaderboardId","score"]},getAchievements:{parameters:[]},saveNotification:{parameters:["notification"]},findNotifications:{parameters:["query"]},trackPlayer:{parameters:["Activity"]},createPlayer:{parameters:["context"]},setFriends:{parameters:["friends"]},getFriends:{parameters:["searchedPlayerId","start","limit"]},getState:{parameters:["context","filter"]},submitAdvProgress:{parameters:["level","score","stars","timeEllapsed","completed","mode","scoreCustomData","progressCustomData"]},getAdvProgress:{parameters:["mode"]},getAdvFriendsProgress:{parameters:["levelMin","levelMax","mode"]},getAdvScores:{parameters:["levelMin","levelMax","mode"]},getAdvFriendsScores:{parameters:["level","mode"]},saveAdvProgress:{parameters:["mode","progress"]},findStorables:{parameters:["namespace","query"]},saveStorable:{parameters:["namespace","storable"]},saveStorableDiff:{parameters:["namespace","storable"]},removeStorable:{parameters:["namespace","storableId"]},saveStorables:{parameters:["namespace","storables"]},findAndModifyStorables:{parameters:["namespace","filter","update","upsert"]},getDuelChampionship:{parameters:["player1","player2"]},submitDuelChampionshipScore:{parameters:["championshipId","score"]},getBestServers:{parameters:[]},createRoom:{parameters:["parameters"]},subscribe:{parameters:["topic","parameters"]},publish:{parameters:["topic","message","parameters"]},unsubscribe:{parameters:["topic"]},pull:{parameters:["topic","parameters"]},getPublicRoom:{parameters:["parameters"]}}}),window.gs=gs,function(r){var t=function(){function t(t,e,i){if(this.id=t,this.config=e,this._available=!1,this._available=this.isAvailable(),this.id=t+"-"+e.gameId+e.publisher,this._available){var n=localStorage.getItem(this.id);this._cacheData=r.json.parse(n,i)}else this._cacheData=i}return t.prototype.isAvailable=function(){try{return localStorage.setItem("test123456789","test123456789"),localStorage.removeItem("test123456789"),!0}catch(t){return!1}},t.prototype.get=function(){return this._cacheData},t.prototype.save=function(){this._available&&localStorage.setItem(this.id,JSON.stringify(this._cacheData))},t}();r.LocalCache=t}(ship||(ship={})),function(o){var t=function(){function t(){this.width=.95,this.height=.7,this.destroyed=!1,this.onResizeBound=this.onResize.bind(this)}return t.prototype.onResize=function(){var t=o.util.getWindowSize(),e=t.width*this.width,i=t.height*this.height,n=(t.width-e)/2,r=(t.height-i)/2;this.main.style.width=e+"px",this.main.style.height=i+"px",this.main.style.left=n+"px",this.main.style.top=r+"px"},t.prototype.build=function(){o.util.getResizehandlers().add(this.onResizeBound),this.overlay=document.createElement("div"),this.overlay.style.position="absolute",this.overlay.style.zIndex="15",this.overlay.style.top="0",this.overlay.style.left="0",this.overlay.style.right="0",this.overlay.style.bottom="0",this.overlay.style.backgroundColor="rgba(0, 0, 0, 0.7)",this.main=document.createElement("div"),this.main.style.position="relative",this.main.style.backgroundColor="white",this.overlay.appendChild(this.main),document.body.appendChild(this.overlay)},t.prototype.afterBuild=function(){},t.prototype.use3RowLayout=function(){var t=new o.DOMVerticalLayout;t.getElement().style.width="100%",t.getElement().style.height="100%",this.main.appendChild(t.getElement());var e=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div");t.add(e).style.textAlign="center";var r=t.add(i);return r.style.height="100%",r.style.textAlign="center",r.style.verticalAlign="middle",t.add(n).style.textAlign="center",{header:e,body:i,footer:n}},t.prototype.addCloseButton=function(){var t=this,e=document.createElement("div");return e.innerHTML="<b>X</b>",e.style.fontSize="35px",e.style.position="absolute",e.style.top="0px",e.style.right="10px",e.style.cursor="pointer",this.main.appendChild(e),e.onclick=function(){t.manualClose()},e},t.prototype.setAutoClose=function(){var t=this;this.overlay.onclick=function(){t.manualClose()},this.main.onclick=function(t){t.stopPropagation()}},t.prototype.setContent=function(t){this.main.appendChild(t)},t.prototype.show=function(){this.build(),this.onResize(),this.afterBuild()},t.prototype.close0=function(){this.destroyed=!0,this.overlay.parentElement.removeChild(this.overlay),o.util.getResizehandlers().remove(this.onResizeBound)},t.prototype.manualClose=function(){this.close0()},t.prototype.close=function(){this.close0()},t}();o.DOMPopup=t}(ship||(ship={})),function(t){var e=function(){function t(){this.table=document.createElement("table")}return t.prototype.getElement=function(){return this.table},t.prototype.add=function(t){var e=document.createElement("tr"),i=document.createElement("td");return this.table.appendChild(e),e.appendChild(i),null!=t&&i.appendChild(t),i},t}();t.DOMVerticalLayout=e}(ship||(ship={})),function(r){var t=function(){function t(t){this.gs=t,this._authCompleteHandler=new r.Handlers,this._authComplete=!1,this._updates=[],this._saveScheduled=!1}return t.prototype._onAuthenticationComplete=function(t){this._player=t,this._authComplete=!0,this._saveToCache(),this._authCompleteHandler.fire()},t.prototype.onAuthenticationComplete=function(t){this._authComplete?t():this._authCompleteHandler.once(t)},t.prototype.getPlayer=function(e){if(this._authComplete)e(this._player);else{var i=this,n=!1;setTimeout(function(){if(!n){n=!0,r.logger.warn("No player data loaded after 1000ms.");var t=i._getPlayer();e(t)}},1e3),this._authCompleteHandler.once(function(){if(!n){n=!0;var t=i._getPlayer();e(t)}})}},t.prototype.savePlayerDiff=function(t){if(null==this._player&&this._getPlayer(),r.json.merge(t,this._player),this._updates.push(t),!this._saveScheduled){var e=this;this._saveScheduled=!0,setTimeout(function(){e._saveScheduled=!1,e._doSaveDiff()},50)}},t.prototype._doSaveDiff=function(){var t=this,e=!0;if(this.gs.isPlayerAuthenticated()?null==this._player.getStoreId()&&(e=!1):e=!1,this._saveToCache(),e){var i=this._getAllPendingUpdates();if(this._updates=[],!this.gs.disabled){var n=new gs.SaveStorableDiffRequest;n.setNamespace("players"),n.setStorable(i),this.gs.sendRequest(n,function(){},function(){t._updates.splice(0,0,i),t._rescheduleSave()})}}else this._rescheduleSave()},t.prototype._rescheduleSave=function(){var t=this;setTimeout(function(){t.savePlayerDiff(new gs.SPlayer)},5e3)},t.prototype._getAllPendingUpdates=function(){var t=new gs.SPlayer;null!=this._player.getStoreId()&&t.setStoreId(this._player.getStoreId());for(var e=0;e<this._updates.length;e++)r.json.merge(this._updates[e],t);return t},t.prototype.savePlayerDiffAndFlush=function(t,e){var i=!0;if(this.gs.isPlayerAuthenticated()?null==this._player.getStoreId()&&(i=!1):i=!1,!i)return r.logger.error("Unable to flush un-identified player"),void e(null);r.json.merge(t,this._player),this._saveToCache(),t.setStoreId(this._player.getStoreId()),this.gs.shipapi.saveStorableDiffRequest("players",t,function(t){e(t.getStorable())})},t.prototype._getPlayer=function(){if(null==this._player){var t=this.gs.getCache().get();if(null==t.player)this._player=this._newPlayer();else try{this._player=this.gs.decode(t.player)}catch(t){r.logger.error("Failed to read player data",t),this._player=this._newPlayer()}}return this._player},t.prototype._newPlayer=function(){var t=new gs.SPlayer;return t.setId("na"),t.setThirdPartyId("na"),t.setPublisherId(r.Ship.get().config.publisher),t},t.prototype._saveToCache=function(){var t=this.gs.encode(this._player),e=this.gs.getCache().get();if(e.player=t,0<this._updates.length){var i=this._getAllPendingUpdates(),n=this.gs.encode(i);e.player0=n}else e.player0=null;this.gs.getCache().save()},t}();r.PlayerManager=t}(ship||(ship={})),function(t){var e=function(){function t(t){this.gs=t}return t.prototype._onAuthenticationComplete=function(t){},t.prototype.submitScore=function(t,e){var i=this.getBestScore(t);if(!(null!=i&&e<=i)&&(this._cacheNewBest(t,e),this.gs.isPlayerAuthenticated()&&!this.gs.disableNetwork)){var n=new gs.SScore;n.setValue(e),this.gs.shipapi.submitScoreRequest(t,n,function(t){})}},t.prototype.getBestScore=function(t){var e=this.gs.getCache().get();return null==e.scores||null==e.scores[t]?0:e.scores[t]},t.prototype.getScores=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=20),this.gs.shipapi.getBestScoresRequest(t,i,n,!0,!1,function(t){e(t)})},t.prototype._cacheNewBest=function(t,e){var i=this.gs.getCache().get();null==i.scores&&(i.scores={}),i.scores[t]=e,this.gs.getCache().save()},t}();t.ScoreManager=e}(ship||(ship={})),function(u){function o(t){if(null==t)return null;for(var e=0,i=t.split("."),n=2;0<=n;n--)if(i.length>n){var r=parseInt(i[n]);0==n?r*=1e4:1==n&&(r*=100),e+=r}return e}u.getVersionAsLong=o;var t=function(){function r(){this.disabled=!1,this._authenticated=!1;var e=r._INSTANCE=this,t=u.Ship.get().config,i=o(t.gameVersion);this._versionId=i,this._gameId=t.gameId,this._cache=new u.LocalCache("gs",t,{}),this._plug=(new gs.DisconnectedPlug).init(),this._plug.setEndpoint(t.gsUrl),this._plug.addDomain((new gs.NuggetaCoreDomain).init()),this.shipapi=(new gs.ShipGsDisconnectedApi).init(),this.shipapi.fill=function(t){t instanceof gs.SRequest&&(t.setGameId(e._gameId),t.setGameVersion(e._versionId),t.setPlayerId(e._playerId))},this.shipapi.setDisconnectedPlug(this._plug),this._scoreManager=new u.ScoreManager(this),this._playerManager=new u.PlayerManager(this);var n=this.getCachedPlayerId();null!=n&&(this._playerId=n),u.util.patchGs(),this._plug.addDomain((new gs.ShipGsServerDomain).init())}return r.prototype.onAuthenticationComplete=function(t){this._playerId=t.getId(),this._player=t,this._authenticated=!0,this._scoreManager._onAuthenticationComplete(t),this._playerManager._onAuthenticationComplete(t)},r.prototype.sendRequest=function(t,e,i){t.setGameId(this._gameId),t.setGameVersion(this._versionId),t.setPlayerId(this._playerId),this._plug.request(t,e,i)},r.prototype.trackPlayer=function(t,e,i,n,r){if(!this.disabled){var o=u.Ship.get().config,s=this.getCachedThirdPartyId(),a=this.getCachedPlayerId(),l=null!=this._player?this._player.getSource():null,h=new gs.SPlayerActivityLog;h.setAction(i),h.setCategory(e),h.setLabel(n),h.setPlayerId(a),h.setPublisherId(o.publisher),h.setSource(l),h.setThirdPartyId(s),h.setValue(r),h.setVerbosity(t),h.setVersion(this._versionId),this.shipapi.trackPlayerRequest(h,function(t){})}},r.get=function(){return this._INSTANCE},r.prototype.encode=function(t){return this._plug.encode(t)},r.prototype.decode=function(t){return this._plug.decode(t)},r.prototype.isPlayerAuthenticated=function(){return this._authenticated},r.prototype.isReady=function(){return null!=this._playerId},r.prototype.getCache=function(){return this._cache},r.prototype.getCachedThirdPartyId=function(){if(null!=this._player&&null!=this._player.getThirdPartyId()&&"na"!=this._player.getThirdPartyId())return this._player.getThirdPartyId();var t=this._readPlayerCache();return null!=t&&"na"!=t.getThirdPartyId()?t.getThirdPartyId():null},r.prototype.getCachedPlayerId=function(){if(null!=this._player&&null!=this._player.getId()&&"na"!=this._player.getId())return this._player.getId();var t=this._readPlayerCache();return null!=t&&"na"!=t.getId()?t.getId():null},r.prototype._readPlayerCache=function(){var t=this._cache.get();return null==t.player?null:this.decode(t.player)},Object.defineProperty(r.prototype,"playerManager",{get:function(){return this._playerManager},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreManager",{get:function(){return this._scoreManager},enumerable:!0,configurable:!0}),r.prototype.safeInt=function(t){return null==t?0:t},r.prototype.getBooster=function(t){var e=this.playerManager._getPlayer();return t==u.ItemType.Coin?this.safeInt(e.getWallet()):t==u.ItemType.FortuneWheel?this.safeInt(e.getFortuneWheels()):t==u.ItemType.Life?this.safeInt(e.getLifes()):(t==u.ItemType.Premium||u.logger.error("No mapping found for item type: "+t.name),0)},r.prototype.disableNetwork=function(){this._plug.request=function(e,t,i){u.logger.error("Network disable. Will not send "+e),setTimeout(function(){if(i){var t=new gs.NuggetaExceptionMessage;t.setReason("Network disable. Message ignored: "+e.getDomainID+"/"+e.getSerializerID),i(t)}},50)},this.disabled=!0},r}();u.ShipGs=t}(ship||(ship={})),function(t){var e=function(){function i(t,e){this.name=t,this.id=e,i.valuesById[e+""]=this,i.valuesByName[t]=this,i.all.push(this)}return i.fromValue=function(t){return i.valuesById[t+""]},i.fromName=function(t){return i.valuesByName[t]},i.valuesById={},i.valuesByName={},i.all=[],i.Coin=new i("Coin",-1),i.FortuneWheel=new i("FortuneWheel",-2),i.Life=new i("Life",-3),i.Premium=new i("Premium",-4),i}();t.ItemType=e}(ship||(ship={})),function(t){var e=function(){function t(){}return t.PENDING=1,t.STARTED=2,t.ABORTED=3,t.FAILED=4,t.VALIDATED=5,t.COMPLETE=6,t}();t.SIAPTransactionStatus=e}(ship||(ship={})),function(e){var t=function(){function t(){this.gs=e.ShipGs.get(),this.ship=e.Ship.get()}return t.prototype.canShowInterstitial=function(){return!1},t.prototype.showInterstitial=function(t){t(!1)},t.prototype.canShowRewardedVideo=function(){return!1},t.prototype.showRewardedVideo=function(t){t(!1)},t}();e.DefaultAdsManager=t}(ship||(ship={})),function(i){var t=function(){function t(){this.gs=i.ShipGs.get(),this.ship=i.Ship.get()}return t.prototype.authenticate=function(t){t(null)},t.prototype.saveServerTime=function(t){if(null!=t.getServerTime()){var e=Date.now()-t.getServerTime();i.util.serverTimeDiff=e}},t}();i.DefaultAuthenticationManager=t}(ship||(ship={})),function(e){var t=function(){function t(){this.gs=e.ShipGs.get(),this.ship=e.Ship.get()}return t.prototype.startGame=function(t){e.logger.debug("Start game"),t()},t.prototype.endGame=function(t){e.logger.debug("End game"),t()},t}();e.DefaultGameActionManager=t}(ship||(ship={})),function(o){var t=function(){function t(){this.packageById={},this.gs=o.ShipGs.get(),this.ship=o.Ship.get(),this._loadPackages()}return t.prototype.buildItemPurchase=function(t){var e=this.packageById[t];return{itemId:t,price:e.price,quantity:e.quantity,name:null,customData:null,discountId:null,externalProductId:null}},t.prototype.startIAP=function(t,e){var i=this.packageById[t.itemId],n=this.gs.getBooster(i.type),r=new gs.SIAPTransaction;r.setDiscountId(t.discountId),r.setExternalItemId(t.externalProductId),r.setItemId(t.itemId),r.setItemType(i.type.name),r.setPrice(t.price),r.setQuantity(t.quantity),r.setInventoryQuantity(n),r.setStatus(o.SIAPTransactionStatus.PENDING),this.gs.shipapi.saveIAPRequest(r,function(t){t.getSaveIAPStatus()==gs.SaveIAPStatus.SUCCESS&&e(t.getIap())})},t.prototype.getDiscountPrice=function(t,e){return e<=0||100<=e?t:t-t*e/100},t.prototype.getPackageById=function(t){return this.packageById[t]},t.prototype._loadPackages=function(){if(null==this.ship.config.packages||this.ship.config.packages.length<=0)o.logger.debug("No item packages.");else for(var t=0;t<this.ship.config.packages.length;t++){var e=this.ship.config.packages[t];this.packageById[e.id]=e}},t.prototype.continueIAP=function(t){var e=new gs.SIAPTransaction;e.setId(t.getId()),e.setStatus(o.SIAPTransactionStatus.STARTED),this.gs.shipapi.saveIAPRequest(e,function(t){})},t}();o.DefaultIAPManager=t}(ship||(ship={})),function(e){var t=function(){function t(){this._readyFired=!1,(t.INSTANCE=this).ship=e.Ship.get()}return t.get=function(){return this.INSTANCE},t.prototype.setReadyCallback=function(t){this._readyCb=t},t.prototype.fireReady=function(){null!=this._readyCb?null!=this._readyFired?this._readyCb():e.logger.error("PublisherService.readyCb already called"):e.logger.error("PublisherService.readyCb is null")},t.prototype.getAuthenticationManager=function(){return this.authenticationManager},t.prototype.getShareManager=function(){return this.shareManager},t.prototype.getIAPManager=function(){return this.iapManager},t.prototype.getGameActionManager=function(){return this.gameActionManager},t.prototype.getAdsManager=function(){return this.adsManager},t}();e.DefaultPublisherService=t}(ship||(ship={})),function(l){var t=function(){function t(){this.uploadedImages={},this.uploadingImages={},this.gs=l.ShipGs.get(),this.ship=l.Ship.get()}return t.prototype.share=function(t,e,i){l.logger.error("Share not implemented"),i({count:0,imageUrl:null})},t.prototype.isB64Image=function(t){return null!=t&&(0!=t.indexOf("http")&&0!=t.indexOf("//"))},t.prototype.uploadImage=function(t,e,i,n){var r=this.uploadedImages[t];if(null==r){var o=this.uploadingImages[t];if(null!=o&&1==o)return l.logger.error("Image "+t+" already uploading."),void n();this.doUploadImage(t,e,i,n)}else i(r)},t.prototype.doUploadImage=function(r,t,o,s){this.uploadingImages[r]=!0;try{var a=this,e="//"+this.ship.config.serverUrl+"/s/image/upload",i="img="+encodeURIComponent(t);l.XHR.post(e,i,function(t,e){if(a.uploadingImages[r]=null,200==e){var i=l.json.parse(t,null);if(null!=i&&"ok"==i.status){var n=i.url;a.uploadedImages[r]=n,o(n)}else s()}else s()})}catch(t){l.logger.error("Error occured while uploadind image id:"+r,t),s()}},t}();l.DefaultShareManager=t}(ship||(ship={})),function(t){var e=function(){};(ship||(ship={})).ItemPurchase=e}(),function(o){var t=function(){function n(t,e){this.config=t,this._loadingProgress=-1,this._readyCalled=!1,this._isReady=!1,this._lastStartTime=Date.now(),(n._INSTANCE=this).gs=null==e?new o.ShipGs:e,this._progressListener=new o.Handlers,this._service=this.createService(t.publisher);var i=this;this._service.setReadyCallback(function(){i._isReady=!0,null!=i._readyCallback&&(i._readyCalled=!0,i._readyCallback())}),this._apiReporter=new o.ApiReporter,this._activityTracker=new o.ActivityTracker,o.logger.debug("Start "+t.publisher+" authentication."),this._service.getAuthenticationManager().authenticate(function(t){o.logger.debug("Authentication complete. "+t.getId()),i.gs.onAuthenticationComplete(t),i._apiReporter._onAuthenticationComplete(t),i._activityTracker._onAuthenticationComplete(t),i._checkApiImplemented()}),o.initErrorTracker()}return n.get=function(){return this._INSTANCE},Object.defineProperty(n.prototype,"service",{get:function(){return this._service},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"shareManager",{get:function(){return this._service.getShareManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"iapManager",{get:function(){return this._service.getIAPManager()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"adsManager",{get:function(){return this._service.getAdsManager()},enumerable:!0,configurable:!0}),n.prototype.createService=function(t){var e="DummyPublisherService";null!=this.config.customData&&null!=this.config.customData.publisherServiceClass?e=this.config.customData.publisherServiceClass:"okru"==t?e="OkRuPublisherService":"facebook"==t?e="FacebookPublisherService":"fbmessenger"==t?e="FBMessengerPublisherService":"external"==t?e="ExternalPublisherService":"vk"==t?e="VkPublisherService":"gd"==t?e="GdPublisherService":"lagged"==t&&(e="LaggedPublisherService");var i=Object.create(o[e].prototype);return i.constructor.apply(i),i},n.prototype._muteSound=function(t){null!=this._muteSoundCallback?this._muteSoundCallback(t):o.logger.error("No toggle sound callback. Check your api impl.")},n.prototype._checkApiImplemented=function(){null==this._muteSoundCallback&&this._apiReporter.reportListenerMissing("onMuteSound")},n.prototype.getRessourceUrl=function(t){var e=null==t?this.config.publisher:t;return"//"+this.config.resourcesUrl+"/"+this.config.gameId+"/"+e+"/resources"},n.prototype.onReady=function(t){this._isReady?(this._readyCalled=!0,t()):this._readyCallback=t},n.prototype.setLoadingProgress=function(t){this._progressListener.fire(t),this._loadingProgress=t},n.prototype.onMuteSound=function(t){this._muteSoundCallback=t},n.prototype.startGame=function(t){var e=this;this._readyCalled||this._apiReporter.reportListenerMissing("onReady"),this._loadingProgress<0&&this._apiReporter.reportAPICallMissing("setLoadingProgress"),this._activityTracker.onStartGame(),this._apiReporter.onStartGame(),this.service.getGameActionManager().startGame(function(){e.track(o.TrackingLevel.INFO,"game","started"),e._lastStartTime=Date.now(),t()})},n.prototype.endGame=function(e,i){var n=this;this._apiReporter.onEndGame(e),this.service.getGameActionManager().endGame(function(){var t=Math.round(Date.now()-n._lastStartTime)/1e3;n.track(o.TrackingLevel.INFO,"game","ended",null,t),e&&(n.track(o.TrackingLevel.INFO,"game","started"),n._lastStartTime=Date.now()),i()})},n.prototype.track=function(t,e,i,n,r){o.TRACKING_LEVEL<t||this.gs.trackPlayer(t,e,i,n,r)},n.prototype.getActivityTracker=function(){return this._activityTracker},n}();o.Ship=t}(ship||(ship={})),function(o){var s,t;function a(t,e){return null==e?t+":na":t+":"+e}(t=s=o.TrackingLevel||(o.TrackingLevel={}))[t.MANDATORY=0]="MANDATORY",t[t.INFO=1]="INFO",t[t.DEBUG=2]="DEBUG",o.UETRACKER_READY=!1,o.TRACKING_LEVEL=s.INFO,o.initErrorTracker=function(){window.addEventListener("error",function(t){var e="n/a";null!=t.error&&null!=t.error.message?e=t.error.message:null!=t.message&&(e=t.message),e+=", ",e+=a("filename",t.filename)+", ",e+=a("lineno",t.lineno)+", ";var i=(e+=a("colno",t.colno)+", ").toLowerCase(),n=(o.Ship.get().config,null),r=!0;return-1<i.indexOf("script error")?r=!(n="Script Error"):n=e,r&&o.Ship.get().track(s.MANDATORY,"error","uncaught error",n),!1}),o.UETRACKER_READY=!0,o.logger.addErrorListener(function(t,e){o.Ship.get().track(s.MANDATORY,"error","error",t)})}}(ship||(ship={})),function(s){var t=function(){function t(){this._gameStarted=0,this._retentionSended=!1,this._retentionMetric=null,this._startTime=Date.now()}return t.prototype._onAuthenticationComplete=function(t){this._player=t;var e=new Date(this._player.getCreationDate()),i=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())).getTime(),n=s.util.serverTime(),r=(n-i)/864e5;if((r=Math.floor(r))<0)s.logger.error("Negative day diff beetween creation and connection date for #"+this._player.getId()+", creationDate: "+i+", connectionTime: "+n);else{this._retentionMetric="d"+r;var o=this;0==r?setTimeout(function(){o._sendRetention()},6e4):o._sendRetention()}},t.prototype.onStartGame=function(){this._gameStarted++,5<=this._gameStarted&&null!=this._retentionMetric&&this._sendRetention()},t.prototype._sendRetention=function(){if(!this._retentionSended&&null!=this._retentionMetric&&!s.ShipGs.get().disabled){this._retentionSended=!0;var t=new gs.SPlayerProperty;t.setPlayerId(this._player.getId()),t.setKey(this._retentionMetric);var e=new gs.NuggetaQuery;e.setQuery("$WHERE PlayerId='"+this._player.getId()+"' $AND Key='"+this._retentionMetric+"'"),e.setLimit(1),s.ShipGs.get().shipapi.findAndModifyStorablesRequest("retentions",e,t,!0,function(t){})}},t}();s.ActivityTracker=t}(ship||(ship={})),function(i){var t=function(){function t(){this._dummy=!1,this._gameStarted=0,this._gameEnded=0,this._firstEnGameChecked=!1,this._lastStart=0,this._startTime=Date.now(),this._dummy="dummy"==i.Ship.get().config.publisher}return t.prototype._onAuthenticationComplete=function(t){var e=this;setTimeout(function(){e._checkGameStarted()},12e4),setTimeout(function(){e._checkGameEnded()},24e4)},t.prototype.reportListenerMissing=function(t){i.logger.warn("No ship listener provided: "+t)},t.prototype.reportAPICallMissing=function(t){i.logger.warn("Ship API not called: "+t)},t.prototype.onStartGame=function(){this._gameStarted++;var t=Date.now(),e=t-this._lastStart;e<5e3&&i.logger.warn("Game already started "+e+" ms ago."),this._lastStart=t},t.prototype.onEndGame=function(t){this._gameEnded++,t&&(this._gameStarted++,this._lastStart=Date.now()),this._firstEnGameChecked||this._checkFirstEndGame()},t.prototype._checkGameStarted=function(){if(!(0<this._gameStarted)){var t=(Date.now()-this._startTime)/1e3;i.logger.warn("No game started after "+t+" seconds.")}},t.prototype._checkGameEnded=function(){if(!(0<this._gameEnded)){var t=(Date.now()-this._startTime)/1e3;i.logger.warn("No game ended after "+t+" seconds.")}},t.prototype._checkFirstEndGame=function(){if(this._firstEnGameChecked=!0,"dummy"==i.Ship.get().config.publisher&&(null!=window.DUST||null!=window.h5ge))try{Error.stackTraceLimit=50;var t=new Error;t.stackTraceLimit=50,t.stack.indexOf("ImmediateClick")<0&&i.logger.error("endGame must be called by user-gesture (ie: onImmediateClick)")}catch(t){i.logger.error("Faild to do first error check",t)}},t}();i.ApiReporter=t}(ship||(ship={})),function(t){(t.util||(t.util={})).patchGs=function(){(new(window.gs||{}||{}).nruntime).load({domainID:401,domainName:"ShipGsServer",nobjects:{SResourceUrl:{hierarchyDepth:2e3,serializerID:201,extendss:{domainID:"400",name:"SStorable"},fields:{Id:{propertyId:0,primitive:!0,type:"String"},Name:{propertyId:1,primitive:!0,type:"String"},RelativePath:{propertyId:2,primitive:!0,type:"String"},MimeType:{propertyId:3,primitive:!0,type:"String"},Width:{propertyId:4,primitive:!0,type:"String"},Height:{propertyId:5,primitive:!0,type:"String"}}},SProduct:{hierarchyDepth:2e3,serializerID:203,extendss:{domainID:"400",name:"SStorable"},fields:{Id:{propertyId:0,primitive:!0,type:"String"},PublisherId:{propertyId:1,primitive:!0,type:"String"},Locale:{propertyId:2,primitive:!0,type:"String"},Title:{propertyId:3,primitive:!0,type:"String"},Description:{propertyId:4,primitive:!0,type:"String"},Image:{propertyId:5,reference:!0,type:"SResourceUrl",domainId:"401"},Price:{propertyId:6,primitive:!0,type:"Double"}}}}})}}(ship||(ship={})),function(t){var e=function(){function t(){this.handlers=[],this.onces=[]}return Object.defineProperty(t.prototype,"length",{get:function(){return this.handlers.length},enumerable:!0,configurable:!0}),t.prototype.once=function(t){return this.onces.push(t),t},t.prototype.add=function(t){return this.handlers.push(t),t},t.prototype.remove=function(t){for(var e=-1,i=0;i<this.handlers.length;i++)if(this.handlers[i]==t){e=i;break}-1<e&&this.handlers.splice(e,1)},t.prototype.clear=function(){0<this.handlers.length&&this.handlers.splice(0,this.handlers.length),0<this.onces.length&&this.onces.splice(0,this.onces.length)},t.prototype.fire=function(e){var i=this;this.handlers.forEach(function(t){t.apply(i,[e])}),0<this.onces.length&&(this.onces.forEach(function(t){t.apply(i,[e])}),this.onces.splice(0,this.onces.length))},t}();t.Handlers=e}(ship||(ship={})),function(n){var t;(t=n.json||(n.json={})).parse=function(e,i){if(null==e)return i;try{return JSON.parse(e)}catch(t){return n.logger.error("failed to decode: "+e),i}},t.merge=function t(e,i){for(var n in e){var r=e[n],o=typeof r;"function"!==o&&(n in i&&"object"===o?t(r,i[n]):i[n]=r)}}}(ship||(ship={})),function(n){!function(t){function i(){var t=window.navigator.languages,e=t?t[0]:null;return-1!==(e=e||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage).indexOf("-")&&(e=e.split("-")[0]),-1!==e.indexOf("_")&&(e=e.split("_")[0]),e=e.toLowerCase()}t.resolveGameLang=function(){var t=n.Ship.get().config.defaultLocale;if(null!=t&&"autodetect"!=t)return t;var e=i();return null!=e?e:"en"},t.detectBrowserLang=i}(n.lang||(n.lang={}))}(ship||(ship={})),function(n){(n.util||(n.util={})).loadJs=function(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,t())}:i.onload=function(){t()},i.onerror=function(t){n.logger.error("Failed to load script "+e+"! "+t)},i.src=e,document.getElementsByTagName("head")[0].appendChild(i)}}(ship||(ship={})),function(t){var s,a=[],n=[];function r(t,e,i){var n=a[0],r=document.createElement("div");if(r.innerHTML="<b>"+t+"</b>: "+e+(null==i?"":", "+i),s.insertBefore(r,n),a.splice(0,0,r),n=r,8<a.length){var o=a[a.length-1];a.splice(a.length-1,1),s.removeChild(o)}}t.logger={debug:function(t){console&&console.debug(t),null!=s&&r("debug",t)},info:function(t){console&&console.info(t),null!=s&&r("info",t)},warn:function(t){console&&console.warn(t),null!=s&&r("warn",t)},error:function(t,e){console&&console.error(t,e),null!=s&&r("error",t,e);for(var i=0;i<n.length;i++){(0,n[i])(t,e)}},addErrorListener:function(t){n.push(t)}},t.enableDomConsole=function(){var t=document.createElement("div");t.style.background="white",t.style.fontSize="10px",t.style.fontFamily="Consolas, monaco, monospace",t.style.position="absolute",t.style.top="0",t.style.zIndex="11",document.body.appendChild(t);var e=document.createElement("div");t.appendChild(e),a.push(e),s=t}}(ship||(ship={})),function(o){!function(t){var e,i=!1;function n(){var t=r();e.fire(t),i=!1}function r(){return{width:window.innerWidth,height:window.innerHeight}}t.getResizehandlers=function(){return null==e&&null==e&&(e=new o.Handlers,window.addEventListener("resize",function(){i||(i=!0,setTimeout(function(){n()},250))}),window.addEventListener("deviceOrientation",function(){i||(i=!0,setTimeout(function(){n()},250))})),e},t.getWindowSize=r}(o.util||(o.util={}))}(ship||(ship={})),function(t){var e;(e=t.util||(t.util={})).serverTimeDiff=0,e.serverTime=function(){return Date.now()-e.serverTimeDiff}}(ship||(ship={})),function(t){!function(t){var s=null;function i(){s={};var t=window.location.search;if(t)for(var e=(t=t.substr(1)).split("&"),i=0;i<e.length;i++){var n=e[i].split("="),r=n[0],o=n[1];o=decodeURIComponent(o.replace(/\+/g," ")),s[r]=o}return s}t.getUrlParameters=function(t){return null==s&&i(),s[t]},t.addUrlParameters=function(t,e){null==s&&i(),s[t]=e},t.deserializeQuery=function(t){var e={};if(null==t||0==t.length)return e;for(var i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(2==r.length){var o=decodeURIComponent(r[0]),s=decodeURIComponent(r[1]);e[o]=s}}return e}}(t.util||(t.util={}))}(ship||(ship={})),function(r){var t=function(){function t(){}return t.get=function(t,e,i){var n=new XMLHttpRequest;n.open("get",t,!0);n.onerror=function(t){r.logger.warn("get error: "+n.statusText),i&&i(null,n.status)},n.onload=function(){i&&i(n.responseText,n.status)},n.send()},t.post=function(t,e,i){var n=new XMLHttpRequest;n.open("post",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");n.onerror=function(t){i&&i(null,n.status)},n.onload=function(){i&&i(n.responseText,n.status)},n.send(e)},t}();r.XHR=t}(ship||(ship={}));var ship;__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t){var e=function(){function t(t,e){this.gaTrackingCode=t,this.pageName=e,console.debug("Init analytics : "+t+" - "+e),this.appendGaTrackingCode()}return t.prototype.appendGaTrackingCode=function(){try{var t=document.createElement("script");t.innerHTML="\n                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n        \n                ga('create', '"+this.gaTrackingCode+"', 'auto');\n                ga('send','pageview', '"+this.pageName+"');\n              ",document.head.appendChild(t)}catch(t){console.error("Error appending google analytics"),console.error(t)}},t.prototype.sendEvent=function(t,e,i,n){var r={hitType:"event",eventCategory:t,eventAction:e};null!=i&&(r.eventLabel=i),null!=n&&(r.eventValue=n),this._send0(r)},t.prototype._send0=function(e){try{ga("send",e)}catch(t){console.error("Failed to send event : "+JSON.stringify(e),t)}},t}();t.GAAnalyticsManager=e}(ship||(ship={})),function(i){var t=function(e){function t(){var t=e.call(this)||this;return t.success=!1,t}return __extends(t,e),t.prototype.canShowInterstitial=function(){return!0},t.prototype.showInterstitial=function(t){null==this.oncomplete?(gdsdk.showBanner(),this.success=!1,this.oncomplete=t):(i.logger.warn("Seems ad already in progress"),this.oncomplete(!1),this.oncomplete=null)},t.prototype.onGdEvent=function(t){var e=this;switch(t.name){case"SDK_GAME_START":e.oncomplete?(e.oncomplete(e.success),e.oncomplete=null):i.logger.warn("Seems ad already in progress");break;case"SDK_GAME_PAUSE":case"AD_SDK_LOADER_READY":case"AD_SDK_MANAGER_READY":case"AD_SDK_REQUEST_ADS":break;case"AD_SDK_FINISHED":e.success=!0;break;case"AD_CANCELED":e.success=!1;break;case"AD_SAFETY_TIMER":break;case"AD_ERROR":e.success=!1;break;case"AD_BREAK_READY":case"AD_METADATA":case"ALL_ADS_COMPLETED":case"CLICK":break;case"COMPLETE":e.success=!0;break;case"CONTENT_PAUSE_REQUESTED":case"CONTENT_RESUME_REQUESTED":case"DURATION_CHANGE":case"FIRST_QUARTILE":case"IMPRESSION":case"INTERACTION":case"LINEAR_CHANGED":case"LOADED":case"LOG":case"MIDPOINT":case"PAUSED":case"RESUMED":case"SKIPPABLE_STATE_CHANGED":break;case"SKIPPED":e.success=!0;break;case"STARTED":case"THIRD_QUARTILE":break;case"USER_CLOSE":e.success=!0}},t}(i.DefaultAdsManager);i.GdAdsManager=t}(ship||(ship={})),function(n){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.authenticate=function(t){n.logger.info("Gd auth"),this._authCompleteCallback=t;var e=this.gs.playerManager._getPlayer(),i=this;setTimeout(function(){i.terminateAnonymousAuthentication(e)},0)},e.prototype.terminateAnonymousAuthentication=function(t){this._authCompleteCallback(t)},e}(n.DefaultAuthenticationManager);n.GdAuthenticationManager=t}(ship||(ship={})),function(i){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.startGame=function(e){this.ship.service.analyticsManager.sendEvent("game","startGame");var t=this.ship.service.getAdsManager();0==t.canShowInterstitial()?e():t.showInterstitial(function(t){i.logger.debug("Start game. Ads displayed: "+t),e()})},e.prototype.endGame=function(e){var t=this.ship.service.getAdsManager();0==t.canShowInterstitial()?e():t.showInterstitial(function(t){i.logger.debug("End game. Ads displayed: "+t),e()})},e}(i.DefaultGameActionManager);i.GdGameActionManager=t}(ship||(ship={})),function(r){var t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.formatPrice=function(t){return t+" EUR"},e.prototype.buyItem=function(i,n,r){this.continueIAP(n);var o=this,t=new gs.NuggetaQuery;t.setQuery("$WHERE Id='"+i.itemId+"'"),t.setLimit(1),this.gs.shipapi.findStorablesRequest("products",t,function(t){var e=0<t.getStorables().length?t.getStorables()[0]:null;o.showPopupConfirmation(i,n,e,r)})},e.prototype.showPopupConfirmation=function(t,e,i,n){if(null==i)return r.logger.error("No product found matching item "+e.getItemId()+". Transaction aborded."),void this.closeIapCb();this.ship.track(r.TrackingLevel.MANDATORY,"iap","openPublisherPopup"),new r.PaiementDOMPopup(t,e,i,n).show()},e}(r.DefaultIAPManager);r.GdIAPManager=t}(ship||(ship={})),function(d){var t=function(a){function t(){var t=a.call(this)||this;t.paymentSdkLoaded=!1,d.logger.info("init GdPublisherService");var e=d.Ship.get().config;d.Ship.get().gs.disableNetwork(),t.authenticationManager=new d.GdAuthenticationManager,t.shareManager=new d.DefaultShareManager,t.iapManager=new d.GdIAPManager,t.gameActionManager=new d.GdGameActionManager,t.adsManager=new d.GdAdsManager,t.analyticsManager=new d.GAAnalyticsManager(e.customData.gaTrackingCode,e.customData.gaPageName);var i,n,r,o,s=t;return window.GD_OPTIONS={gameId:e.customData.gameId,onEvent:s.onGdEvent.bind(t)},i=document,n="gamedistribution-jssdk",o=i.getElementsByTagName("script")[0],i.getElementById(n)||((r=i.createElement("script")).id=n,r.src="/main.min.js",o.parentNode.insertBefore(r,o)),t}return __extends(t,a),t.prototype.onGdEvent=function(t){switch(d.logger.debug("Received GD event : "+t.name),t.name){case"SDK_READY":this.fireReady();break;case"SDK_ERROR":d.logger.error("GD sdk critical error !");break;case"SDK_GAME_DATA_READY":break;case"SDK_GAME_START":this.ship._muteSound(!1);break;case"SDK_GAME_PAUSE":this.ship._muteSound(!0)}this.adsManager.onGdEvent(t)},t.prototype.waitPaymentSdkLoaded=function(t){if(this.paymentSdkLoaded)t();else{null==this.paymentSdkLoadedHandler&&(this.paymentSdkLoadedHandler=new d.Handlers),this.paymentSdkLoadedHandler.once(t);var e=this;d.util.loadJs("https://www.paypalobjects.com/api/checkout.js",function(){e.paymentSdkLoaded=!0,e.paymentSdkLoadedHandler.fire()})}},t.prototype.openInfoPopup=function(){var t=d.Ship.get().config.customData.infoPopup;if(t){this.analyticsManager.sendEvent("infopopup","opened");var e=this;try{var i=t.targetUrl,n=t.targetUrlTarget||"blank",r=t.bgImgSrc,o=t.closeBtnImgSrc,s=t.closeBtnTop,a=t.closeBtnLeft,l=new d.DOMPopup,h=document.createElement("img");h.src=r;var u=document.createElement("a");u.href=i,u.target=n,u.appendChild(h),u.onclick=function(){e.analyticsManager.sendEvent("infopopup","clicked")};var c=document.createElement("div");c.style.display="inline-flex",c.style.margin="0",c.style.position="absolute",c.style.top="50%",c.style.left="50%",c.style.transform="translate(-50%, -50%)",c.appendChild(u);var p=document.createElement("img");p.src=o,p.style.position="absolute",p.style.top=s,p.style.left=a,p.onclick=function(t){t.stopImmediatePropagation(),t.stopPropagation(),l.close(),e.analyticsManager.sendEvent("infopopup","closed")},c.appendChild(p),l.show(),l.setContent(c),l.main.style.backgroundColor=null}catch(t){console.error(t)}}},t}(d.DefaultPublisherService);d.GdPublisherService=t}(ship||(ship={})),function(s){var t=function(l){function t(t,e,i,n){var r=l.call(this)||this;return r.itemPurchase=t,r.transaction=e,r.product=i,r.closeCb=n,r.ship=s.Ship.get(),r.gs=s.ShipGs.get(),r.lang=s.lang.resolveGameLang(),r.coinPackage=r.ship.iapManager.getPackageById(r.itemPurchase.itemId),r}return __extends(t,l),t.prototype.build=function(){l.prototype.build.call(this);var t=document.createElement("div"),e=document.createElement("img");e.src=this.ship.getRessourceUrl("facebook")+"/"+this.product.getImage().getRelativePath(),e.style.padding="10px",t.appendChild(e);var i=document.createElement("div");i.innerText=this.itemPurchase.name,i.style.fontWeight="bolder",i.style.padding="10px",t.appendChild(i);var n=document.createElement("div");n.innerText=this.ship.iapManager.formatPrice(this.itemPurchase.price),n.style.padding="10px",t.appendChild(n);var r=document.createElement("div");r.innerText=this.getBuy(),r.style.borderBottom="1px solid #ddd",r.style.padding="10px";var o=document.createElement("div");o.style.borderTop="1px solid #ddd",o.style.padding="10px";var s=document.createElement("div");s.style.display="inline-block",s.id="paypal-button",o.appendChild(s);var a=this.use3RowLayout();a.header.appendChild(r),a.body.appendChild(t),a.footer.appendChild(o),this.main.style.fontFamily="Arial,Helvetica,sans-serif",this.main.style.fontSize="16px",this.addCloseButton(),this.setAutoClose()},t.prototype.getBuy=function(){return"fr"==this.lang?"Acheter":"ru"==this.lang?"Купить":"Buy"},t.prototype.afterBuild=function(){l.prototype.afterBuild.call(this);var t=this;this.ship.service.waitPaymentSdkLoaded(function(){t.setupPaypalButton()})},t.prototype.setupPaypalButton=function(){if(!this.destroyed){var n=this,t=this.transaction.getId(),e=this.ship.config,r="//"+e.serverUrl+"/s/cpayment?source=paypal&gid="+e.gameId+"&tid="+t,i="en_US";null==this.lang||"en"==this.lang?i="en_US":"fr"==this.lang?i="fr_FR":"ru"==this.lang&&(i="ru_RU");var o="production";null!=e.customData&&"1"==e.customData.test_mode&&(o="sandbox"),paypal.Button.render({env:o,locale:i,commit:!0,client:{sandbox:"AVYWtqOx6KfvXbpTjvTI5Eok4_Viv-Yw4zaGL1QDRzaRlZeBGC9F-FI1L1wvKkemtYYtl8E_cw10-b0m",production:"AZoOVUT98Htz0o0Q_ySDPopBup5nt_S1gCPp9aTEZkcR3fwJzV0yoQoP13Mqq_bEUtjVKKmuxRwXCW6O"},payment:function(){var t=[{amount:{total:n.itemPurchase.price,currency:"EUR"}}];return n.trackTransaction("paypal","created"),paypal.rest.payment.create(this.props.env,this.props.client,{transactions:t})},onAuthorize:function(t,i){n.trackTransaction("paypal","authorized"),s.XHR.get(r,null,function(t,e){if(null!=t&&(t=t.trim()),"OK"==t)return i.payment.execute().then(function(){n.close()});s.logger.error("Failed to validate transaction (KO): "+t),n.close()})},onCancel:function(t,e){n.trackTransaction("paypal","cancel"),n.abordTransaction(s.SIAPTransactionStatus.ABORTED),n.close()},onError:function(t){n.trackTransaction("paypal","failed"),n.abordTransaction(s.SIAPTransactionStatus.FAILED),n.close()}},"#paypal-button")}},t.prototype.trackTransaction=function(t,e,i){this.ship.track(s.TrackingLevel.MANDATORY,"iap",t,e,i)},t.prototype.manualClose=function(){l.prototype.manualClose.call(this),this.closeCb(),this.abordTransaction(s.SIAPTransactionStatus.ABORTED)},t.prototype.abordTransaction=function(t){var e=this.transaction.getId();this.trackTransaction("paypal","manual close");var i=new gs.SIAPTransaction;i.setId(e),i.setStatus(t),this.gs.shipapi.saveIAPRequest(i,function(t){})},t.prototype.close=function(){l.prototype.close.call(this);var t=this;setTimeout(function(){t.closeCb()},3e3)},t}(s.DOMPopup);s.PaiementDOMPopup=t}(ship||(ship={}));var ship3;__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(n){n.logger=plume.logger;var t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initialize=function(t,e){this.config=t,n.logger.debug("Starting "+t.gameId+" "+t.gameVersion),n.logger.debug("✰ by https://gamebuilt.com/ ✰");var i=new plume.CanvasGui({canvasId:"2d"});return null==e&&(e=new plume.Engine({canvasId:"3d"})),this.initializeEngine(e),this.initializeGui(i),this.scaleManager.resizeHandler.add(this.onResize,this),this.onResize(),this.shipi=new ship.Ship(t),this.shipi.onMuteSound(function(t){"undefined"!=typeof Howler&&(t?plume.AudioManager.get().mute():plume.AudioManager.get().unmute())}),this.shipi},e.prototype.onResize=function(){},e.prototype.switchScene=function(t){this.gui.switchScene(t)},Object.defineProperty(e.prototype,"gui",{get:function(){return this._gui},enumerable:!0,configurable:!0}),e}(plume.Game);n.S3Game=t}(ship3||(ship3={})),function(n){var t=function(r){function t(){var t=r.call(this)||this;t.previousProgress=-1,t.estimatedLoadingTime=5e3;var e=t.game;t.shipi=ship.Ship.get(),t.loader=e.engine.loader;var i=t;return setTimeout(function(){i.ensureModelLoadedAndSwitch()},500),t.drawUI(),t}return __extends(t,r),t.prototype.ensureModelLoadedAndSwitch=function(){if(this.areModelsLoaded())this._onAssetsLoaded();else{var t=this;setTimeout(function(){t.ensureModelLoadedAndSwitch()},100)}},t.prototype.areModelsLoaded=function(){return this.loader.isLoaded()&&1==this.h5geAssetsLoaded},t.prototype.load2dAssets=function(t){var e=this;new plume.Loader2d(t,plume.H5PreLoadingScene.retryMax).load(function(t){t||n.logger.error("Failed to load all assets :/"),e.h5geAssetsLoaded=!0})},t.prototype.load3dAssets=function(){},t.prototype._onAssetsLoaded=function(){var t=this;this.onAssetsLoaded(),this.shipi.onReady(function(){t.goToGame()})},t.prototype.goToGame=function(){},t.prototype.onAssetsLoaded=function(){},t.prototype.drawUI=function(){var t=this.gui.expandedBounds,e=new plume.Graphics;e.beginFill(0),e.drawRect(t.left,t.top,t.width,t.height),e.endFill(),this.addChild(e),this.startTime=performance.now();var i=plume.Sprite.fromImage(n.gamebuiltLogo);this.addChild(i),i.addLoadedHandler(function(){plume.layout.centerOnXInParent(i),plume.layout.centerOnYInParent(i)}),this.loadingStatus=new plume.Text("","Arial",30,16777215),this.loadingStatus.y=this.gui.expandedBounds.y+this.gui.expandedBounds.height-200,this.addChild(this.loadingStatus)},t.prototype.update=function(t){r.prototype.update.call(this,t);var e=performance.now()-this.startTime,i=plume.Mathf.clamp01(e/this.estimatedLoadingTime),n=Math.round(100*i);n!=this.previousProgress&&(this.loadingStatus.text=n+"%",plume.layout.centerOnXInParent(this.loadingStatus),this.shipi.setLoadingProgress(n)),this.previousProgress=n},t}(plume.GuiScene);n.S3SplashScene=t,n.gamebuiltLogo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAD6CAYAAAAyRkcxAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMjHxIGmVAAApCUlEQVR4Xu3dAbXrNtYF4IFQCAOhEAZCIQyEQiiDgTAQCqEQCmEgFEL/vZPt9+cmkn2OLEWK7/7W8nrvxjqynDiSJcvOP8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzGzP33///S8sv2H5HcsfWI78DwvT/QfLv7H8U1mZmZmtjw0Xll+xRBq9KDaO/8XyizZjZma2FjRS7L31bPxq2Ciyt+ieopmZ5aDx+BkLhyp/wcLhSi7svfE1Lj8raQjS/4SFefyFZQYOt/5LxQlBepZ529/H94HL9robWTOzK2CFjoW9pz+xZLDXxUaGjcNL44jXejeA3N4Z7InWysnGju9BS2+VMTxR+ElZmpnZJ0DFzQaQDVkvbPB4jY69JQ6BZhqu7foe43703rhio5du8Oe2DTZe2QaS22Hjx/je+/+bimhmZitDhc3hz1lDlS9UrBdafaOXipRkM3u/2LN279DMbFWopNkTnNlYsEfGMvygor3Q6hu9VKQkm623lx3q7ekPFc3MzFaDSpoN0R4ONfK6F4cdHyeJbPf4tTYwtwZQxQg1clp9o5eKlORGL93gTw6htpaX+7r3PhydTKQm6JiZ2Zuggi5V4HyNlXx4JiTScniVk0TYMOw1Cl8awM191Z1eeqHVN3qpSElu9NIXeJk9xL0ybtcoOWkm+x7UTiz+q2RmZrYKVM7sIT1jA3HqmhbjsbCxeZy4wp5YtVd0T3Knl15o9Y1eKlKSG730AqtYxudGi3+f7rkhD54QPPtTq83MbBWonEsNYdfrWcjvNptTf1bdtix66YVW3+ilIiW50UtVSML3gL3YrkOX3PYzrTIzs1Wgbh7eEEZhu7z2RtVGU+tv9FIRVh/mNZq2/4VWmZnZKlA3L9MQRqh8N3ppSSjel1mw8j+tNjOzVaByLlXYf2n1clS+G720JBSPk2ye+RYKM7MVqZJ+lnp+6LuobDd6aUko3jY0+2jaMK2Zme1ABc174J79qtVLUdlu9NKSULzSvYr/1mozM1sJKuiPmeqPcvGaJu9vXPbmdJStNNxM/nUKM7MVoYLmTeAlSw6Prg7vW2lY1PcQmpmtjBX1vb7+wk9CaYD3rfTEmiWHms3MTFhR3+vrL04/Yea7wfvFhweUeFjUzGxlqKj5uLFST8a/p5eA96v0W4juWZuZfQJW2Pd6+ws2ju7NBOB9KvWqyb86YWb2CVBh12Y7/q4kVoH3qNaj9k30ZmafBBV37SeE3KvZgfeHD+0u8ftmZvZJUHHXejapiTNIy1syeL8fG9btB235NyeTLDEBB+XgY9Aef1iX//LvX5QkhOmxlLgnbWb2iVCB137B/fDJKEyDpTRh5BkbyLc3iNwmFjZ2pcb+Edcz3WEZkaa2v6kG1czMFoDKuzbhY/daF9azgSk9qm0PG5u3DR1iW+ylRhrpRzwp2H2wANbXeoS+id7M7JOg4uZkmfSwKNdhqfUiI4b3nLANNoJHvcAaxh01hqWnyZBvPzEzWwUqZVbWvA5WrNS1rmS3ocL6WlwUG5qht2gg/zMNNe327rCeJwO13mbt/d4+jyWumZqZXR5rZHnp4eDvpgkfWF/6Yd8NrwMyX6bhwoq/1isbdtM58ua1vhKWhWXayseyssy1Mu727rC+9szWl2FlvPY4O9ePXzMzewdUuI+9oh+NIf6t9WaYZre3gvWl3iDjitf+8PreMOqQnhHyLe0by1DshfJ1rX92+AvzSFMbIv0x0Qj/f2wE+V75gQVmZu+ACve5Ebo1hlhqPabDa3dK9+xoKLXW8Hb/vT7kWeulHV3za43bPanA8twI7uZnZmadoeItNYZcnh0+EQVpSsOih70mQrrS7NTuv+COPEvbCQ3DMt09+ReRW0hqw8yPDaQbQTOzWVABPzeGJYfDdUhTagijjUwptvvjyJBnqbcbmsnJdPfkX0Rj924lcSNoZjYbKuK9xjDUM0O6UmMWbSiaGkKk4ZAlY2+LXq5CmlJjFrp3EelKP6kU3b/ac1vdCJqZrQIVcqnXwoo6NGmF6ZT+UfgGeaR9vpb2MnsSr7Ex4oSc0nW3DcvANC/DlnjtucFl2tDkFKa7RXyV2b/axBlPjjEzmw2VcalHRqkeC9NiYSPERjV1Y/xT7JeeltYdDd+WsMH8Un78zWt23Aa3FW7IiOkV17J/pWuM5N8nNDObDZVxqTe4STWGI2D7bHxahSbsjIQy1BrBjXuFZmazoBLe6w1upjaG2PZeQ31I2UyBzT/fIvH4vm7cKzQz6wEVKq/T8RYBLtFre6XeCocUS7dWTGkMsd2jHtWeaQ+7xrafG0EO8dbu04xeq+R1Up4YpIZ1zcy+BVSOj/fJseJlpVutYLmOCQtuE03w7xKNIbZZuxcvovv9iBHY7ksjqNdLk4qoWk6sYww/y8dJQt1vLzEz+3ioHGu/GMFK+aVBxGulmYx/afUN/n5uDKdcc+N275tPe/v1N2zz+YTky8kD/i71CpnuSy+ef2Nh2tJn6meSmpmVoILcqzzZIN6G1PBvrWfycm8cXntsDGc1hC29winX3rDdrSF8aQQJr9Xe+1vjhn95QlMaDmZM8aTGzMyeoLJkZVv7hXheYyr2BrFUry1iHSfWDHkYdgS2nZk9yn2Z1mBg23yv9oalSw0dP6taA8iTm2nvvZnZR0MFWmsQny09exHle+yZHknd5/duKF/t+uwjfmbhiU9mZnYAFSp7KXu3IkyZFZqBMh41huw9df/lihFQztrJCV//iH0wM/tIqGRLw2/0EUNwLB+W0j5w6HT562co414PfXd42szMOkBFezRM+mXm6KpQzsfhxY+YQIJy1k5CHrk3aGY2CipZ3tRdwskz7I3cKPnyVNxPKu/jhB82iqUJQL8ruZmZ9YZKtjRb9Fbx4l8OOXJyxtITTR6x8KQ/l4ei8j3+MaMU/9ZuC/HwqJnZCKhgS8OiUxo+bHdrFFqXx0aE191KaaLLlIaH28VS8jEnI2ZmHwOVa3FYVKt3IRmvxz02HGyEOLHmceEwH2elPi5H1yM/Affheb+4PO//c2McmoWLdKVZsH4Qt5lZb6hcHx/9tWElv1XkvGa1VfLR+/Usju/p9v7ypGF730vv9fSfjzIz+1ioRNnzY6PHStYN22d7bjjZE/f1QzOzZ6wcsbDxu8JQpB1jw+ifYjIzI1SI7CX8uPXhQ9Suu5UWDtluw4gtSynP2vJpWOaPuIfSzKw7VIDsBUZu0O7h8foWF96G8djYsDf6OFHktqioHw/7Upvh+vgecHm8zsrlHSco3IZvwjez7wUVHyvm1ut+j43aY4PGnuVWwS//3NFP9PD+ctmu43J5nHHb2ni+/ISWmdklocKLNIJczwp2q3Q9fPaBHj4/3prBk5aja8BuDM3s+lDZsddQw3Vu9C4Mny8bxb1eo4dJzey6UMmV7gXc3H7h3K4PnzVHBTicWsJG0idDZnY9qNxY+dV6An4k1zeEz702WcpPpjGz60HlVnpgNnko7BvD518bKnev0MyuBRVbqTfoM/9vDsdAbaTgP0piZvb5UKlx5mCJz/qNxwdnCD/7U6vNzD4fKrVSRecfcLUbHAvsFZb4RMnMrgEVWuk6kGeJ2g84Hkr3lvr6sZldgyq1Zz7btx9wPJQmU/kaspl9PlRmpeuD/r06+wLHxOMv9m98nJjZ50NlVjrT/0OrzW5wTPzzfmi88MiBmX0eVF7sBdaeHPKI14X4tJlvWdlxv7F82weEY9/ZC+RN9UfPIOV6Trhyo2hma2NFhWXvWaJ7GHf5H2vFPnKGJCv153vneOJw+UYR+8j9b/0RZr5nfjC3ma0JFdTPqqjOuuyDt7FfbASOfnnjsjMluW9YWhrAZzxGflK2ZmbzoVLq1QhumNflbq/APkWGi+lSJwLYH54AtI4U1PiGezNbAyokVnJ7jSB7AGwAOBzIhRVitFfAuEuc+WM/eLIQdZnbBrAvmZMkHhu8ZsjjhJOsjhpPP4bNzOZDZVT7BQFWftVhPqzj9cTItSIOJX58Y4h9YOUe9ZfCPhr2g0OhR3iyU/31EazjiVbtge10+evKZrYwVkL3uuhFqvFC2qNrR0s3higbez27w5lYn2kI/1ZYEVazceB7v/J7ctQIsrcXHgJG2lp+HiI1s3lQCZWuebEnmJ79iJijM//lGkOWR+Xa8P/s5b7sP1471RDiJW5ru91gG2rkv8v9liPKtNcINpcZcbX30L1CM3s/VD61G6BPTW9HPCvRraJ/ttSN+CjPXoXPHi4bLTaM7L0d9ZAe8QSD7y8bPlb+e9fKlnr6Csqzd02QJwqnJgIhvjRy4Ae4m9n7ofJhBf+MFeDpXhvy2KtMl7mPDGU5mszxLkvcf4hysNdaG+Lu0qNHHrUTimWHic3solDxlBqBbrP4kNdeYzi94kcZaj3iGZaYPcly3IvzouuwNvIqHRf+pQozey9VPs+6NlDIr3b2P32CBMqQGeocbYX3o8vEqQjkV5qp7F+qMLP3QaVTqvSGTPlHvrVextQeALZfmig009Sb8LH92jBx99478iz9UoVnj5rZ+6DSKV0fHDJhAfnWrjtNnSSC7deGbWeZdmKAbdd6g0Ou5yJfHhMvtNrMbDzUOaVe2rBJLMi7VtFOmTaP7a50fXAz7Tohtl0aqhx6osL875v5f1plZjYe6pzSMNjQRgn5l7Y55boQtlsampttyq0l2G6xdwZDe6jI/+V40Cozs/FQ58xoCEuTU6Y8igzbTd0c/y4q3lths1M+F2zjZVRCq8zMxlO984VWDYXNlK7LvX14FNusPV91KhXvrbDZKTM4sY2XkxGtMjMbT/XOF1o1FDZTmqn59hvssc3HyUK8VlWbMTnS83anTB7idu+b/2L4Y9+wjZcJW1plZjae6p0vtGoobOZts1WPYLucwPPj1gD8n9fK9p6V2gvvy/vRC8b/uV2WZcqTVbDdF1o1FDbzMoFKq8zMxlO98+gtvRFspzR7dLXnj468fsje1zKPEkNZSp/HW+7nw3bcEJrZPKp3Hr2lMcJ2SrctLHcjNco06h7DpR4jhvJMOzHBdtwQmtk8qnceva1Xpu19oVXLQJFGXTOc+vSYZyiPG0Iz+55U7zya2RAu92vuKNOohnCJX5nYoDxuCM3se1K98+hdlR9/keLZ2xrhCJSndoN5D8v8BBWhPG4Izex7Ur3z6C29MmxnWsUbhfKMfBg3rz0u0ytkWW6l+mrasaBVZmbjqd75QquGwmZKMzLf/pg1bJO9PpaFt3PcrtvhXz527R33E7Ix5LY5cYjl2H7FftZzV0uGz2zFNtwQmtk8qne+0KqhsJlSQ/OrVr8NtvmO+wWzZj1ujvc1Phs+uxXbeDkp0iozs/FQ55RuDxjaC2D+9828ePtQIba5YkM4pSHAZkvvxfCHHGAbbgjNbB7UOaWe2eiHbpeeKjPrsWIvlfACZvUIa7/EMfrE6OUZp1plZjYe6pxSQzj0+ZLIv/RMyym/wYftlibtzDZt0hC2XRohGDrDFfm/HINaZWY2HuqcUo9o5A/zlnqDNOUGc2x35C0SrabdWoFtl4ZH2TgO6xUq/y+0ysxsPNQ5pd+gG9IjQb6cHVnqcUy9bQLbL/VQZxr+iw812HbtF/uHXCtEvsXtabWZ2Xioc0r3jw2piJBt7ZaEKbcLbLD91X6TcOrDuLH92vvRfQYp87xn/cVS95Oa2TeAiqfUS+vaK0F+tdmZb7938BnKUJskMsP0RgBl4HBx6Zjga11n9iK/0kMLplwvNrNvDBVPqTLq1kAhr9JZP7Findr7IZbhVpo1vP1eyhKW416cF90aQ+RTe9+nDQ2b2TeFiqfWUJ2ewII8annTMhUeypIZHi3deF7D64+l3lXNMr9KgbLUHjHXpTFEHqWJWss9eN3MvgFUPrWhsFO9QsbfsylaavgL5andRsGGjPvBBv1W+ev/UbffWMS/fI+5DVb+tYZ0qWtjKA/LXJtIxOOl+UQGsUOOOTOzZqiAatfw0pUdYjgBZ6/XtGRlh3LxPWDlzMqf/y/2evB66iZ8hX2Bl9kQsEHdel2cSNT1+lsPLBOWUoO14fuUHt5GTK23udTvNJrZN8IKCEupwuNroVmdSMc8joYYP/6MH/twuiH8JNiFo8aQ69iohxpEpKsdI+4NmtlcqIj2KnhWXi89FrzGxu+xZ7PnEhUd9qM2kaRkyqPjesN+sDE8ut+SDSKPk+IoAl/HUhspYKx7g2Y2Hyqjo4kgrLA4jFe7J7BmidmQPWBfajedlyz1A7xnYF84nJv53LdjJTK5aPivXJiZhaBCYmUXqbiimNdy177Owj5FhkfZEEy/PaQ37BN7xNy3XjwkamZrQcXUozFkRXmZ3lAJ9m/veiiHES93ArDBvkWuB0dcZqTAzC4IlRR7PdkzfzYA7DFcridUgv3kLRFsEHjisA0Ffqf9b20Q+T5NfbSemVkIKqvHaf61RpGVGhvNy/aAbB8+++042U4KSniSxPVuAM3sM6ECK82WHP4L5vZZcEwUJxNptZnZ50JdVvqlCj8Sy77AMcGe4bPbE3bMzD4eKrTS8KiHRO0HHA+la4b+RQkzuwZUaKUb5y89O9RycDyUbrz3L0qY2TWgQitdJ/Swl93gWCgNn9O3mEVrZt8AKrRaRefhUePxURoW9S/Om9m1oGIrDX25svvmcAzUTpJ807yZXQsqttKsQPKjsr4pfPa8j7B0gsTJVR4WNbPrQeVWqvTIjeE3g89875F8nkhlZteECq72i+7EmaXuBXwD+Jx5HNSeOMTG0ceBmV0XKrnar9oTK0c+ds0V4QXhcz16xig/f0+gMrPrQ2W3VxlutmeRcuHtF+xFcPEPsS4Mnw8nv2yf1fb58fOO/DKJnydqZt8HKr1IY3iElSsbTC7Mr9RwuvFshPftsVHjL8Vv7y8XDmVv731tmDPKPUEz+55Q+XEm6dlKtAUn7WyV+LY8VvLbwsr/sUH9sWgXloEycfJJsaxY+D4/7xuHqJ/fgxmfBU9m3Aia2feFSpDXjUqPYLuSx55rZpnRML0L982zQ83MNqgUOQzH4c0rV/52Pyn4Nj9CbGbWBJXkdm2qNIxXuxfR1vDY+90+Pw7N8vN042dm1hMqVg6r1q6DbZUxF1bOlvf4Hj5ORuKyve9u4MzMPg0r7qeKnEtpQgmXx8bgeVlFafLPtvD6a2m/nicCecKKmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZWcbff//9M5Z/HSw/KbmZmdnnQoP2Tyy/Yvkdy/+wZP2F5Q8s/8Hybyz/VNZTYPtsxH/Dwv1huR4Xvv5vJZ2OZcHC9+25nP/Fws9k2skGts2THb5fz2Xj+8qydfuckRffBx5HM/HY/1lFqkIavi8t35Mjz9+jrp898uP3vPa96P6Z1mAbteOKC1//l5KGIP2Q/ULMT4otfT+5dPucmIfy/BSh78rysBPbhzziC03MlwdK6qA+A9viPvHAj5j6QWLb0QOflePby4ltsiE+wrKdPqlAHr/cclvDnypWEdazEn+nP7GcrmyVR9SwE0Xmfd/EoVAZmO6ePCS8X0jLk+noidnp7yjiI9+31fxPxf88KDwrYJ49RT/kHtjoDG8QsY3sGdWURoawXX4GUXz/3tYzxLYyZeN7eLaSHnUy1qp6TGDdrLLyff5VxUhTfNRfCuuOed83cShUBqa7Jw8J7xfSZj/nU40C4jP7sZK3dXS6YaGxzKx0flFRukPemcr7Ec+439bIbLDN7IH/u0KHwnZaejxnKmiemK2muD94fYWy8nhNn7zdQ+MU1p2yD1HILiUNU9ghJU9RaBpC2fv8VL9pNz4DC3wv91RDutLI9+xw1X+V1Vtge7ym0aK5wYlA/qzoW85Mm98/xK7YEBa/3Hh9lbLyM0o1hvewOIV1p+xDFLJLScMUdkjJUxSahtB3D7f39DkNIQq70vhz16FI5MfKqUcvd1hv9Rm3dd9kGivAYZMZkHf0+uqz3etqR5THSqpfbq1fQaoxvIfEKaw7ZR+ikF1KGqawQ0qeotA0hLohHA0FXe0ibNcxZeTHCTk9sGJ5yxAptnOmzH8om66Q79kJK83vneJX8gkNIYWP2XvyOIV1p+xDFLJLScMUdkjJUxSahlA3hCOxkPeyLqVbQ8i87ll28x9lPRS2c3aadNchUuTXOiT6qPlzVfxKPqUhpNC1Y6UNU1h3yj5EIbuUNExhh5Q8RaFpCHVDOAoKuOqb263Xhbw4caC3rkO3JdrOGV17r8irx6hB8xdC8Supnmho/WoOT0KULkxh3Sn7EIXsUtIwhR1S8hSFpiHUk2VGQOF6XTd7dLbHQN0myyCvzP1DGUOGHjfIv9dB32UWKfLpdcLUXB7Fr6R6MqT1qzmcrKR0YQrrTtmHKGSXkoYp7JCSpyi0CcJ71K8zrHv7BAp3dkiUPS3ebL9XIbBC53UlXu+K9sy6DD0inxEN/aORt3n0bMBPH4TIo1evuvkkR/Gr2N0PpVnN4f1xShemsO6UfYhCdilpmMIOKXmKQpsg3DfU94TCtU7NJ1aKTZUr4tg4sZKvVaw84+ky4xH5jL72OewDRt49y352tmbvXnXTcK1iV8CTq92h8XuyJe1+b5UmTGHdKfsQhexS0jCFHVLyFIU2QTjrTz9irRcUrrWi7XYvHfJiY8ye4tZr6/amIZ8eEzsihjxmCvn2Ptibyom4Ee9j60lUisKmUBFCFFKE1RxR4bD0tvCkhL2C1pGO3eNAacIU1p2yD1HILiUNU9ghJU9R6DQqRopCrwf71lK5vfWG8jNQ1paGvuX+uCG9QuTbu/FpKifiRvSqm2azKjZMYVOoCCEKSUNoy2ezO2lBacIU1p2yD1HILiUNU9ghJU9R6DQqRopCrwX71TLUNXRySG8ob/aMmQ0Pez8t9+517RUiP5ZjhFQ5kX5Ur7rpGrBiwxQ2hYoQopAmCM9eM3JDGKCwQ0qeotBpVIwUhV4L9qul5zP8Z1d6QVlbGvpbLwX/tlT+XU8SkN+oW1pujb02cwhpR/QGqen9UmyYwqZQEUIU0gTh2QccuCEMUNghJU9R6DQqRopCr0X7lvExQ6KE8mZ7g1+GDfF3S0PabXow8uJM3IxMwx0alkS67AlB6uRBm0lRaJjCplARQhTSBOHZkyY3hAEKO6TkKQqdRsVIUeh1YJ9aehuf1Bts2b+XRgyvZRvTnpOIMsOzbIAyPbfQtUKkS+WJJXvy0PIDqCkKm0JFCFFIE4Rnj3dPlglQ2CElT1HoNCpGikKvA/uUHe46NfX+3VDe7DWT4jAdXm95pmaXp7ggn8yM0Vv58W+m4T6qDLO9QVbG2Qo53YNWXJjCplARQhTSBOHZ0YOut30orDtlH6KQXUoaprBDSp6i0GlUjBSFXgf2KTstv+vzKkdCWVsmmVQrZKyb8l4hn0wjdJt4gn8zPbLdXiHWZ06WtoY4+96nH7mkuDCFTaEihCgkDaHp4WuFVildmMK6U/YhCtmlpGEKO6TkKQqdRsVIUeh1YJ+yQ37r3gz5BGXNnh3vTtrA+myv8PStFMijuUHB/zMNd/WpOFiX6g0qjHEZ6ZmjigtT2BQqQohCUhDG+wuzT/vxI9aCFHZIyVMUOo2KkaLQ69B+hSnsI6C42Yrh8BFpSPPWEwfENw8x8v/3l0JqQ8KZnuWXihV/p4d0MxQXprApVIQQhRRh9TbsvC3srbc+7u7wuqzShSmsO2UfopBdShqmsENKnqLQaVSMFIVeA/YnU1HSx1wfRFmzD6mOThrJTgI5NWkG8dntfWl48XemMXqpGPFappL9Eo+/M7flpHvPins3ngilT27uoUsJHZdKG6aw7pR9iEJ2KWmYwg4peYpCp1ExUhR6DdifbEOYPmvPQP7Pj4/i0jRDFXHZG+GH3Uag0CaIT01mUtgPeCkznPvco8scHy+/IoHXTpX9iMJm4Oefmgh1D1tGuPz35HEK607Zhyhkl5KGKeyQkqcodBoVI0Wh14D9yfY20hMaIpgvlr3GhWfhqV92UExGuMFF2uxM1OZfpUBspldVbHTxevS9+FJB4v+Z/SzdcnKqN3tEMbNkj8dV8DMOv8/3kDiFdafsQxSyS0nDFHZIyVMUOo2KkaLQa8D+pM7YoXtDyDzvWYeEKh+kyw6Lpn4TD+mz+TcPjyL29HU2vJ5pkG63UuDfzCSd2nYzPUpK3UKhmFlS3wXFzJZqBOkeFqew7pR9iEJ2KWmYwg4peYpCp1ExUhR6DdifFRrCTEUfukaJdNlh0fSzQRGT6XE2D48y9p5FSLVBx7poPrdGDf9mGs/iCQpez54wfFLj8mkNIa/1Dr+2qbDulH2IQnYpaZjCDil5ikKnUTFSFHoN2J9PawijB3l2Fl36xnfEZBvbdCVEio2qfj5cd08Swp/Dir6HR/cgZrghHIfD3Onr7ffQOIV1p+xDFLJLScMUdkjJUxQ6jYqRotBrwP6s0BBmG5Td4TOsz/7AcNNMWMRl7ylsuU+uW48K6zLvS+Yz2Z1khPWZHm1qMpZiZvm0hnDDzzZ84ncPiVNYd8o+RCG7lDRMYYeUPEWh06gYKQq9BuzPCg1hdkLFUcWbvYm+eZ8UH5VucBHT9Rob1rf8ysiR3UoV64fdS6iYWT61IaTwMOk9eZzCulP2IQrZpaRhCjuk5CkKnUbFSFHoNWB/VmgIu15HwvpsZZ+aoPEIsalhXUgNTSF9tlE/aghbnpe653ASENJk3qPUtVTFzPKps0Y3oYkz96RxCutO2YcoZJeShinskJKnKHQaFSNFodeA/ZneEJLyjtrtNWB9Ziju1AeK8Oz7l/0h3Gz+hw0t0mRvK9lz2BggTWroW2EhCpmBx1jquvI9bDk8Fo569CkK607Zhyhkl5KGKeyQkqcodBoVI0Wh14D9WaUh7HIdCeuyvcvUUNwzxGeHLlO3USB990YEybLXZGuiT+Lp3phvlP7d2HgMn335RkcnlikK6wrZpp63q7BdShqmsENKnqLQaVSMFIVeA/YnW5GnJ3xEIN/M8Fm1Asa6bKV7en+UT1TqMWJIP2JGbXYyUU3ovUO67GcSHqpW+jCFTaEihCikCknYMPC7y4XX2DkjNDUS8qTas9f6jOZLDTXM8551jMJ2KWmYwg4peYpCp1ExUhR6DdifbEN4qgdVw3zv2cco7AVWZa8Ppu8ffIY8srdqZHo8mfclPBmHae8hp0QnW2SPMTeEjRDKRrGlQdw7ucxyQ5ik0GlUjBSFXgP2J9s7SPVoopBvr4YwWwk03dv3CHlkG9/wJAuk7TJk/Axps5NwnoWPA6TNNoTh4XelD1PYFCpCiEKaIJy9xZYTnWIDpnUZbgiTFDqNipGi0OvQfoUprCtke7ohxMvZ64OzhIdjlT4q0xCeHR7N7IMbQlARQhTSDFmwMcxOiipev9a6jBENYWq2s8J2KWmYwg4peYpCp1ExUhR6Hdin7NnjiAO9R0OYvR9xlkyDlZG63on0Z4ZHUz1pxUS5IewA2XT5EWmty+g+oY553rOOUdguJQ1T2CElT1HoNCpGikKvA/uUHdobcaD3aAh7zYYcTkXehWSjn9PZ+n6ln5uquKhRJwpTv7wqQohCTkNW2V7hy60UeC313YTmB8zXIM9MHRU6fpQ2TGGHlDxFodOoGCkKvQ7sU/Z6Ufcf52We96xjFPYFXs5+YWeK3Mg8bEiRkL51KDld0Skuyg1hJ8gq+514Ge3Ba9kT5RH1Q+ZaeeiXZJQ2TGGHlDxFodOoGCkKvQ7sU0uFmH547x7lGVUbwjkzffzdIjeiD20ICTEt71nLL3WMmvSTorApVIQQhZyGrE7fuoLXsnlQt/oBeWWHeEPfA6UNU9ghJU9R6DQqRopCrwX7la0Quw1/IK9shf9SUeK11A23Czj8siJNtgJIX7tFTPZsn9KVHGIyPZPMjNQUhU2hIoQo5DRklR3+LjWELY/l230ecAbyGvIj2EobprBDSp6i0GlUjBSFXgv2K3uwUZezPuST3fbLpBC8lm1MZzscvkGaYTeibxCTHRZvun0GcaevAZcoeZjCplARQhRyGrLqMTTacpLZdJw8Qz4ts5tDj75T2jCFHVLyFIVOo2KkKPRasF8tZ33hIawa5NFyoL8MzeG1s/fFvdvhe4c072gIs8PiTSMBiHNDmKCQU5BNSwNWPIbwessM49O9QuSR3W7moRIpCjuk5CkKnUbFSFHo9WDfWh7GfGqIFPHZM1Z66YnitZbrGFOp6FVIMrwhJMRlhsWbnsSDODeECQo5Bdm0fCeKvSm83nKiyeOq+YEViG0ZpQo3vkofprBDSp6i0GlUjBSFXg/2rbUxae0ltBzoxTM+vN7SoM529NT/dzWEmfeuqWJDnBvCBIU0QxYtIzzV22KwrvUBDGwMU8cl0rMn23LtmsKXa5Q+TGGHlDxFodOoGCkKvR7sGw/A7KSZDYcwQgc80nE4rrXhKp7x4fVsfk2Nxh7kme1R75YB67MNYdM1W8RFt5O+f3CD2OykjdC+KG2YwqZQEUIUkoZQfoeHnNBy/T1ZE8bufqZcj4Vlb62DUifkiglT2CElX8GoJ1jdKPSasH+tX6ING0TmwckrzwuHV1quNWz4BakN3WS/PKefMfoMeXZtjLF+SC/qGUKjZ/upJ9c8Qmz2uIqeVKUobAoVIUQhVUjCBu/5u8VeVGsjQruzLbGe2zmL3382ijwetoV/n6kXNqkTQcWEKeyQkq9iyAxaUuh1YR9brhW+Q/WWA60PU1hXyDbb69m9noH1b2kICeGs5GrDUTwe0vcoPmL8Lae4IQ3hYKzQq8Pd9yTLCs3yRLozvcKR0pdnFBemsENKvoohDxcghV4X9rH1iSMjsTLuVskorCtkm63sdxsXrH9bQzgaivcdGkLqdrL2ZqFJUEh35vLJKNWRoj330DiFHVLyVURPcNIUem3Yz9UeYF2tGLGOX86MLvc4PUO+bggrULzv0hBWb4vR+hWlboNC+paJOCOFf9bskWLDFHZIyZehYu1S0hSFXh/2dZVhkN2zVazPXrs4ff9jCfLNVhBuCOs+tSGsfg5avZrW3tQq9+023c5Dig9T2CElX4aKtUtJUxT6PWB/Z/+iw+EEDaRZpSHMlsMNYZ0bwvHYCJ65z2923dDcCJLyCFPYISVfhoq1S0lTFPp9YJ85TDrjukD0usWnNoS75eD6e7IYhS0JxXNDuBbO0jw9cxp5zLiEwrroVCNI96ziFHZIyZehYu1S0hSFfi/Yb06xT1XMJ6S+pEx7i4pbpSHc7e1ivRvCA0q7FBXthVavgD259HBoDfLi96/H7Q8R/E50ufXpnl2cwg4p+So8WWYE7D+vg4066DkztOlMT7FRzffD7UG+2Uk7u/uK9ZnrMKFp0rOgfJknk4Rv3Efad52cRVVPsrCu9WkpvXRrREqQN3uHo269aq4bapBf5tgJnzwj7Uq3mERvn8h+j4Z0Jj4O3gieBfID7zFkygri1EGOeJYn8iU8dV3kCPKOVnahhwMjXeQ6DA/ibmf4o6CMkSF2foaZ0YBsL3y0vdsneDLw7ksMfD95DDU9dagFtsWT5bM39xPjWcc0zQo9gnxZZ0QagNQJBNLyhPhdPeQj0ZEVljlad/EzWb6+eTu8KTyg2HvhF44HTe0g4IHN9XzDOVQW+pAykCfLwi8i839eWMahFQLy5wHF7XA/Swvfo1Sjj/TMkxU+G5LHfeFrwxr1UVTu58+IrzUdD4hjXqN6IhmRiV3RyrfF9v1iRcXjY/qxgTLwc+XnyzKxbLXPia9vZb8dD8piOGyLJygsJ9+z7Xjcvl9N9QXi+J3lvsyUHvlCzFbXPH8/+TdfdwNoZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmtu8f//g/M3SqgvaRfp8AAAAASUVORK5CYII="}(ship3||(ship3={}));var GAME,plume;__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(n){n.logger=plume.logger,n.layout=plume.layout,n.Time=plume.Time,n.random=plume.Random,n.Mathf=plume.Mathf,n.vpool=plume.ephemeralPool;var t=function(e){function i(){var t=e.call(this,750,1334,{})||this;return i._INSTANCE=t}return __extends(i,e),i.get=function(){return i._INSTANCE},i.prototype.onCreate=function(){e.prototype.onCreate.call(this),n.shipi=this.initialize(n.GAMECONFIG,new plume.Engine({canvasId:"3d",alpha:!1,logarithmicDepthBuffer:!0})),this.goToSplash()},i.prototype.goToSplash=function(){var t=new n.SplashScene;this.switchScene(t)},i}(ship3.S3Game);n.Game=t,n.game=new t,n.game.start()}(GAME||(GAME={})),function(g){var v=function(o){function s(t){var e=o.call(this,s.WIDTH,s.HEIGHT)||this;e.ballDef=t,e.unlocked=!1;var i=1,n="balls-preview/"+t.name+".png";e.sprite=plume.Sprite.fromFrame(n),i=e.sprite.width>e.sprite.height?80/e.sprite.width:80/e.sprite.height,e.sprite.scaleXY=i,e.addChild(e.sprite),g.layout.centerOnXYInParent(e.sprite),e.sprite.y-=5,e.unlocked=g.BallsManager.isUnlocked(t);var r=e.unlocked?t.text:"?";return e.text=g.factory.newText(r,15),e.text.tint=8685191,e.addChild(e.text),g.layout.centerOnX(e.text,e),e.text.y=s.HEIGHT-e.text.height-5,e.unlocked||(e.sprite.tint=3355443),e}return __extends(s,o),s.WIDTH=128,s.HEIGHT=128,s}(plume.Container),t=function(i){function y(){var t=i.call(this,g.game.width,g.game.height)||this;t.blinkDuration=0,t.build(),t.onClick(t.close,t);var e=t;return g.game.addUpdatable(e),e.detachListener.once(function(){g.game.removeUpdatable(e)}),t}return __extends(y,i),y.prototype.build=function(){var t=g.gui.expandedBounds.width,e=v.HEIGHT*y.LINES+150,i=new plume.Graphics(t,e);i.beginFill(14935011),i.drawRect(0,0,t,e),i.endFill(),this.addChild(i),this.bg=i,g.layout.centerOnXInParent(this.bg);var n=g.BallsManager.getAll();this.line=new plume.Graphics,this.line.beginFill(15606919),this.line.drawRect(g.gui.expandedBounds.x,0,g.gui.expandedBounds.width,15),this.line.endFill(),this.addChild(this.line);var r=g.Player.getCurrentLevel();r=g.Mathf.clamp(r,1,n.length);var o=g.factory.newText(r+"/"+n.length+"\n"+g.geti18n("BallsDiscovered"),32);o.tint=8685191,o.align="center",this.addChild(o),g.layout.centerOnXInParent(o),o.y=this.line.bottom+30,this.ballsCtn=new plume.ScrollableList(3*(v.WIDTH+10),v.HEIGHT,y.LINES,!0),this.ballsCtn.optShowItemOverlay=!1,this.selectedRect=g.factory.newRoundRect(v.WIDTH,v.HEIGHT,16777215,10),this.ballsCtn.addChild(this.selectedRect);for(var s=g.BallsManager.getCurrent(),a=0;a<n.length;a+=3){var l=new plume.Container(3*(v.WIDTH+10),v.HEIGHT),h=this.getBallCmp(a,n,s),u=this.getBallCmp(a+1,n,s),c=this.getBallCmp(a+2,n,s);h.x=5,l.addChild(h),null!=u&&(u.x=10+v.WIDTH,l.addChild(u)),null!=c&&(c.x=2*(10+v.WIDTH),l.addChild(c)),this.ballsCtn.addItem(l)}this.addChild(this.ballsCtn),g.layout.centerOnXInParent(this.ballsCtn),this.ballsCtn.y=o.bottom+10;var p=plume.Sprite.fromFrame("icon/balls.png");p.scaleXY=.5;var d=g.factory.newRoundButtonIcon(150,60,15606919,p);this.addChildAt(d,0),g.layout.centerOnXInParent(d),d.y=this.bg.bottom-5,this.selectedRect.removeSelf(),this.selectedBall.parent.addChildAt(this.selectedRect,0),this.selectedRect.x=this.selectedBall.x,this.selectedRect.y=this.selectedBall.y;var f=n.indexOf(s),m=Math.floor(f/3);this.ballsCtn.scrollToItem(m)},y.prototype.tintSelected=function(t){this.selectedRect=g.factory.newRoundRect(v.WIDTH,v.HEIGHT,t,10,this.selectedRect)},y.prototype.getBallCmp=function(t,e,i){var n=this;if(t>=e.length)return null;var r=new v(e[t]);return e[t]==i&&(this.selectedBall=r),r.onClick(function(){n.selectBall(r)},this),r},y.prototype.redraw=function(){var t=g.gui.expandedBounds,e=this.height/4;this.bg.clear(),this.bg.beginFill(14935011),this.bg.drawRect(0,0,t.width,e),this.bg.endFill(),this.bg.setSize(t.width,e),g.layout.centerOnXInParent(this.bg);this.line.clear(),this.line.beginFill(15606919),this.line.drawRect(g.gui.expandedBounds.x,0,g.gui.expandedBounds.width,15),this.line.endFill()},y.prototype.selectBall=function(t){1==t.unlocked&&(this.selectedBall==t?this.close():(g.BallsManager.setCurrent(t.ballDef),this.selectedBall=t),this.selectedRect.removeSelf(),this.selectedBall.parent.addChildAt(this.selectedRect,0),this.selectedRect.x=t.x,this.selectedRect.y=t.y)},y.prototype.onClose=function(t,e){this._onClose=t.bind(e)},y.prototype.close=function(){var t=this;this.animateOut(function(){t._onClose&&t._onClose()})},y.prototype.update=function(t){if(0<this.blinkDuration){this.blinkDuration-=t/1e3;var e=Math.round(5*this.blinkDuration)%2!=0?16777215:15606919;this.tintSelected(e),this.blinkDuration<=0&&(this.blinkDuration=0,this.tintSelected(16777215))}},y.prototype.animateIn=function(){var t=this.y,e=t-this.height;this.y=e;var i=plume.TweenManager.get().create(this);i.to({y:t},350,plume.easing.easeOutCubic),i.start()},y.prototype.animateOut=function(t){var e=this.y-this.height,i=plume.TweenManager.get().create(this);i.to({y:e,alpha:0},350,plume.easing.easeInCubic),i.start(),i.onComplete=function(){t()}},y.LINES=2,y}(plume.Container);g.BallStore=t}(GAME||(GAME={})),function(e){var t=function(){function t(t){this._removeContainer=!0,this._particles=[],this._fired=!1,this.loop=0,this._removeContainer=null!=t?(this._ctn=t,!1):(this._ctn=new plume.Container,!0)}return Object.defineProperty(t.prototype,"container",{get:function(){return this._ctn},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.startTime=performance.now(),e.Game.get().addUpdatable(this)},t.prototype.update=function(t){this.deltaTime=t,this.ellapsedTime=performance.now()-this.startTime;var e=this.emit();if(null==e)this._updateParticules(t),this._particles.length<=0&&this.destroy();else{this._updateParticules(t);for(var i=0;i<e.length;i++){var n=e[i];n.start(),this._particles.push(n),this._ctn.addChild(n.object)}}this.loop++},t.prototype._updateParticules=function(t){for(var e=this._particles.length-1;0<=e;e--){var i=this._particles[e];i.terminated?this._particles.splice(e,1):i.update(t)}},t.prototype.destroy=function(){e.Game.get().removeUpdatable(this),this._removeContainer&&this._ctn.removeSelf()},t}();e.Emitter=t}(GAME||(GAME={})),function(l){var t=function(n){function t(t,e){void 0===e&&(e=!0);var i=n.call(this,t)||this;return i.left=e,i.done=!1,i.build(),i}return __extends(t,n),t.prototype.build=function(){this.emit=this.emitParticule.bind(this)},t.prototype.emitParticule=function(){if(this.done)return null;for(var t=[],e=0;e<40;e++){var i=plume.Sprite.fromFrame("particles/Blank.png"),n=16777215;switch(l.random.intInRange(1,4)){case 1:n=15802143;break;case 2:n=15868115;break;case 3:n=4137202;break;case 3:n=2159343}i.tint=n;var r=new o(this.left,i,plume.easing.easeOutCubic);t.push(r)}return this.done=!0,t},t}(l.Emitter);l.Confettis=t;var o=function(){function t(t,e,i){this.left=t,this.object=e,this._easing=i,this.terminated=!1,this.lifetime=2e3,this.gravityY=-.5,this.gravityX=0}return t.prototype.start=function(){this.angle=l.random.intInRange(0,90),this.startSpeed=l.random.inRange(.5,3),this.endSpeed=.1,this.object.scaleXY=l.random.inRange(.1,.3),this.left?this.object.x=.25*l.game.width-l.random.intInRange(0,.25*l.game.width):this.object.x=.75*l.game.width+l.random.intInRange(0,.25*l.game.width),this.object.y=l.game.height/2,this._startTime=plume.Time.now();var t=this.angle*plume.Mathf.DEG2RAD;this._angleCos=Math.cos(t),this._angleSin=Math.sin(t),this.vX=this.startSpeed*this._angleCos,this.vY=this.startSpeed*this._angleSin,this.rotationSpeed=l.random.inRange(1,3),this.rotationSpeed*=.5<Math.random()?1:-1;var e=plume.TweenManager.get().create(this.object);e.delay(l.random.intInRange(500,1e3)),e.to({scaleY:.1*this.object.scaleXY},500),e.delay(l.random.intInRange(50,200)),e.to({scaleY:1*this.object.scaleXY},500),e.delay(l.random.intInRange(50,200)),e.repeat(-1),e.start()},t.prototype.update=function(t){if(!this.terminated){var e=plume.Time.now(),i=1;if(0<this.lifetime){var n=e-this._startTime,r=Math.min(n,this.lifetime)/this.lifetime;i=this._easing(r)}var o=this.startSpeed+(this.endSpeed-this.startSpeed)*i,s=t*(o*this._angleCos*(this.left?-1:1)),a=t*(o*this._angleSin);return this.vY=this.vY,this.vX=this.vX+this.gravityX*t/1e3*(this.left?-1:1),this.object.x-=s+this.gravityX*t,this.object.y-=a+this.gravityY*t,this.object.rotation+=this.rotationSpeed*t/1e3,this.object.y>l.Game.get().height?(this.terminated=!0,void(this.object.visible=!1)):void 0}},t.prototype.reset=function(){this.terminated=!1,this.object.visible=!0},t.prototype.destroy=function(){this.object.visible=!1},t}();l.ConfettiParticle=o}(GAME||(GAME={})),function(h){var t=function(e){function t(){var t=e.call(this,0,0)||this;return t.emitCount=0,t.particle2dEmitter=new plume.Particle2dEmitter(t),t.particle2dEmitter.emit=t.emit.bind(t),t}return __extends(t,e),t.prototype.onEnd=function(t,e){this._onEnd=t.bind(e)},t.prototype.emit=function(){var t=[];if(1e3<this.particle2dEmitter.ellapsedTime)return null;for(var e=0;e<4;e++){var i=o("coins/01/coins1_",0,14,4),n=plume.Animation.fromFrames(i);n.animationSpeed=.2;var r=new s(n);t.push(r),n.repeat(-1),n.play()}return t},t.prototype.start=function(){var t=this;this.particle2dEmitter.onDestroyed=function(){t.destroy()},this.particle2dEmitter.start()},t.prototype.destroy=function(){this.removeSelf(),this._onEnd&&this._onEnd()},t}(plume.Container);function o(t,e,i,n){void 0===n&&(n=1);for(var r=[],o=e;o<=i;o++)r.push(t+plume.Strings.pad(o,n)+".png");return r}h.CoinsAnim2d=t,h.getAnimFrames=o;var s=function(){function t(t,e){void 0===e&&(e=plume.easing.linear),this.object=t,this._easing=e,this.terminated=!1,this.angle=0,this.startScale=1,this.endScale=1,this.lifetime=400,this.startSpeed=.5,this.endSpeed=.7}return t.prototype.start=function(){this.object.x=h.random.inRange(-200,200),this.object.y=h.random.inRange(-200,200),this.object.scaleXY=this.startScale,this._startTime=h.Time.now(),0<this.lifetime&&(this._endTime=this._startTime+this.lifetime),this.angle=h.random.inRange(0,360);var t=this.angle*h.Mathf.DEG2RAD;this._angleCos=Math.cos(t),this._angleSin=Math.sin(t)},t.prototype.update=function(t){if(!this.terminated){var e=h.Time.now(),i=1;if(0<this.lifetime){if(e>this._endTime)return this.terminated=!0,this.object.visible=!1,void this.object.removeSelf();var n=e-this._startTime,r=Math.min(n,this.lifetime)/this.lifetime;i=this._easing(r)}var o=this.startScale+(this.endScale-this.startScale)*i;this.object.scaleXY=o;var s=this.startSpeed+(this.endSpeed-this.startSpeed)*i,a=t*(s*this._angleCos),l=t*(s*this._angleSin);this.object.x+=a,this.object.y+=l}},t}();h.CoinParticle2d=s}(GAME||(GAME={})),function(g){var t=function(){function t(t){this.main=g.factory.newContainer(!0),t.addChild(this.main),this.top=new e,this.bottom=new i,this.center=new plume.Container(100,100),this.particles=g.factory.newContainer(!0),this.main.addChild(this.center),this.main.addChild(this.top),this.main.addChild(this.bottom),this.main.addChild(this.particles),g.game.scaleManager.resizeHandler.add(this.onResize,this),this.onResize(),this.logo=plume.Sprite.fromFrame("logo.png"),this.center.addChild(this.logo),g.layout.centerOnXYInParent(this.logo)}return t.prototype.onResize=function(){this.top.redraw(),this.bottom.redraw();var t=g.gui.expandedBounds.height-this.top.height-this.bottom.height;this.center.setSize(g.gui.expandedBounds.width,t),this.center.x=g.gui.expandedBounds.x,this.center.y=g.gui.expandedBounds.y+this.top.height},t.prototype.onStart=function(){this.top.onStart(),this.bottom.onStart()},t.prototype.onWaiting=function(){this.bottom.onWaiting(),this.hideLogo()},t.prototype.onLaunch=function(){this.hideTopBarButtons()},t.prototype.showAndSelectNewBall=function(){var t=g.BallsManager.selectLast();return t&&(this.top.openBallStore(),this.top.ballStore.blinkDuration=1),t},t.prototype.showConfetti=function(){var t=this;g.game.timeManager.createAndStartTimer(600,function(){new g.Confettis(t.particles,!1).start()}),g.game.timeManager.createAndStartTimer(900,function(){new g.Confettis(t.particles,!0).start()})},t.prototype.hideTopBarButtons=function(){this.top.ballStoreButton.clickHandler.clear();var t=plume.TweenManager.get().create(this.top.ballStoreButton);t.to({y:this.top.ballStoreButton.y-this.top.ballStoreButton.height},300,plume.easing.easeOutCubic),t.start()},t.prototype.onProgress=function(t){this.top.onProgress(t)},t.prototype.destroy=function(){g.game.scaleManager.resizeHandler.remove(this.onResize)},t.prototype.showPerfect=function(){var t=g.factory.newText(g.geti18n("Perfect"),120);this.center.addChild(t),g.layout.centerOnXYInParent(t),t.setPivotToCenter(),t.x+=250,t.y+=50,t.angle=10;var e=t.y-30,i=t.x-50,n=plume.TweenManager.get().create(t);n.delay(100),n.to({scaleXY:.6,x:i,y:e,angle:-10},150,plume.easing.easeInCubic),n.start(),plume.TimeManager.createAndStartTimer(1e3*(g.ConstantDyn.BallLaunchDuration+.5),function(){t.removeSelf()})},t.prototype.hideLogo=function(){this.logo.visible=!1},t}();g.Hud=t;var e=function(y){function t(){var t=y.call(this)||this;t.lengthTextMargin=75;var e=g.game.width;t.setSize(e,140);var i=t,n=new plume.Graphics(e,140);n.beginFill(14935011),n.drawRect(0,0,e,140),n.endFill(),t.addChild(n),t.bg=n;var r=g.Player.getCoins(),o=g.factory.newText("$"+r,50);o.tint=0,o.y=10,t.coinsText=o,t.addChild(o),g.layout.centerOnXInParent(o);var s=e-150,a=new plume.Graphics(s,15);a.beginFill(8685191),a.drawRoundedRect(0,0,s,15,5),a.endFill();var l=new plume.Graphics(s,15);l.beginFill(14745676),l.drawRoundedRect(0,0,s,15,5),l.endFill(),t.addChild(a),t.addChild(l),a.y=65,g.layout.centerOnXInParent(a),l.y=a.y,l.x=a.x;var h=new plume.ProgressBar(l,0,0);t.progressbg=l,t.progressbar=h;var u=g.factory.newText("0",20),c=g.factory.newText("500",20);u.tint=8685191,c.tint=8685191,t.goal=c,t.addChild(u),t.addChild(c),t.centerDistText(u,c,l);var p=g.factory.newText(g.geti18n("ReachNToLevelUp",{n:500}),20);p.tint=8685191,p.y=110,t.goalDescription=p,t.addChild(p),g.layout.centerOnXInParent(p);var d=new v(14745676,100,!1),f=new v(488097,100,!0);d.y=l.y+l.height-3,f.y=d.y,f.x=300,t.currentTooltip=d,t.reccordTooltip=f,t.addChild(f),t.addChild(d),g.coinsChangeListener.add(function(t){i.updateCoins(t.value,t.old)});var m=plume.Sprite.fromFrame("icon/balls.png");return m.scaleXY=.5,t.ballStoreButton=g.factory.newRoundButtonIcon(150,60,15606919,m),t.addChildAt(t.ballStoreButton,0),g.layout.centerOnXInParent(t.ballStoreButton),t.ballStoreButton.y=t.bg.bottom,t.ballStoreButton.onClick(t.openBallStore,t),t}return __extends(t,y),t.prototype.openBallStore=function(){this.ballStore=new g.BallStore,this.ballStore.onClose(this.closeBallStore,this),this.addChild(this.ballStore),this.ballStore.animateIn()},t.prototype.closeBallStore=function(){this.ballStore.removeSelf(),this.ballStore=null},t.prototype.redraw=function(){var t=g.gui.expandedBounds;this.y=t.y,this.bg.clear(),this.bg.beginFill(14935011),this.bg.drawRect(t.x,0,t.width,this.height),this.bg.endFill(),null!=this.ballStore&&this.ballStore.redraw()},t.prototype.centerDistText=function(t,e,i){var n=i.y+i.height/2;t.x=this.lengthTextMargin/2-t.width/2,t.y=n-t.height/2-2,e.x=g.game.width-this.lengthTextMargin/2-e.width/2,e.y=n-e.height/2-2},t.prototype.updateCoins=function(t,e){null!=this.coinsTween&&this.coinsTween.stop();var i=this,n=new plume.TweenValueListener(e,!0);n.onValueChange=function(t){i.coinsText.text="$"+t,i.coinsText.x=(i._width-i.coinsText.width)/2},this.coinsTween=plume.TweenManager.get().create(n),this.coinsTween.to({value:t},2e3),this.coinsTween.start()},t.prototype.onStart=function(){var t=g.Player.getCurrentLevel(),e=g.Player.getScore();this.currentGoal=g.gameplay.getGoalByLevel(t),this.progressbar.setProgress(0),this.currentTooltip.updateText("0m"),this.reccordTooltip.updateText(e+"m"),this.moveTooltipAt(this.currentTooltip,0),0<e?(this.reccordTooltip.visible=!0,this.moveTooltipAt(this.reccordTooltip,e)):this.reccordTooltip.visible=!1,this.goal.text=""+this.currentGoal,this.goalDescription.text=g.geti18n("ReachNToLevelUp",{n:this.currentGoal})},t.prototype.onProgress=function(t){var e=t/this.currentGoal;e=plume.Mathf.clamp01(e),this.currentTooltip.updateText(t+"m"),this.moveTooltipAt(this.currentTooltip,t),this.progressbar.setProgress(e)},t.prototype.moveTooltipAt=function(t,e){var i=plume.Mathf.clamp(e,0,this.currentGoal)/this.currentGoal,n=this.progressbg.width*i;t.x=this.progressbg.x-t.width/2+n},t}(plume.Container);g.TopPanel=e;var i=function(u){function t(){var t=u.call(this)||this;t.tabs=[],t.coinsToBuy=0,t.canBuy=!1;var e=t,i=g.game.width;t.setSize(i,220),t.bg=new plume.Graphics,t.bg.beginFill(14935011),t.bg.drawRect(0,55,i,165),t.bg.endFill(),t.addChild(t.bg);for(var n=[0,1,2,3],r=0;r<n.length;r++){var o=new c(n[r],t);t.addChild(o);var s=(i-4*o.width)/5;o.x=(r+1)*s+r*o.width,t.tabs.push(o)}t.line=new plume.Graphics,t.line.y=50,t.addChild(t.line);var a=t.line.y+25;t.main=g.factory.newText("",50),t.main.tint=0,t.main.x=30,t.main.y=a,t.description=g.factory.newText("",20),t.description.tint=8685191,t.description.x=30,t.description.y=a+60;var l=new plume.Container(210,80),h=g.factory.newText(g.geti18n("Upgrade"),20);return t.button=new plume.Graphics(210,80),t.price=g.factory.newText("",50),l.addChild(t.button),l.addChild(h),l.addChild(t.price),h.y=2,t.price.y=22,g.layout.centerOnXInParent(h),l.x=g.game.width-30-l.width,l.y=a+5,t.addChild(t.main),t.addChild(t.description),t.addChild(l),t.selectTab(0),l.onClick(t.buy,t),g.coinsChangeListener.add(function(){e.redraw()}),t}return __extends(t,u),t.prototype.redraw=function(){var t=g.gui.expandedBounds,e=g.Player.getSkillLevel(this.skill)+1,i=g.gameplay.getUpgradeCost(this.skill),n=g.Player.getCoins();this.canBuy=i<=n,this.coinsToBuy=i,this.y=t.y+t.height-this.height,this.bg.clear(),this.bg.beginFill(14935011),this.bg.drawRect(t.x,55,t.width,this.height-55),this.bg.endFill(),this.line.clear(),this.line.beginFill(a(this.skill)),this.line.drawRect(t.x,0,t.width,15),this.line.endFill(),this.main.text=function(t,e){{if(0==t)return g.geti18n("StrengthN",{n:e});if(1==t)return g.geti18n("SpeedN",{n:e});if(2==t)return g.geti18n("BounceN",{n:e});if(3==t)return g.geti18n("OfflineN",{n:e})}return null}(this.skill,e),this.description.text=function(t,e){{if(e*=10,0==t)return g.geti18n("StrengthDescN",{n:e});if(3==t)return g.geti18n("SpeedDescN",{n:e});if(2==t)return g.geti18n("BounceDescN",{n:e});if(1==t)return g.geti18n("OfflineDescN",{n:e})}return null}(this.skill,e),this.price.text="$"+i,g.layout.centerOnXInParent(this.price),this.button.clear(),this.button.beginFill(this.canBuy?a(this.skill):8685191),this.button.drawRoundedRect(0,0,210,80,10),this.button.endFill()},t.prototype.onStart=function(){var t=g.factory.newText(g.geti18n("TapToStart"),60);this.addChild(t),t.y=-300,g.layout.centerOnXInParent(t),g.tween.blink(t),this.clickToStart=t},t.prototype.onWaiting=function(){null!=this.clickToStart&&this.clickToStart.removeSelf()},t.prototype.buy=function(){if(this.canBuy){var t=g.Player.getSkillLevel(this.skill);g.Player.setSkillLevel(this.skill,t+1),g.Player.removeCoins(this.coinsToBuy),g.Player.save()}},t.prototype.selectTab=function(t){if(this.skill!=t){this.skill=t;for(var e=0;e<this.tabs.length;e++){var i=this.tabs[e];i.setSelected(i.skill==t)}this.redraw()}},t}(plume.Container);g.BottomPanel=i;var c=function(s){function t(t,e){var i=s.call(this)||this;i.skill=t,i.panel=e;i.setSize(160,60);var n=new plume.Graphics(160,60);n.beginFill(a(t)),n.drawRoundedRect(0,0,160,60,10),n.endFill(),i.addChild(n);var r=function(t){{if(0==t)return plume.Sprite.fromFrame("icon/power.png");if(1==t)return plume.Sprite.fromFrame("icon/drag.png");if(2==t)return plume.Sprite.fromFrame("icon/bounciness.png");if(3==t)return plume.Sprite.fromFrame("icon/offlineearning.png")}return null}(t);r.scaleXY=.5,i.addChild(r),g.layout.centerOnXYInParent(r);var o=new plume.Graphics(160,60);return o.beginFill(0),o.drawRoundedRect(0,0,160,60,10),o.endFill(),o.alpha=.5,i.addChild(o),i.blackOverlay=o,i.onClick(function(){e.selectTab(t)}),i}return __extends(t,s),t.prototype.setSelected=function(t){this.blackOverlay.visible=!t},t}(plume.Container),v=function(a){function t(t,e,i){void 0===i&&(i=!1);var n=a.call(this,e,30)||this;n.color=t;var r=new plume.Graphics;r.beginFill(t),r.drawRoundedRect(0,5,e,25,5),r.endFill(),n.addChild(r);var o=new plume.Graphics(10,10);o.beginFill(t),o.moveTo(5,0),o.lineTo(10,10),o.lineTo(0,10),o.lineTo(5,0),o.endFill(),n.addChild(o),o.x=e/2-5;var s=g.factory.newText("150m",20);return n.text=s,n.addChild(s),g.layout.centerOnXInParent(s),g.layout.centerOnYInParent(s),s.y+=3,n}return __extends(t,a),t.prototype.updateText=function(t){this.text.text=t,g.layout.centerOnXInParent(this.text)},t}(plume.Container);function a(t){return 0==t?16741376:1==t?3871919:2==t?39321:3==t?16766208:null}}(GAME||(GAME={})),function(i){var t=function(){function t(){this.game=i.Game.get(),this.container=i.factory.newContainer(),this.contentback=i.factory.newContainer(),this.content=new plume.Container,this.targetAlpha=.4;var t=i.gui.expandedBounds,e=new plume.Graphics(t.width,t.height);e.beginFill(0),e.drawRect(t.x,t.y,t.width,t.height),e.endFill(),e.alpha=.6,e.interactive=!0,this.targetAlpha=.6,this.overlay=e,this.container.addChild(e),this.container.addChild(this.contentback),this.container.addChild(this.content)}return t.prototype.setBg=function(){var t=new plume.Graphics;t.beginFill(14935011),t.drawRoundedRect(0,0,500,700,10),t.endFill(),this.content.addChildAt(t,0),this.content.setSize(500,700)},t.prototype.build=function(){},t.prototype.show=function(){plume.layout.centerOnX(this.content,this.container),plume.layout.centerOnY(this.content,this.container);var t=this.content.y;this.overlay.alpha=0,this.content.alpha=0,this.content.y-=100;var e=plume.TweenManager.get().create(this.overlay);e.delay(100),e.to({alpha:this.targetAlpha},450,plume.easing.easeOutQuad),e.start();var i=plume.TweenManager.get().create(this.content);i.delay(150),i.to({alpha:1,y:t},450,plume.easing.easeOutQuad),i.start(),this.game.gui.layers.popup.addChild(this.container)},t.prototype.close=function(){var t=this,e=this.content.y-100,i=plume.TweenManager.get().create(this.overlay);i.to({alpha:0},450,plume.easing.easeInQuad),i.start();var n=plume.TweenManager.get().create(this.content);n.to({alpha:0,y:e},450,plume.easing.easeInQuad),n.start(),n.onComplete=function(){t.container.removeSelf()}},t}();i.Popup=t}(GAME||(GAME={})),function(d){var t=function(p){function t(t,e,i,n){var r=p.call(this)||this;r.setBg();var o=r,s=i?d.geti18n("YouEarnOffline",{n:t}):d.geti18n("YouEarnThisRun",{n:t}),a=d.factory.newText(s,60);a.align="center",a.tint=8685191;var l=d.factory.newButton(450,80,488097),h=d.factory.newText(d.geti18n("CollectN",{n:t}),30);l.setText(h);var u=d.factory.newButton(450,160,e?14745676:14935011),c=d.factory.newText(d.geti18n("DoubleN",{n:2*t}),40);return u.setText(c),e||u.disable(),r.content.addChild(a),r.content.addChild(l),r.content.addChild(u),d.layout.centerOnXInParent(a),d.layout.centerOnXInParent(l),d.layout.centerOnXInParent(u),a.y=80,l.y=350,u.y=l.y+l.height+30,l.onClick(function(){o.collectAndClose(t,l),n()}),e&&u.onClick(function(){d.Ads.showRv(function(){o.collectAndClose(2*t,u),n()})}),r}return __extends(t,p),t.prototype.collectAndClose=function(t,e){var i=this;d.Player.addCoins(t);var n=new d.CoinsAnim2d;n.onEnd(function(){i.close()},this),this.content.addChild(n),d.layout.centerOnX(n,e),d.layout.centerOnY(n,e),n.start()},t}(d.Popup);d.WinPopup=t}(GAME||(GAME={})),function(l){var t=function(){function t(t){this.gameplay=t,this.startPosition=new THREE.Vector3,this.startTarget=new THREE.Vector3,this.offsetToTarget=new THREE.Vector3,this.camera=l.engine.camera}return t.prototype.update=function(t){},t.prototype.reset=function(t){},t.prototype.destroy=function(){},t.prototype.start=function(){this.startPosition.copy(this.camera.position),this.startTarget.copy(this.gameplay.ball.getHitPosition()),this.offsetToTarget.copy(this.startPosition).sub(this.startTarget)},t}(),e=function(n){function t(t){var e=n.call(this,t)||this;return e.gameplay=t,e._strafeTmp=new THREE.Vector3,e._moveSpeed=20,e._orbitDistance=100,e._lookSpeed=.2,e._orbitTarget=new THREE.Vector3,e._orbit=!1,e._freeLook=!1,e.mouse=l.game.inputManager.mouse,e.kb=l.game.inputManager.keyboard,e.initOrbitTarget(),e}return __extends(t,n),t.prototype.update=function(t){n.prototype.update.call(this,t);var e=this._moveSpeed*t;if(e*=10,this.kb.isDown(plume.KeyCode.UP)&&this.strafe(l.FORWARD,-e),this.kb.isDown(plume.KeyCode.DOWN)&&this.strafe(l.FORWARD,+e),this.kb.isDown(plume.KeyCode.LEFT)&&this.strafe(l.LEFT,-e),this.kb.isDown(plume.KeyCode.RIGHT)&&this.strafe(l.LEFT,+e),0!=this.mouse.wheelDelta&&this.strafe(l.FORWARD,10*e*this.mouse.wheelDelta),this.mouse.isDown){if(this.mouse.isJustDown){if(this._orbit=!1,this._freeLook=!1,this.kb.isDown(plume.KeyCode.ALT))this._orbit=!0;else{var i=this.mouse.pointer.getLastMouseEvent();null!=i&&3==i.which&&(this._freeLook=!0)}this._orbit&&this.initOrbitTarget(),this._freeLook&&this.initFreeLook()}this._freeLook?this.freeLook():this._orbit&&this.orbit()}else this._freeLook=!1,this._orbit=!1},t.prototype.strafe=function(t,e){this._strafeTmp.copy(t),this._strafeTmp.normalize(),this._strafeTmp.multiplyScalar(e).applyQuaternion(this.camera.quaternion),this.camera.position.add(this._strafeTmp)},t.prototype.freeLook=function(){var t=this.mouse.pointer.diffPosition.x,e=this.mouse.pointer.diffPosition.y;if(0!=t||0!=e){var i=-t*this._lookSpeed*l.Mathf.DEG2RAD,n=e*this._lookSpeed*l.Mathf.DEG2RAD,r=this.camera.getWorldDirection(new THREE.Vector3).multiplyScalar(100),o=this.camera.getWorldPosition(new THREE.Vector3).clone().add(r),s=(new THREE.Vector3).copy(o).sub(this.camera.position),a=new THREE.Spherical;a.setFromVector3(s),a.theta+=i,a.phi+=n,s.setFromSpherical(a),o.copy(this.camera.position).add(s),this.camera.lookAt(o)}},t.prototype.initFreeLook=function(){},t.prototype.initOrbitTarget=function(){var t=new THREE.Vector3;(t=this.camera.getWorldDirection(t)).multiplyScalar(this._orbitDistance),this._orbitTarget=this.camera.getWorldPosition(this._orbitTarget),this._orbitTarget.add(t)},t.prototype.orbit=function(){var t=this.mouse.pointer.diffPosition.x,e=this.mouse.pointer.diffPosition.y;if(0!=t||0!=e){var i=-t*this._lookSpeed*l.Mathf.DEG2RAD,n=-e*this._lookSpeed*l.Mathf.DEG2RAD,r=this.camera.position,o=(new THREE.Vector3).copy(r).sub(this._orbitTarget),s=new THREE.Spherical;s.setFromVector3(o),s.theta+=i,s.phi+=n,o.setFromSpherical(s),r.copy(this._orbitTarget).add(o)}},t}(l.Camera=t);l.FreeCamera=e;var i=function(i){function t(t){var e=i.call(this,t)||this;return e.lookAtCharacter=new THREE.Vector3,e.startFollowDelay=.3,e.smootherNeedInit=!0,e.lastBallPosition=new THREE.Vector3,e.newBallPosition=new THREE.Vector3,e.currentBallPosition=new THREE.Vector3,e.topRotation=new THREE.Quaternion,e.regularRotation=new THREE.Quaternion,e.topRotation.setFromEuler(new THREE.Euler(Math.PI/3,Math.PI,0)).normalize(),e.regularRotation.setFromEuler(new THREE.Euler(Math.PI/8,Math.PI,0)).normalize(),e.distanceLerp=new plume.ValueSmootherNumber,e.distanceLerp.currentValue=1,e.rotationLerp=new plume.ValueSmootherQuat,e}return __extends(t,i),t.prototype.initSmoother=function(){this.smootherNeedInit=!1;var t=this.gameplay.ball,e=l.vpool.v3().copy(t.root.position).sub(this.camera.position).length();this.distanceLerp.currentValue=e},t.prototype.start=function(){i.prototype.start.call(this);var t=this.gameplay.character;this.lookAtCharacter.copy(t.root.position),this.lookAtCharacter.y+=0,this.camera.position.z+=20,this.camera.lookAt(this.lookAtCharacter)},t.prototype.rotateToShoot=function(){console.log("Prepare to shoot");var t=this.camera.position.clone(),e=this.camera.position.clone();t.x-=6,t.z-=5,e.x-=6,e.z-=15;var i=new THREE.CatmullRomCurve3([this.camera.position.clone(),t,e,this.startPosition.clone()]),n=new l.Travelling(this.camera);n.useLineCurve(!1,this.lookAtCharacter.clone(),this.startTarget.clone()),n.moveCurve=i,n.play()},t.prototype.update=function(t){var e=this.gameplay.ball,i=e.state;if(0!=i&&1!=i&&3!=i)if(this.startFollowDelay-=t,0<this.startFollowDelay)this.camera.lookAt(e.root.position);else{var n=performance.now();this.newBallPosition.copy(e.root.position),this.smootherNeedInit&&this.initSmoother(),40<this.newBallPosition.y&&2!=this.rotationLerp.state?(this.rotationLerp.state=2,this.rotationLerp.reset(this.camera.quaternion.clone().normalize(),this.topRotation,5e3,n)):this.newBallPosition.y<=40&&1!=this.rotationLerp.state&&(this.rotationLerp.state=1,this.rotationLerp.reset(this.camera.quaternion.clone().normalize(),this.regularRotation,5e3,n));var r=this.rotationLerp.getInterpolation(n);this.camera.quaternion.copy(r);var o=e.speed;40<o&&2!=this.distanceLerp.state?(this.distanceLerp.state=2,this.distanceLerp.reset(this.distanceLerp.currentValue,25,5e3,n)):o<=10&&1!=this.distanceLerp.state&&(this.distanceLerp.state=1,this.distanceLerp.reset(this.distanceLerp.currentValue,10,5e3,n));var s=this.distanceLerp.getInterpolation(n),a=new THREE.Vector3(0,0,-s);a.applyQuaternion(this.camera.quaternion),this.currentBallPosition.copy(this.lastBallPosition),this.currentBallPosition.lerp(this.newBallPosition,1),this.lastBallPosition.copy(this.currentBallPosition),this.camera.position.copy(this.currentBallPosition),this.camera.position.sub(a)}},t}(t);l.FollowCamera=i}(GAME||(GAME={})),function(s){var t=function(o){function r(t,e,i,n){var r=o.call(this,t,e)||this;r.sourceGeometry=n,r.numInstances=0;return r.numInstances=i,r._instancePosition=new THREE.InstancedBufferAttribute(new Float32Array(3*i),3,!1,1),r._instanceScale=new THREE.InstancedBufferAttribute(new Float32Array(3*i),3,!1,1),r._instanceQuaternion=new THREE.InstancedBufferAttribute(new Float32Array(4*i),4,!1,1),r.geometry.uuid=n.uuid,r.geometry.attributes.instancePosition=r._instancePosition,r.geometry.attributes.instanceScale=r._instanceScale,r.geometry.attributes.instanceQuaternion=r._instanceQuaternion,t.computeBoundingSphere=function(){return null!=t.boundingSphere||(t.boundingSphere=new THREE.Sphere(new THREE.Vector3(0,0,70),150)),t.boundingSphere},r}return __extends(r,o),r.from=function(t,e,i){var n=(new THREE.InstancedBufferGeometry).copy(t);return n.boundingBox=null,n.boundingSphere=null,new r(n,s.Materials.getCachedMaterial(e,!0,!0),i,t)},r.prototype.removeAt=function(t,e){this._instancePosition.setXYZ(t,e.x,e.y,e.z),this._instancePosition.needsUpdate=!0},r.prototype.set=function(t,e,i,n){this._instancePosition.setXYZ(t,e.x,e.y,e.z),this._instanceScale.setXYZ(t,n.x,n.y,n.z),this._instanceQuaternion.setXYZW(t,i.x,i.y,i.z,i.w)},r.prototype.get=function(t,e,i,n){e.x=this._instancePosition.getX(t),e.y=this._instancePosition.getY(t),e.z=this._instancePosition.getZ(t),n.x=this._instanceScale.getX(t),n.y=this._instanceScale.getY(t),n.z=this._instanceScale.getZ(t),i.x=this._instanceQuaternion.getX(t),i.y=this._instanceQuaternion.getY(t),i.z=this._instanceQuaternion.getZ(t),i.w=this._instanceQuaternion.getW(t)},r}(THREE.Mesh);s.InstancedMesh=t}(GAME||(GAME={})),function(h){var t=function(){function t(t){this.gameplay=t,this.root=new THREE.Object3D,this.state=0,this.justBounce=!1,this.launchTimer=0,this.speed=100,this.perfectLaunch=!1,this.hitPosition=new THREE.Vector3,this.lastPosition=new THREE.Vector3,this.speedv3=new THREE.Vector3,this.lastMoveTime=0,this.previousSpeed=100,this.launchAngle=0,this.perfectLaunchEmitterRunning=!1,this.accelerationRatio=1,this.initialBounciness=1,this.initialDamping=1,this.damping=1,this.gravity=0,this.falling=!1,this.rebounceEnd=0,this.rebounceOffset=new THREE.Vector3,this.cannonImpulse=new CANNON.Vec3,this.cannonWorldPosition=new CANNON.Vec3,this.perfectHitLoopingEmitters=[],this.jumpEmitters=[];var e=this;t.scene.add(this.root),this.simulation=h.game.simulation;var i=h.BallsManager.getCurrent();this.initBall(i),this.hitPosition.set(0,30.2,-52);var n=h.FX.getFX(h.FXNames.HitParticles);this.hitParticlesEmitter=n.emitter,this.hitParticlesEmitter.initialize(),n.node.position.copy(this.getHitPosition()),t.scene.add(n.node);var r=h.FX.getFX(h.FXNames.PerfectHitParticles1);this.perfectHitEmitter=r.emitter,this.perfectHitEmitter.initialize(),r.node.scale.multiplyScalar(5),this.root.add(r.node);var o=h.FX.getFX(h.FXNames.PerfectHitParticles),s=h.FX.getFX(h.FXNames.PerfectHitParticles0);this.perfectHitLoopingEmitters.push(o.emitter),this.perfectHitLoopingEmitters.push(s.emitter);var a=h.FX.getFX(h.FXNames.JumpParticle),l=h.FX.getFX(h.FXNames.JumpParticle0);this.jumpEmitters.push(a.emitter),this.jumpEmitters.push(l.emitter),this.jumpEmitters.forEach(function(t){t.initialize(),e.root.add(t.parent)}),this.trail=new plume.TrailRenderer2,this.trail.autoUpdate=!1,this.trail.target=this.root,this.trail.length=20,this.trail.setColor((new THREE.Color).setHex(16777215),.5,(new THREE.Color).setHex(16777215),.01),this.trail.setWidth(1.5*this.worldRadius,0),this.trail.initialize(),window.__ball=this}return t.prototype.changeBall=function(t){this.root.remove(this.ball),this.initBall(t),this.reset()},t.prototype.initBall=function(t){var e=t.model;t.model?t.model:e=t.name,this.ball=h.ModelParser.get().getBall(e,!1),this.ball.position.set(0,0,0),this.ball.castShadow=!0,this.root.add(this.ball);var i=(new THREE.Box3).setFromObject(this.ball),n=(i.max.x-i.min.x)/2,r=.3/n;this.ball.scale.multiplyScalar(r),this.worldRadius=n*r,this.body=plume.CannonBodyBuilder.newSphere(this.worldRadius,{mass:h.ConstantDyn.BallMass})},t.prototype.reset=function(){this.state=0,this.root.position.copy(this.getStartPosition()),this.lastPosition.set(0,0,0),this.lastMoveTime=0,this.launchTimer=10,this.previousSpeed=100,this.speed=this.previousSpeed,this.falling=!1,this.justBounce=!1,this.accelerationRatio=1,this.perfectLaunch=!1,this.gravity=0,this.simulation.setGravity(0,-10,0),null!=this.body&&this.simulation.removeRigidBody(this.body)},t.prototype.launch=function(t){if(0!=this.state)return!1;h.logger.debug("Ball will be hit at "+t*plume.Mathf.RAD2DEG),this.state=1,this.launchTimer=h.ConstantDyn.BallLaunchDuration,this.launchAngle=t+Math.PI/2,this.perfectLaunch=!1;var e=this.launchAngle*plume.Mathf.RAD2DEG;if(89<=e&&e<=91&&(this.perfectLaunch=!0),this.perfectLaunch){var i=h.ModelParser.get().getPlayerAnim(h.PlayerAnims.Victory);this.launchTimer+=i.clip.duration-.5}return this.perfectLaunch},t.prototype.justBeforeGiveImpulse=function(){var e=this;this.hitParticlesEmitter.play(),this.perfectLaunch&&(h.logger.debug("Perfect launch"),this.perfectLaunchEmitterRunning=!0,this.perfectHitEmitter.play(),this.perfectHitLoopingEmitters.forEach(function(t){t.initialize(),t.play(),t.parent.scale.multiplyScalar(1.2),e.root.add(t.parent)}))},t.prototype.giveImpulse=function(){this.state=2,this.launchTimer=100;var t=this.root.position;this.lastPosition.copy(t),this.lastMoveTime=performance.now();var e=h.ConstantDyn.BallStrength,i=h.ConstantDyn.BallBounciness,n=h.ConstantDyn.BallLinearVelocityDamping,r=h.gameplay.getBonusFactor(h.Player.getStrength(),.1),o=h.gameplay.getBonusFactor(h.Player.getBounce(),.2),s=h.gameplay.getBonusFactor(h.Player.getSpeed(),.1),a=1+5*h.Player.getCurrentLevel()/100;h.logger.debug("Bonus factor. Strength: "+r+", bounce: "+o+", speed: "+s+", general bonus: "+a),e*=r,e*=a,i*=o,this.initialBounciness=i,this.initialDamping=n,this.damping=n,this.accelerationRatio=s;var l=new THREE.Vector3;l.x=-Math.cos(this.launchAngle),l.y=Math.PI/8,l.z=Math.sin(this.launchAngle),l.normalize(),l.multiplyScalar(e),this.gameplay.simulation.getWorld().defaultContactMaterial.restitution=.3*o,h.game.physicsTimeScale=s,this.body.linearDamping=n,this.body.angularDamping=h.ConstantDyn.BallAngularDamping,this.simulation.addRigidBody(this.body,this.root,!0,1,2),this.simulation.setDynamicBodySyncProperty(this.body,!0,!1),this.cannonImpulse.set(l.x,l.y,l.z),this.body.applyImpulse(this.cannonImpulse,new CANNON.Vec3(.01,.01,.01)),null!=this.trail&&this.trail.activate()},t.prototype.rebounce=function(){this.startRebounce()},t.prototype.moveOnLaunchCurve=function(t){this.launchTimer-=t,this.launchTimer<=.1&&0==this.hitParticlesEmitter.isPlaying&&this.justBeforeGiveImpulse(),this.launchTimer<=0&&this.giveImpulse()},t.prototype.checkMoving=function(t){this.justBounce=!1;var e=this.root.position,i=this.lastPosition.distanceTo(e),n=performance.now(),r=e.y,o=this.lastPosition.y;i<.2?1e3<n-this.lastMoveTime&&(this.state=3,this.simulation.removeRigidBody(this.body)):(this.lastMoveTime=n,this.lastPosition.copy(e));this.previousSpeed=this.speed;var s=this.body.velocity;this.speedv3.set(s.x,s.y,s.z),this.speed=this.speedv3.length();var a=r-o;a<0?this.falling=!0:0<a&&(this.falling&&(this.justBounce=!0,this.onBounce()),this.falling=!1),this.speed<=5&&this.perfectLaunchEmitterRunning&&(this.perfectLaunchEmitterRunning=!1,this.perfectHitLoopingEmitters.forEach(function(t){t.stop()})),this.speed<=.5&&null!=this.trail&&this.trail.deactivate()},t.prototype.rotate=function(t){if(null!=this.body){var e=this.body.quaternion;this.ball.quaternion.set(e.x,e.y,e.z,e.w)}},t.prototype.start=function(){},t.prototype.destroy=function(){null!=this.hitParticlesEmitter&&(this.hitParticlesEmitter.destroy(),this.hitParticlesEmitter=null),null!=this.perfectHitEmitter&&(this.perfectHitEmitter.destroy(),this.perfectHitEmitter=null),this.perfectHitLoopingEmitters.forEach(function(t){t.destroy()}),this.jumpEmitters.forEach(function(t){t.destroy()}),this.gameplay.scene.remove(this.root),null!=this.trail&&this.trail.deactivate()},t.prototype.update=function(t){0!=this.state&&(1==this.state?this.moveOnLaunchCurve(t):2==this.state?(this.rotate(t),this.checkMoving(t),this.updateRebounce()):this.state)},t.prototype.render=function(t){0!=this.state&&null!=this.trail&&this.trail.update()},t.prototype.getStartPosition=function(){return this.hitPosition},t.prototype.getHitPosition=function(){return this.hitPosition},t.prototype.getPosition=function(){return this.lastPosition},t.prototype.onBounce=function(){this.initialBounciness<.1||(this.initialBounciness=.8*this.initialBounciness,this.initialBounciness<.1&&(this.initialBounciness=0),this.gameplay.simulation.getWorld().defaultContactMaterial.restitution=.3*this.initialBounciness)},t.prototype.startRebounce=function(){this.jumpEmitters.forEach(function(t){t.play()}),this.updateRebounce()},t.prototype.updateRebounce=function(){performance.now();this.rebounceEnd},t.prototype._fakeShoot=function(){this.simulation.removeRigidBody(this.body),this.body.angularVelocity.setZero(),this.body.velocity.setZero(),this.body.force.setZero();var t=this.gameplay.camera.camera.position;this.root.position.copy(t);var e=this.gameplay.camera.camera.getWorldDirection(h.vpool.v3());e.multiplyScalar(10),this.cannonImpulse.set(e.x,e.y,e.z),this.simulation.addRigidBody(this.body,this.root,!0,1,2),this.simulation.setDynamicBodySyncProperty(this.body,!0,!1),this.body.applyImpulse(this.cannonImpulse,this.body.position)},t}();h.Ball=t}(GAME||(GAME={})),function(h){var t=function(){function t(t){this.scene=t,this.bestposition=new THREE.Vector3,this.savedbest=-200,this.doDistanceAdjustement=!1,this.lightMaterial=new THREE.MeshBasicMaterial({color:14935011,depthTest:!1}),this.bestpane=this.createScorePane(!0),this.scorepane=this.createScorePane(!1);var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(-150,0,0)),e.vertices.push(new THREE.Vector3(150,0,0));var i=new THREE.LineDashedMaterial({color:488097,scale:5,linewidth:1,dashSize:1,gapSize:1}),n=new THREE.Line(e,i);n.computeLineDistances(),n.position.y-=1,this.bestline=n,this.scene.add(this.bestline),this.scene.add(this.bestpane.group),this.scene.add(this.scorepane.group),this.bestline.visible=!1,this.bestpane.group.visible=!1,this.scorepane.group.visible=!1,this.bestposition.set(0,0,-200)}return t.prototype.setScore=function(t){this.doDistanceAdjustement=!0,t>this.savedbest&&(this.savedbest=t);var e=t;this.bestposition.set(0,.1,e),this._updateScoreText(this.bestpane.score,t,!0),this.bestline.visible=!0,this.bestpane.group.visible=!0,this.scorepane.group.visible=!1,this.bestpane.group.position.copy(this.bestposition),this.bestline.position.copy(this.bestposition)},t.prototype.updateScore=function(t,e){this.doDistanceAdjustement=!1;var i=this,n=e.x-1,r=e.y+.1,o=e.z,s=t>this.savedbest,a=s?this.bestpane:this.scorepane;this._updateScoreText(a.score,t,s),a.group.visible=!0,a.group.position.set(n,r-0,o),s&&(this.bestline.position.z=o,this.bestline.position.y=r-0,this.bestposition.set(n,r,o),plume.TimeManager.createAndStartTimer(800,function(){i.bestline.visible=!0}));var l=plume.TweenManager.get();a.group.position.y=r+10;var h=l.create(a.group.position);h.to({y:r},800,plume.easing.easeInCubic),h.start();var u=l.create(a.group.scale);u.delay(750),u.to({y:.6},60,plume.easing.easeInCubic),u.to({y:1},1500,plume.easing.easeOutElastic),u.start()},t.prototype.update=function(t){if(this.doDistanceAdjustement){var e=i(this.bestposition.z);this.bestpane.group.position.set(this.bestposition.x,this.bestposition.y-e,this.bestposition.z),this.bestline.position.set(this.bestposition.x,this.bestposition.y-e,this.bestposition.z)}},t.prototype.createScorePane=function(t){var e=t?new THREE.MeshBasicMaterial({color:488097,depthTest:!1}):new THREE.MeshBasicMaterial({color:14745676,depthTest:!1}),i=new THREE.MeshBasicMaterial({transparent:!0,depthTest:!1});i.side=THREE.DoubleSide;var n=h.ModelParser.get().getModel(h.MapIds.Homebase,!0);n.position.set(0,0,0),n.scale.set(1,1,1),n.material=this.lightMaterial;var r=n.clone();r.scale.set(1.2,.8,1.2),r.material=e;var o=new THREE.Mesh(new THREE.PlaneBufferGeometry(1.1,1.1),i);o.rotateX(-Math.PI/2),o.position.y+=.1,r.renderOrder=2,n.renderOrder=3,o.renderOrder=4;var s=new THREE.Group,a=new THREE.Group;a.add(r),a.add(n),a.add(o),a.rotateY(Math.PI),a.rotateX(Math.PI/2),a.position.y=1,s.add(a);var l=plume.DynamicTexture.fromSize(256,256);return i.map=l.texture,{group:s,score:l}},t.prototype._updateScoreText=function(t,e,i){t.clear(),i?(t.drawText("Best distance!","Arial","bold",35,"#00BBFF","#FFFFFF00",null,100,!1),t.drawText(e+"m","Arial","bold",80,"#0095FF",null,null,180,!1)):(t.drawText("Score","Arial","bold",35,"#FF2F51","#FFFFFF00",null,100,!1),t.drawText(e+"m","Arial","bold",80,"#FF2F51","#FFFFFF00",null,180,!1)),t.update()},t}();function i(t){var e=h.engine.camera,i=Math.abs(t-e.position.z),n=h.Mathf.smoothStep(0,1e4,i);return n=1e4*plume.Mathf.clamp01(n)}h.BestScore=t,h.computeBending=i}(GAME||(GAME={})),function(n){var t=function(){function t(t){this.gameplay=t,this.root=new THREE.Object3D,this.state=3,this.time=0,this.animationDelay=0,this.character=n.ModelParser.get().getModel(n.ElementIds.Character,!1),this.character.position.set(0,0,0),this.root.add(this.character),t.scene.add(this.root),this.character.scale.set(1.8,1.8,1.8),this.mixer=new THREE.AnimationMixer(this.character),window.__boy=this}return t.prototype.reset=function(){this.root.position.set(1.8,30,-56.7),this.state=0,this.time=0;var t=n.ModelParser.get().getPlayerAnim(n.PlayerAnims.Idle);this.animationAction=this.mixer.clipAction(t.clip).reset().play()},t.prototype.start=function(){},t.prototype.destroy=function(){},t.prototype.update=function(t){if(3!=this.state){this.time+=t,null!=this.mixer&&this.mixer.update(t);var e=this.gameplay.ball;if(0==this.state)1==e.state&&(e.perfectLaunch?this.yeah():this.shoot(.2));else if(1==this.state)0<this.animationDelay?this.animationDelay-=t:this.shoot(.2);else if(2==this.state){0<e.root.position.z&&(this.state=3)}}},t.prototype.yeah=function(){this.state=1;var t=n.ModelParser.get().getPlayerAnim(n.PlayerAnims.Victory),e=this.mixer.clipAction(t.clip).play();e.setLoop(THREE.LoopOnce,1),this.animationAction.crossFadeTo(e,.2,!1),this.animationDelay=t.clip.duration-.5},t.prototype.shoot=function(t){this.state=2,this.time=0;var e=n.ModelParser.get().getPlayerAnim(n.PlayerAnims.Kick),i=this.mixer.clipAction(e.clip).play();this.animationAction.crossFadeTo(i,t,!1)},t}();n.Character=t}(GAME||(GAME={})),function(l){var t=function(){function t(t,e,i){if(this.gameplay=t,this.chunk=e,this.index=i,this.root=new THREE.Object3D,this.bodies=[],this.active=!1,this.clouds=[],this.cloudsSpeed=[],this.root.name="chunck"+(i+1),this.box=new THREE.Box3,this.boxCenter=new THREE.Vector3(0,10,0),this.boxSize=new THREE.Vector3(300,20,140),this.init(),-1==i){var n=l.FX.getFX(l.FXNames.GodrayParticles);n.node.position.set(-15,10,80),this.godRayEmitter=n.emitter,this.godRayEmitter.initialize(),this.godRayEmitter.play(),this.root.add(n.node)}}return t.prototype.init=function(){var n=[],r=[];this.root.position.copy(this.chunk.position),this.root.scale.copy(this.chunk.scale),this.root.quaternion.copy(this.chunk.quaternion),this.chunk.traverse(function(t){if(t instanceof THREE.Mesh){var e=t.geometry.uuid+"_"+t.material.uuid,i=n.indexOf(e);if(i<0)n.push(e),r.push([]),r[r.length-1].push(t);else r[i].push(t)}});for(var t=0;t<r.length;t++){var e=r[t];if(1==e.length){var i=e[0].clone();i.material=l.Materials.getCachedMaterial(i.material,!1,!0),this.root.add(i)}else{var o=this.createInstanced(e);0,this.root.add(o)}}this.gameplay.scene.add(this.root);var s=l.ModelParser.get();for(t=0;t<6;t++){var a=s.getCloud();a.name="cloud",a.material=l.Materials.getCachedMaterial(a.material,!1,!0),this.root.add(a),this.clouds.push(a),this.cloudsSpeed.push(plume.Random.intInRange(1,3))}},t.prototype.createInstanced=function(t){for(var e=t[0],i=l.InstancedMesh.from(e.geometry,e.material,t.length),n=0;n<t.length;n++){var r=t[n];i.set(n,r.position,r.quaternion,r.scale)}return i.name=e.name,i},t.prototype.moveForward=function(){this.root.position.z+=l.ConstantDyn.ChunkOffset,this.root.updateMatrix(),this.boxCenter.z=this.root.position.z+70,this.box.translate(l.vpool.v3(0,0,+l.ConstantDyn.ChunkOffset)),this.moveBodies(+l.ConstantDyn.ChunkOffset),this.refreshBox3Helper()},t.prototype.moveBackward=function(){var t=this.root.position.z-l.ConstantDyn.ChunkOffset;t<0||(this.root.position.z=t,this.root.updateMatrix(),this.boxCenter.z=this.root.position.z+70,this.box.translate(l.vpool.v3(0,0,-l.ConstantDyn.ChunkOffset)),this.moveBodies(-l.ConstantDyn.ChunkOffset),this.refreshBox3Helper())},t.prototype.reset=function(){this.root.position.z=140*this.index,this.root.updateMatrix(),this.boxCenter.set(0,9,this.root.position.z+70),this.box.setFromCenterAndSize(this.boxCenter,this.boxSize),this.refreshBox3Helper(),this.visible=!1;for(var t=0;t<this.clouds.length;t++){var e=this.clouds[t],i=plume.Random.intInRange(-150,100),n=plume.Random.intInRange(20,100),r=plume.Random.intInRange(20,120);e.position.set(i,n,r)}},t.prototype.start=function(){},t.prototype.destroy=function(){this.visible=!1},t.prototype.update=function(t){if(this.root.visible){var e=this.root.position.z,i=this.root.position.z+140,n=this.gameplay.ball.root.position.z;e<=n&&n<=i?this.activate():this.deactivate(),this.moveClouds(t)}},t.prototype.registerPhysics=function(t){l.logger.debug("Register physics on "+this.root.name);for(var e=0;e<this.root.children.length;e++){var i=this.root.children[e];"cloud"!=i.name&&(i instanceof THREE.Mesh?this.registerPhysicElement(t,i):l.logger.warn(i.name+" is not a mesh. Can not create physical element."))}},t.prototype.activate=function(){if(!this.active){console.log("ACTIVATE "+this.root.name);for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];this.gameplay.simulation.addRigidBody(e,null,!1,2,1)}this.active=!0}},t.prototype.deactivate=function(){if(this.active){console.log("deactivate "+this.root.name);for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];this.gameplay.simulation.removeRigidBody(e)}this.active=!1,null!=this.godRayEmitter&&this.godRayEmitter.destroy()}},t.prototype.moveBodies=function(t){for(var e=0;e<this.bodies.length;e++){this.bodies[e].position.z+=t}},t.prototype.registerPhysicElement=function(t,e){var i=t.createBodies(e);plume.Collections.addAll(this.bodies,i)},Object.defineProperty(t.prototype,"visible",{get:function(){return this.root.visible},set:function(t){t!=this.root.visible&&((this.root.visible=t)||this.deactivate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bounds",{get:function(){return this.box},enumerable:!0,configurable:!0}),t.prototype.refreshBox3Helper=function(){if(null!=this.boxhelper){var t=new THREE.Color(2236962);t.lerp(new THREE.Color(16777215),this.index/20),this.boxhelper.parent.remove(this.boxhelper),this.boxhelper=new THREE.Box3Helper(this.box,t),this.gameplay.scene.add(this.boxhelper)}},t.prototype.moveClouds=function(t){for(var e=0;e<this.clouds.length;e++){var i=this.clouds[e],n=this.cloudsSpeed[e];i.position.x+=t*n,i.updateMatrix()}},t}();l.Chunk=t}(GAME||(GAME={})),function(i){var t=function(){function t(t){this.gameplay=t,this.root=new THREE.Object3D,this.progress=0,this.waitinInput=!1;var e=i.ModelParser.get().getModel(i.MapIds.Forcemeter,!0);this.root.add(e),t.scene.add(this.root),this.gauge=e.getObjectByName("gauge"),this.arrow=e.getObjectByName("arrow"),this.homebase=e.getObjectByName("homebase"),this.homebase.visible=!1}return t.prototype.reset=function(){this.waitinInput=!0,this.progress=0},t.prototype.start=function(){},t.prototype.stop=function(){this.waitinInput=!1},t.prototype.destroy=function(){},t.prototype.update=function(t){if(this.waitinInput){this.progress+=3.14*t;Math.abs(Math.cos(this.progress));var e=this.getAngle();this.arrow.setRotationFromAxisAngle(i.UP,e)}},t.prototype.getAngle=function(){var t=Math.sin(this.progress);return i.Mathf.map(t,-1,1,-Math.PI/8,Math.PI/8)},t}();i.Forcemeter=t}(GAME||(GAME={})),function(t){var e=function(){function t(t){this.gameplay=t,this.projMatrix=new THREE.Matrix4,this.frustum=new THREE.Frustum,this.chunks=t.chunks}return t.prototype.reset=function(){this.chunks.forEach(function(t){t.reset()})},t.prototype.start=function(){this.chunks.forEach(function(t){t.start()})},t.prototype.destroy=function(){this.chunks.forEach(function(t){t.destroy()})},t.prototype.update=function(e){var n=this,t=this.gameplay.camera.camera,i=t.position.z,r=i-560,o=i+980;this.projMatrix.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this.frustum.setFromMatrix(this.projMatrix),this.chunks.forEach(function(t){var e=t.root.position.z;(e<r||o<e)&&(e<r?t.moveForward():t.moveBackward(),t.visible=!1);var i=n.frustum.intersectsBox(t.bounds);t.visible=i}),this.chunks.forEach(function(t){t.update(e)})},t}();t.ChunkManager=e}(GAME||(GAME={})),function(a){var t=function(){function t(t){this.hud=t,this.state=0,this.chunks=[],this.currentBest=0,this.rebounceCount=0,this.rebounceRequestEnd=0,a.logger.debug("Create gameplay");var e=this;a.Materials.refresh(),this.engine=a.engine,this.engine.camera.near=2,this.engine.camera.far=420,this.engine.camera.updateProjectionMatrix(),this.engine.renderer.autoClear=!1,this.engine.addRenderable(this.preRender,!0,this),this.engine.addRenderable(this.postRender,!1,this),this.scene=new THREE.Scene,this.engine.scene=this.scene,this.modelParser=a.ModelParser.get(),this.physics=a.Physics.get(),this.camera=new a.FollowCamera(this),this.simulation=a.game.simulation,this.simulation.optFixedTimeStep=1/240,this.theme=a.collections.one(a.themes),this.skyScene=new THREE.Scene,this.skydome=new plume.Skydome,this.skydome.topColor.setHex(this.theme.skyTop),this.skydome.bottomColor.setHex(this.theme.skyBottom),this.skydome.radius=140,this.skydome.create(),this.skyScene.add(this.skydome.mesh),this.currentBest=a.Player.getScore(),this.bestScore=new a.BestScore(this.scene),this.kb=a.game.inputManager.keyboard,this.hud.center.onClick(function(){e.onClick()}),this.hud.center.showCursor=!1,this.createWorld()}return t.prototype.preRender=function(){a.engine.renderer.clear(),a.engine.renderer.render(this.skyScene,this.camera.camera)},t.prototype.postRender=function(){},t.prototype.createWorld=function(){var i=this,t=a.engine.loader.getModel("Map").cameras[0];this.camera.camera.position.copy(t.position),this.camera.camera.quaternion.copy(t.quaternion),this.camera.camera.rotateY(Math.PI),this.camera.camera.updateProjectionMatrix();var e=this.modelParser.getModel(a.MapIds.DirectionalLight,!0);e.intensity=this.theme.directional,this.scene.add(e);var n=new THREE.HemisphereLight(this.theme.lightTop,this.theme.lightBottom,this.theme.ambient);n.position.set(-.5,1,.5),this.scene.add(n);var r=0,o=this.modelParser.getModel(a.MapIds.Chuncks,!0);o.children.forEach(function(t){var e=new a.Chunk(i,t,r);i.chunks.push(e),r++}),a.ConstantDyn.ChunkOffset=140*o.children.length;var s=this.modelParser.getModel(a.MapIds.Base,!0);this.base=new a.Chunk(i,s,-1),this.base.visible=!0,this.base.root.position.copy(s.position),this.ball=new a.Ball(i),this.character=new a.Character(i),this.forcemeter=new a.Forcemeter(i),this.chunkManager=new a.ChunkManager(this),this.scene.updateMatrixWorld(!0),a.BallsManager.changeHandler.add(this.onBallChanged,this)},t.prototype.destroy=function(){this.physics.destroy(),this.camera.destroy(),this.ball.destroy(),this.character.destroy(),this.forcemeter.destroy(),this.chunkManager.destroy(),a.engine.removeRenderable(this.preRender),a.engine.removeRenderable(this.postRender),a.BallsManager.changeHandler.remove(this.onBallChanged)},t.prototype.onBallChanged=function(t){this.ball.changeBall(t)},t.prototype.restart=function(){a.logger.debug("Preparing.."),this.state=1,this.ball.reset(),this.character.reset(),this.forcemeter.reset(),this.chunkManager.reset(),this.hud.onStart(),0<this.currentBest&&this.bestScore.setScore(this.currentBest),this.start()},t.prototype.start=function(){a.logger.debug("Start gameplay"),this.physics.start(this),this.camera.start(),this.ball.start(),this.character.start(),this.forcemeter.start(),this.chunkManager.start(),this.chunks.forEach(function(t){t.start()})},t.prototype.update=function(t){if(this.kb.isJustDown(plume.KeyCode.fromChar("r")))return a.logger.debug("Reset game"),void a.game.switchScene(new a.MenuScene(!0));if(this.kb.isJustDown(plume.KeyCode.fromChar("s")))return a.logger.debug("Fake shoot"),void this.ball._fakeShoot();var e=t/1e3*1;if(this.physics.update(e),this.ball.update(e),this.character.update(e),this.forcemeter.update(e),this.chunkManager.update(e),3==this.state)2==this.ball.state&&(this.state=4);else if(4==this.state){this.onFlying(),3==this.ball.state&&(this.state=5,this.onBallStopped())}else this.state;if(null!=this.light){this.light.position.x=this.ball.root.position.x-4,this.light.position.y=100,this.light.position.z=this.ball.root.position.z-6}this.bestScore.update(e),this.skydome.mesh.position.z=this.camera.camera.position.z,this.skydome.mesh.position.y=this.camera.camera.position.y},t.prototype.render=function(t){var e=t/1e3*1;this.ball.render(e),this.camera.update(e)},t.prototype.onClick=function(){var e=this;1==this.state?a.Ads.showIs(function(t){e.startWaiting()}):2==this.state?(this.hud.onLaunch(),this.launchBall()):4==this.state&&(this.rebounceRequestEnd=performance.now()+500)},t.prototype.startWaiting=function(){this.hud.onWaiting(),this.state=2,this.camera instanceof a.FollowCamera&&this.camera.rotateToShoot()},t.prototype.launchBall=function(){var t=this.forcemeter.getAngle();this.state=3;var e=this.ball.launch(t);this.forcemeter.stop(),e&&this.hud.showPerfect()},t.prototype.onBallStopped=function(){a.logger.debug("Ball stopped.");var t=this.getDistance(),e=a.Player.getCurrentLevel(),i=a.gameplay.getCoinsWin(e,t);a.Player.getScore()<t&&(a.Player.setScore(t),a.Player.save());var n=!1;e<a.Player.getCurrentLevel()&&(n=!0),t>this.currentBest&&(this.currentBest=t),this.bestScore.updateScore(t,this.ball.getPosition()),setTimeout(function(){new a.WinPopup(i,a.Ads.canShowRv(),!1,function(){a.Player.save(),a.game.switchScene(new a.MenuScene(n))}).show()},2e3)},t.prototype.onFlying=function(){var t=this.getDistance();(this.hud.onProgress(a.Mathf.clamp(t,0,t)),this.ball.justBounce)&&(this.rebounceCount<3&&performance.now()<this.rebounceRequestEnd&&(this.ball.rebounce(),this.rebounceRequestEnd=0,this.rebounceCount++))},t.prototype.getDistance=function(){var t=this.ball.getPosition().z;return t=Math.round(t)},t}();a.Gameplay=t}(GAME||(GAME={})),function(o){var t=function(){function t(){}return t.load=function(){var t=this;o.shipi.gs.playerManager.onAuthenticationComplete(function(){t._init(),t.loadHandler.fire(!0)})},t.onLoaded=function(t){null==this.data?this.loadHandler.once(t):t()},t.get=function(t,e){if(null==this.data)return e;if(null==this.data[t])return e;var i=this.data[t];return null==i?e:i},t.set=function(t,e){null!=this.data&&(this.data[t]=e)},t.save=function(){var t=new gs.NMap;for(var e in this.data)t.put(e,this.data[e]);var i=new gs.SPlayer;i.setDF(t),o.shipi.gs.playerManager.savePlayerDiff(i)},t._init=function(){null==this.data&&(this.data={});var t=o.shipi.gs.playerManager._getPlayer(),e=null==t?null:t.getDF();null==e&&(e=new gs.NMap);for(var i=e.keys();i.hasNext();){var n=i.next(),r=e.get(n);this.data[n]=r}null==this.data.score&&(this.data.score=0),null==this.data.coins&&(this.data.coins=0),null==this.data.strength&&(this.data.strength=0),null==this.data.speed&&(this.data.speed=0),null==this.data.bounce&&(this.data.bounce=0),null==this.data.offline&&(this.data.offline=0),null==this.data.time&&(this.data.time=Date.now()),this.currentLevel=o.gameplay.getLevelByDistance(this.data.score)},t.setScore=function(t,e){void 0===e&&(e=!1),t<=this.getScore()&&!e||(this.set("score",t),this.currentLevel=o.gameplay.getLevelByDistance(t))},t.getScore=function(){return this.get("score",0)},t.addCoins=function(t){var e=this.getCoins();e+=t,this.setCoins(e,!0)},t.removeCoins=function(t){var e=this.getCoins();(e-=t)<0&&(e=0),this.setCoins(e,!0)},t.setCoins=function(t,e){var i=this.getCoins();this.set("coins",t),o.coinsChangeListener.fire({value:t,old:i})},t.getCoins=function(){return this.get("coins",0)},t.setStrength=function(t){this.set("strength",t)},t.getStrength=function(){return this.get("strength",0)},t.setSpeed=function(t){this.set("speed",t)},t.getSpeed=function(){return this.get("speed",0)},t.setBounce=function(t){this.set("bounce",t)},t.getBounce=function(){return this.get("bounce",0)},t.setOffline=function(t){this.set("offline",t)},t.getOffline=function(){return this.get("offline",0)},t.getTime=function(){var t=Date.now(),e=this,i=this.get("time",t);return setTimeout(function(){e.set("time",t),e.save()},0),i},t.setSkillLevel=function(t,e){0==t?this.setStrength(e):1==t?this.setSpeed(e):2==t?this.setBounce(e):3==t&&this.setOffline(e)},t.getSkillLevel=function(t){return 0==t?this.getStrength():1==t?this.getSpeed():2==t?this.getBounce():3==t?this.getOffline():0},t.getCurrentLevel=function(){return this.currentLevel},t.getBall=function(){return this.get("ball",0)},t.setBall=function(t){this.set("ball",t)},t.setCurrentBall=function(t){this.set("ball",t)},t.getCurrentBall=function(t){this.set("ball",t)},t.currentLevel=0,t.loadHandler=new plume.Handler,t}();o.Player=t}(GAME||(GAME={})),function(t){var e=function(){};(GAME||(GAME={})).CompressedTextures=e}(),function(t){!function(t){t.fonts=[];t.fonts.push({face:"text",size:80,lineHeight:96,baseLine:74,chars:[{id:287,x:1,y:1,width:39,height:79,xoffset:1,yoffset:14,xadvance:42},{id:291,x:41,y:1,width:83,height:78,xoffset:1,yoffset:14,xadvance:42},{id:219,x:125,y:1,width:43,height:76,xoffset:2,yoffset:0,xadvance:47},{id:352,x:169,y:1,width:44,height:76,xoffset:0,yoffset:0,xadvance:45},{id:268,x:214,y:1,width:48,height:76,xoffset:1,yoffset:0,xadvance:49},{id:286,x:263,y:1,width:50,height:76,xoffset:1,yoffset:0,xadvance:53},{id:212,x:314,y:1,width:51,height:76,xoffset:1,yoffset:0,xadvance:54},{id:255,x:366,y:1,width:36,height:75,xoffset:2,yoffset:17,xadvance:40},{id:290,x:403,y:1,width:50,height:74,xoffset:1,yoffset:19,xadvance:53},{id:346,x:454,y:1,width:44,height:74,xoffset:0,yoffset:1,xadvance:45},{id:262,x:499,y:1,width:48,height:74,xoffset:1,yoffset:1,xadvance:49},{id:81,x:548,y:1,width:52,height:74,xoffset:1,yoffset:19,xadvance:54},{id:350,x:601,y:1,width:44,height:74,xoffset:0,yoffset:19,xadvance:45},{id:218,x:646,y:1,width:43,height:74,xoffset:2,yoffset:1,xadvance:47},{id:211,x:690,y:1,width:51,height:74,xoffset:1,yoffset:1,xadvance:54},{id:206,x:742,y:1,width:29,height:74,xoffset:-7,yoffset:0,xadvance:15},{id:202,x:772,y:1,width:41,height:74,xoffset:2,yoffset:0,xadvance:43},{id:199,x:814,y:1,width:48,height:74,xoffset:1,yoffset:19,xadvance:49},{id:194,x:863,y:1,width:51,height:74,xoffset:0,yoffset:0,xadvance:51},{id:381,x:915,y:1,width:42,height:74,xoffset:0,yoffset:0,xadvance:43},{id:1049,x:958,y:1,width:43,height:74,xoffset:2,yoffset:0,xadvance:47},{id:217,x:1,y:82,width:43,height:74,xoffset:2,yoffset:1,xadvance:47},{id:311,x:45,y:82,width:37,height:73,xoffset:2,yoffset:20,xadvance:39},{id:192,x:83,y:82,width:51,height:73,xoffset:0,yoffset:1,xadvance:51},{id:323,x:135,y:82,width:44,height:73,xoffset:2,yoffset:1,xadvance:47},{id:316,x:180,y:82,width:11,height:73,xoffset:2,yoffset:20,xadvance:15},{id:1092,x:192,y:82,width:55,height:73,xoffset:1,yoffset:20,xadvance:58},{id:205,x:248,y:82,width:21,height:73,xoffset:0,yoffset:1,xadvance:15},{id:200,x:270,y:82,width:41,height:73,xoffset:2,yoffset:1,xadvance:43},{id:106,x:312,y:82,width:32,height:73,xoffset:-19,yoffset:20,xadvance:16},{id:377,x:345,y:82,width:42,height:73,xoffset:0,yoffset:1,xadvance:43},{id:201,x:388,y:82,width:41,height:73,xoffset:2,yoffset:1,xadvance:43},{id:325,x:430,y:82,width:44,height:72,xoffset:2,yoffset:20,xadvance:47},{id:260,x:475,y:82,width:51,height:72,xoffset:0,yoffset:20,xadvance:51},{id:315,x:527,y:82,width:38,height:72,xoffset:2,yoffset:20,xadvance:40},{id:214,x:566,y:82,width:51,height:72,xoffset:1,yoffset:3,xadvance:54},{id:220,x:618,y:82,width:43,height:72,xoffset:2,yoffset:3,xadvance:47},{id:310,x:662,y:82,width:46,height:72,xoffset:2,yoffset:20,xadvance:48},{id:280,x:709,y:82,width:41,height:72,xoffset:2,yoffset:20,xadvance:43},{id:362,x:751,y:82,width:43,height:71,xoffset:2,yoffset:4,xadvance:47},{id:379,x:795,y:82,width:42,height:70,xoffset:0,yoffset:3,xadvance:43},{id:1025,x:838,y:82,width:41,height:70,xoffset:2,yoffset:3,xadvance:43},{id:298,x:880,y:82,width:31,height:70,xoffset:-8,yoffset:4,xadvance:15},{id:274,x:912,y:82,width:41,height:70,xoffset:2,yoffset:4,xadvance:43},{id:256,x:954,y:82,width:51,height:70,xoffset:0,yoffset:4,xadvance:51},{id:207,x:1,y:158,width:27,height:70,xoffset:-5,yoffset:3,xadvance:15},{id:376,x:29,y:158,width:48,height:70,xoffset:0,yoffset:3,xadvance:48},{id:41,x:78,y:158,width:21,height:70,xoffset:1,yoffset:15,xadvance:26},{id:196,x:100,y:158,width:51,height:70,xoffset:0,yoffset:3,xadvance:51},{id:203,x:152,y:158,width:41,height:70,xoffset:2,yoffset:3,xadvance:43},{id:209,x:194,y:158,width:44,height:70,xoffset:2,yoffset:4,xadvance:47},{id:40,x:239,y:158,width:21,height:70,xoffset:5,yoffset:15,xadvance:26},{id:124,x:261,y:158,width:9,height:69,xoffset:9,yoffset:15,xadvance:27},{id:125,x:271,y:158,width:23,height:68,xoffset:1,yoffset:16,xadvance:26},{id:91,x:295,y:158,width:19,height:68,xoffset:6,yoffset:16,xadvance:26},{id:93,x:315,y:158,width:19,height:68,xoffset:1,yoffset:16,xadvance:25},{id:123,x:335,y:158,width:23,height:68,xoffset:2,yoffset:16,xadvance:27},{id:1044,x:359,y:158,width:56,height:67,xoffset:1,yoffset:20,xadvance:57},{id:1065,x:416,y:158,width:68,height:67,xoffset:2,yoffset:20,xadvance:71},{id:1062,x:485,y:158,width:50,height:67,xoffset:2,yoffset:20,xadvance:52},{id:36,x:536,y:158,width:37,height:61,xoffset:1,yoffset:17,xadvance:39},{id:1073,x:574,y:158,width:40,height:61,xoffset:1,yoffset:14,xadvance:43},{id:353,x:615,y:158,width:37,height:61,xoffset:1,yoffset:14,xadvance:38},{id:226,x:653,y:158,width:36,height:61,xoffset:1,yoffset:14,xadvance:39},{id:269,x:690,y:158,width:37,height:61,xoffset:1,yoffset:14,xadvance:38},{id:251,x:728,y:158,width:36,height:61,xoffset:2,yoffset:14,xadvance:40},{id:244,x:765,y:158,width:41,height:61,xoffset:1,yoffset:14,xadvance:43},{id:234,x:807,y:158,width:38,height:61,xoffset:1,yoffset:14,xadvance:40},{id:382,x:846,y:158,width:34,height:60,xoffset:1,yoffset:14,xadvance:36},{id:347,x:881,y:158,width:37,height:60,xoffset:1,yoffset:15,xadvance:38},{id:232,x:919,y:158,width:38,height:60,xoffset:1,yoffset:15,xadvance:40},{id:263,x:958,y:158,width:37,height:60,xoffset:1,yoffset:15,xadvance:38},{id:249,x:1,y:230,width:36,height:60,xoffset:2,yoffset:15,xadvance:40},{id:243,x:38,y:230,width:41,height:60,xoffset:1,yoffset:15,xadvance:43},{id:224,x:80,y:230,width:36,height:60,xoffset:1,yoffset:15,xadvance:39},{id:233,x:117,y:230,width:38,height:60,xoffset:1,yoffset:15,xadvance:40},{id:250,x:156,y:230,width:36,height:60,xoffset:2,yoffset:15,xadvance:40},{id:1081,x:193,y:230,width:36,height:60,xoffset:2,yoffset:14,xadvance:41},{id:238,x:230,y:230,width:29,height:60,xoffset:-4,yoffset:14,xadvance:22},{id:112,x:260,y:230,width:38,height:59,xoffset:2,yoffset:33,xadvance:42},{id:113,x:299,y:230,width:58,height:59,xoffset:1,yoffset:33,xadvance:41},{id:1088,x:358,y:230,width:38,height:59,xoffset:2,yoffset:33,xadvance:42},{id:103,x:397,y:230,width:39,height:59,xoffset:1,yoffset:33,xadvance:42},{id:326,x:437,y:230,width:36,height:59,xoffset:2,yoffset:33,xadvance:40},{id:324,x:474,y:230,width:36,height:59,xoffset:2,yoffset:15,xadvance:40},{id:351,x:511,y:230,width:37,height:59,xoffset:1,yoffset:33,xadvance:38},{id:378,x:549,y:230,width:34,height:59,xoffset:1,yoffset:15,xadvance:36},{id:261,x:584,y:230,width:36,height:59,xoffset:1,yoffset:33,xadvance:39},{id:281,x:621,y:230,width:38,height:59,xoffset:1,yoffset:33,xadvance:40},{id:231,x:660,y:230,width:37,height:59,xoffset:1,yoffset:33,xadvance:38},{id:237,x:698,y:230,width:21,height:59,xoffset:3,yoffset:15,xadvance:22},{id:121,x:720,y:230,width:36,height:58,xoffset:2,yoffset:34,xadvance:40},{id:246,x:757,y:230,width:41,height:58,xoffset:1,yoffset:17,xadvance:43},{id:228,x:799,y:230,width:36,height:58,xoffset:1,yoffset:17,xadvance:39},{id:252,x:836,y:230,width:36,height:58,xoffset:2,yoffset:17,xadvance:40},{id:1105,x:873,y:230,width:38,height:58,xoffset:1,yoffset:17,xadvance:40},{id:1091,x:912,y:230,width:36,height:58,xoffset:2,yoffset:34,xadvance:40},{id:235,x:949,y:230,width:38,height:58,xoffset:1,yoffset:17,xadvance:40},{id:83,x:1,y:292,width:44,height:57,xoffset:0,yoffset:19,xadvance:45},{id:79,x:46,y:292,width:51,height:57,xoffset:1,yoffset:19,xadvance:54},{id:37,x:98,y:292,width:51,height:57,xoffset:2,yoffset:19,xadvance:54},{id:239,x:150,y:292,width:27,height:57,xoffset:-2,yoffset:17,xadvance:22},{id:241,x:178,y:292,width:36,height:57,xoffset:2,yoffset:17,xadvance:40},{id:1054,x:215,y:292,width:51,height:57,xoffset:1,yoffset:19,xadvance:54},{id:67,x:267,y:292,width:48,height:57,xoffset:1,yoffset:19,xadvance:49},{id:64,x:316,y:292,width:55,height:57,xoffset:1,yoffset:23,xadvance:57},{id:1057,x:372,y:292,width:48,height:57,xoffset:1,yoffset:19,xadvance:49},{id:57,x:421,y:292,width:37,height:57,xoffset:1,yoffset:19,xadvance:39},{id:56,x:459,y:292,width:37,height:57,xoffset:1,yoffset:19,xadvance:40},{id:1047,x:497,y:292,width:45,height:57,xoffset:0,yoffset:19,xadvance:45},{id:54,x:543,y:292,width:37,height:57,xoffset:1,yoffset:19,xadvance:39},{id:257,x:581,y:292,width:36,height:57,xoffset:1,yoffset:18,xadvance:39},{id:71,x:618,y:292,width:50,height:57,xoffset:1,yoffset:19,xadvance:53},{id:51,x:669,y:292,width:37,height:57,xoffset:1,yoffset:19,xadvance:38},{id:1069,x:707,y:292,width:48,height:57,xoffset:0,yoffset:19,xadvance:49},{id:275,x:756,y:292,width:38,height:57,xoffset:1,yoffset:18,xadvance:40},{id:380,x:795,y:292,width:34,height:57,xoffset:1,yoffset:17,xadvance:36},{id:1070,x:830,y:292,width:66,height:57,xoffset:2,yoffset:19,xadvance:69},{id:48,x:897,y:292,width:37,height:57,xoffset:1,yoffset:19,xadvance:39},{id:363,x:935,y:292,width:36,height:57,xoffset:2,yoffset:18,xadvance:40},{id:299,x:972,y:292,width:31,height:56,xoffset:-4,yoffset:18,xadvance:22},{id:223,x:1,y:351,width:38,height:56,xoffset:2,yoffset:19,xadvance:41},{id:100,x:40,y:351,width:38,height:55,xoffset:1,yoffset:20,xadvance:42},{id:85,x:79,y:351,width:43,height:55,xoffset:2,yoffset:20,xadvance:47},{id:1059,x:123,y:351,width:42,height:55,xoffset:2,yoffset:20,xadvance:46},{id:63,x:166,y:351,width:37,height:55,xoffset:1,yoffset:19,xadvance:39},{id:50,x:204,y:351,width:37,height:55,xoffset:0,yoffset:19,xadvance:37},{id:74,x:242,y:351,width:34,height:55,xoffset:0,yoffset:20,xadvance:36},{id:53,x:277,y:351,width:36,height:55,xoffset:2,yoffset:20,xadvance:39},{id:98,x:314,y:351,width:38,height:55,xoffset:2,yoffset:20,xadvance:42},{id:38,x:353,y:351,width:37,height:55,xoffset:1,yoffset:20,xadvance:40},{id:105,x:391,y:351,width:11,height:54,xoffset:2,yoffset:20,xadvance:15},{id:108,x:403,y:351,width:11,height:54,xoffset:2,yoffset:20,xadvance:15},{id:104,x:415,y:351,width:36,height:54,xoffset:2,yoffset:20,xadvance:40},{id:107,x:452,y:351,width:37,height:54,xoffset:2,yoffset:20,xadvance:39},{id:322,x:490,y:351,width:21,height:54,xoffset:0,yoffset:20,xadvance:21},{id:102,x:512,y:351,width:23,height:54,xoffset:0,yoffset:20,xadvance:24},{id:87,x:536,y:351,width:68,height:53,xoffset:0,yoffset:20,xadvance:68},{id:1055,x:605,y:351,width:43,height:53,xoffset:2,yoffset:20,xadvance:47},{id:88,x:649,y:351,width:48,height:53,xoffset:0,yoffset:20,xadvance:48},{id:86,x:698,y:351,width:47,height:53,xoffset:0,yoffset:20,xadvance:47},{id:80,x:746,y:351,width:41,height:53,xoffset:2,yoffset:20,xadvance:43},{id:65,x:788,y:351,width:51,height:53,xoffset:0,yoffset:20,xadvance:51},{id:1058,x:840,y:351,width:44,height:53,xoffset:0,yoffset:20,xadvance:44},{id:1051,x:885,y:351,width:48,height:53,xoffset:1,yoffset:20,xadvance:50},{id:1050,x:934,y:351,width:46,height:53,xoffset:2,yoffset:20,xadvance:48},{id:49,x:981,y:351,width:22,height:53,xoffset:0,yoffset:20,xadvance:24},{id:1068,x:1,y:409,width:41,height:53,xoffset:2,yoffset:20,xadvance:43},{id:1060,x:43,y:409,width:55,height:53,xoffset:1,yoffset:20,xadvance:57},{id:68,x:99,y:409,width:46,height:53,xoffset:2,yoffset:20,xadvance:49},{id:1052,x:146,y:409,width:52,height:53,xoffset:2,yoffset:20,xadvance:56},{id:1067,x:199,y:409,width:54,height:53,xoffset:2,yoffset:20,xadvance:58},{id:76,x:254,y:409,width:38,height:53,xoffset:2,yoffset:20,xadvance:40},{id:89,x:293,y:409,width:48,height:53,xoffset:0,yoffset:20,xadvance:48},{id:70,x:342,y:409,width:38,height:53,xoffset:2,yoffset:20,xadvance:40},{id:1071,x:381,y:409,width:44,height:53,xoffset:1,yoffset:20,xadvance:46},{id:1046,x:426,y:409,width:70,height:53,xoffset:1,yoffset:20,xadvance:71},{id:1045,x:497,y:409,width:41,height:53,xoffset:2,yoffset:20,xadvance:43},{id:66,x:539,y:409,width:44,height:53,xoffset:2,yoffset:20,xadvance:46},{id:1061,x:584,y:409,width:48,height:53,xoffset:0,yoffset:20,xadvance:48},{id:1043,x:633,y:409,width:38,height:53,xoffset:2,yoffset:20,xadvance:40},{id:1042,x:672,y:409,width:44,height:53,xoffset:2,yoffset:20,xadvance:46},{id:90,x:717,y:409,width:42,height:53,xoffset:0,yoffset:20,xadvance:43},{id:75,x:760,y:409,width:46,height:53,xoffset:2,yoffset:20,xadvance:48},{id:1041,x:807,y:409,width:41,height:53,xoffset:2,yoffset:20,xadvance:43},{id:47,x:849,y:409,width:24,height:53,xoffset:0,yoffset:20,xadvance:24},{id:1040,x:874,y:409,width:51,height:53,xoffset:0,yoffset:20,xadvance:51},{id:1066,x:926,y:409,width:57,height:53,xoffset:1,yoffset:20,xadvance:57},{id:82,x:1,y:464,width:44,height:53,xoffset:2,yoffset:20,xadvance:46},{id:84,x:46,y:464,width:44,height:53,xoffset:0,yoffset:20,xadvance:44},{id:77,x:91,y:464,width:52,height:53,xoffset:2,yoffset:20,xadvance:56},{id:69,x:144,y:464,width:41,height:53,xoffset:2,yoffset:20,xadvance:43},{id:73,x:186,y:464,width:11,height:53,xoffset:2,yoffset:20,xadvance:15},{id:72,x:198,y:464,width:43,height:53,xoffset:2,yoffset:20,xadvance:47},{id:1048,x:242,y:464,width:43,height:53,xoffset:2,yoffset:20,xadvance:47},{id:92,x:286,y:464,width:24,height:53,xoffset:0,yoffset:20,xadvance:24},{id:35,x:311,y:464,width:38,height:53,xoffset:1,yoffset:20,xadvance:40},{id:1063,x:350,y:464,width:42,height:53,xoffset:2,yoffset:20,xadvance:46},{id:1053,x:393,y:464,width:43,height:53,xoffset:2,yoffset:20,xadvance:47},{id:1064,x:437,y:464,width:62,height:53,xoffset:2,yoffset:20,xadvance:66},{id:78,x:500,y:464,width:44,height:53,xoffset:2,yoffset:20,xadvance:47},{id:1056,x:545,y:464,width:41,height:53,xoffset:2,yoffset:20,xadvance:43},{id:55,x:587,y:464,width:38,height:53,xoffset:0,yoffset:20,xadvance:38},{id:33,x:626,y:464,width:12,height:53,xoffset:4,yoffset:20,xadvance:20},{id:321,x:639,y:464,width:38,height:53,xoffset:2,yoffset:20,xadvance:40},{id:52,x:678,y:464,width:37,height:53,xoffset:0,yoffset:20,xadvance:38},{id:1094,x:716,y:464,width:43,height:52,xoffset:2,yoffset:34,xadvance:45},{id:1076,x:760,y:464,width:46,height:52,xoffset:1,yoffset:34,xadvance:47},{id:1097,x:807,y:464,width:62,height:52,xoffset:2,yoffset:34,xadvance:64},{id:116,x:870,y:464,width:32,height:51,xoffset:2,yoffset:23,xadvance:36},{id:59,x:903,y:464,width:11,height:51,xoffset:1,yoffset:36,xadvance:14},{id:1077,x:915,y:464,width:38,height:42,xoffset:1,yoffset:33,xadvance:40},{id:1101,x:954,y:464,width:37,height:42,xoffset:1,yoffset:33,xadvance:39},{id:111,x:1,y:519,width:41,height:42,xoffset:1,yoffset:33,xadvance:43},{id:1079,x:43,y:519,width:36,height:42,xoffset:1,yoffset:33,xadvance:38},{id:99,x:80,y:519,width:37,height:42,xoffset:1,yoffset:33,xadvance:38},{id:101,x:118,y:519,width:38,height:42,xoffset:1,yoffset:33,xadvance:40},{id:1102,x:157,y:519,width:55,height:42,xoffset:2,yoffset:33,xadvance:58},{id:97,x:213,y:519,width:36,height:42,xoffset:1,yoffset:33,xadvance:39},{id:115,x:250,y:519,width:37,height:42,xoffset:1,yoffset:33,xadvance:38},{id:1072,x:288,y:519,width:36,height:42,xoffset:1,yoffset:33,xadvance:39},{id:1089,x:325,y:519,width:37,height:42,xoffset:1,yoffset:33,xadvance:38},{id:1086,x:363,y:519,width:41,height:42,xoffset:1,yoffset:33,xadvance:43},{id:114,x:405,y:519,width:23,height:41,xoffset:2,yoffset:33,xadvance:26},{id:110,x:429,y:519,width:36,height:41,xoffset:2,yoffset:33,xadvance:40},{id:109,x:466,y:519,width:57,height:41,xoffset:2,yoffset:33,xadvance:60},{id:117,x:524,y:519,width:36,height:41,xoffset:2,yoffset:34,xadvance:40},{id:118,x:561,y:519,width:39,height:40,xoffset:0,yoffset:34,xadvance:40},{id:1103,x:601,y:519,width:37,height:40,xoffset:0,yoffset:34,xadvance:39},{id:1100,x:639,y:519,width:38,height:40,xoffset:2,yoffset:34,xadvance:41},{id:1099,x:678,y:519,width:52,height:40,xoffset:2,yoffset:34,xadvance:56},{id:1098,x:731,y:519,width:53,height:40,xoffset:1,yoffset:34,xadvance:54},{id:1096,x:785,y:519,width:55,height:40,xoffset:2,yoffset:34,xadvance:60},{id:1095,x:841,y:519,width:36,height:40,xoffset:2,yoffset:34,xadvance:40},{id:119,x:878,y:519,width:57,height:40,xoffset:0,yoffset:34,xadvance:57},{id:1090,x:936,y:519,width:37,height:40,xoffset:1,yoffset:34,xadvance:38},{id:1085,x:974,y:519,width:37,height:40,xoffset:2,yoffset:34,xadvance:41},{id:1084,x:1,y:563,width:46,height:40,xoffset:2,yoffset:34,xadvance:50},{id:1083,x:48,y:563,width:40,height:40,xoffset:1,yoffset:34,xadvance:42},{id:1082,x:89,y:563,width:37,height:40,xoffset:2,yoffset:34,xadvance:39},{id:1080,x:127,y:563,width:36,height:40,xoffset:2,yoffset:34,xadvance:41},{id:1078,x:164,y:563,width:54,height:40,xoffset:0,yoffset:34,xadvance:55},{id:1075,x:219,y:563,width:25,height:40,xoffset:2,yoffset:34,xadvance:28},{id:1074,x:245,y:563,width:38,height:40,xoffset:2,yoffset:34,xadvance:40},{id:120,x:284,y:563,width:39,height:40,xoffset:0,yoffset:34,xadvance:40},{id:122,x:324,y:563,width:34,height:40,xoffset:1,yoffset:34,xadvance:36},{id:1087,x:359,y:563,width:37,height:40,xoffset:2,yoffset:34,xadvance:41},{id:1093,x:397,y:563,width:39,height:40,xoffset:0,yoffset:34,xadvance:40},{id:42,x:437,y:563,width:38,height:38,xoffset:3,yoffset:20,xadvance:43},{id:58,x:476,y:563,width:11,height:38,xoffset:1,yoffset:36,xadvance:14},{id:43,x:488,y:563,width:38,height:38,xoffset:2,yoffset:27,xadvance:42},{id:61,x:527,y:563,width:38,height:24,xoffset:2,yoffset:34,xadvance:42},{id:44,x:566,y:563,width:11,height:24,xoffset:2,yoffset:63,xadvance:15},{id:34,x:578,y:563,width:19,height:20,xoffset:2,yoffset:20,xadvance:23},{id:39,x:598,y:563,width:7,height:20,xoffset:2,yoffset:20,xadvance:12},{id:94,x:606,y:563,width:34,height:16,xoffset:1,yoffset:20,xadvance:37},{id:46,x:641,y:563,width:11,height:11,xoffset:2,yoffset:63,xadvance:15},{id:775,x:653,y:563,width:11,height:10,xoffset:-25,yoffset:17,xadvance:0},{id:45,x:665,y:563,width:20,height:8,xoffset:1,yoffset:45,xadvance:22},{id:95,x:686,y:563,width:39,height:5,xoffset:0,yoffset:79,xadvance:38},{id:32,x:0,y:0,width:0,height:0,xoffset:0,yoffset:79,xadvance:19}]});t.fonts.push({face:"text20",size:20,lineHeight:24,baseLine:19,chars:[{id:291,x:0,y:0,width:21,height:20,xoffset:0,yoffset:4,xadvance:11},{id:287,x:21,y:0,width:10,height:20,xoffset:0,yoffset:3,xadvance:11},{id:262,x:31,y:0,width:12,height:19,xoffset:0,yoffset:0,xadvance:12},{id:352,x:43,y:0,width:11,height:19,xoffset:0,yoffset:0,xadvance:11},{id:350,x:54,y:0,width:11,height:19,xoffset:0,yoffset:5,xadvance:11},{id:346,x:65,y:0,width:11,height:19,xoffset:0,yoffset:0,xadvance:11},{id:290,x:76,y:0,width:13,height:19,xoffset:0,yoffset:5,xadvance:13},{id:286,x:89,y:0,width:13,height:19,xoffset:0,yoffset:0,xadvance:13},{id:1049,x:102,y:0,width:11,height:19,xoffset:1,yoffset:0,xadvance:12},{id:381,x:113,y:0,width:11,height:19,xoffset:0,yoffset:0,xadvance:11},{id:219,x:124,y:0,width:11,height:19,xoffset:0,yoffset:0,xadvance:12},{id:217,x:135,y:0,width:11,height:19,xoffset:0,yoffset:0,xadvance:12},{id:81,x:146,y:0,width:13,height:19,xoffset:0,yoffset:5,xadvance:13},{id:212,x:159,y:0,width:13,height:19,xoffset:0,yoffset:0,xadvance:13},{id:211,x:172,y:0,width:13,height:19,xoffset:0,yoffset:0,xadvance:13},{id:206,x:185,y:0,width:8,height:19,xoffset:-2,yoffset:0,xadvance:4},{id:268,x:193,y:0,width:12,height:19,xoffset:0,yoffset:0,xadvance:12},{id:218,x:205,y:0,width:11,height:19,xoffset:0,yoffset:0,xadvance:12},{id:202,x:216,y:0,width:10,height:19,xoffset:0,yoffset:0,xadvance:11},{id:199,x:226,y:0,width:12,height:19,xoffset:0,yoffset:5,xadvance:12},{id:194,x:238,y:0,width:13,height:19,xoffset:0,yoffset:0,xadvance:13},{id:255,x:251,y:0,width:9,height:19,xoffset:1,yoffset:4,xadvance:10},{id:41,x:260,y:0,width:5,height:18,xoffset:0,yoffset:4,xadvance:7},{id:40,x:265,y:0,width:5,height:18,xoffset:1,yoffset:4,xadvance:7},{id:311,x:270,y:0,width:9,height:18,xoffset:1,yoffset:5,xadvance:10},{id:124,x:279,y:0,width:2,height:18,xoffset:2,yoffset:4,xadvance:7},{id:214,x:281,y:0,width:13,height:18,xoffset:0,yoffset:1,xadvance:13},{id:1025,x:294,y:0,width:10,height:18,xoffset:0,yoffset:1,xadvance:11},{id:325,x:304,y:0,width:11,height:18,xoffset:0,yoffset:5,xadvance:12},{id:323,x:315,y:0,width:11,height:18,xoffset:0,yoffset:0,xadvance:12},{id:315,x:326,y:0,width:10,height:18,xoffset:0,yoffset:5,xadvance:10},{id:310,x:336,y:0,width:12,height:18,xoffset:0,yoffset:5,xadvance:12},{id:298,x:348,y:0,width:8,height:18,xoffset:-2,yoffset:1,xadvance:4},{id:280,x:356,y:0,width:10,height:18,xoffset:0,yoffset:5,xadvance:11},{id:106,x:366,y:0,width:8,height:18,xoffset:-5,yoffset:5,xadvance:4},{id:207,x:374,y:0,width:7,height:18,xoffset:-1,yoffset:1,xadvance:4},{id:316,x:381,y:0,width:3,height:18,xoffset:1,yoffset:5,xadvance:4},{id:1092,x:384,y:0,width:14,height:18,xoffset:0,yoffset:5,xadvance:14},{id:274,x:398,y:0,width:10,height:18,xoffset:0,yoffset:1,xadvance:11},{id:260,x:408,y:0,width:13,height:18,xoffset:0,yoffset:5,xadvance:13},{id:256,x:421,y:0,width:13,height:18,xoffset:0,yoffset:1,xadvance:13},{id:376,x:434,y:0,width:12,height:18,xoffset:0,yoffset:1,xadvance:12},{id:220,x:446,y:0,width:11,height:18,xoffset:0,yoffset:1,xadvance:12},{id:205,x:457,y:0,width:5,height:18,xoffset:0,yoffset:0,xadvance:4},{id:362,x:462,y:0,width:11,height:18,xoffset:0,yoffset:1,xadvance:12},{id:209,x:473,y:0,width:11,height:18,xoffset:0,yoffset:1,xadvance:12},{id:192,x:484,y:0,width:13,height:18,xoffset:0,yoffset:0,xadvance:13},{id:379,x:497,y:0,width:11,height:18,xoffset:0,yoffset:1,xadvance:11},{id:377,x:508,y:0,width:11,height:18,xoffset:0,yoffset:0,xadvance:11},{id:201,x:519,y:0,width:10,height:18,xoffset:0,yoffset:0,xadvance:11},{id:203,x:529,y:0,width:10,height:18,xoffset:0,yoffset:1,xadvance:11},{id:200,x:539,y:0,width:10,height:18,xoffset:0,yoffset:0,xadvance:11},{id:196,x:549,y:0,width:13,height:18,xoffset:0,yoffset:1,xadvance:13},{id:1062,x:562,y:0,width:13,height:17,xoffset:1,yoffset:5,xadvance:13},{id:93,x:575,y:0,width:5,height:17,xoffset:0,yoffset:4,xadvance:6},{id:91,x:580,y:0,width:5,height:17,xoffset:1,yoffset:4,xadvance:6},{id:1044,x:585,y:0,width:14,height:17,xoffset:0,yoffset:5,xadvance:14},{id:125,x:599,y:0,width:6,height:17,xoffset:0,yoffset:4,xadvance:7},{id:123,x:605,y:0,width:6,height:17,xoffset:1,yoffset:4,xadvance:7},{id:1065,x:611,y:0,width:17,height:17,xoffset:1,yoffset:5,xadvance:18},{id:269,x:628,y:0,width:9,height:16,xoffset:0,yoffset:3,xadvance:10},{id:251,x:637,y:0,width:9,height:16,xoffset:1,yoffset:3,xadvance:10},{id:244,x:646,y:0,width:10,height:16,xoffset:0,yoffset:3,xadvance:11},{id:353,x:656,y:0,width:9,height:16,xoffset:0,yoffset:3,xadvance:9},{id:226,x:665,y:0,width:9,height:16,xoffset:0,yoffset:3,xadvance:10},{id:234,x:674,y:0,width:10,height:16,xoffset:0,yoffset:3,xadvance:10},{id:121,x:684,y:0,width:9,height:15,xoffset:1,yoffset:9,xadvance:10},{id:67,x:693,y:0,width:12,height:15,xoffset:0,yoffset:5,xadvance:12},{id:382,x:705,y:0,width:9,height:15,xoffset:0,yoffset:3,xadvance:9},{id:1057,x:714,y:0,width:12,height:15,xoffset:0,yoffset:5,xadvance:12},{id:71,x:726,y:0,width:13,height:15,xoffset:0,yoffset:5,xadvance:13},{id:281,x:739,y:0,width:10,height:15,xoffset:0,yoffset:8,xadvance:10},{id:113,x:749,y:0,width:15,height:15,xoffset:0,yoffset:8,xadvance:10},{id:112,x:764,y:0,width:10,height:15,xoffset:1,yoffset:8,xadvance:10},{id:1069,x:774,y:0,width:12,height:15,xoffset:0,yoffset:5,xadvance:12},{id:51,x:786,y:0,width:9,height:15,xoffset:0,yoffset:5,xadvance:10},{id:37,x:795,y:0,width:13,height:15,xoffset:0,yoffset:5,xadvance:13},{id:1047,x:808,y:0,width:11,height:15,xoffset:0,yoffset:5,xadvance:11},{id:79,x:819,y:0,width:13,height:15,xoffset:0,yoffset:5,xadvance:13},{id:57,x:832,y:0,width:9,height:15,xoffset:0,yoffset:5,xadvance:10},{id:103,x:841,y:0,width:10,height:15,xoffset:0,yoffset:8,xadvance:11},{id:56,x:851,y:0,width:10,height:15,xoffset:0,yoffset:5,xadvance:10},{id:83,x:861,y:0,width:11,height:15,xoffset:0,yoffset:5,xadvance:11},{id:1088,x:872,y:0,width:10,height:15,xoffset:1,yoffset:8,xadvance:10},{id:54,x:882,y:0,width:9,height:15,xoffset:0,yoffset:5,xadvance:10},{id:263,x:891,y:0,width:9,height:15,xoffset:0,yoffset:4,xadvance:10},{id:1091,x:900,y:0,width:9,height:15,xoffset:1,yoffset:9,xadvance:10},{id:1081,x:909,y:0,width:9,height:15,xoffset:1,yoffset:3,xadvance:10},{id:1054,x:918,y:0,width:13,height:15,xoffset:0,yoffset:5,xadvance:13},{id:1070,x:931,y:0,width:17,height:15,xoffset:0,yoffset:5,xadvance:17},{id:36,x:948,y:0,width:9,height:15,xoffset:0,yoffset:4,xadvance:10},{id:224,x:957,y:0,width:9,height:15,xoffset:0,yoffset:4,xadvance:10},{id:64,x:966,y:0,width:14,height:15,xoffset:0,yoffset:6,xadvance:14},{id:228,x:980,y:0,width:9,height:15,xoffset:0,yoffset:4,xadvance:10},{id:231,x:989,y:0,width:9,height:15,xoffset:0,yoffset:8,xadvance:10},{id:232,x:998,y:0,width:10,height:15,xoffset:0,yoffset:4,xadvance:10},{id:233,x:1008,y:0,width:10,height:15,xoffset:0,yoffset:4,xadvance:10},{id:1073,x:0,y:20,width:10,height:15,xoffset:0,yoffset:4,xadvance:11},{id:235,x:10,y:20,width:10,height:15,xoffset:0,yoffset:4,xadvance:10},{id:237,x:20,y:20,width:5,height:15,xoffset:1,yoffset:4,xadvance:5},{id:238,x:25,y:20,width:8,height:15,xoffset:-1,yoffset:3,xadvance:5},{id:378,x:33,y:20,width:9,height:15,xoffset:0,yoffset:4,xadvance:9},{id:351,x:42,y:20,width:9,height:15,xoffset:0,yoffset:8,xadvance:9},{id:243,x:51,y:20,width:10,height:15,xoffset:0,yoffset:4,xadvance:11},{id:347,x:61,y:20,width:9,height:15,xoffset:0,yoffset:4,xadvance:9},{id:246,x:70,y:20,width:10,height:15,xoffset:0,yoffset:4,xadvance:11},{id:250,x:80,y:20,width:9,height:15,xoffset:1,yoffset:4,xadvance:10},{id:249,x:89,y:20,width:9,height:15,xoffset:1,yoffset:4,xadvance:10},{id:326,x:98,y:20,width:9,height:15,xoffset:1,yoffset:8,xadvance:10},{id:252,x:107,y:20,width:9,height:15,xoffset:1,yoffset:4,xadvance:10},{id:48,x:116,y:20,width:9,height:15,xoffset:0,yoffset:5,xadvance:10},{id:1105,x:125,y:20,width:10,height:15,xoffset:0,yoffset:4,xadvance:10},{id:261,x:135,y:20,width:9,height:15,xoffset:0,yoffset:8,xadvance:10},{id:324,x:144,y:20,width:9,height:15,xoffset:1,yoffset:4,xadvance:10},{id:86,x:153,y:20,width:12,height:14,xoffset:0,yoffset:5,xadvance:12},{id:1061,x:165,y:20,width:12,height:14,xoffset:0,yoffset:5,xadvance:12},{id:257,x:177,y:20,width:9,height:14,xoffset:0,yoffset:5,xadvance:10},{id:76,x:186,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:65,x:196,y:20,width:13,height:14,xoffset:0,yoffset:5,xadvance:13},{id:299,x:209,y:20,width:8,height:14,xoffset:-1,yoffset:5,xadvance:5},{id:239,x:217,y:20,width:7,height:14,xoffset:0,yoffset:4,xadvance:5},{id:1066,x:224,y:20,width:14,height:14,xoffset:0,yoffset:5,xadvance:14},{id:322,x:238,y:20,width:5,height:14,xoffset:0,yoffset:5,xadvance:5},{id:66,x:243,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:11},{id:241,x:254,y:20,width:9,height:14,xoffset:1,yoffset:4,xadvance:10},{id:69,x:263,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:11},{id:68,x:273,y:20,width:12,height:14,xoffset:0,yoffset:5,xadvance:12},{id:1064,x:285,y:20,width:16,height:14,xoffset:1,yoffset:5,xadvance:16},{id:363,x:301,y:20,width:9,height:14,xoffset:1,yoffset:5,xadvance:10},{id:85,x:310,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:12},{id:380,x:321,y:20,width:9,height:14,xoffset:0,yoffset:4,xadvance:9},{id:1063,x:330,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:11},{id:1058,x:341,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:11},{id:92,x:352,y:20,width:6,height:14,xoffset:0,yoffset:5,xadvance:6},{id:223,x:358,y:20,width:10,height:14,xoffset:1,yoffset:5,xadvance:10},{id:70,x:368,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:72,x:378,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:12},{id:90,x:389,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:11},{id:89,x:400,y:20,width:12,height:14,xoffset:0,yoffset:5,xadvance:12},{id:1055,x:412,y:20,width:11,height:14,xoffset:1,yoffset:5,xadvance:12},{id:88,x:423,y:20,width:12,height:14,xoffset:0,yoffset:5,xadvance:12},{id:87,x:435,y:20,width:17,height:14,xoffset:0,yoffset:5,xadvance:17},{id:84,x:452,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:11},{id:1053,x:463,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:12},{id:1052,x:474,y:20,width:13,height:14,xoffset:0,yoffset:5,xadvance:14},{id:1051,x:487,y:20,width:12,height:14,xoffset:0,yoffset:5,xadvance:13},{id:1050,x:499,y:20,width:12,height:14,xoffset:0,yoffset:5,xadvance:12},{id:82,x:511,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:12},{id:49,x:522,y:20,width:6,height:14,xoffset:0,yoffset:5,xadvance:6},{id:80,x:528,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:11},{id:47,x:538,y:20,width:6,height:14,xoffset:0,yoffset:5,xadvance:6},{id:1048,x:544,y:20,width:11,height:14,xoffset:1,yoffset:5,xadvance:12},{id:78,x:555,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:12},{id:77,x:566,y:20,width:13,height:14,xoffset:0,yoffset:5,xadvance:14},{id:275,x:579,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:75,x:589,y:20,width:12,height:14,xoffset:0,yoffset:5,xadvance:12},{id:1046,x:601,y:20,width:18,height:14,xoffset:0,yoffset:5,xadvance:18},{id:1045,x:619,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:11},{id:74,x:629,y:20,width:9,height:14,xoffset:0,yoffset:5,xadvance:9},{id:73,x:638,y:20,width:3,height:14,xoffset:0,yoffset:5,xadvance:4},{id:1043,x:641,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:1042,x:651,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:11},{id:1060,x:662,y:20,width:14,height:14,xoffset:0,yoffset:5,xadvance:14},{id:1059,x:676,y:20,width:11,height:14,xoffset:1,yoffset:5,xadvance:12},{id:1041,x:687,y:20,width:10,height:14,xoffset:1,yoffset:5,xadvance:11},{id:1056,x:697,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:11},{id:1067,x:707,y:20,width:14,height:14,xoffset:1,yoffset:5,xadvance:14},{id:1040,x:721,y:20,width:13,height:14,xoffset:0,yoffset:5,xadvance:13},{id:100,x:734,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:50,x:744,y:20,width:9,height:14,xoffset:0,yoffset:5,xadvance:9},{id:52,x:753,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:53,x:763,y:20,width:9,height:14,xoffset:1,yoffset:5,xadvance:10},{id:1068,x:772,y:20,width:10,height:14,xoffset:1,yoffset:5,xadvance:11},{id:38,x:782,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:108,x:792,y:20,width:3,height:14,xoffset:1,yoffset:5,xadvance:4},{id:107,x:795,y:20,width:9,height:14,xoffset:1,yoffset:5,xadvance:10},{id:105,x:804,y:20,width:3,height:14,xoffset:1,yoffset:5,xadvance:4},{id:104,x:807,y:20,width:9,height:14,xoffset:1,yoffset:5,xadvance:10},{id:63,x:816,y:20,width:9,height:14,xoffset:0,yoffset:5,xadvance:10},{id:35,x:825,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:102,x:835,y:20,width:6,height:14,xoffset:0,yoffset:5,xadvance:6},{id:55,x:841,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:321,x:851,y:20,width:10,height:14,xoffset:0,yoffset:5,xadvance:10},{id:33,x:861,y:20,width:3,height:14,xoffset:1,yoffset:5,xadvance:5},{id:1071,x:864,y:20,width:11,height:14,xoffset:0,yoffset:5,xadvance:12},{id:98,x:875,y:20,width:10,height:14,xoffset:1,yoffset:5,xadvance:10},{id:1097,x:885,y:20,width:16,height:13,xoffset:1,yoffset:9,xadvance:16},{id:59,x:901,y:20,width:3,height:13,xoffset:0,yoffset:9,xadvance:4},{id:116,x:904,y:20,width:8,height:13,xoffset:1,yoffset:6,xadvance:9},{id:1094,x:912,y:20,width:11,height:13,xoffset:1,yoffset:9,xadvance:11},{id:1076,x:923,y:20,width:12,height:13,xoffset:0,yoffset:9,xadvance:12},{id:1079,x:935,y:20,width:9,height:11,xoffset:0,yoffset:8,xadvance:9},{id:1089,x:944,y:20,width:9,height:11,xoffset:0,yoffset:8,xadvance:10},{id:1086,x:953,y:20,width:10,height:11,xoffset:0,yoffset:8,xadvance:11},{id:97,x:963,y:20,width:9,height:11,xoffset:0,yoffset:8,xadvance:10},{id:1077,x:972,y:20,width:10,height:11,xoffset:0,yoffset:8,xadvance:10},{id:101,x:982,y:20,width:10,height:11,xoffset:0,yoffset:8,xadvance:10},{id:111,x:992,y:20,width:10,height:11,xoffset:0,yoffset:8,xadvance:11},{id:115,x:1002,y:20,width:9,height:11,xoffset:0,yoffset:8,xadvance:9},{id:1101,x:1011,y:20,width:10,height:11,xoffset:0,yoffset:8,xadvance:10},{id:1102,x:0,y:35,width:14,height:11,xoffset:1,yoffset:8,xadvance:15},{id:99,x:14,y:35,width:9,height:11,xoffset:0,yoffset:8,xadvance:10},{id:1072,x:23,y:35,width:9,height:11,xoffset:0,yoffset:8,xadvance:10},{id:1080,x:32,y:35,width:9,height:10,xoffset:1,yoffset:9,xadvance:10},{id:42,x:41,y:35,width:10,height:10,xoffset:1,yoffset:5,xadvance:11},{id:1078,x:51,y:35,width:14,height:10,xoffset:0,yoffset:9,xadvance:14},{id:43,x:65,y:35,width:10,height:10,xoffset:0,yoffset:7,xadvance:10},{id:1075,x:75,y:35,width:7,height:10,xoffset:1,yoffset:9,xadvance:7},{id:1103,x:82,y:35,width:10,height:10,xoffset:0,yoffset:9,xadvance:10},{id:1100,x:92,y:35,width:10,height:10,xoffset:1,yoffset:9,xadvance:10},{id:1099,x:102,y:35,width:13,height:10,xoffset:1,yoffset:9,xadvance:14},{id:1098,x:115,y:35,width:13,height:10,xoffset:0,yoffset:9,xadvance:14},{id:1096,x:128,y:35,width:14,height:10,xoffset:1,yoffset:9,xadvance:15},{id:1095,x:142,y:35,width:9,height:10,xoffset:0,yoffset:9,xadvance:10},{id:1093,x:151,y:35,width:10,height:10,xoffset:0,yoffset:9,xadvance:10},{id:1090,x:161,y:35,width:10,height:10,xoffset:0,yoffset:9,xadvance:10},{id:1087,x:171,y:35,width:9,height:10,xoffset:1,yoffset:9,xadvance:10},{id:1085,x:180,y:35,width:9,height:10,xoffset:1,yoffset:9,xadvance:10},{id:1084,x:189,y:35,width:12,height:10,xoffset:1,yoffset:9,xadvance:13},{id:1083,x:201,y:35,width:10,height:10,xoffset:0,yoffset:9,xadvance:11},{id:1082,x:211,y:35,width:9,height:10,xoffset:1,yoffset:9,xadvance:10},{id:58,x:220,y:35,width:3,height:10,xoffset:0,yoffset:9,xadvance:3},{id:119,x:223,y:35,width:14,height:10,xoffset:0,yoffset:9,xadvance:14},{id:120,x:237,y:35,width:10,height:10,xoffset:0,yoffset:9,xadvance:10},{id:1074,x:247,y:35,width:10,height:10,xoffset:1,yoffset:9,xadvance:10},{id:122,x:257,y:35,width:9,height:10,xoffset:0,yoffset:9,xadvance:9},{id:114,x:266,y:35,width:6,height:10,xoffset:1,yoffset:8,xadvance:6},{id:109,x:272,y:35,width:14,height:10,xoffset:1,yoffset:8,xadvance:15},{id:110,x:286,y:35,width:9,height:10,xoffset:1,yoffset:8,xadvance:10},{id:117,x:295,y:35,width:9,height:10,xoffset:1,yoffset:9,xadvance:10},{id:118,x:304,y:35,width:10,height:10,xoffset:0,yoffset:9,xadvance:10},{id:44,x:314,y:35,width:3,height:6,xoffset:0,yoffset:16,xadvance:4},{id:61,x:317,y:35,width:10,height:6,xoffset:0,yoffset:9,xadvance:10},{id:39,x:327,y:35,width:2,height:5,xoffset:0,yoffset:5,xadvance:3},{id:34,x:329,y:35,width:5,height:5,xoffset:0,yoffset:5,xadvance:6},{id:94,x:334,y:35,width:9,height:4,xoffset:0,yoffset:5,xadvance:9},{id:775,x:343,y:35,width:3,height:3,xoffset:-6,yoffset:4,xadvance:0},{id:46,x:346,y:35,width:3,height:3,xoffset:0,yoffset:16,xadvance:4},{id:45,x:349,y:35,width:5,height:2,xoffset:0,yoffset:11,xadvance:6},{id:95,x:354,y:35,width:10,height:2,xoffset:0,yoffset:20,xadvance:10},{id:32,x:0,y:0,width:0,height:0,xoffset:0,yoffset:20,xadvance:5}]})}(t.fonts||(t.fonts={}))}(GAME||(GAME={})),(GAME||(GAME={})).GAMECONFIG={publisher:"gd",gameId:"soccerboy",gameVersion:"1.0.0",defaultLocale:"autodetect",customData:{gameId:"a0abfb88584744f9bc455442eee01973",gaTrackingCode:"UA-132892696-1",gaPageName:"soccershoot3d",infoPopup:{targetUrl:"https://gamebuilt.com/games.html",bgImgSrc:"https://gamebuilt.com/ext/gd/infopopup_300x200.png",closeBtnImgSrc:"https://gamebuilt.com/ext/gd/close_30x30.png",closeBtnTop:"5px",closeBtnLeft:"5px"}},gameCustom:{splashDuration:3e3},gsUrl:"gs.snapgame.io/ship-01",serverUrl:"hip.snapgame.io",resourcesUrl:"games.snapgame.io"},function(h){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(t){e.prototype.update.call(this,t)},t.prototype.onShow=function(){var t=new THREE.Scene;(h.engine.scene=t).background=new THREE.Color(16777215);var e=h.engine.camera;e.position.set(2.5,3.5,8),e.lookAt(2,2.5,0);var i=new THREE.DirectionalLight(16777215);i.position.set(3,3,-1),t.add(i);var n=new THREE.AmbientLight(16777215);t.add(n);for(var r=0,o=h.BallsManager.getAll(),s=0;s<5;s++)for(var a=0;a<4;a++){var l=o[r];this.addModel(l,t,s,a),r++}},t.prototype.addModel=function(t,e,i,n){var r=h.ModelParser.get().getBall(t.name,!1);r.position.set(0,0,0);var o=(new THREE.Box3).setFromObject(r),s=.4/((o.max.x-o.min.x)/2);r.scale.multiplyScalar(s),r.position.x=n,r.position.y=i,e.add(r),"height"==t.name&&r.rotateZ(-Math.PI/2),"smiley"==t.name&&r.rotateZ(+Math.PI/2),"football"==t.name&&r.scale.multiplyScalar(.8)},t.prototype.onHide=function(){e.prototype.onHide.call(this)},t}(plume.GuiScene);h.BallPreviewScene=t}(GAME||(GAME={})),function(o){var t=function(n){function r(t){var e=n.call(this)||this;e.levelUpgrade=t,e.fpsCount=!1,e.fpsCountDuration=0,e.fps=0;var i=e;return setTimeout(function(){i.fpsCount=!0,i.fpsCountDuration=performance.now()},50),setTimeout(function(){i.fpsCount=!1,i.fpsCountDuration=performance.now()-i.fpsCountDuration,i.adjustQuality()},2050),r.firstBuild&&(r.firstBuild=!1,e.firstInit()),e}return __extends(r,n),r.prototype.update=function(t){n.prototype.update.call(this,t),o.util.updateLogger(),this.fpsCount&&this.fps++,null!=this.gameplay&&this.gameplay.update(t)},r.prototype.onShow=function(){var e=this;(this.scene=new THREE.Scene,this.engine=o.engine,this.engine.scene=this.scene,this.hud=new o.Hud(this.container),this.gameplay=new o.Gameplay(this.hud),this.gameplay.restart(),this.renderFn=function(t){e.gameplay.render(t)},o.game.engine.addRenderable(this.renderFn,!0,this),r.firstPlayerLoad&&(r.firstPlayerLoad=!1,o.Player.onLoaded(function(){e.onFirstPlayerLoad()})),this.levelUpgrade)&&(this.hud.showAndSelectNewBall()&&this.hud.showConfetti())},r.prototype.onHide=function(){n.prototype.onHide.call(this),this.hud.destroy(),this.gameplay.destroy(),o.engine.removeRenderable(this.renderFn)},r.prototype.adjustQuality=function(){var t=Math.round(this.fps/(this.fpsCountDuration/1e3));(o.logger.debug("FPS bench: "+t),t<45)&&(1<o.engine.renderer.getPixelRatio()&&(o.logger.debug("Reducing quality"),o.engine.renderer.setPixelRatio(1)))},r.prototype.firstInit=function(){},r.prototype.onFirstPlayerLoad=function(){var t=Date.now()-o.Player.getTime();if(!((t=Math.round(t/36e5))<=0)){var e=o.Player.getOffline(),i=o.gameplay.getOfflineEarnings(e,t);if(!(i<=0))new o.WinPopup(i,o.Ads.canShowRv(),!0,function(){}).show()}},r.firstBuild=!0,r.firstPlayerLoad=!0,r}(plume.GuiScene);o.MenuScene=t}(GAME||(GAME={})),function(o){var t=function(r){function t(){var t=r.call(this)||this,e=t;CANNON.Shape.printLog=!1,o.engine=plume.Engine.get(),o.gui=o.engine.game.getGui(),o.coinsChangeListener=new plume.Handler,o.loader=t.loader;var i=new plume.CannonSimulation;i.useCustomMatrixCollision(),o.game.simulation=i,o.game.simulation.running=!0,o.engine.renderer.gammaOutput=!0;var n=Date.now();o.logger.debug("Using seed: "+n),o.random.init(n),t.factory={geometryProcessor:function(t,e){return t.computeVertexNormals(),t},materialFactory:function(t,e){return delete e.metalness,delete e.roughness,null==e.normalMap?new THREE.MeshLambertMaterial(e):new THREE.MeshPhongMaterial(e)}},o.Ads.load();return t.load2dAssets([{type:"spritesheet",name:"game-0",file:"game/assets/images/game-0.png",atlas:"game/assets/images/game-0.json"}]),t.load3dAssets(),o.Player.load(),o.Player.onLoaded(function(){e.playerLoaded=!0}),o.SoundManager.get(),t}return __extends(t,r),t.prototype.areModelsLoaded=function(){return r.prototype.areModelsLoaded.call(this)&&this.playerLoaded},t.prototype.goToGame=function(){(new o.ModelParser).read(),(new o.FX).read(),(new o.Physics).read(),o.Materials.initialize(),o.gui.switchScene(new o.MenuScene(!1))},t.prototype.load3dAssets=function(){var e=this;e.playerLoaded=!1;var t=function(t){t.factory=e.factory};o.loader.loadGltf("game/assets/export/SoccerMap.gltf","Map",t),o.loader.loadGltf("game/assets/export/SoccerElements.gltf","Elements",t),o.loader.loadGltf("game/assets/export/SoccerBalls.gltf","Balls",t),o.loader.loadGltf("game/assets/export/Sky.gltf","Sky",t)},t.prototype.onAssetsLoaded=function(){plume.FontLoader.loadAll(o.fonts.fonts)},t}(ship3.S3SplashScene);o.SplashScene=t}(GAME||(GAME={})),function(t){var e=function(){function i(){}return i.load=function(){this._startTime=performance.now(),this._nextAds=this._startTime},i.canShowIs=function(){return!(performance.now()<=this._nextAds)&&t.shipi.adsManager.canShowInterstitial()},i.onShowIs=function(){this._nextAds=performance.now()+3e4},i.canShowRv=function(){return t.shipi.adsManager.canShowRewardedVideo()},i.showRv=function(e){this.canShowRv()?t.shipi.adsManager.showRewardedVideo(function(t){e(t)}):e(!1)},i.showIs=function(e){this.canShowIs()?t.shipi.adsManager.showInterstitial(function(t){i.onShowIs(),e(t)}):e(!1)},i._startTime=0,i._nextAds=0,i}();t.Ads=e}(GAME||(GAME={})),function(m){var y,t,g,e,v,i;(t=y=m.MapIds||(m.MapIds={})).Chuncks="chuncks",t.Base="base",t.Forcemeter="Forcemeter",t.Homebase="homebase",t.Physics="Physics",t.DirectionalLight="DirectionalLight",(e=g=m.ElementIds||(m.ElementIds={})).Character="Character",e.Ball="Ball",e.BallSoccerBall="ball_soccerball",e.BallBasketBall="ball_basketball",e.BallBeachBall="ball_beachball",e.BallBowlingBall="ball_bowlingball",e.BallTomato="ball_tomato",(i=v=m.PlayerAnims||(m.PlayerAnims={})).Kick="Goalkeeper Drop Kick",i.Idle="Idle",i.Victory="Victory Idle";var n=function(){function f(){this._modelByName=new plume.HashMap,this._ballByName=new plume.HashMap,this._playerAnims=new plume.HashMap,this._clouds=[],f._INST=this}return f.get=function(){return this._INST},f.prototype.read=function(){var n=this,r=m.engine.loader.getModel("Map"),t=Object.keys(y);t.forEach(function(t){var e=y[t],i=r.scene.getObjectByName(e);n._modelByName.put(e,i)});var e=this.getModel(y.Chuncks,!1),i=e.children[4],o=e.children[2],s=i.clone(),a=o.clone();s.position.z+=280,a.position.z+=700,e.children.splice(6,0,s,a);for(var l=0;l<e.children.length;l++){var h=e.children[l];plume.SceneUtils.flatten(h)}m.ConstantDyn.ChunkOffset=140*e.children.length;var u=this.getModel(y.Base,!1);plume.SceneUtils.flatten(u);var c=m.engine.loader.getModel("Elements");if((t=Object.keys(g)).forEach(function(t){var e=g[t],i=c.scene.getObjectByName(e);n._modelByName.put(e,i)}),null!=c.animationsRelatives&&0<c.animationsRelatives.length)for(l=0;l<c.animationsRelatives.length;l++){var p=c.animationsRelatives[l];p.clip.optimize(),this._playerAnims.put(p.clip.name,p),m.logger.debug("loading anim "+p.clip.name)}m.engine.loader.getModel("Sky").scene.traverse(function(t){t instanceof THREE.Mesh&&0==t.name.indexOf("cloud")&&n._clouds.push(t)});var d=f.get().getPlayerAnim(v.Kick);m.ConstantDyn.BallLaunchDuration=.53*d.clip.duration,m.engine.loader.getModel("Balls").scene.getObjectByName("Balls").children.forEach(function(t){n._ballByName.put(t.name,t)})},f.prototype.getModel=function(t,e){var i=this._modelByName.get(t);return e&&(i=i.clone()),i},f.prototype.getBall=function(t,e){var i=this._ballByName.get(t);return e&&(i=i.clone()),i},f.prototype.getCloud=function(){return plume.Collections.one(this._clouds).clone()},f.prototype.getPlayerAnim=function(t){return this._playerAnims.get(t)},f}();m.ModelParser=n}(GAME||(GAME={})),function(i){var t=function(){function t(){}return t.getAll=function(){return this.ballsDef},t.selectLast=function(){var t=i.Player.getCurrentLevel()-1;if(t<this.ballsDef.length){var e=this.ballsDef[t];return this.setCurrent(e),!0}return!1},t.setCurrent=function(t){var e=this.ballsDef.indexOf(t);i.Player.setBall(e),i.Player.save(),this.changeHandler.fire(t)},t.getCurrent=function(){var t=i.Player.getBall();return t>=this.ballsDef.length&&(t=0),this.ballsDef[t]},t.isUnlocked=function(t){var e=i.Player.getCurrentLevel();return this.ballsDef.indexOf(t)<e},t.unlock=function(t){},t.changeHandler=new plume.Handler,t.ballsDef=[{name:"soccer",text:"SoccerBall"},{name:"beach",text:"BeachBall"},{name:"basket",text:"BasketBall"},{name:"candy",text:"Candy"},{name:"tennis",text:"TennisBall"},{name:"smiley",text:"Smiley"},{name:"golf",text:"GolfBall"},{name:"volley",text:"VolleyBall"},{name:"height",text:"HeightBall"},{name:"football",text:"FootBall"},{name:"disco",text:"Disco"},{name:"america",text:"America"},{name:"xmas",text:"Xmas"},{name:"halloween",text:"Halloween"},{name:"yingyang",text:"Yingyang"},{name:"earth",text:"Earth"},{name:"asteroid",text:"Asteroid"},{name:"bomb",text:"Bomb"},{name:"tomato",text:"Tomato"},{name:"rocket",text:"Rocket"}],t}();i.BallsManager=t}(GAME||(GAME={})),function(t){var e=function(){function t(){}return t.ChunkOffset=140,t.BallLaunchDuration=3.5,t.BallMass=.1,t.BallStrength=6,t.BallBounciness=.8,t.BallLinearVelocityDamping=.1,t.BallAngularDamping=.8,t.BallRebounceFactor=2,t}();t.ConstantDyn=e,t.themes=[{name:"morning",skyTop:16746496,skyBottom:591165,lightTop:16746496,lightBottom:591165,ambient:1,directional:1},{name:"dark",skyTop:3391,skyBottom:3819127,lightTop:3391,lightBottom:3819127,ambient:1,directional:1},{name:"blue",skyTop:464207,skyBottom:14739199,lightTop:7836415,lightBottom:14739199,ambient:1,directional:1},{name:"orange",skyTop:16752647,skyBottom:30719,lightTop:16768424,lightBottom:16775146,ambient:1,directional:1},{name:"neutre",skyTop:30719,skyBottom:30719,lightTop:16777215,lightBottom:16777215,ambient:1,directional:1}],t.WHITE=new THREE.Color(16777215)}(GAME||(GAME={})),function(n){var t;(t=n.FXNames||(n.FXNames={})).GodrayParticles="GodrayParticles",t.HitParticles="HitParticles",t.PerfectHitParticles="PerfectHitParticles",t.PerfectHitParticles0="PerfectHitParticles0",t.PerfectHitParticles1="PerfectHitParticles1",t.JumpParticle="JumpParticle",t.JumpParticle0="JumpParticle0";var e=function(){function t(){this._fx=new plume.HashMap,t._INST=this}return t.prototype.read=function(){for(var t=n.engine.loader.getModel("Elements"),e=0;e<t.particles.length;e++){var i=t.particles[e];this._fx.put(i.name,i.parent)}},t.get=function(){return this._INST},t.getFX=function(t){var e=this.get()._fx.get(t);return{node:e=e.clone(),emitter:e.children[0]}},t}();n.FX=e}(GAME||(GAME={})),function(t){t.geti18n=function(t,e){return plume.I18N.get(t,e)},t.geti18nPlural=function(t,e){return plume.I18N.getPlural(t,e)}}(GAME||(GAME={})),function(s){var t;(t=s.factory||(s.factory={})).newContainer=function(t){return void 0===t&&(t=!0),t?new plume.Container(s.game.bounds.width,s.game.bounds.height):new plume.Container},t.newText=function(t,e){return void 0===e&&(e=80),e<=20?new plume.BitmapText(t,"text20",e,!0):new plume.BitmapText(t,"text",e,!0)},t.newTextArial=function(t,e,i,n){void 0===e&&(e=80),void 0===i&&(i=0);var r=null==n?"Arial":n;return new plume.Text(t,r,e,i)},t.newRectangle=function(t,e,i){var n=new plume.Graphics(t,e);return n.beginFill(i),n.drawRect(0,0,t,e),n.endFill(),n},t.newDebugBorder=function(t,e,i){var n=new plume.Graphics(t,e);return n.beginStroke(2,i),n.drawRect(0,0,t,e),n.endStroke(),n},t.newButton=function(t,e,i){var n=new plume.Graphics(t,e);n.beginFill(i),n.drawRoundedRect(0,0,t,e,10),n.endFill();var r=plume.Colors.getRgb(i),o=plume.Colors.fromRgb(.2*r[0],.2*r[1],.2*r[2]),s=plume.Colors.fromRgb(r[0]+.2*(255-r[0]),r[1]+.2*(255-r[1]),r[2]+.2*(255-r[2])),a=new plume.Graphics(t,e);a.beginFill(s),a.drawRoundedRect(0,0,t,e,10),a.endFill();var l=new plume.Graphics(t,e);l.beginFill(o),l.drawRoundedRect(0,0,t,e,10),l.endFill();var h=new plume.ImageButtonStyle(n,l,a);return new plume.ImageButton(h)},t.newRoundRect=function(t,e,i,n,r){var o;return(o=null!=r?(r.clear(),r):new plume.Graphics(t,e)).beginFill(i),o.drawRoundedRect(0,0,t,e,n),o.endFill(),o},t.newRoundButtonIcon=function(t,e,i,n){var r=new plume.Container(t,e),o=new plume.Graphics(t,e);return o.beginFill(i),o.drawRoundedRect(0,0,t,e,10),o.endFill(),r.addChild(o),r.addChild(n),s.layout.centerOnXYInParent(n),r}}(GAME||(GAME={})),function(t){(t.tween||(t.tween={})).blink=function(t){var e=plume.TweenManager.get().create(t,"blink");e.to({alpha:.2},750,plume.easing.easeInQuad),e.to({alpha:1},750,plume.easing.easeOutQuad),e.delay(450),e.repeat(-1),e.start(),t.detachListener.once(function(){e.stop()})}}(GAME||(GAME={})),function(t){plume.I18N.setAvailableLocales(["en","fr"]),plume.I18N.setDefaultLocale("en");plume.I18N.registerTranslation("fr",{TapToStart:"Toucher pour commencer",TapToContinue:"Toucher pour continuer",CollectN:"Récupérer ${n}",DoubleN:"Doubler ${n}",ReachNToLevelUp:"Atteint {n} metres.",Upgrade:"Booster",YouEarnOffline:"Tu as gagné\n${n}\npendant ton absence.",YouEarnThisRun:"Tu as gagné\n${n}\npour ce lancé.",Perfect:"Parfait!",StrengthN:"Force ({n})",StrengthDescN:"Les balles sont frappées avec {n}% de force en plus.",SpeedN:"Vitesse ({n})",SpeedDescN:"Les balles volent {n}% plus vite.",BounceN:"Rebond ({n})",BounceDescN:"Les balles rebondissent {n}% de plus.",OfflineN:"Revenus ({n})",OfflineDescN:"Les revenus sont {n}% plus important.",ContinueFromHere:"Continuer depuis ici?",Continue:"Continuer",BallsDiscovered:"Balles découvertes"});plume.I18N.registerTranslation("en",{TapToStart:"Tap to start",TapToContinue:"Tap to continue",CollectN:"Collect ${n}",DoubleN:"Double ${n}",ReachNToLevelUp:"Reach {n} meters to level up.",Upgrade:"Upgrade",YouEarnOffline:"You earn\n${n}\nwhile offline.",YouEarnThisRun:"You earn\n${n}\nthis run.",Perfect:"Perfect!",StrengthN:"Strength ({n})",StrengthDescN:"Balls are hit {n}% harder",SpeedN:"Speed ({n})",SpeedDescN:"Balls fly {n}% faster",BounceN:"Bounciness ({n})",BounceDescN:"Balls bounce {n}% further",OfflineN:"Offline earning ({n})",OfflineDescN:"Offline earning are {n}% higher",ContinueFromHere:"Continue from here?",Continue:"Continue",BallsDiscovered:"Discovered Balls"})}(GAME||(GAME={})),function(i){var t,n;t=i.util||(i.util={}),n=0,t.updateLogger=function(){n++},t.logThreshold=function(t,e){n%e==0&&i.logger.debug(t)}}(GAME||(GAME={})),function(t){var e=function(){function t(){}return t.initialize=function(){},t.getKey=function(t,e,i){return t.uuid+"-"+e+"-"+i},t.getCachedMaterial=function(t,i,n){var e=this.getKey(t,i,n),r=this.cache.get(e);if(null!=r)return r;var o=t.clone();return null==o.defines&&(o.defines={}),o.defines.BENDING=n?1:0,o.defines.INSTANCED=i?1:0,o.isShaderMaterial=!0,o.onBeforeCompile=function(t){var e=[THREE.ShaderChunk.common,"attribute vec3 instancePosition;","attribute vec4 instanceQuaternion;","attribute vec3 instanceScale;","vec3 applyTRS( vec3 position, vec3 translation, vec4 quaternion, vec3 scale ) {","    position *= scale;","    position += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );","    return position + translation;","}"];t.vertexShader=t.vertexShader.replace("#include <common>",e.join("\n")),i&&(t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",["    vec3 transformed = applyTRS( position.xyz, instancePosition, instanceQuaternion, instanceScale );"].join("\n"))),n&&(t.vertexShader=t.vertexShader.replace("#include <project_vertex>",["  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","  vec4 worldP = modelMatrix * vec4(transformed, 1.0);","  float distance = abs(worldP.z - cameraPosition.z);","  float bending = smoothstep(0.0, 10000.0, distance);","  bending = clamp(bending, 0.0, 1.0);","  worldP.y = worldP.y - bending * 10000.0;","  gl_Position = projectionMatrix * viewMatrix * worldP;"].join("\n")))},this.cache.put(e,o),o},t.refresh=function(){},t.cache=new plume.HashMap,t}();t.Materials=e}(GAME||(GAME={})),function(h){var u=[],t=function(){function t(){this.worldPosition=new THREE.Vector3,this.worldScale=new THREE.Vector3,this.worldRotation=new THREE.Quaternion,t._INST=this}return t.prototype.read=function(){var t=h.engine.loader.getModel("Map"),e=h.ModelParser.get().getModel(h.MapIds.Physics,!1).getObjectByName("Meshes");h.shapeManager=new plume.CannonCachedShapeManager,h.shapeManager.readShapesFromGltf(t,e)},t.prototype.start=function(t){this.gameplay=t,this.simulation=h.game.simulation;var e=this.simulation.getWorld();e.defaultContactMaterial.friction=.4,e.defaultContactMaterial.restitution=.3,this.addCorridor();for(var i=0;i<this.gameplay.chunks.length;i++)this.gameplay.chunks[i].registerPhysics(this)},t.prototype.update=function(t){},t.prototype.destroy=function(){this.simulation.removeRigidBodies()},t.prototype.addCorridor=function(){var t=h.vpool.q();t.setFromAxisAngle(h.LEFT,-Math.PI/2);var e=plume.CannonBodyBuilder.newPlane(t);e.position.y=-.01,this.simulation.addRigidBody(e,null,!1,2,1),t.setFromAxisAngle(h.UP,-Math.PI/2);var i=plume.CannonBodyBuilder.newPlane(t);i.position.x=130,this.simulation.addRigidBody(i,null,!1,2,1),t.setFromAxisAngle(h.UP,+Math.PI/2);var n=plume.CannonBodyBuilder.newPlane(t);n.position.x=-130,this.simulation.addRigidBody(n,null,!1,2,1)},t.prototype.createBodies=function(t){if("Plane"==t.name)return u;if("flower_mesh"==t.name)return u;var e=[],i=t.getWorldPosition(this.worldPosition),n=t.getWorldQuaternion(this.worldRotation);t.getWorldScale(this.worldScale);if(t instanceof h.InstancedMesh)for(var r=h.vpool.v3(),o=h.vpool.v3(),s=h.vpool.q(),a=0;a<t.numInstances;a++){t.get(a,r,s,o),r.add(i);var l=new CANNON.Body({mass:0});h.shapeManager.addShapesToBody(l,t,o),this.simulation.updatePositionAndRotation(l,r,s),e.push(l)}else{l=new CANNON.Body({mass:0});h.shapeManager.addShapesToBody(l,t),this.simulation.updatePositionAndRotation(l,i,n),e.push(l)}return e},t.get=function(){return this._INST},t.ShapeMaterial=new THREE.MeshBasicMaterial({color:16711680,wireframe:!0}),t}();h.Physics=t}(GAME||(GAME={})),function(t){var e=function(){function t(){t.INSTANCE=this,t.audioManager=plume.AudioManager.get()}return t.load=function(){this.audioManager.loadSounds([{type:"soundsheet",name:"sounds",file:"game/assets/sounds/sounds.json"}],function(){null!=(t.sound=plume.AudioManager.get().getSoundSprite("sounds"))&&(t.ready=!0)})},t.get=function(){if(null==t.INSTANCE)new t;return t.INSTANCE},t.play=function(t,e){this.ready&&this.enabled&&this.sound.play(t,function(){e&&e()})},t.stopMusic=function(){0!=this.musicid&&(this.sound.stop(this.musicid),this.musicid=0)},t.playMusic=function(t){this.ready&&this.enabled&&(0!=this.musicid&&(this.sound.stop(this.musicid),this.musicid=0),this.musicid=this.sound.play(t,function(){}),this.sound.setVolume(.5,this.musicid),this.sound.loop(!0,this.musicid))},t.stopEngine=function(){0!=this.motorid&&(this.sound.stop(this.motorid),this.motorid=0,this.curEngineName=null)},t.updateEngineSound=function(t,e,i){null==this.curEngineName&&(this.curEngineName="engine",this.motorid=this.sound.play(this.curEngineName,function(){}),this.sound.loop(!0,this.motorid),this.sound.setVolume(.3,this.motorid)),(null==t||isNaN(t))&&(t=0);var n=plume.Mathf.map(t,0,400,.5,4),r=plume.Mathf.lerp(this.engineLastRate,n,.1);this.engineLastRate=r,this.sound.rate(r,this.motorid)},t.ready=!1,t.enabled=!0,t.curEngineName=null,t.engineLastRate=.5,t.currentGear=1,t.lastGearChanged=performance.now(),t.musicid=0,t.motorid=0,t}();t.SoundManager=e}(GAME||(GAME={})),function(o){var t=function(){function t(t){this.camera=t,this.duration=1,this.timeLeft=0}return t.prototype.play=function(){console.log("start travelling"),o.game.addUpdatable(this),this.timeLeft=this.duration},t.prototype.stop=function(){o.game.removeUpdatable(this),console.log("stop travelling")},t.prototype.update=function(t){var e=t/1e3;this.timeLeft-=e,this.timeLeft<0&&(this.timeLeft=0);var i=(1-this.timeLeft)/this.duration,n=this.moveCurve.getPointAt(i,o.vpool.v3()),r=this.lookatCurve.getPointAt(i,o.vpool.v3());this.camera.position.copy(n),this.camera.lookAt(r),this.timeLeft<=0&&this.stop()},t.prototype.useLineCurve=function(t,e,i){var n=new THREE.LineCurve3(e,i);t?this.moveCurve=n:this.lookatCurve=n},t}();o.Travelling=t}(GAME||(GAME={})),(GAME||(GAME={})).getReadable=function(t,e){return void 0===e&&(e=2),"["+t.x.toFixed(e)+","+t.y.toFixed(e)+","+t.z.toFixed(e)+"]"},function(t){(t.utils||(t.utils={})).ensureGeometry=function(t){return t instanceof THREE.Geometry?t:(new THREE.Geometry).fromBufferGeometry(t)}}(GAME||(GAME={})),function(t){var e;(e=t.collections||(t.collections={})).one=function(t){return t[Math.floor(Math.random()*t.length)]},e.remove=function(t,e){var i=t.indexOf(e);return 0<=i&&(t.splice(i,1),!0)}}(GAME||(GAME={})),function(t){t.UP=new THREE.Vector3(0,1,0),t.LEFT=new THREE.Vector3(1,0,0),t.FORWARD=new THREE.Vector3(0,0,1)}(GAME||(GAME={})),function(a){!function(t){var i=[],n=[];function e(t,e){t.push(0),t.push(e);for(var i=e,n=0;n<=100;n++){var r=i+i/2;i=r,t.push(Math.round(r))}}function r(t,e){t.push(1),t.push(e);for(var i=e,n=0;n<=100;n++){var r=i*e;i=r,t.push(Math.round(1e3*r)/1e3)}}function o(t){return t<2?0:5*(t-1)/100}function s(t,e){return 1+e*(t=plume.Mathf.clamp(t,0,100))}e(i,25),e(n,50),r([],1.1),r([],1.05),t.getUpgradeCost=function(t){var e=a.Player.getSkillLevel(t);return e+=1,e=plume.Mathf.clamp(e,0,100),3==t?n[e]:i[e]},t.getGoalByLevel=function(t){return t<=1?500:t<=2?1e3:t<=3?1500:t<=4?2250:1e3*(t-2)},t.getLevelByDistance=function(t){return t<500?1:t<1e3?2:t<1500?3:t<2250?4:Math.floor(t/1e3)+3},t.getCoinBonusByLevel=o,t.getCoinsWin=function(t,e){var i=.6*e,n=o(t);return Math.round(i+i*n)},t.getBonusFactor=s,t.getOfflineEarnings=function(t,e){e=plume.Mathf.clamp(e,1,72);var i=Math.round(100*Math.log2(1+e)),n=s(t,1.2);return Math.round(i*n)}}(a.gameplay||(a.gameplay={}))}(GAME||(GAME={})),function(e){var t=function(){function t(t){this._removeContainer=!0,this._particles=[],this._fired=!1,this.loop=0,this._destroyed=!1,this._removeContainer=null!=t?(this._ctn=t,!1):(this._ctn=new e.Container,!0)}return Object.defineProperty(t.prototype,"container",{get:function(){return this._ctn},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.startTime=performance.now(),e.Game.get().addUpdatable(this)},t.prototype.update=function(t){this.deltaTime=t,this.ellapsedTime=performance.now()-this.startTime;var e=this.emit();if(null==e)this._updateParticules(t),this._particles.length<=0&&this.destroy();else{this._updateParticules(t);for(var i=0;i<e.length;i++){var n=e[i];n.start(),this._particles.push(n),this._ctn.addChild(n.object)}}this.loop++},t.prototype._updateParticules=function(t){for(var e=this._particles.length-1;0<=e;e--){var i=this._particles[e];i.terminated?this._particles.splice(e,1):i.update(t)}},t.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,e.Game.get().removeUpdatable(this),this._removeContainer&&this._ctn.removeSelf(),this.onDestroyed&&this.onDestroyed())},t}();e.Particle2dEmitter=t}(plume||(plume={}));